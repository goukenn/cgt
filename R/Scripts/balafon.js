//author: C.A.D BONDJE DOUE
//libname:balafon.js
//version:3.2
//copyright: igkdev @ 2013 - 2018
//license: //igkdev.com/balafon/balafonjs/license
(function(window){"use strict";var m_scriptTag=null;var yes=!0;var no=false;var readyFunc=[];var m_readyGlobalFunc=[];var m_tag_obj=[];var m_ready_calling=false;var m_scriptNode=null;var __nsigk=null;var sm_regEventContext=new Array();var m_attribs={};var IGK_UNDEF="undefined";var IGK_FUNC="function";var IGK_CLASS="class";var IGK_OBJECT="object";var RZ_TIMEOUT=200;var __eventObjectManager=null;var __libName="BalafonJS";var __version="4.0.1.0310";var __author="C.A.D. BONDJE DOUE";var __lang=[];var __igk_settings={nosymbol:0 };var m_LibScript="";var __debug_z=0;var m_provider=['webkit','ms','moz','o'];var _rgx={attribs:/([^\s]+)\s*=\s*(((")([^"]*)("))|((')([^']*)(')))/g,ff:/Firefox\/([0-9]+\.[0-9]+)/,ios:/ / };__lang[0xEA001]="failed to transform xml with xsl . {0}";function __init_console(){__debug_z=$igk("#debug-z").first();if(__debug_z){var d=__igk_settings["console"];for(var i=0;i<d.length;i++){var dv=__debug_z.add('div');switch(d[i].t){case-1:dv.addClass('igk-danger');break;case 1:dv.addClass('igk-info');default:break;}dv.setHtml(d[i].m);}}delete(__igk_settings["console"]);};if(typeof(window.console)==IGK_UNDEF){window.console={error:function(m){__debug_z=__debug_z? __debug_z:$igk("#debug-z").first();if(__debug_z){__debug_z.add('div').addClass("igk-danger").setHtml(m);}else{var c=__igk_settings["console"]||[];c.push({t:-1,m:m});__igk_settings["console"]=c;}}};m_readyGlobalFunc.push(__init_console);}if(typeof(console.debug)==IGK_UNDEF){console.debug=function(m){__debug_z=__debug_z? __debug_z:$igk("#debug-z").first();if(__debug_z){__debug_z.add('div').addClass("igk-info").setHtml(m);}else {var c=__igk_settings["console"]||[];c.push({t:1,m:m});__igk_settings["console"]=c;}};}function __dom_innerHTML(i){if("innerHTML" in i)return i.innerHTML;if("nodeType" in i){var k=0;var s="";return s;}return "/!\\ NotSupported";}function igk_object(){};function igk_class(){};igk_class.prototype=new igk_object();function igk_namespace(){};igk_namespace.prototype=new igk_object();function igk_is_string(t){return typeof(t)=='string';};function igk_is_notdef(t){return typeof(t)==IGK_UNDEF;};function igk_is_object(t){return typeof(t)=='object';};function igk_reg_tag_obj(n,p){if(m_tag_obj[n]){m_tag_obj[n]=p;}else{m_tag_obj[n]=p;m_tag_obj.push({n:n,data:p});}};function igk_stop_event(ev){ev.preventDefault();ev.stopPropagation();}function igk_select_exp(p){var m_items=[];function loader(t){m_items.push(t);}var m=new RegExp("[ ]?[\.# ]{0,1}[^\.# ]+","ig");p.replace(m,loader);var q={pattern:p,getCount:function(){return m_items.length;},check:function(item,offset){for(var i=offset;i<m_items.length;i++){var p=m_items[i];switch(p[0]){case ".":if(!igk_item_match_class(p.substring(1),item)){return !1;}break;case "#":if(item.id !=p.substring(1)){return !1;}break;case " ":if(item.tagName.toLowerCase()!=p.substring(1)){return !1;}}}return !0;},select:function(selector,item){if(!item)return null;var pk=null;var v_it=null;var b=false;var depth=false;function __select(pk){if(!b){var sq=$igk(item).select(pk);if(sq.getCount()>0){selector.load(sq);}}else{var isel=null;if(depth){isel=selector.select(pk);}else{isel=selector.select('?'+pk);}selector.clear();selector.load(isel);}b=true;}for(var j=0;j<m_items.length;j++){v_it=null;pk=m_items[j];switch(pk[0]){case ".":case "#":__select(pk);continue;case ' ':while((pk=pk.substring(1))&&(pk[0]==' ')){}if(pk){depth=!0;__select(pk);depth=false;}break;case "$":console.debug("is dollar error. not implement");break;default:break;}}if(!b){var v_it=item.getElementsByTagName(p);if(v_it){for(var i=0;i<v_it.length;i++){var s=v_it[i];if(this.check(s,1)){selector.push(s);}}}}}};if(q.getCount()==0)return null;return q;}function igk_item_match_class(p,n){if(!n)return !1;var q=new RegExp("(\\s|^)("+p+")(\\s{1}|$)","i");if(q.exec(""+n.className)){return !0;}return !1;};function igk_item_inherit_class(p,n){var q=n;while(q){if(igk_item_match_class(p,q)){return !0;}q=q.parentNode;}return !1;};function igk_freeEventContext(){igk_unreadyAll();if(sm_regEventContext.length>0){igk_clearEventContent(sm_regEventContext);if(sm_regEventContext.length !=0){console.debug("[igk.js] igk_freeEventContext [for some reson not cleared]");}}}function igk_show_notify_error(t,m){igk.winui.notify.showErrorInfo(t,m);};function igk_show_notify_msg(t,m){igk.winui.notify.showMsBox(t,m);};function igk_get_script_src(){if(typeof(script_src_lnk)!=IGK_UNDEF){return script_src_lnk;}var p=igk_getLastScript();if(p){return p.getAttribute("src");}return null;}function igk_unRegEventContext(chain){var r=sm_regEventContext.length;var s=[];for(var i=0;i<r;i++){if(sm_regEventContext[i]==chain){s.push(sm_regEventContext[i]);}}sm_regEventContext.pop(chain);return(r>sm_regEventContext.length);}function igk_get_html_item_definition_value(item){if(item==null)return "<div class=\"igk-notify igk-notify-danger\">item is null</div>";var msg="";var func="";var e=igk.createNode("div");msg+="<div><div class=\"igk-notify-title\" style=\"color:white;\">"+item.toString()+"</div><div class=\"igk-title-4\">Properties</div><ul>";func+="<div class=\"igk-title-4\">Functions</div><ul>";var tab=[];for(var i in item){tab.push(i);}igk.system.array.sort(tab);for(var i=0;i<tab.length;i++){try{var n=tab[i];var txt="<div class=\"dispb igk-bigger\">"+n+"=</div>";if(typeof(item[n])==IGK_FUNC){func+="<li class=\"igk-col-lg-12-2\" >"+txt+"</li>";}else msg+="<li class=\"igk-col-lg-12-2\" >"+txt+"<pre class=\"dispb\" style='background-color:white;'>"+item[tab[i]]+"</pre>"+"</li>";}catch(ex){igk.winui.debug.addMsg("error i :"+i+" : "+ex);}}func+="</ul><div class=\"disptable clearb\"> </div></div>";msg+="</ul><div class=\"disptable clearb\"> </div></div>";e.setHtml(msg+func);return e.o.outerHTML;}function igk_get_html_item_definition(item){if(item==null)return "<div class=\"igk-notify igk-notify-danger\">item is null</div>";var msg="";var func="";var e=igk.createNode("div");msg+="<div><div class=\"igk-notify-title\" style=\"color:white;\">"+item+"</div><div class=\"igk-title-4\">Properties</div><ul>";func+="<div class=\"igk-title-4\">Functions</div><ul>";var tab=[];for(var i in item){tab.push(i);}igk.system.array.sort(tab);for(var i=0;i<tab.length;i++){try{var n=tab[i];if(typeof(item[n])==IGK_FUNC){func+="<li class=\"igk-col-lg-5-1\" >"+n+"</li>";}else msg+="<li class=\"igk-col-lg-5-1\" >"+n+"</li>";}catch(ex){igk.winui.debug.addMsg("error i :"+i+" : "+ex);}}func+="</ul><div class=\"disptable clearb\"> </div></div>";msg+="</ul><div class=\"disptable clearb\"> </div></div>";e.setHtml(msg+func);return e.o.outerHTML;}function igk_getRegEventContextByOwner(o){if(o==null)return null;var k=sm_regEventContext;for(var i=0;i<k.length;i++){if(k[i].o==o)return k[i];}return null;}function igk_getRegEventContext(prop,reg,callback){var k=sm_regEventContext ;for(var i=0;i<k.length;i++){if(k[i].properties==prop)return k[i];}if(reg){var c=callback();sm_regEventContext.push(c);return c;}return null;}function igk_clearEventContent(context){var ctab=new Array();var k=context;if((k==null)||(k.length==0))return;for(var i=0;i<k.length;i++){ctab.push(k[i]);}for(var j=0;j<ctab.length;j++){var r=ctab[j];if(r.unregEventContext){r.unregEventContext();}}}function igk_unreadyAll(){var tab=readyFunc;for(var i=0;i<tab.length;i++){igk.unready(tab[i]);}readyFunc=[];}function a(a){return IGK_UNDEF===typeof a;}function b(b){return a(b)||(null===b);}function igkJSError(msg){console.debug("igkJSError: "+typeof(this));this.name="igkerror";this.message=msg;this.level=1;this.toString=function(){return this.message;};}function __igksetAttribute(ns,n,v){var d=ns.__ATTRIBS__;if(d)d[n]=v;};function igk_getCurrentScript(){if(m_scriptNode)return m_scriptNode;if(document.currentScript)return document.currentScript;var s=document.scripts;return s.length>0 ? s[s.length-1]:null;}function igk_getAjxInitiator(){return __ajxInitiator;}function igk_namespaceBuilder(t,a,c,d,callback){var h=0;var i="";var ns="";var ps="";var win=t;var _iswin=(t==window);var _fileSrc=(d && d.fileSrc)||igk_getCurrentScript().src;if((_fileSrc=="")&&(_iswin)){_fileSrc="@"+m_LibScript;}this.build=function(){function __igksysNameSpace(n,ps){var m_type=new function(){igk_appendProp(this,{getFullName:function(){return n;},toString:function(){return "class:igk:systemType";}});};var tn=new igk_namespace();var mps=ps;igk_appendProp(tn,{namespace:n,type:IGK_CLASS,fullname:n,hierarchie:{getParent:function(){if(mps)return igk_get_namespace(mps);return null;}},getParent:function(){return this.hierarchie.getParent();},getType:function(){return m_type;},toString :function(){return "namespace["+this.namespace+"]";}});igk_defineProperty(tn,"__FILE_SRC__",{get:function(){return _fileSrc;}});igk_defineProperty(tn,"__ATTRIBS__",{get:function(){return d;}});return tn;};for(var f=0<=a.indexOf(".")?a.split("."):[a],h=0;h<f.length;h++){i=f[h];ps=ns;if(h>0)ns+=".";ns+=i;b(win[i])&&(win[i]=__igksysNameSpace(ns,ps));win=win[i];}if(d){m_attribs[a]=d;}if(!b(c)){igk_appendProp(win,c);if(callback)callback(win);}return win;};}function createPNS(t,a,c,d,callback){if(!a||(typeof(a)!='string'))throw new igkJSError("[igk] - wrong argument: namespace "+a);var g=new igk_namespaceBuilder(t,a,c,d,callback);return g.build();}function igk_get_namespace(n){if(typeof(n)!='string')return null;var t=n.split(".");var win=window[t[0]];if(win){for(var i=1;win && i<t.length;i++){win=win[t[i]];}return win;}return null;}function igk_console_debug(msg){if(igk.DEBUG && console && console.debug){console.debug(msg);}}if(typeof(console)==IGK_UNDEF){createNS("window",{console:new(function(){igk_appendProp(this,{write:function(msg){alert(msg);},debug:function(m){}});})()});}if(typeof(getComputedStyle)==IGK_UNDEF){createNS("window",{getComputedStyle:function(item,selector){if(!item)return null;function __getstylev(i,p){if(i.style){var h=i.style[p];if(h)return h;else if(i.parentNode){return __getstylev(i.parentNode,p);}else if(i !=document.body){return __getstylev(document.body,p);}}return '';}function __initStyle(item){var d=igk.createNode('div');var m={};var t="";m.cssText='';for(var i in d.o.style){if(i !="cssText"){m[i]=__getstylev(item,i);t+=" "+i+":"+m[i]+";";}}m.cssText=t;return m;}return __initStyle(item);}});}function igk_callfunction(name,params){igk_console_debug("call function");var func=null;if(!name)throw Error("wrong argument: namespace ");var h=0;var i="";var ns="";var a=name;var t=window;for(var win=t,f=(0<=a.indexOf("."))?a.split("."):[a],h=0;h<f.length;h++){if(!f[h]){func=null;break;}i=f[h];if(h>0)ns+=".";ns+=i;win=win[i];if(!win){func=null;break;}else func=win;}if(func){func.apply(window,params);}else{console.debug("function "+name+" doen't exists");}}function igk_getEmValue(q,property){if(!q)return 1.0;var f=q.getComputedStyle("fontSize");var e=0.0;var p=null;var r=1.0;if(property !="fontSize"){e=q.getComputedStyle(property);r=Math.round(igk.getNumber(e)/igk.getNumber(f));}else{p=q.getParentNode();if(p!=null){e=p.getComputedStyle(property);r=Math.round(igk.getNumber(f)/igk.getNumber(e));}}return r;}function igk_getNumber(value,cibling,property){var ex=/(((-{0,1})[0-9]+(\.[0-9]+){0,1})(px|em|%){0,1})$/;var t=ex.exec(value);if(t){if(t[5]){switch(t[5]){case "px":break;case "em":var r=parseFloat(t[2]);var e=igk_getEmValue(cibling,property);var h=igk_getNumber($igk(cibling).getComputedStyle(property));var o=(r/e)*h;return o;break;case "%":break;}}return parseFloat(t[2]);}return 0;}function igk_getInt(value){var t=/((-{0,1})[0-9]+(\.[0-9]+){0,1})(px|em|%)*$/.exec(value);if(t)return parseInt(t[1]);return 0;}function igk_getUnit(value){var t=/([0-9]+(\.[0-9]+){0,1})(px|em|%)*$/.exec(value);if(t){if(typeof(t[3])==igk.constants.undef){return "px";}return t[3];}return "";}function igk_getPixel(value,cibling,property){switch(value){case "auto":if(cibling && cibling.parentNode){var v=igk_getPixel($igk(cibling.parentNode).getComputedStyle(property));return v;}break;default:var ex=/(((-{0,1})[0-9]+(\.[0-9]+){0,1})(px|em|%){0,1})$/;var t=ex.exec(value);if(t){var d=parseFloat(t[2]);if(t[5]){switch(t[5]){case "em":var e=igk_getEmValue(cibling,property);var h=igk_getNumber($igk(cibling).getComputedStyle(property));var o=(d/e)*h;return o;break;case "%":if(cibling && cibling.parentNode){var v=igk_getPixel($igk(cibling.parentNode).getComputedStyle(property));d=v*(d /100.0);return d;}else{console.debug("no cibling : and cibling no parent "+property);}break;case "px":default:break;}}return parseFloat(t[2]);}break;}return 0;}function igk_getv(obj,keys,defaultvalue){if(obj){if(obj[keys])return obj[keys];}return defaultvalue;}function igk_newGUID(){var result='';var hexcodes="0123456789abcdef".split("");for(var index=0;index<32;index++){var value=Math.floor(Math.random()*16);switch(index){case 8:result+='-';break;case 12:value=4;result+='-';break;case 16:value=value & 3|8;result+='-';break;case 20:result+='-';break;}result+=hexcodes[value];}return result;};function createNS(a,c,d,callback){return createPNS(window,a,c,d,callback);};function igk_get_form_posturi(form){var msg="";var e=null;var p=[];for(var i=0;i<form.length;i++){e=form.elements[i];switch(e.type){case "radio":case "checkbox":if(e.checked){if(p[p.id]){var m=p[p.id];if(!m.push){t=[];t.push(m);}else m.push(e.value);}else p[e.id]=e.value;}break;case "file":break;default:p[e.id]=e.value;break;}}e=0;for(var i in p){if(e!=0)msg+="&";msg+=i+"="+p[i];e=1;}return msg;};function igk_defineProperty(target,name,property){if(!target)return;try{var s=typeof(Object.defineProperty);if(s=='function'){var prop={};if(property.get)prop.get=property.get;if(property.set)prop.set=property.set;prop.configurable=igk_getv(property,"configurable",true);prop.enumerable=igk_getv(property,"enumerable",true);prop.enumerable=igk_getv(property,"writable",false);var k=Object.defineProperty(target,name,prop);return k;}else{if(property.nopropfunc){property.nopropfunc.apply(target);}else{var t={toString:function(){return "data";}};target[name]=t;}}}catch(ex){if(property.nopropfunc){property.nopropfunc.apply(target);}else{var t={toString:function(){return property.get();}};target[name]=t;}}};function igk_appendProp(t,e,override){override=typeof(override)==IGK_UNDEF?!0:override;if(t && e){for(var j in e){try{t[j]=e[j];}catch(exception){window.igk.console_debug(" exception : "+j+" "+exception);}}}};function __igk(name){if(window.igk && window.igk.DEBUG){}if(name==window){throw("/!\\ Call to __igk function on [window] is not allowed. It will break the igk js framework namespace hierarchi."+"if you want to register event please use 'igk.winui.reg_event instead'");}var item=null;if(typeof(name)=="string"){var e=$igk(document).select(name);return e;}else if(typeof(name)=="igk.selector"){item=name;}else{item=name;}if(item==null)return null;if(item.o && item.o.igk)return item;if(window.igk){window.igk.initprop(item);}return item.igk;};function igk_show_prop(i,element){var msg="";var space="\n";var s="";if(element !=null)space="<br />";try{var ig={"outerHTML":1,"innerHTML":1};for(s in i){if(s in ig)continue;try{msg+=s+"="+i[s]+space;}catch(Exception){msg+=s+"; ex:["+Exception+"]"+space;}}if(element==null)alert(msg);else{$igk(element).o.innerHTML=msg;}}catch(ex){msg="can't evaluate object";igk.winui.notify.showError(msg);}}function igk_show_prop_keys(i,element){var msg="";var space="\n";var s="";if(element !=null)space="<br />";try{for(s in i){try{msg+=s+""+space;}catch(Exception){msg+=s+"; ex:["+Exception+"]"+space;}}if(element==null)alert(msg);else{$igk(element).o.innerHTML=msg;}}catch(ex){igk.show_notify_error("Exception","can't evaluate object");}}function igk_show_event(i,element){var msg="";var space="\n";if(element !=null)space="<br />";for(var s in i){if(igk.system.string.startWith(s,"on")){try{msg+=s+"="+i[s]+space;}catch(Exception){}}}if(element==null){igk.winui.notify.showError(msg);}else{$igk(element).o.innerHTML=msg;}}function igk_get_prop(i){var msg="";for(var s in i){try{msg+=s+"="+i[s]+"<br />\n";}catch(Exception){}}return msg;}function igk_preload_image(node,async){if((node==null)||(typeof(node.getElementsByTagName)==igk.constants.undef))return;function __preload(){var v_timg=node.getElementsByTagName("igk-img");if(!v_timg||(v_timg.length<=0)){return;}var v_tab=new Array();for(var s=0;s<v_timg.length;s++){v_tab[s]=v_timg[s];}var v_img=null;var v_div=null;var v_cimg=null;var v_preload={init:function(img,source){$igk(img).reg_event("load",function(evt){if(source.parentNode)source.parentNode.replaceChild(img,source);});},replace:function(img,source){if(source.parentNode)source.parentNode.replaceChild(img,source);},copyAttribute:function(source,dest){for(var x=0;x<source.attributes.length;x++){var j=source.attributes[x];if(j.name=="src")continue;try {dest.setAttribute(j.name,j.value);}catch(Exception){console.debug("error");}}}};var i=0;for(;i<v_tab.length;i++){var src=v_tab[i].getAttribute("src");if(src){v_cimg=document.createElement("img");v_cimg.source=v_tab[i];v_cimg.src=src;if(v_cimg.complete &&((v_cimg.width+v_cimg.height)>0)){v_preload.copyAttribute(v_tab[i],v_cimg);v_preload.replace(v_cimg,v_tab[i]);}else{v_img=v_cimg;v_preload.init(v_img,v_tab[i]);v_preload.copyAttribute(v_tab[i],v_img);}}}}__preload();}function igk_preload_anim_image(node){if((node==null)||(typeof(node.getElementsByTagName)==igk.constants.undef))return;var v_timg=node.getElementsByTagName("igk-anim-img");if(v_timg.length<=0)return;var v_tab=new Array();for(var s=0;s<v_timg.length;s++){v_tab[s]=v_timg[s];}var v_img=null;var v_div=null;var v_cimg=null;var v_preload={replace:function(img,source){try{if(source.parentNode){source.parentNode.replaceChild(img.o,source);}}catch(ex){igk.winui.notify.showError("Error : "+ex+" "+img);}},copyAttribute:function(source,dest){for(var x=0;x<source.attributes.length;x++){var j=source.attributes[x];if(j.name=="src")continue;try {}catch(Exception){console.debug("error");}}}};var i=0;for(;i<v_tab.length;i++){var src=v_tab[i].getAttribute("src");var v_width=v_tab[i].getAttribute("width");var v_height=v_tab[i].getAttribute("height");if(src){v_cimg=igk.createNode("span");v_cimg.source=v_tab[i];v_cimg.src=src;$igk(v_cimg).setCss({width:v_width,height:v_height,cursor:"pointer",backgroundImage :"url('"+src+"')",overflow:"hidden",backgroundImageRepeat:"no-repeat",display:"inline-block",margin:"0px",padding:"0px" });v_preload.copyAttribute(v_tab[i],v_cimg);v_preload.replace(v_cimg,v_tab[i]);$igk(v_cimg).reg_event("mouseover",function(){$igk(this).addClass("btnover").setCss({backgroundPosition:-this.clientWidth+"px"});});$igk(v_cimg).reg_event("mouseleave",function(){$igk(this).rmClass("btnover").setCss({backgroundPosition:"0px 0px"});});$igk(v_cimg).reg_event("mousedown",function(){$igk(this).addClass("btndown").setCss({backgroundPosition:-(2*this.clientWidth)+"px 0px"});});}}}function igk_base64encode(str){return igk.utils.Base64.encode(str);}function igk_remove_all_script(x){var t=x.getElementsByTagName("script");var c=t.length;for(var i=0;i<c;i++){t[0].parentNode.removeChild(t[0]);}}function igk_array_copy(tab){var c=tab.length;var btab=new Array();for(var i=0;i<c;i++){btab[i]=tab[i];}return btab;}function igk_is_array(tab){return tab instanceof Array;}function igk_eval_all_script(item){if(item==null){return;}var s=$igk(item);var v_script="";var c=null;var tab=null;var i=0;if(s==null){return;}try{if(s.o.getElementsByTagName){tab=igk_array_copy(s.o.getElementsByTagName("script"));c=tab.length;if(c>0){for(i=0;i<c;i++){if(!tab[i]){alert('not define '+tab[i]+" i="+i+" c="+c+" tab.length="+tab.length+" \n "+tab[i-1].innerHTML);continue;}var j=tab[i];v_script=j.innerHTML;igk_eval(v_script,j.parentNode,j);}}}}catch(ex){igk.show_notify_error("Exception","igk_eval_all_script:\nERROR: "+ex+"<br />\n" +"The script have error : "+v_script+"\ni="+i+" \ntab.length="+tab.length+"<div class='tracebox'> "+ex.stack+"</div>" );}}function igk_isdefine(i){return typeof(i)!='undefined';}function igk_eval(s,sn,n){m_scriptNode=sn;igk.evaluating=!0;try{eval(s);}catch(ex){var sg='';if(ex.stack){sg=ex.stack.replace('\n','<br />');}igk_show_notify_error("Exception","<div><p>Error: igk_eval</p>Message:<b> "+ex+"</b><pre>"+s+"</pre><div class='tracebox'>"+sg+"</div>" +"</div>" );}m_scriptNode=null;igk.evaluating=false;}function igk_append_script_to_head(item){var tab=item.getElementsByTagName("script");var c=tab.length;var head=null;if(!document.getElementsByTagName("head")[0]){head=igk.createNode("head");}else{head=document.getElementsByTagName("head")[0];}for(var i=0;i<c;i++){var scriptText=tab[i].text;var scriptFile=tab[i].src;var scriptTag=igk.createNode("script");if((scriptFile !=null)&&(scriptFile !="")){scriptTag.src=scriptFile;}scriptTag.text=scriptText;head.appendChild(scriptTag);}}function igk_confirm_lnk(lnk){var frm=igk_getParentByTagName(lnk,'form');if(frm){frm.confirm.value=1;frm.action=lnk.href;frm.submit();}}function igk_getLastScript(){var t=document.getElementsByTagName('script');if(t.length>0)return t[t.length-1];return null;}function igk_getParentByTagName(e,tagname){if((e==null)||(typeof(tagname)!="string"))return null;if(e.parentNode==null)return null;if((e.parentNode.tagName!=null)&&(e.parentNode.tagName.toLowerCase()==tagname.toLowerCase()))return e.parentNode;return igk_getParentByTagName(e.parentNode,tagname);}function igk_getParentScriptByTagName(tagname){var p=m_scriptNode;var q=null;if(p !=null){q=p.parentNode;if(tagname){if(q.tagName.toLowerCase()!=tagname.toLowerCase())return igk_getParentByTagName(q,tagname);}return q;}if(tagname !=null)return igk_getParentByTagName(igk_getLastScript(),tagname);else{return igk_getLastScript().parentNode;}}function igk_getParentById(e,id){if((e==null)||(id==null))return null;var p=e.parentNode;if(!id.toLowerCase){igk.show_notify_error("Error","ERROR FOR: "+e+" Request "+id);return null;}var i=id.toLowerCase();if(p==null)return null;if((p.id!=null)&&(p.id.toLowerCase()==i))return p;return igk_getParentById(p,id);}function igk_getfirstchild(e,tag){var c=[];var t=e.childNodes;var p=null;for(var i=0;i<t.length ;i++){p=t[i];if(p.tagName &&(p.tagName.toLowerCase()==tag.toLowerCase())){c[c.length]=p;}}return c;}function igk_getChildsByAttr(item,attribute){if((item==null)||(attribute==null)||(!item.childNodes))return null;var t=item.childNodes;var p=null;var b=null;var i=0;var isok=!0;var ret=new Array();var iret=null;for(var i=0;i<t.length ;i++){p=t[i];isok=!0;for(var j in attribute){if(!p.getAttribute||(p.getAttribute(j)!=attribute[j])){isok=false;break;}}if(isok){ret[ret.length]=p;}iret=igk_getChildsByAttr(p,attribute);if(iret !=null){for(j=0;j<iret.length;j++){ret[ret.length]=iret[j];}}}return ret;}function igk_checkOnePropertyExists(item,proplist){if(item==null)return !1;var t=proplist.split(' ');for(var s in t){if(typeof(item[t[s]])!==IGK_UNDEF)return !0;}return !1;}function igk_checkAllPropertyExists(item,proplist){if(item==null)return !1;var t=proplist.split(' ');for(var s in t){if(typeof(item[t[s]])===IGK_UNDEF)return !1;}return !0;}function igk_getChildById(item,id){if((item==null)||(id==null))return null;var t=item.childNodes;var p=null;var b=null;var i=0;for(var i=0;i<t.length ;i++){p=t[i];if(p.id &&(p.id.toLowerCase()==id.toLowerCase())){return p;}else{b=igk_getChildById(p,id);if(b !=null)return b;}}return null;}function igk_getvi(item,prop){if(item[prop]){return item[prop];}else if(item.igk && item.igk["get"+prop]){return item.igk["get"+prop];}return 0;}function igk_init_powered(n){var node=n||window.igk.getParentScriptByTagName('div');var q=$igk(".igk-powered-viewer").last();if(!q){q=$igk("div").first();}if(q){igk.ready(function(){if(window.igk.ctrl){if(q){igk_powered_manager(node,q.o);}else igk_debug_t('igk_init_powered','no cibling node found');}else console.debug("no ctrl found for powered manager");});}}function igk_powered_manager(node,ciblingnode){if(!node)return;function init(node,poweredhost){var node=node;var s=poweredhost;var animinfo={duration:200,interval:10,animtype:"timeout",context:"init_powered_manager",effect:"circ",effectmode:"easeinout" };function update_size(){var animprop={right :"0px",bottom:"0px" };if($igk(s).fn.hasVScrollBar()){var _q=$igk(s).add("div").addClass("posab fitw fith").setHtml("width:info");var h=s.offsetWidth-_q.o.offsetWidth;_q.remove();animprop.right=(h+2)+"px";}if($igk(s).fn.hasHScrollBar()){var _q=$igk(s).add("div").addClass("posab fitw fith").setHtml("height:info");var h=s.offsetHeight-_q.o.offsetHeight ;_q.remove();animprop.bottom=(h+2)+"px";}$igk(node).animate(animprop,animinfo);}var v_self=this;v_self.toString=function(){return "igk_powered_manager";};var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){update_size();});};update_size();function __doc_changed(){update_size();};igk.publisher.register("sys://doc/changed",__doc_changed);};var s=ciblingnode ? ciblingnode :document.getElementById(ciblingnode);if(s){var q=new init(node,s);}else{console.debug("/!\\ parent cibling not found");}}function igk_getdir(uri){if(uri==null)return null;var d=uri.split('/');var o="";for(var s=0;s<d.length-1;s++){if(s!=0)o+="/";o+=d[s];}return o;}m_scriptTag=igk_getLastScript();createNS("igk",{},{desc:"global igk js namespace"});createNS("igk.ctrl",{},{desc:"manage controller"});createNS("igk.system",{},{desc:"global system igk js namespace"});createNS("igk.type",{},{desc:"global igk js namespace"});createNS("igk.reflection",{},{desc:"global igk js namespace"});createNS("igk.exception",{},{desc:"global igk exception class"});createNS("igk.os",{},{desc:"balafon os utility function"});createNS("igk.android",{},{desc:"balafon android utility namespace"});createNS("igk.winui",{},{desc:"winui global igk js namespace. manage interface"});createNS("igk.winui.fn",{},{desc:"utility functions"});createNS("igk.winui.notify",{},{desc:"winui.notify global igk js namespace"});createNS("igk.html",{},{desc:"igk.html namespace. to manage dom element"});createNS("igk.R",{},{desc:"resource namespace"});createNS("igk.log",{debug:function(m){if(igk.DEBUG){console.debug(m);}},error:function(m){if(igk.DEBUG){console.error(m);}}},{desc:'manage log'});createNS("igk.attribute",{setAttribute:__igksetAttribute });createNS("igk",{configure:function(o){for(var i in o){if(typeof(o[i])=='function')continue;__igk_settings[i]=o[i];}},regex:function(){return _rgx;},getSettings:function(){return __igk_settings;},object:igk_object,is_notdef:igk_is_notdef,is_string:igk_is_string,is_object:igk_is_object,reg_tag_component :igk_reg_tag_obj,die:function(msg,code){throw code+" : "+msg;},geti:function(t){if(t)return 1;return 0;},stop_event:igk_stop_event,bool_parse:function(t){if(igk_is_string(t)){var s=t.toLowerCase();if((s.length==0)||(s=="false")||(s=="0"))return !1;return !0;}if(t)return !0;return !1;}},{desc:"global igk.object base class namespace"});createNS("igk.namespaces",{xhtml:"http://www.w3.org/1999/xhtml" });createNS("igk.convert",{toHtmlColor:function(i){var c=igk.system.colorFromString(i);if(c)return c.toHtml();return 0;}});var __jsload={};createNS("igk.js",{load:function(s){if(s in __jsload)return;var p=document.createElement("script");var e=0;p.type="text/javascript";p.language="javascript";p.async=true;p.onerror=function(){console.error("failed to load "+s);$igk(p).remove();delete(__jsload[s]);e=1;};p.onload=function(e){console.debug("laod complete "+p.readyState);};igk.ajx.get(s,null,function(xhr){if(this.isReady()){console.debug("load script : "+s);p.innerHTML=xhr.responseText;}},true);document.head.appendChild(p);__jsload[s]=1;},require:function(scs){var prop={};var def={c:0,e:{}};var u=0;var o={promise:function(callback,h){prop.callback=callback;prop.host=h;if(def.c<=0){__invoke();}}};function __invoke(){prop.callback.apply(o,[$igk(prop.host).o]);}for(var i=0 ;i<scs.length;i++){u=scs[i];if(__jsload[u]){def.c--;continue;}__jsload[u]=1;var sc=document.createElement("script");sc.src=u;def.e[u]=i;def.c++;sc.onload=(function(i,u){return function(){delete(def.e[u]);def.c--;if(def.c==0){__invoke();}}})(i,u);sc.onerror=function(){console.debug("/!\\ failed:"+u);};document.head.appendChild(sc);}return o;},getLoadedScript:function(){return __jsload;}});(function(){createNS("igk.evts",{stop:igk.stop_event });igk.evts.dom=["sys://dom/pageloaded","sys://dom/bodyreplaced","sys://dom/nodetextchanged" ];})();createNS("igk.reflection",{getFunctions:function(item){if(!item)return null;var r=[];for(var i in item){if(typeof(item[i])==IGK_FUNC){r.push(i);}}return r;},getProperties:function(e){var t=[];if(typeof(e)!=IGK_UNDEF){if(typeof(e)=='string'){for(var i in e){if(!igk.isInteger(i)&&(typeof(e[i])!="function")){t.push(i);}}}else{for(var i in e){if(typeof(e[i])!="function"){t.push(i);}}}}return t;}});__nsigk=igk;window.$igk=function(n){return __igk(n)};window.$ns_igk=__nsigk;window.ns_igk=__nsigk;window.igk.wln=console.debug;(function(){createNS("igk.io.file",{load:function(u,f){f=typeof(f)=="function"?f:f.complete;var eCb=f.error||null;function getNodeData(n){var dummy=igk.createNode("dummy");var c=n.childNodes.length;var i=0;var m=null;while(c>0){m=n.childNodes[i];switch(m.nodeType){case 8:case 3:case 11:case 10:i++;break;default:dummy.o.appendChild(n.childNodes[i]);break;}c--;}var v_d=dummy.getHtml();if(v_d==null){return null;}return v_d;};var __loaded=0;var ob=igk.createNode('object');ob.addClass('no-visible posab').setCss({width:'1px',height:'1px'});ob.o.type=igk.navigator.isXBoxOne()? "text/html" :"text/plain";$igk(document.body).prepend(ob);ob.reg_event("error",function(evt){if(__loaded||(igk.navigator.isFirefox()&& igk.navigator.getFirefoxVersion()>=50)){return;}if(eCb){eCb.apply(ob);}f.apply(document,[{error:1,data:evt,msg:"/!\\error: "+u }]);ob.remove();});ob.reg_event("load",function(evt){try{if(!ob.o.contentDocument||ob.o.contentDocument.readyState!="complete")return;var s=ob.o.contentDocument;var d=getNodeData(s);f.apply(document,[{data:d,document:s}]);__loaded=1;}catch(e){console.error("Exception arrived : "+e);}finally{ob.remove();}});ob.o.data=u;}});})();igk_appendProp(igk.object.prototype,{toString:function(){return "igk.object";},getType:function(){return igk.object;}});function igk_regex_constant(){return{tagName:/^[\w_]+[\w0-9_\-]*$/,className:/^\.[\w_]+[\w0-9_\-]*$/,idSearch:/^#[\w\-_]+(\[[\w\-_]*\])?$/ }}createNS("igk",{DEBUG:false,release:"17/01/15",evaluating:false,createObj:function(s){var o={};var t=s.split('|');for(var s=0;s<t.length;s++){o[t[s]]=0;}return o;},initObj:function(o,def){if(o==null||typeof(o)!=="object")return def;for(var i in def){if((i in o)==false){o[i]=def[i];}}return o;},createNode:function(tag,ns){if(!tag)return 0;tag=tag.toLowerCase();if(ns)return __igk(document.createElementNS(ns,tag));return __igk(document.createElement(tag));},createNSComponent:function(ns,classname){var lst=igk.winui.getClassList();var g=lst["ns://"]&& lst["ns://"][ns]&& lst["ns://"][ns][classname];if(g){var s=null;if(g.data.create){s=g.data.create.apply(window,igk.system.array.slice(arguments,2));}else{s=igk.createNode("div");s.addClass(classname);}igk.ajx.fn.initnode(s.o);return s;}return null;},createComponent:function(classname){var lst=igk.winui.getClassList();var g=lst[classname];if(g){var s=null;if(g.data.create){s=g.data.create.apply(window,igk.system.array.slice(arguments,1));}else{s=igk.createNode("div");s.addClass(classname);}igk.ajx.fn.initnode(s.o);return s;}return null;},createText:function(s){return __igk(document.createTextNode(s));},createHtml:function(s){var o=igk.createNode("div").setHtml("&nbsp;").o;return igk.createText(o.textContent);},clearTimeout:function(timeout){window.clearTimeout(timeout);},eval:igk_eval,typeofs:function(n){return typeof(n)=='string';},typeoff:function(n){return typeof(n)=='function';},loadScript:function(filename){if(!filename)return;var uri=null;var p=m_scriptTag;if(p){uri=igk.constants.http_scheme+document.domain+igk_getdir(window.location.pathname+"")+"/"+igk_getdir(p.getAttribute("src"))+"/"+filename;}if(!uri){return;}igk.ajx.get(uri,null,function(xhr){if(this.isReady()){var s=igk.createNode("script");s.setAttribute("type","text/javascript");s.setAttribute("language","javascript");s.o.innerHTML=xhr.responseText;document.head.appendChild(s);}});},loadPlugins:function(plugins){if(!plugins)return;var t=plugins.split(',');var uri=null;var p=m_scriptTag;if(p){uri=igk.constants.http_scheme+document.domain+"/"+igk_getdir(window.location.pathname+"")+"/"+igk_getdir(p.getAttribute("src"))+"/plugins";}if(!uri){return;}for(var i=0;i<t.length;i++){igk.ajx.get(uri+"/"+t[i]+"/plugin.js",null,function(xhr){if(this.isReady()){var s=igk.createNode("script");s.setAttribute("type","text/javascript");s.setAttribute("language","javascript");s.setHtml(xhr.responseText);document.head.appendChild(s.o);}});}},preload:function(u){igk.ajx.get(u,null,function(xhr){if(this.isReady()){var s=igk.createNode("script");s.setAttribute("type","text/javascript");s.setAttribute("language","javascript");s.setHtml(xhr.responseText);var b=document.head||document.body;if(b)b.appendChild(s.o);}});},canInvoke:function(){return window.external &&(typeof(window.external.callFunc)!=igk.constants.undef);},invoke:function(method,params){if(window.external &&(typeof(window.external.callFunc)!=igk.constants.undef)){try{if(typeof(params)=='object')params=igk.JSON.convertToString(params);window.external.callFunc(method,params);}catch(ex){igk.winui.notify.showMsg("<div class=\"igk-notify-danger\">No function "+method+" function defined in external <br /> "+ex+"</div");}}else{igk.winui.notify.showMsBox(__libName,"<div class=\"igk-notify-danger\">No external function defined ["+method+"]</div>","igk-info");}},constants:{http_scheme:"http://",https_scheme:"https://",namespace:"http://www.igkdev.com","undef":IGK_UNDEF,"true":true,"false":false,regex:igk_regex_constant()},"selector_showlist" :function(s){var ss="";s.each(function(){ss+=" "+this.o.tagName+":"+this.o+"\n";return !0;});},eval_all_script :igk_eval_all_script,init_document:function(){igk.ctrl.init_controller();igk_preload_image(document);igk_preload_anim_image(document);__applyPreloadDocument(document);},console_debug:igk_console_debug,show_prop:igk_show_prop,show_notify_prop:function(e){igk.winui.notify.showMsg(igk.html.getDefinition(e));},show_notify_prop_v:function(e){igk.winui.notify.showMsg(igk.html.getDefinitionValue(e));},show_notify_msg:igk_show_notify_msg,show_notify_error:igk_show_notify_error,get_v:function(o,k,d){if(typeof(o[k]!=IGK_UNDEF))return o[k];if(typeof(d)==IGK_UNDEF)return null;return d;},show_prop_keys:igk_show_prop_keys,preload_image:igk_preload_image,show_event:igk_show_event,getParentScriptByTagName:igk_getParentScriptByTagName,getParentScriptForm:function(){return igk_getParentScriptByTagName("form");},getElementsByTagName:function(e,tag){return e.getElementsByTagName(tag);},getParentScript:function(){return igk_getParentScriptByTagName(null);},getLastScript:igk_getLastScript,getCurrentScript:igk_getCurrentScript,rmCurrentScript:function(){var s=igk.getCurrentScript();if(s){$igk(s).remove();}},initpowered :igk_init_powered,getParentByTagName:igk_getParentByTagName,getParentById:igk_getParentById,appendProperties:igk_appendProp,defineProperty:igk_defineProperty,checkOnePropertyExists:igk_checkOnePropertyExists,checkAllPropertyExists:igk_checkAllPropertyExists,callfunction :igk_callfunction,check:function(item,pattern){var m=igk_select_exp(pattern.substring(1));if(m.check(item,0)){return !0;}return !1;},qselect:function(item,pattern){var v_sl=new igk.selector();if(item.querySelectorAll){var p=item.querySelectorAll(pattern);for(var i=0;i<p.length;i++){v_sl.push($igk(p[i]));}}return $igk(v_sl);},select:function(item,pattern){var b=null;var v_sl=new igk.selector();if(!item||(pattern==null)){return $igk(v_sl);}var v_list=pattern.split(',');if(v_list.length>1){for(var sm=0;sm<v_list.length;sm++){var v_cq=igk.select(item,v_list[sm]);if(v_cq.getCount()>0){v_sl.load(v_cq);}}return v_sl;}if(pattern=="::"){v_sl.push($igk(item).o.parentNode);return $igk(v_sl);}if(pattern=="??"){v_sl.push(document.body);return $igk(v_sl);}if(igk.system.string.startWith(pattern,'?')){var m=igk_select_exp(pattern.substring(1));if(m.check(item,0)){v_sl.push(item);}return $igk(v_sl);}if(igk.system.string.startWith(pattern,'^')){var spattern=pattern.split(" ");pattern=spattern[0];if((/^\^[\w\-_]+$/.exec(pattern))){b=$igk($igk(item).getParentByTagName(pattern.substring(1)));if(b)v_sl.push(b);}else if((/^\^#[\w\-_]+$/.exec(pattern))){b=$igk(item).getParentById(pattern.substring(2));if(b)v_sl.push(b);}else if((/^\^\./.exec(pattern))){pattern=pattern.substring(2);var s=$igk(item).o.parentNode;var rx=new RegExp("("+pattern+")(\\s|$)","i");while(s!=null){if(rx.exec(""+s.className)){v_sl.push(s);}s=s.parentNode;}}if((spattern.length>1)&&(v_sl.getCount()==1)){return $igk(v_sl).first().select(spattern.slice(1).join(" "));}return $igk(v_sl);}if(igk.system.string.startWith(pattern,'+')){var h=$igk(item).o.nextSibling;var spattern=pattern.substr(1).split(" ");pattern=spattern[0];while(h){if(igk.css.isMatch(h,pattern)){v_sl.push(h);}h=h.nextSibling;}return $igk(v_sl);}var v_it=null;var s=null;var exp=null;var fid=false;if(typeof(pattern)=="string"){switch(pattern){case ">>":for(var i=0;i<item.childNodes.length;i++){s=item.childNodes[i];v_sl.push(s);}return $igk(v_sl);break;default:if(/^>:([\w_#\.]+[\w\-_0-9 ]*)$/.exec(pattern)){pattern=pattern.substring(2);for(var i=0;i<item.childNodes.length;i++){s=item.childNodes[i];if(v_sl.isMatch(pattern,s)){v_sl.push(s);}}return $igk(v_sl);}break;}if(!item.getElementsByTagName){if(igk.DEBUG)console.debug("/!\ selection will failed because element not support getElementByTagName");return $igk(v_sl);}v_it=item.getElementsByTagName("*");if(pattern=="*"){for(var i=0;i<v_it.length;i++){s=v_it[i];v_sl.push(s);}}else{if(/^:([\w_]+[\w\-_0-9]*)$/.exec(pattern)){pattern=pattern.substring(1);for(var i=0;i<v_it.length;i++){s=v_it[i];if(s.getAttribute(pattern)){v_sl.push(s);}}}else if(/^:\^([\w_]+[\w\-_0-9]*)$/.exec(pattern)){pattern=pattern.substring(2);for(var i=0;i<v_it.length;i++){s=v_it[i];var msg=$igk(s).getAllAttribs();if(RegExp(""+pattern+"","i").test(msg)){v_sl.push(s);}}}else if((/^\.[\w\-_]+$/.exec(pattern))){pattern=pattern.substring(1);for(var i=0;i<v_it.length;i++){s=v_it[i];if(igk_item_match_class(pattern,s)){v_sl.push(s);}}}else if((/^\>[\w\-_]+$/.exec(pattern))){pattern=pattern.substring(1);exp=new RegExp("("+pattern+")","i");for(var i=0;i<v_it.length;i++){s=v_it[i];if((s.parentNode==item)&& exp.exec(""+s.tagName)){v_sl.push(s);}}}else {if((igk.constants.regex.idSearch.exec(pattern))){fid=!0;pattern=pattern.substring(1);for(var i=0;i<v_it.length;i++){s=v_it[i];if(new RegExp("^("+pattern+")$","i").exec(""+s.id)){v_sl.push(s);}}}else{var m=igk_select_exp(pattern);if(m!=null){m.select(v_sl,item);}else{v_it=item.getElementsByTagName(pattern);for(var i=0;i<v_it.length;i++){s=v_it[i];v_sl.push(s);}}}}}}return $igk(v_sl);},load:function(func){if(func==null)return;if(document.readyState=="loading"){igk.winui.reg_event(window,"load",func);}else{func.apply(window);}},is_readyRegister:function(func){for(var i=0;i<readyFunc.length;i++){if(func==readyFunc[i])return !0;}return !1;},readyCountFunc:function(){return readyFunc.length;},readyGlobal:function(func){if(document.readyState=="complete"){func.apply(document);}else{m_readyGlobalFunc[m_readyGlobalFunc.length]=func;}},readyinvoke:function(n){var s=igk_getCurrentScript();var t=igk.system.array.slice(arguments,1);igk.ready(function(){var ns=igk.system.getNS(n);if(typeof(ns)=='function'){var bck=m_scriptNode;m_scriptNode=s;ns.apply(s,t);m_scriptNode=bck;}else{}});},ready:function(func,sys){if((func==null)||(func==0)){if((document.readyState !=="complete")||m_ready_calling)return;m_ready_calling=!0;var e=null;if(m_readyGlobalFunc.length>0){for(var i=0;i<m_readyGlobalFunc.length;i++){e=m_readyGlobalFunc[i];try{e.apply(document);}catch(ex){igk.winui.notify.showError("<div class=\"igk-title-5\">igk.js ReadyGlobal function call failed </div> <br />"+ex+"<br /><quote>"+ex.stack+"</quote><pre style=\"max-height:200px; overflow-y:auto;\">"+e+"</pre>");}}m_readyGlobalFunc=[];}if(readyFunc.length>0){for(var i=0;i<readyFunc.length;i++){e=readyFunc[i];try{e.apply(document);}catch(ex){var ox="";if(ex.stack)ox=(ex.stack+"").replace("\n","<br />");igk.winui.notify.showError("<div class=\"igk-title-5\">igk.js Ready function call failed </div> <br />"+ex+"<br /><quote>"+ox +"</quote><pre style=\"max-height:200px; overflow-y:auto; background:#eee; \">"+e+"</pre>");}}}readyFunc=[];m_ready_calling=false;}else{if(m_ready_calling||(document.readyState=="complete")){func.apply(document);}else{readyFunc[readyFunc.length]=func;}}},unready:function(func){var s=[];for(var i=0;i<readyFunc.length;i++){if(readyFunc[i]==func){continue;}s.push(readyFunc[i]);}readyFunc=s;},getElementsByAttribute:function(properties){if(!properties)return null;var d=document.getElementsByTagName("*");var out=[];var b=!0;for(var i=0;i<d.length;i++){for(var k in properties){if(d[i].getAttribute(k)==properties[k]){out.push(d[i]);}}}return out;},selector:function(){var m_items=[];igk_appendProp(this,{getCount:function(){return m_items.length;},push:function(item){m_items.push(item);this.length=this. getCount();},isSr:function(){return !0;},toString:function(){return "igk.selector["+this.getCount()+"]";},each:function(func,args){args=args? args:[];for(var i=0;i<this.getCount();i++){if((func)&& func.apply && !func.apply($igk(m_items[i]),args)){break;}}return this;},waitInterval:function(duration,func){function __func_waiter(i,func){var self=this;igk_appendProp(this,{next:null,wait:function(){func.apply(i,arguments);if(self.next)self.next.start();},start:function(){this.timeout=setTimeout(this.wait,duration);}});}var iduration=duration;var h=null;var t=null;for(var i=0;i<this.getCount();i++){if(i==0){h=new __func_waiter($igk(m_items[i]),func);t=h;}else{h.next=new __func_waiter($igk(m_items[i]),func);h=h.next;}}if(t!=null){t.start();}return this;},each_all:function(func,args){if(func){if(typeof(args)==IGK_UNDEF)args=[];for(var i=0;i<this.getCount();i++){func.apply($igk(m_items[i]),args);}}return this;},getItemAt:function(index){if((index>=0)&&(index<this.getCount()))return $igk(m_items[index]);return null;},getLastItem:function(){var c=this.getCount();return c>0? this.getItemAt(c-1):null;},getFirstItem:function(){var c=this.getCount();return c>0? this.first():null;},getNodeAt:function(index){if((index>=0)&&(index<this.getCount()))return m_items[index];return null;},isMatch:function(p,n){if(igk.constants.regex.tagName.exec(p)){return n.tagName &&(n.tagName.toLowerCase()==p.toLowerCase());}else if(igk.constants.regex.className.exec(p)){return igk_item_match_class(p,n);}else if(igk.constants.regex.idSearch.exec(p)){return(new RegExp("^("+p+")$","ig")).exec(""+n.id);}return !1;},select:function(pattern){var v_s=new igk.selector();if(this.getCount()==0){return v_s;}for(var i=0;i<this.getCount();i++){var g=igk.select(m_items[i],pattern);if(g &&(g.getCount()>0)){for(var j=0;j<g.getCount();j++){v_s.push(g.getNodeAt(j));}}}return $igk(v_s);},load:function(g){if(g && g.isSr()){for(var j=0;j<g.getCount();j++){this.push(g.getNodeAt(j));}}},clear:function(){m_items=new Array();}});igk.initprop(this);},initprop:function(element){function __igk_nodeProperty(element){var m_o=element;var m_self=this;var m_anim;var m_timeOutList=[];var m_unregfuncs=[];igk_defineProperty(this,"o",{get:function(){return m_o;},nopropfunc:function(){this.o=m_o;}});igk_defineProperty(this,"t",{get:function(){return $igk(m_o.parentNode);},nopropfunc:function(){this.t=$igk(m_o.parentNode);}});var m_data={};createPNS(this,"fn",{o :element,igk :m_self,vscrollWidth:function(){return this.o.offsetWidth-this.o.clientWidth;},hscrollHeight:function(){return this.o.offsetHeight-this.o.clientHeight;},hasVScrollBar:function(){var h=this.igk.getHeight();return(this.o.clientHeight>0)&&(this.o.scrollHeight>h);},hasHScrollBar:function(){var w=this.igk.getWidth();return(this.o.clientWidth>0)&&(this.o.scrollWidth>w);}});createPNS(this,"data",{contains:function(k){if(typeof(m_data[k])!=IGK_UNDEF)return !0;return !1;},add:function(k,v){m_data[k]=v;},remove:function(k){delete(m_data[k]);},getData:function(){return m_data;}});var m_config={};igk_appendProp(this,{setConfig:function(k,v){m_config[k]=v;},getConfig:function(k){return m_config[k];},getConfigKeys:function(){var t=[];for(var i in m_config){t.push(i);}return t;}});igk_appendProp(this,{toString:function(){return "igk_node_properties["+this.o+"]";},unregister:function(){igk.winui.unreg_system_event_object(this);for(var i=0;i<m_unregfuncs.length;i++){m_unregfuncs[i].apply(this);}},getParentCtrl:function(func){return $igk(igk.ctrl.getParentController(this.o));},registerUnregCallback:function(func){if(func){m_unregfuncs.push(func);}},add:function(t,properties){if(typeof(t)=="string"){var c=$igk(this.appendNChild(t));c.setProperties(properties);return c;}return this.appendChild(t);},addText:function(s){var i=document.createTextNode(s);return this.add(i);},isOnDocument:function(){var q=0;if(this.isSr())return 0;q=this;while((q=q.o.parentNode)&&(q!=document.body)){q=$igk(q);}return q==document.body;},prepend:function(n){var i=null;if(typeof(n)=="string")i=igk.createNode(n);else i=$igk(n);if(i==null)return null;if(this.o.firstChild==null){this.o.appendChild(i.o);}else{this.o.insertBefore(i.o,this.o.firstChild);}return i;},replace:function(i,by){if(!this.isSr()){this.o.replaceChild($igk(by).o,$igk(i).o);}else{this.o.each(this.replace,arguments);}return this;},fullscreen:function(){if(!this.isSr()){var fc=igk.fn.getItemFunc(this.o,"requestFullScreen");if(fc){igk.publisher.publish("sys://dom/beforefullsizeRequest");fc.apply(this.o);}}return this;},replaceBy:function(i){if(igk_is_string(i)){var d=igk.createNode("dummy");i=d.setHtml(i).o.firstChild;}var v_si=$igk(i);if(!this.isSr()){var p=this.o.parentNode;p.replaceChild(v_si.o,this.o);}else{if(this.getCount()>1){var c=0;this.o.each(function(){if(c==0){this.replaceBy(i);}else{this.replaceBy($igk(i).clone());}c=1;return !0;});}else this.o.each(this.replaceBy,arguments);}return this;},addSpace:function(){if(this.isSr()){this.each(this.addSpace,arguments);}else this.o.appendChild(igk.createHtml("&nbsp;").o);return this;},setOpacity:function(v){if(this.isSr()){this.o.each(this.setOpacity,arguments);return this;}else{this.o.style.opacity=v;if(this.o.style.filter){this.o.style["filter"]="alpha(opacity="+(v*100)+")";}this.o.style["-moz-opacity"]=v;this.o.style["-khtml-opacity"]=v;}return this;},setBoxShadow:function(offsetX,offsetY,blur,color){this.o.style["boxShadow"]=offsetX+" "+offsetY+" "+blur+" "+color;},setTextShadow:function(offsetX,offsetY,blur,color){this.o.style["textShadow"]=offsetX+" "+offsetY+" "+blur+" "+color;},focus:function(){if(this.o.focus)this.o.focus();},click:function(){if(this.o.click){this.o.click();}else{var e=document.createEvent('HTMLEvents');e.initEvent("click",true,true);this.o.dispatchEvent(e);}return this;},clone:function(){var cl=igk.createNode(this.o.tagName,this.o.namespaceURI);cl.copyAttributes(this);if(this.o.childNodes.length>0){for(var i=0;i<this.o.childNodes.length;i++){if(this.o.childNodes[i].tagName)cl.add($igk(this.o.childNodes[i]).clone());else{cl.o.appendChild(document.createTextNode($igk(this.o.childNodes[i]).text()));}}}return cl;},copyAttributes:function(i){i=$igk(i);if((i==null)||!i.o.hasAttributes||!i.o.attributes)return;var j="";for(var k=0;k<i.o.attributes.length;k++){j=i.o.attributes[k];try {this.o.setAttribute(j.name,j.value);}catch(Exception){console.debug("error when try to copy "+j.name);}}return this;},each:function(func,args){if(this.o.each)this.o.each(func,args);return this;},each_all:function(func,args){if(this.o.each_all)this.o.each_all(func,args);return this;},getItemAt:function(index){if(this.o.getItemAt){return this.o.getItemAt(index);}return null;},first:function(index){if(this.o.getItemAt){return this.o.getItemAt(0);}return null;},last:function(index){if(this.o.getItemAt){return this.o.getItemAt(this.o.getCount()-1);}return null;},getNodeAt:function(index){if(this.o.getNodeAt){return this.o.getNodeAt(index);}return this.o.ChildNodes[index];},getCount:function(){if(this.o.getCount)return this.o.getCount();return 0;},isSr:function(){if(this.o.each)return !0;return !1;},getChildCount:function(){if(this.o.childNodes){return this.o.childNodes.length;}return 0;},timeOut:function(time,func){var q=this;var s=m_timeOutList.length;var i=setTimeout(function(){func.apply(q);m_timeOutList.pop(s);},time);m_timeOutList.push(i);return this;},clearTimeOut:function(){while(m_timeOutList.length>0){clearTimeout(m_timeOutList[0]);m_timeOutList.pop(0);}return this;},on :function(method,func){if(this.o.each){this.o.each(this.on,arguments);return this;}else{igk.winui.reg_event(this.o,method,func);return this;}},waitInterval:function(duration,func){if(this.isSr()){this.o.waitInterval(duration,func);}else{var q=this;setTimeout(function(){func.apply(q)},duration);}return this;},css:function(value){if(this.o.each){this.o.each(this.css,arguments);return this;}else{this.o.style=value;return !0;}},getCssSelector:function(){var o=0;var cl=0;o=this.o.tagName.toLowerCase();if(this.o.id)o+="#"+this.o.id;cl=this.o.className;if(cl){var t=cl.split(" ");for(var k=0;k<t.length;k++){o+="."+t[k];}}return o;},setCss:function(properties){if(this.isSr()){this.o.each(this.setCss,arguments);return this;}else{igk.css.setProperties(this.o,properties);}return this;},setCssAssert:function(c,p){if(c){this.setCss(p);}return this;},setProperties:function(properties){if(!properties)return this;if(this.isSr()){this.o.each(this.setProperties,arguments);}else {for(var i in properties){try{this.o[i]=properties[i];}catch(Ex){console.debug("can't  set property "+i);}}}return this;},hide:function(){this.setCss({"display":"none"});},show:function(){this.setCss({"display":"inline-block"});},fadein:function(interval,duration,opacityOrProperties,callback){window.igk.animation.fadein(this.o,interval,duration,opacityOrProperties,callback);return this;},fadeout:function(interval,duration,opacityOrProperties,callback){window.igk.animation.fadeout(this.o,interval,duration,opacityOrProperties,callback);return this;},getoffsetParent:function(){if(this.isSr()){return this;}return $igk(igk.winui.GetRealOffsetParent(this.o));},getscrollParent:function(){if(this.isSr()){return this;}return $igk(igk.winui.GetRealScrollParent(this.o));},appendProperties:function(properties,override){if(!properties)return this;if(this.isSr()){this.each(this.appendProperties,arguments);return this;}else{igk.appendProperties(this,properties,override);}return this;},dispatchEvent:function(evt){if(this.o.dispatchEvent){this.o.dispatchEvent(evt);}else{if(document.dispatchEvent){document.dispatchEvent(evt);}}},raiseEvent:function(n){if(!this.isSr()){var e=this.o[n];if(e!=null){try{if(this.o.dispatchEvent){this.o.dispatchEvent(e);}else{if(document.dispatchEvent)document.dispatchEvent(e);else{document.documentElement[n]++;}}}catch(ex){console.debug(n+" "+ex.message+" ");}}}return this;},addEvent:function(n,p){var q=this;if(!this.isSr()){var e=null;if(typeof(Event)==IGK_FUNC){e=new Event(n);igk_appendProp(e,p);}else{if(document.createEvent){e=document.createEvent('CustomEvent');e.initCustomEvent(n,true,false,{});igk_appendProp(e,p);igk_appendProp(e,{fordoc:true});}else{e=new(function(){var self=this;function __ecall(evt){if(evt.propertyName==n){igk.winui.getEventObjectManager().raise(self.target.o,n);}}document.documentElement.attachEvent('onpropertychange',__ecall);igk_appendProp(this,p);igk_appendProp(this,{fordoc:true,target:q,unregister:function(){document.documentElement.detachEvent('onpropertychange',__ecall);}});})();}}if(e !=null){try{this.o[n]=e;this.raiseEventCreated(n);}catch(e){}}}return this;},getParentBody:function(){if(this.isSr()){return null;}var q=this.o;while(q &&(q.tagName.toLowerCase()!="body")){q=q.parentNode;}return q;},addClass:function(classname){if(this.isSr()){this.o.each(this.addClass,arguments);return this;}else{if((typeof(classname)==="string")&&(classname.length>0)){var ch=false;if(typeof(this.o.className)==IGK_UNDEF){this.o.className=classname;ch=true;}else{var tab=classname.split(" ");var s="";var k="";var st={};for(var i=0;i<tab.length;i++){k=igk.system.string.trim(tab[i]);if(st[k]){continue;}st[k]=1;if(this.o.className && !this.o.className.indexOf){console.debug(this.o.className);continue;}if((k.lenth==0)||(this.o.className &&(this.o.className.indexOf(k)!==-1)))continue;if(s.length>0)s+=" ";s+=k;ch=!0;}if(s.length>0){if(this.o.className==" ")this.o.className=igk.system.string.trim(ts);else{this.o.className=igk.system.string.trim(this.o.className+" "+s);}}}if(ch){igk.publisher.publish("sys://dom/classchanged",{target:this,className:classname});}}}return this;},rmClass:function(classname){if(typeof classname==="string"){classname=igk.system.string.trim(classname);if(classname.length==0){return this;}if(this.isSr()){this.o.each(this.rmClass,arguments);return this;}else{var tab=classname.split(" ");var cur=this.o.className;var rms="";var index=0;var s="";var removing=false;if(cur){for(var i=0;i<tab.length;i++){s=tab[i];index=cur.indexOf(s);while((index>=0)&&((index+s.length)<=cur.length)){cur=cur.replace(tab[i],"");index=cur.indexOf(tab[i]);removing=!0;}}var h=igk.system.string.trim(cur);this.o.className=h;}}}return this;},rmAllClass:function(rg){if(typeof rg==="string"){if(this.isSr()){this.o.each(this.rmClass,arguments);return this;}else{var cur=this.o.className;var tab;var _rg;if(cur){tab=cur.split(" ");_rg=new RegExp(rg);var o="";for(var i=0;i<tab.length;i++){if(_rg.test(tab[i])){continue;}o+=tab[i]+" ";}cur=o;var h=igk.system.string.trim(cur);this.o.className=h;igk.success=1;}else igk.success=0;}}return this;},rpClass:function(oldcl,newcl){if(typeof oldcl==="string"){if(this.isSr()){this.o.each(this.rpClass,arguments);return this;}else{var tab=oldcl.split(" ");var cur=this.o.className;var rms="";var index=0;var s="";var removing=false;if(cur){for(var i=0;i<tab.length;i++){s=tab[i];index=cur.indexOf(s);while((index>=0)&&((index+s.length)<=cur.length)){cur=cur.replace(tab[i],"");index=cur.indexOf(tab[i]);removing=!0;}}var h=igk.system.string.trim(cur);if(newcl)h+=" "+newcl;this.o.className=h;}}}return this;},supportClass:function(classname){if(this.isSr()){return !1;}var cl=this.o.className;var exp="($|[\\s]?)("+classname+"){1}($|[\\s]+)";var rg=new RegExp(exp,"g");if(rg.test(cl)){return !0;}return !1;},toggleClass:function(cl){if(this.supportClass(cl)){this.rmClass(cl);}else{this.addClass(cl);}},qselect:function(pattern){if(this.isSr()){return this.o.qselect(pattern);}return igk.qselect(this.o,pattern);},select:function(pattern){if(this.isSr()){return this.o.select(pattern);}return igk.select(this.o,pattern);},getForm:function(){if(this.o.form)return this.o.form;return igk.getParentByTagName(this.o,"form");},replaceOwner:function(d){if(d){m_o=d;}},replaceTagWith:function(nTagName){if(this.isSr()){this.o.each(this.replaceTagWith,arguments)}else{var d=igk.createNode(nTagName);d.setHtml(this.o.innerHTML);igk.dom.copyAttributes(this.o,d.o);igk.dom.replaceChild(this.o,d.o);this.replaceOwner(d.o);}return this;},view:function(){if(this.isSr()){return this;}var p=this.getscrollParent();if(p){if(p.o.scroll)p.o.scroll(this.o.offsetLeft,this.o.offsetTop);}return this;},scroll:function(x,y){this.o.scrollLeft=x;this.o.scrollTop=y;if(this.o.scrollLeft !=x){console.error("/!\\ scroll x not changed: "+this.o.scrollLeft+"=>"+x);}if(this.o.scrollTop !=y){console.error("/!\\ scroll y not changed: "+this.o.scrollTop+"=>"+y);}},animate:function(propertyToAnimate,animationProperty){if(this.isSr()){this.each(this.animate,arguments);}else{igk.animation.animate(this.o,propertyToAnimate,animationProperty);}return this;},animateUpdate:function(animationProperty){igk.animation.animateUpdate(this.o,animationProperty);return this;},scrollTo:function(t,property,callback){if((t==null)||typeof(t)!='object')return;if((property==null)||(typeof(property)==IGK_UNDEF)){property={duration:500,interval:20,effect:"linear",effectmode:"easeinout" };}var ts=igk.fn.isItemStyleSupport(this.o,"transition");var trf=igk.fn.isItemStyleSupport(this.o,"transform");var it=$igk(t);var self=this;var counter=0;var m_il=new igk.system.collections.list();var scrollprop=null;var m_duration_ms=property? igk.datetime.timeToMs(property.duration):null;var mout=null;function __init_scroll(){var offsetParent=it.getscrollParent();if(offsetParent==null){return null;}return new(function(){var q=this;var orientation="vertical";var distance=0;var d=0;var o=self.o;var v_loc=self.getLocation();var startpos=0,endpos=0,endscroll=0;var pos=0;v_loc.y+=self.o.scrollTop;v_loc.x+=self.o.scrollLeft;var v_ttloc=it.getLocation();v_ttloc.y+=it.o.scrollTop;v_ttloc.x+=it.o.scrollLeft;var v_tloc=it.getscrollLocation(offsetParent.o);if(!property.orientation){var pp=it.getOffsetScreenLocation(self);orientation=pp.orientation;}else{orientation=property.orientation? property.orientation:"vertical";}if(orientation=="vertical"){startpos=v_loc.y;endscroll=v_tloc.y;d=endscroll-startpos;q.dir=(d>0)?"godown":"goup";}else{startpos=v_loc.x;endscroll=v_tloc.x;d=endscroll-startpos;q.dir=(d>0)?"goright":"goleft";}distance=Math.abs(d);var sign=d>=0?1:-1;q.distance=distance;q.sign=sign;q.target=t;igk.appendProperties(this,{getTransform:function(){if(orientation=="vertical")return "TranslateY("+(-sign*distance)+"px)";return "TranslateX("+(-sign*distance)+"px)";},getStartTransform:function(){if(orientation=="vertical")return "TranslateY("+startpos+"px)";return "TranslateX("+startpos+"px)";},resetTransform:function(){if(orientation=="vertical")return "TranslateY(0px)";return "TranslateX(0px)";},getStartScroll:function(){return startpos;},X:function(){if(orientation=="horizontal")return startpos+(sign*distance);return 0;},Y:function(){if(orientation=="vertical")return startpos+(sign*distance);return 0;}});})();};function __clearTransition(){self.select('>>').each_all(function(){if(!this.o.nodeType||(this.o.nodeType !=1)||(this.o.tagName.toLowerCase()=='script'))return;if(!this.o.style||(property.filter && property.filter(this))){return;}this.rmClass("igk-trans-all-200ms").setCss({transform:scrollprop.resetTransform(),transitionDuration:null });});var pp=scrollprop;self.scroll(pp.X(),pp.Y());if(callback){callback({"type":"transition",target:t,x:pp.X(),y:pp.Y()});}}function __transition_end(evt){var g=$igk(igk.winui.eventTarget(evt));m_il.remove(g);counter--;if(counter<=0){__clearTransition();}else{if(mout)clearTimeout(mout);mout=setTimeout(function(){if(counter>0){__clearTransition();counter=0;}},500);}igk.winui.unreg_event(this,'transitionend',__transition_end);};if(ts && trf){console.debug("use transition to scroll");scrollprop=__init_scroll();counter=0;if(scrollprop && scrollprop.distance!=0){if(!scrollprop.getTransform){throw("[IGK] no scrollprop.getTransform function found");return;}counter=0;self.select('>>').each_all(function(){if(!this.o.nodeType||(this.o.nodeType !=1)||(this.o.tagName.toLowerCase()=='script'))return;if(!this.o.style||(property.filter && property.filter(this))){return;}counter++;m_il.add(this);this.reg_event("transitionend",__transition_end);this.addClass("igk-trans-all-200ms").setCss({"transform":scrollprop.getTransform()});});}else{if(callback)callback();}return;}if(m_anim && m_anim.scrolling){m_anim.scrolling.stop();}if(property==null){target.scrollIntoView();if(callback!=null)callback({"type":"scrollIntoView"});return !0;}var anim1=igk.animation.init(this,property.interval,property.duration,function(){var self=this;self.offsetParent=$igk(t).getscrollParent();if(self.offsetParent==null)return;var d=0;var q=self.getOwner().o;var v_loc=self.getOwner().getLocation();v_loc.y+=q.scrollTop;v_loc.x+=q.scrollLeft;var v_tloc=$igk(t).getscrollLocation(self.offsetParent.o);self.speed=property.speed? property.speed :0.05;if(!property.orientation){if(v_loc.y==v_tloc.y)self.orientation="horizontal";else self.orientation="vertical";}else{self.orientation=property.orientation? property.orientation:"vertical";}self.pos=0;if(self.orientation=="vertical"){self.startpos=v_loc.y;self.endscroll=v_tloc.y;d=self.endscroll-self.startpos;self.dir=(d>0)?"godown":"goup";}else{self.startpos=q.scrollLeft;self.endscroll=v_tloc.x;d=self.endscroll-self.startpos;self.dir=(d>0)?"goright":"goleft";}self.distance=Math.abs(d);},function(){var d=this.distance;if(d==0){return !0;}var v_o=this.offsetParent !=null ? this.offsetParent :this.getOwner();var y=0;var end=false;var f=this.getStepfactor();var sign=(this.dir=="goleft")||(this.dir=="goup")?-1:1;y=this.startpos+(sign*f*d);this.pos=y;end=(this.getEllapsed()/this.getDuration())>=1.0;switch(this.dir){case "godown":v_o.scroll(0,y);break;case "goup":v_o.scroll(0,y);break;case "goright":v_o.scroll(y,0);break;case "goleft":v_o.scroll(y,0);break;default:return !1;}return !end;},function(){var v_o=this.getOwner();if(m_anim && m_anim.__anim && m_anim.__anim.scrolling)delete m_anim.__anim.scrolling;if(callback)callback({"type":"igk.animation"});});m_anim=createPNS(this,"__anim",{"scrolling":anim1});m_anim.type="scrolling";anim1.properties=property;anim1.start();return !0;},getParentByTagName:function(tag){return igk_getParentByTagName(this.o,tag);},getParentById:function(id){return igk_getParentById(this.o,id);},remove:function(){if(this.isSr()){this.o.each(this.remove,arguments);}else{if(this.o.parentNode)this.o.parentNode.removeChild(this.o);}return this;},transEnd:function(n,t){var q=this;function __function_end(evt){if(evt.target==q.o){if(typeof(n)=="function")n.apply(q);else{if(n in q){q[n].apply(q);}}q.unreg_event("transitionend",__function_end);}};if(this.isSr()){this.o.each(q.transEnd,arguments);}else{this.reg_event("transitionend",__function_end);}return q;},loadStringAsHtml:function(s,evalscript){if(this.o.each){this.o.each(this.loadStringAsHtml,arguments);}else{if(typeof(this.o.appendChild)!="undefined"){var m=igk.createNode("dummyNode");m.setHtml(s);if(m.o.childNodes.length==1){var p=m.o.childNodes[0];var c=p.childNodes.length;this.o.innerHTML="";while(c>0){this.o.appendChild(p.childNodes[0]);c--;}}}if(evalscript)igk.system.evalScript(this.o);}return this;},istouchable:function(){if((typeof(this.o.ontouchstart)!=IGK_UNDEF)&& (typeof(this.o.ontouchend)!=IGK_UNDEF)&& (typeof(this.o.ontouchmove)!=IGK_UNDEF)&& (typeof(this.o.ontouchcancel)!=IGK_UNDEF))return !0;return !1;},isCssSupportTransition:function(){return igk.fn.isItemSupport(this.o.style,['transition','webkitTransition','msTransition','oTransition']);},isCssSupportAnimation:function(){return igk.fn.isItemSupport(this.o.style,['animation','webkitAnimation','msAnimation','oTransition']);},setTransitionDelay:function(time){if(this.o.each){this.o.each(this.setTransitionDelay,arguments);}else igk.css.setTransitionDelay(this,time);return this;},setTransition:function(k){if(this.o.each){this.o.each(this.setTransition,arguments);}else this.setCss({transition:k});return this;},setTransitionDuration:function(time){if(this.o.each){this.o.each(this.setTransitionDuration,arguments);}else igk.css.setTransitionDuration(this,time);return this;},replaceWith:function(t){if(this.o.each){this.o.each(this.setHtml,arguments);}else{this.clearAttributes();igk.dom.copyAttributes(this.o,$igk(t).o);this.setHtml($igk(t).getHtml());}return this;},clearAttributes:function(){while(this.o.attributes.length>0){this.o.removeAttribute(this.o.attributes[0].name);}return this;},text:function(){if(this.o.each){this.o.each(this.text,arguments);}else{if("textContent" in this.o)return this.o.textContent;return("data" in this.o)? this.o.data :null }},setHtml:function(v,evalScript){if(this.o.each){this.o.each(this.setHtml,arguments);}else{this.o.innerHTML=v;if(evalScript){igk.system.evalScript(this.o);}}return this;},getText:function(){var s="";if(this.o.innerHTML){s=igk.html.string(this.getHtml());}return s;},getHtml :function(){var s="";if(this.o.each){var fc=this;var args=arguments;this.o.each_all(function(){s+=fc.getHtml.apply(this,args);});}else{return('innerHTML' in this.o)? this.o.innerHTML :__dom_innerHTML(this.o);}return s;},getOuterHtml:function(){if(this.o.outerHTML)return this.o.outerHTML;var s="";if(this.o.each){s+=this.o.each(this.getOuterHtml,arguments);}else{if(typeof(this.o.tagName)!=IGK_UNDEF){s="<"+this.o.tagName;if(this.o.hasAttributes){s+=" ";for(var i=0;i<this.o.attributes.length;i++){var g=this.o.attributes[i];if(i!=0)s+=" ";s+=g.name+"=\""+g.value+"\"";}}s+=">";for(var i=0;i<this.o.childNodes.length;i++){s+=$igk(this.o.childNodes[i]).getOuterHtml();}s+="</"+this.o.tagName+">";}else{s+=this.o.wholeText;}}return s;},evalScript :function(){if(this.o.each){this.o.each(this.evalScript,arguments);}else{igk.system.evalScript(this.o);}return this;},init:function(){if(this.o.each){this.o.each(this.init,arguments);}else igk.ajx.fn.initnode(this.o);return this;},render:function(){var s="";if(this.o.each){s+=this.o.each(this.renber,arguments);}else{return this.o.outerHTML;}return s;},getAllAttribs:function(){var msg="";if(this.o.attributes){for(var h=0;h<this.o.attributes.length;h++){msg+=this.o.attributes[h].name+" ";}}return msg;},getParentNode:function(){return $igk(this.o.parentNode);},getStyle:function(name){if(!this.isSr()){return igk.css.getValue(this.o,name);}return "no-value";},getComputedStyle:function(n,select){if(!this.isSr()){if(window.getComputedStyle){var q=window.getComputedStyle(this.o,select);return igk.css.getStyleValue(q,n);}return null;}return "no-value";},setAttributes:function(properties){if(!properties)return ;for(var i in properties){this.o.setAttribute(i,properties[i]);}return this;},setAttribute:function(name,value){if(this.o.each){this.o.each(this.setAttribute,arguments);}else this.o.setAttribute(name,value);return this;},setAttributeAssert:function(condition,name,value){if(condition){this.setAttribute(name,value);}return this;},setSize:function(w,h){if(h==null)h=w;this.setCss({"width":w,"height":h});return this;},getAttribute:function(value){if(this.o.getAttribute)return this.o.getAttribute(value);return null;},getChildById:function(id){return igk_getChildById(this.o,id);},getChildsByAttr:function(properties){return igk_getChildsByAttr(this.o,properties);},getParent :function(tagname){if(tagname){return this.getParentByTagName(tagname);}return $igk(this.o.parentNode);},getParentForm:function(){return this.getParentByTagName("form");},getPixel:function(propName,o){return igk.getPixel(this.getComputedStyle(propName),o||this.o,propName);},appendChild:function(name){var item=null;if(typeof(name)=="string"){item=document.getElementById(name);}else{item=name;}if(item !=null){var s=$igk(item);this.o.appendChild(s.o);return s;}},appendNChild:function(tagname){var item=this.createElement(tagname);this.appendChild(item);return item;},insertBefore:function(i,j){this.o.insertBefore(i,j);},firstChild:function(){return(this.o.firstChild)? $igk(this.o.firstChild):null;},firstNode:function(type){var r=null;this.select('>>').each(function(){if(this.o.nodeType==type){r=this.o;return !1;}return !0;});return r;},prependChild:function(node){if(this.o.firstChild)this.o.insertBefore(node,this.o.firstChild);else{this.o.appendChild(node);}},reg_event:function(method,func,opts){if(this.o.each){this.o.each(this.reg_event,arguments);}else{igk.winui.reg_event(this.o,method,func,opts);}return this;},unreg_event:function(method,func){if(this.o.each){this.o.each(this.unreg_event,arguments);}else{igk.winui.unreg_event(this.o,method,func);}return this;},insertAfter:function(item){if(item && this.o.parentNode){if(this.o.parentNode.lastchild==this.o)this.o.parentNode.appendChild(item);else this.o.parentNode.insertBefore(item,this.o.nextSibling);}}});if(!this.isSr()){var m_bE="igk-eventcreated";igk_appendProp(this,{raiseEventCreated:function(n){var e=this.o[m_bE];if(e){e.name=n;this.raiseEvent(m_bE);}else{console.debug("no event to raise "+n);}},postRegisterEvent:function(n,func){if(!n||!func)return;if(n=="igk-eventcreated"){this.reg_event(n,func);}else{if(typeof(this.o[n])==IGK_UNDEF){var _b=this;this.reg_event(m_bE,function _postevent(evt){if(evt.name==n){_b.unreg_event(m_bE,_postevent);_b.reg_event(n,func);}});}else{this.reg_event(n,func);}}}});this.addEvent("igk-eventcreated",{name:null});}igk_appendProp(this,{getOffsetScreenLocation:function(t){var v1=t.getScreenLocation();var v2={x:this.o.offsetLeft,y:this.o.offsetTop};var q=this.o.offsetParent;var v3={x:0,y:0};var v4=this.getScreenLocation();var p=this.o;var o="horizontal";while(q &&(q!=document.body)){if(q==t.o){if(t.o.offsetWidth<v2.x){}if(((v4.x==0)&&(v4.y!=0))||(t.o.offsetHeight<v2.y)){o="vertical";}break;}p=q;q=q.offsetParent;v2.x+=p.offsetLeft;v2.y+=p.offsetTop;v4.x-=p.offsetLeft;v4.y-=p.offsetTop;}return{orientation:o,x:v4.x,y:v4.y};}});this.getElementsByTagName=function(tag){if(this.o.getElementsByTagName)return this.o.getElementsByTagName(tag);};this.getWidth=function(){return this.o.clientWidth;};this.getglobalWidth=function(){return this.o.clientWidth+this.o.scrollWidth;};this.getglobalHeight=function(){return this.o.cliclientHeight+this.o.scrollHeight;};this.getHeight=function(){return this.o.clientHeight;};this.getTop=function(){return this.getLocation().y;};this.getLeft=function(){return this.getLocation().x;};this.getSize=function(){return{w:this.getWidth(),h:this.getHeight(),toString:function(){return "w:"+this.w+" h:"+this.h;}};};this.getLocation=function(){return igk.winui.GetScreenPosition(this.o);};this.getScreenLocation=function(){return igk.winui.GetRealScreenPosition(this.o);};this.getBoundingClientRect=function(){var g=this.o.getBoundingClientRect ? this.o.getBoundingClientRect():{x:0,y:0,width:0,height:0,left:0,top:0,right:0,bottom:0,toString:function(){"igk.boundingClientRect[]" }};if(!g.x)g.x=g.left;if(!g.y)g.y=g.top;return g;};this.getScreenBounds=function(){var l=igk.winui.GetRealScreenPosition(this.o);var s=this.getSize();return{x:l.x,y:l.y,w:s.w,h:s.h,contains:function(x,y){return(l.x<=x)&&((l.x+s.w)>=x)&&(l.y<=y)&&((l.x+s.h)>=y);},toString:function(){return "getScreenBounds["+igk.system.stringProperties(this)+"]";}};};this.getisVisible=function(){var j=this;var loc=j.getBoundingClientRect();var size=igk.winui.screenSize();var vsb=((loc.x>=0)&&(loc.x<=size.width)&&(loc.y>=0)&&(loc.y<=size.height));return vsb;};this.getpresentOnDocument=function(doc){var j=this.o;var _doc=doc||document;while(j &&(j !=_doc)){j=j.parentNode;}return(j!=null);};this.getscrollLeft=function(){if(this.o.pageXOffset){return this.o.pageXOffset;}else if(this.o.scrollLeft)return this.o.scrollLeft;return 0;};this.getscrollTop=function(){if(this.o.pageYOffset){return this.o.pageYOffset;}else if(this.o.scrollTop)return this.o.scrollTop;return 0;};this.getscrollLocation=function(targetParent){return igk.winui.GetScrollPosition(this.o,targetParent);};this.getscrollMaxTop=function(){if(this.o.scrollTopMax)return this.o.scrollTopMax;else return this.o.offsetHeight;};this.getscrollMaxLeft=function(){if(this.o.scrollLeftMax)return this.o.scrollLeftMax;else return this.o.offsetWidth;};this.createElement=function(tagname){return igk.createNode(tagname);};this.isChildOf=function(target){var q=this.o.parentNode;while(q){if(q==target)return !0;q=q.parentNode;}return !1;};this.collapse=function(property,callback){if(m_anim && m_anim.collapsing){m_anim.collapsing.stop();}var anim1=igk.animation.init(this,property.interval,property.duration,function(){},function(){},function(){if(m_anim && m_anim.__anim && m_anim.__anim.collapsing)delete m_anim.__anim.collapsing;if(callback)callback();});m_anim=createPNS(this,"__anim",{"collapsing":anim1});m_anim.type="scrolling";anim1.start();return !0;};this.expand=function(property,callback){if(m_anim && m_anim.expanding){m_anim.expanding.stop();}var anim1=igk.animation.init(this,property.interval,property.duration,function(){},function(){},function(){if(m_anim && m_anim.__anim && m_anim.__anim.expanding)delete m_anim.__anim.expanding;if(callback)callback();});m_anim=createPNS(this,"__anim",{"expanding":anim1});m_anim.type="scrolling";anim1.start();return !0;};};if(typeof(element.igk)==igk.constants.undef){(function(){this.igk=new __igk_nodeProperty(element);this.igk.$=window.igk;}).apply(element);}if(typeof(element.$)==igk.constants.undef){(function(){this.global=window.igk;}).apply(element);}},getNumber:igk_getNumber,getUnit:igk_getUnit,getPixel:igk_getPixel });igk_appendProp(igk,{exception:function(msg){this.name="IGKException";this.level="";if(typeof(msg)=="string"){this.message="Error:"+msg;}else if(typeof(msg)=="object"){igk_appendProp(this,msg);}this.toString=function(){return this.name+" : "+this.message;};}});createNS("igk.uri",{getQueryArg:function(q){return new(function(){var nb=[];var i=q.indexOf("?");if(i!=-1){var e=q.substr(i+1);var ln=e.length,pos=0;var c=0;var t=0;var n="";var v="";while(pos<ln){c=e[pos];switch(c){case "=":t=1;break;case "&":nb[n]=v;nb.push(v);t=0;n="";v="";break;default:if(t==0){n+=c;}else v+=c;break;}pos++;}if(t==1){nb[n]=v;nb.push(v);}console.debug(nb);}igk.appendProperties(this,{get:function(n){return nb[n];}})})();}});(function(){var m_publisher={};var m_staticReg={};var m_publisherobj=new function(){igk.appendProperties(this,{toString:function(){return "publisher obj";}});};var m_cinf={};createNS("igk.publisher",{createEventData:function(t,ctx){return{target:t,context:ctx };},register:function(n,func){if(!n||!func)return !1;var e=null;if(m_publisher[n]){e=m_publisher[n];}else{e={k:n,s:new igk.system.collections.list(),toString:function(){return "publisher-entity";}};m_publisher[n]=e;}e.s.add(func);},unregister:function(n,func){var e=m_publisher[n];if(typeof(e)==IGK_UNDEF)return;e.s.remove(func);if(e.s.getCount()==0){delete(m_publisher[n]);}},publish:function(n,prop){var e=m_publisher[n];if(typeof(e)==IGK_UNDEF)return;var tab=[];for(var i=0;i<e.s.getCount();i++){tab.push(e.s.getItemAt(0));}for(var i=0;i<tab.length;i++){m_cinf={name:n,caller:tab[i],funcs:e.s };m_cinf.caller.apply(m_cinf,[prop]);}},getName:function(obj,ns,name){if(obj instanceof igk.object){if(obj.type=="class"){return name;}}else{for(var i in ns){if(obj.constructor==ns[i])return i;}}},inheritFrom:function(src,parent){if((typeof(src)=='function')&&(typeof(parent)=='function')){var p=new parent();src.prototype=p;src.prototype.$parent=p;src.prototype.$super=function(m){var r=arguments.length>1? igk.system.array.slice(arguments,1):null;this.$parent[m].apply(this,r);};return !0;}return !1;},registerStatic:function(ns,name,func){var fname=ns.namespace+"."+name;if(m_staticReg[fname]){return;}m_staticReg[fname]=1;func.call(ns);},createPublisherEvent:function(prop){var c=new igk.publisher.event();igk.appendProperties(c,prop);return c;},event:function(){igk.appendProperties(this,{toString:function(){return "publisher event";}});},getCount:function(n){n=n||this.name;if(!n)return-1;var e=m_publisher[n];if(typeof(e)==IGK_UNDEF)return-2;return e.s.getCount();}});})();createNS("igk.os",{checkupdate:function(uri,v){var q=$igk(igk.getParentScript());(function(){igk.io.file.load(uri,function(d){if(!d.error){var c=igk.createNode("dummy");c.setHtml(d.data);var m=c.getElementsByTagName("Message")[0];var s=c.getElementsByTagName("status")[0]||null;var v=s? s.innerHTML:-1;if(m)q.setHtml(m.innerHTML);else{q.remove();}return;}var w=$igk("#dialog.error").first();if(w){var m=w.select(".msg").first().clone();igk.show_notify_error(w.select(".title").first().getHtml(),m.getHtmll());}q.remove();});})();},update:function(u){var w=$igk("#dialog.wait").first();if(w){var m=w.select(".msg").first().clone();igk.winui.notify.showMsBox(w.select(".title").first().getHtml(),m,'default',1 );igk.ajx.fn.initnode(m.o);}igk.io.file.load(u,function(d){igk.winui.notify.close(function(){var w=$igk("#dialog.os-complete").first();if(w){igk.winui.notify.showMsBox(w.select(".title").first().getHtml(),w.select(".msg").first().getHtml());}else{igk.winui.notify.showMsBox("OS","Update complete");}var k=igk.utils.getBodyContent(d.data);var m=igk.createNode('div').setHtml(k);var uk=m.select('ruri').first().o.innerHTML;if(uk){igk.ajx.post(uk+"/?c=c_sc&f=forceview",null,igk.ajx.fn.replace_body);}});});},install:function(f,msg){var q=igk.createNode("div");ns_igk.ajx.postform(f,f.action,function(xhr){if(this.isReady()){f.reset();q.remove();igk.ajx.replaceBody(xhr.responseText,true);igk.winui.notify.showMsBox("OS",msg.complete);}});$igk(f).o.appendChild(q.o);q.setHtml(msg.wait);}});createNS("igk.features",{});(function(){var _passive=false;try{var opts={};igk_defineProperty(opts,'passive',{get:function(){_passive=true;}});if(window.addEventListener){window.addEventListener('test',null,opts);}}catch(e){}igk_defineProperty(igk.features,'supportPassive',{get:function(){return _passive;}});igk_defineProperty(igk.features,'supportBackgroundWorker',{get:function(){return typeof(window.Worker)!=='undefined';}});})();createNS("igk.fn",{isset:function(i){if((i==null)||(typeof(i)==IGK_UNDEF))return !1;return !0;}},{desc:"igk utility fonctions"});createNS("igk.debug",{write:function(msg){if(igk.DEBUG){console.debug(msg);}},assert:function(c,m){if(c){console.debug(m);}},enable:function(f){igk.DEBUG=f;}});var prop_toextend=0;createNS("igk.fn",{getItemFunc:function(it,n,fallback){if(n in it)return it[n];var c="";var r=n[0].toUpperCase()+n.substring(1);for(var i=0;i<m_provider.length;i++){c=m_provider[i]+r;if(c in it)return it[c];}return fallback;},getWindowFunc:function(n,fallback){return igk.fn.getItemFunc(window,n,fallback);},isItemStyleSupport:function(item,name){var t=[name.toLowerCase()];var h=m_provider;var k=name[0].toUpperCase()+name.substring(1).toLowerCase();for(var i=0;i<h.length;i++){t.push(h[i]+k);}return igk.fn.isItemSupport(item.style,t);},isItemSupport:function(e,tab){if(!e||!tab)return !1;for(var i=0;i<tab.length;i++){if(typeof(e[tab[i]])!=IGK_UNDEF)return !0;}return !1;},isItemSupportAll:function(e,tab){if(!e||!tab)return !1;for(var i=0;i<tab.length;i++){if(typeof(e[tab[i]])==IGK_UNDEF)return !1;}return !0;},getItemProperty:function(i,n){var g=prop_toextend||(function(){return prop_toextend={isFullScreen:["webkitIsFullScreen","mozFullScreen"],fullscreenElement:["webkitFullScreenElement","mozFullScreenElement"],fullscreenEnabled:["webkitFullScreenEnabled","mozFullScreenEnabled"],};})();if(n in i)return n;var tab=g[n];for(var m=0;m<tab.length;m++){if(tab[m]in i){return tab[m];}}return 0;}});function def_property(o,n){igk_defineProperty($igk(o),n,{get:function(){return o[igk.fn.getItemProperty(o,n)];}});}def_property(window.document,"isFullScreen");def_property(window.document,"fullscreenElement");def_property(window.document,"fullscreenEnabled");createNS("igk.ext",{call:function(name,p){var r=arguments.length>1? igk.system.array.slice(arguments,1):IGK_UNDEF;if(typeof(external)!="undefined"){r=(typeof(p)=="object")? igk.JSON.convertToString(p):r;try{if(r==IGK_UNDEF)return external[name]();return external[name](r);}catch(ex){igk.show_notify_error("Exception on Call : "+name,ex+"<br /><pre>"+ex.stack+"</pre>" );}}return null;},buildJSONData:function(t){if((t==null)||(typeof(t)==IGK_UNDEF))return "";var ob={};$igk(t).select(".dial-item").each_all(function(){var id=this.getAttribute("id");switch(this.o.tagName.toLowerCase()){case "select":ob[id]=this.o.value;break;default:var o=this.getAttribute("type")||"text";switch(o){case "checkbox":if(this.o.checked)ob[id]=this.o.value;break;default:ob[id]=this.o.value;break;}break;}});var s=JSON.stringify(ob);return s;}});createNS("igk.system.colors",{transparent:"Transparent",black:"#000",navy:"#00007F",darkblue:"#00008C",mediumblue:"#00C",blue:"#00F",darkgreen:"#006300",green:"#007F00",teal:"#007F7F",darkcyan:"#008C8C",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00F999",lime:"#0F0",springgreen:"#00FF7F",aqua:"#0FF",cyan:"#0FF",midnightblue:"#191970",dodgerblue:"#1E8EFF",lightseagreen:"#21B2AA",forestgreen:"#218C21",seagreen:"#2D8C56",darkslategrey:"#2D4F4F",darkslategray:"#2D4F4F",limegreen:"#3C3",mediumseagreen:"#3DB270",turquoise:"#3FE0D1",royalblue:"#3F68E0",steelblue:"#4482B5",darkslateblue:"#473D8C",mediumturquoise:"#47D1CC",indigo:"#490082",darkolivegreen:"#546B2D",cadetblue:"#5E9EA0",cornflowerblue:"#6393ED",mediumaquamarine:"#6CA",dimgray:"#686868",dimgrey:"#686868",slateblue:"#6B59CC",olivedrab:"#6B8E23",slategrey:"#707F8E",slategray:"#707F8E",lightslategray:"#778799",lightslategrey:"#778799",mediumslateblue:"#7A68ED",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD3",maroon:"#7F0000",purple:"#7F007F",olive:"#7F7F00",grey:"#7F7F7F",gray:"#7F7F7F",skyblue:"#87CEEA",lightskyblue:"#87CEF9",blueviolet:"#892BE2",darkred:"#8C0000",darkmagenta:"#8C008C",saddlebrown:"#8C4411",darkseagreen:"#8EBC8E",lightgreen:"#8EED8E",mediumpurple:"#9370D8",darkviolet:"#9300D3",palegreen:"#99F999",darkorchid:"#93C",yellowgreen:"#9C3",sienna:"#A0512D",brown:"#A52828",darkgrey:"#A8A8A8",darkgray:"#A8A8A8",lightblue:"#ADD8E5",greenyellow:"#ADFF2D",paleturquoise:"#AFEDED",lightsteelblue:"#AFC4DD",powderblue:"#AFE0E5",firebrick:"#B22121",darkgoldenrod:"#B7870A",mediumorchid:"#BA54D3",rosybrown:"#BC8E8E",darkkhaki:"#BCB76B",silver:"#BFBFBF",mediumvioletred:"#C61484",indianred:"#CC5B5B",peru:"#CC843F",chocolate:"#D1681E",tan:"#D1B58C",lightgrey:"#D3D3D3",lightgray:"#D3D3D3",palevioletred:"#D87093",thistle:"#D8BFD8",orchid:"#D870D6",goldenrod:"#D8A521",crimson:"#DB143D",gainsboro:"#DBDBDB",plum:"#DDA0DD",burlywood:"#DDB787",lightcyan:"#E0FFFF",lavender:"#E5E5F9",darksalmon:"#E8967A",violet:"#ED82ED",palegoldenrod:"#EDE8AA",lightcoral:"#EF7F7F",khaki:"#EFE58C",aliceblue:"#EFF7FF",honeydew:"#EFFFEF",azure:"#EFFFFF",sandybrown:"#F4A360",wheat:"#F4DDB2",beige:"#F4F4DB",whitesmoke:"#F4F4F4",mintcream:"#F4FFF9",ghostwhite:"#F7F7FF",salmon:"#F97F72",antiquewhite:"#F9EAD6",linen:"#F9EFE5",lightgoldenrodyellow:"#F9F9D1",oldlace:"#FCF4E5",red:"#F00",magenta:"#F0F",fuchsia:"#F0F",deeppink:"#FF1493",orangered:"#F40",tomato:"#FF6347",hotpink:"#FF68B5",coral:"#FF7F4F",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB5C1",pink:"#FFBFCC",gold:"#FFD600",peachpuff:"#FFD8BA",navajowhite:"#FFDDAD",moccasin:"#FFE2B5",bisque:"#FFE2C4",mistyrose:"#FFE2E0",blanchedalmond:"#FFEACC",papayawhip:"#FFEFD6",lavenderblush:"#FFEFF4",seashell:"#FFF4ED",cornsilk:"#FFF7DB",lemonchiffon:"#FFF9CC",floralwhite:"#FFF9EF",snow:"#FFF9F9",yellow:"#FF0",lightyellow:"#FFFFE0",ivory:"#FFFFEF",white:"#FFF"});createNS("igk.system.color",{HSVtoColor:function(h,s,v){var r,g,b;var c=v*s;var x=c*(1-Math.abs(((h /60.0)% 2)-1));var m=v-c;if(h<60){r=c;g=x;b=0;}else if(h<120){r=x;g=c;b=0;}else if(h<180){r=0;g=c;b=x;}else if(h<240){r=0;g=x;b=c;}else if(h<300){r=x;g=0;b=c;}else{r=c;g=0;b=x;}return{r:parseInt(r*255),g:parseInt(g*255),b:parseInt(b*255)};}});function _setall(t,s){for(var i=0;i<t.length;i++){t[i]=s;}}createNS("igk.system.colors",{toFloatArray:function(n){var c=0;if(igk.isInteger(n)){c="#"+n.toString(16);}else{c=igk.system.colors[n.toLowerCase()];}var t=new Float32Array(4);if(c){if(c[0]=="#"){var s=c.substring(1);switch(s.length){case 1:_setall(t,parseInt((s+s),16)/ 255.0);break;case 3:t[0]=1.0;t[1]=parseInt((s[0]+s[0]),16)/ 255.0;t[2]=parseInt((s[1]+s[1]),16)/ 255.0;t[3]=parseInt((s[2]+s[2]),16)/ 255.0;break;case 4:t[0]=parseInt((s[0]+s[0]),16)/ 255.0;t[1]=parseInt((s[1]+s[1]),16)/ 255.0;t[2]=parseInt((s[2]+s[2]),16)/ 255.0;t[3]=parseInt((s[3]+s[3]),16)/ 255.0;break;case 6:t[0]=1.0;t[1]=parseInt((s[0]+s[1]),16)/ 255.0;t[2]=parseInt((s[2]+s[3]),16)/ 255.0;t[3]=parseInt((s[4]+s[5]),16)/ 255.0;break;case 8:t[0]=parseInt((s[0]+s[1]),16)/ 255.0;t[1]=parseInt((s[2]+s[3]),16)/ 255.0;t[2]=parseInt((s[4]+s[5]),16)/ 255.0;t[3]=parseInt((s[6]+s[7]),16)/ 255.0;break;}}}return{a:t[0],r:t[1],g:t[2],b:t[3]};}});createNS("igk.uri",{addquery:function(s,t){if(s.length>0)s+="&"+t;else s+="?"+t;return s;},getquery :function(ctrlname,funcName,params){var s="";if(ctrlname)s=igk.uri.addquery(s,"c="+ctrlname);if(funcName)s=igk.uri.addquery(s,"f="+funcName);if(params)s=igk.uri.addquery(s,params);return s;}});createNS("igk.char",{isKeyCodeNumber:function(keyCode){return(keyCode>=46)&&(keyCode<69);},isChar:function(key){var t=/^[\w\d]$/.exec(key,true);return(t!=null);},isControl :function(keyCode){return(keyCode<=40);}});createNS("igk.datetime",{timeToMs:function(d){if(typeof(d)=='string'){d=igk.system.string.trim(d);if(igk.system.string.endWith(d,'s')){return parseInt(d.substr(0,d.length-1)*1000);}return parseInt(d)+"ms";}if(typeof(d)=='number'){return parseInt(d)+"ms";}return 0;}});function __igk_get_activeXDocument(){var progIDs=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","htmlfile" ];for(var i=0;i<progIDs.length;i++){try{return new ActiveXObject(progIDs[i]);}catch(e){};}return null;};function __new_activeDocumentObject(){var d=__igk_get_activeXDocument();if(!d)return null;return new(function(d){var m_d=d;igk_defineProperty(this,"async",{get:function(){return m_d.async;},set:function(v){m_d.async=v;}});igk_defineProperty(this,"readyState",{get:function(){return m_d.readyState;}});igk_defineProperty(this,"firstChild",{get:function(){return m_d;}});igk_appendProp(this,{load:function(f){return m_d.load(f);},loadXML:function(s){return m_d.loadXML(s);},onreadystatechange:null,addEventListener:function(method,func,capture){m_d["on"+method]=func;},removeEventListener:function(method,func){m_d["on"+method]=null;},toString:function(){return "igk://activeXDocument";}});})(d);}function __dom_get_root(e){var r=null;$igk(e).select(">>").each(function(){if(this.o.nodeType==1){r=this.o;return false;}return true;});return r;};function __replace_xml_doc(d,txt){var r=igk.dom.loadXML(txt);if(r){d.replaceChild(r,d.documentElement);}};createNS("igk.dom",{replaceTagWith:function(q,tag){var d=igk.createNode(tag);d.setHtml(q.o.innerHTML);igk.dom.copyAttributes(q.o,d.o);igk.dom.replaceChild(q.o,d.o);return d;},createXMLDocument:function(){if(igk.navigator.$ActiveXObject()){return __igk_get_activeXDocument();}return igk.dom.createDocument("xml");},activeXDocument:function(){return __new_activeDocumentObject();},createDocument:function(t,ns){t=t||"xml";var d=null;var m_cb=null;var cs=1;ns=ns||"http://www.w3.org/1999/xhtml";if(document.implementation){if(typeof(document.implementation.createDocument)!=igk.constants.undef){d=document.implementation.createDocument(null,t,null);}}else{if(igk.navigator.$ActiveXObject()){d=__new_activeDocumentObject();cs=0;}}if(d){if(cs && !d.load){d.load=function(l,callback){m_cb=callback;var fc=d.async?function(xhr){var e=document.createEvent("HTMLEvents");e.initEvent("readystatechange",false,false);e.readyState=xhr.readyState;e.xhr=xhr;if((xhr.readyState==4)&&(xhr.status==200)){__replace_xml_doc(d,xhr.responseText);if(m_cb)m_cb();}d.dispatchEvent(e);}:null;var g=igk.ajx.get(l,null,fc,d.async,false,{});if(!d.async){__replace_xml_doc(d,g.xhr.responseText);}return d;};d.async=1;}else if(d.load && d.async){var bfc=d.load;d.load=function(l,callback){m_cb=callback;bfc.apply(this,[l]);return d;};__igk(d).reg_event("readystatechange",function(){if(m_cb &&((d.readyState=="complete")||(d.readyState==4))){m_cb();}});}}return d;},getPropertiesTab:function(t){var o=[];for(var i in t){if(typeof(t[i])=="function")continue;o[i]=t[i];}return o;},compare:function(tab,t){var o=[];var c={};for(var i in t){if(typeof(t[i])=="function")continue;o[i]=t[i];if(tab[i]!=o[i])c[i]=o[i];}return c;},replaceChild:function(target,node){if(target)target.parentNode.replaceChild(node,target);},copyAttributes:function(f,n,a){if((f==null)||(n==null)||(!n.hasAttributes))return;var j="";for(var i=0;i<f.attributes.length;i++){j=f.attributes[i];try {if((a!=null)&&(a[j.name]==1))continue;n.setAttribute(j.name,j.value);}catch(Exception){}}},transformXSL:function(xml,xsl){if(!xml||!xsl)return null;var ex=null;if(document.implementation && document.implementation.createDocument &&(typeof(XSLTProcessor)!=igk.constants.undef)){var xsltProcessor=new XSLTProcessor();xsltProcessor.importStylesheet(xsl);ex=xsltProcessor.transformToFragment(xml,document);if(ex){ex=__dom_get_root(ex);}}else if(igk.navigator.$ActiveXObject()||(xml.responseType=="msxml-document")){if(xml.responseType=="msxml-document"){ex=xml.transformNode(xsl);}else{var srcTree=new ActiveXObject("Msxml2.DOMDocument.6.0");srcTree.async=false;srcTree.loadXML($igk(xml.documentElement).getOuterHtml());if(srcTree.parseError.errorCode!=0)console.debug("srcTree : error code "+srcTree.parseError.errorCode+" : "+srcTree.parseError.reason);var xsltTree=new ActiveXObject("Msxml2.DOMDocument.6.0");xsltTree.async=false;xsltTree.validateOnParse=false;xsltTree.loadXML($igk(xsl.documentElement).getOuterHtml());if(xsltTree.parseError.errorCode!=0)console.debug("xsl : error code "+xsltTree.parseError.errorCode+" : "+xsltTree.parseError.reason);ex=igk.dom.loadXML(srcTree.transformNode(xsltTree));}}return ex;},transformXSLString:function(sxml,sxsl){var ex=null;if(igk.navigator.$ActiveXObject()){var srcTree=new ActiveXObject("Msxml2.DOMDocument.6.0");srcTree.async=false;srcTree.loadXML(sxml);if(srcTree.parseError.errorCode!=0){console.debug("srcTree : error code "+srcTree.parseError.errorCode+" : "+srcTree.parseError.reason);return 0;}var xsltTree=new ActiveXObject("Msxml2.DOMDocument.6.0");xsltTree.async=false;xsltTree.validateOnParse=false;xsltTree.loadXML(sxsl);if(xsltTree.parseError.errorCode!=0){console.debug("xsl : error code "+xsltTree.parseError.errorCode+" : "+xsltTree.parseError.reason);return 0;}ex=igk.dom.loadXML(srcTree.transformNode(xsltTree));}else{if(document.implementation && document.implementation.createDocument){var xsltProcessor=new XSLTProcessor();var xsl=igk.dom.loadXML(sxsl);var xml=igk.dom.loadXML(sxml);if(xsl && xml){var dsl=document.implementation.createDocument(null,'xml',null);dsl.replaceChild(xsl,dsl.documentElement);var dxl=document.implementation.createDocument(null,'xml',null);dxl.replaceChild(xml,dxl.documentElement);xsltProcessor.importStylesheet(dsl);ex=xsltProcessor.transformToFragment(dxl,document);}}}return ex;},transformXSLUri:function(u_xml,u_xsl,callback){var doc=igk.dom.createDocument();var ex=null;if(callback){doc.async=true;doc.load && doc.load(u_xml,function(evt){var doc2=igk.dom.createDocument();doc2.async=false;doc2.validateOnParse=false;var xsl=doc2.load(u_xsl);var _ch=igk.navigator.isChrome()||igk.navigator.isSafari();if(_ch){var dh=null;dh=doc2.getElementsByTagName("html");if(dh.length==1){$igk(dh[0]).replaceTagWith("igk-html");}}ex=igk.dom.transformXSL(doc,xsl);if(_ch &&(ex.tagName.toLowerCase()=="igk-html")){ex=$igk(ex).replaceTagWith("html").o;$igk(ex).select(" igk-th,igk-td,igk-tr,igk-table").each(function(){this.replaceTagWith(this.o.tagName.substring(4).toLowerCase());return true;});}ex && callback(ex);});}else{doc.async=false;doc.load && doc.load(u_xml,function(evt){var doc2=igk.dom.createDocument();doc2.async=false;var xsl=doc2.load(u_xsl);ex=igk.dom.transformXSL(doc,xsl);});return ex;}},loadXML:function(s){var r=null;var _ch=igk.navigator.isChrome()||igk.navigator.isSafari();if(_ch){s=s.replace(/(\<(\/)?)(html|table|th|tr|td)( [^>]+)?>/gi,'$1igk-$3$4>',s);}if("DOMParser" in window){var g=(new window.DOMParser()).parseFromString(s,"text/xml");r=__dom_get_root(g);if(r && r.tagName.toLowerCase()=="parsererror"){return null;}}else{r=igk.dom.activeXDocument();r.load(s);}return r;}});(function(){var m_xsltransform=[];createNS("igk.dom.xslt",{initTransform:function(){var p=$igk(igk.getParentScript());if(!p){return;}var _s_ns=igk.system.string;var _x=p.select('.xml').first();var _y=p.select('.xslt').first();var _g=0;if(_x && _y){var _sxml=_s_ns.rmComment(_x.getHtml());var _sxsl=_s_ns.rmComment(_y.getHtml());var _dxsl=_sxsl;var opts=igk.JSON.parse(_y.getAttribute("xslt:data"));var rgx=0;if(opts){for(var s in opts){rgx=new RegExp("%"+s+"%","g");_dxsl=_dxsl.replace(rgx,opts[s]);}}try{_g=igk.dom.transformXSLString(_sxml,_dxsl);_y.remove();if(_g)p.o.replaceChild(_g,_x.o);var _callback=0;var o={xml:_sxml,xsl:_sxsl,type:"xmltransform",idx:m_xsltransform.length,options:opts,initResult:function(callback){callback(p);_callback=callback;},reload:function(opts){console.debug("reload");console.debug(opts);var c=this.idx;var _dxsl=_sxsl;if(opts){for(var s in opts){rgx=new RegExp("%"+s+"%","g");_dxsl=_dxsl.replace(rgx,opts[s]);}}var _tg=igk.dom.transformXSLString(_sxml,_dxsl);p.setHtml('').add(_tg);_g=_tg;_callback(p);}};m_xsltransform.push(o);return o;}catch(ex){console.debug(igk.R.gets(0xEA001,ex))}}}});igk.appendProperties(igk.dom.xslt.initTransform,{lastTransform:function(){if(m_xsltransform.length>0)return m_xsltransform[m_xsltransform.length-1];return null;}});})();(function(){var source;createNS("igk.JSON",{init_data:function(src,str,fallback){var _v=igk.JSON.parse(str);if((_v!=null)&&(typeof(_v)=="object")){for(var i in src){if(typeof(_v[i])!=igk.constants.undef){src[i]=_v[i];}}}else{if(fallback){fallback(src);}}return src;},parse :function(js,target){var q=null;source=target;try{if((js!=null)&&(typeof(js)=="string"))q=eval('('+js+')');}catch(ex){q=js;}this.target=null;source=null;return q;},convertToString :function(jsonobj){if(JSON && JSON.stringify){return JSON.stringify(jsonobj);}var r="{";var k=0;var prop=[];for(var i in jsonobj){if((typeof(jsonobj[i])==IGK_FUNC)||(typeof(jsonobj[i])==IGK_UNDEF)){continue;}if(k>0)r+=",";if(typeof(jsonobj[i])=="object"){prop.push(jsonobj[i]);r+="\""+i+"\": ";}else r+="\""+i+"\":"+jsonobj[i];k++;}r+="}";return r;},setSource:function(src){source=src;}});})();function igk_form_geturi(frm){var u=$igk(frm).getAttribute("igk-ajx-form-uri");if(u)return u;return frm["action"];};function igk_form_ajx_getfunc(frm){var s=$igk(frm).getAttribute("igk-ajx-form-target");var q=null;if(s){q=$igk(s).first();}if(q && !q.isSr()){return igk.ajx.fn.replace_content(q.o);}return null;};function igk_form_submit(frm){if(frm){var ajxform=$igk(frm).getAttribute("igk-ajx-form");if(ajxform){ns_igk.ajx.postform(frm,igk_form_geturi(frm),igk_form_ajx_getfunc(frm));}else{frm.submit();}}}createNS("igk.form",{keypress_validate:function(i,event){var frm=null;if(event.keyCode==13){event.preventDefault();frm=window.igk.getParentByTagName(i,'form');igk_form_submit(frm);return !1;}return !0;},submitonclick:function(l){var q=window.igk.getParentByTagName(l,'form');if(q){igk_form_submit(q);return !1;}return !0;},confirmLink:function(e,msg){var f=igk.getParentByTagName(e,'form');if(f){if(confirm(msg)){f.action=''+e.href;f.confirm.value=1;f.submit();}}},updateTarget:function(form,cibling){if(!cibling||!form)return;var q=form;for(var i in cibling){if(typeof(q[i])!='undefined' &&(q[i].type!='undefined')){switch(q[i].type){case "checkbox":case "radio":if(q[i].checked)cibling[i]=q[i].value;else cibling[i]='';break;default:cibling[i]=q[i].value;break;}}}},posturi:function(uri,method){var frm=igk.createNode("form");frm.setCss({"display":"none"});document.body.appendChild(frm.o);frm.o.method=method?method:"POST";frm.o.action=uri;frm.o.submit();},form_tojson:function(form){if(!form)return null;var p=[];var e=null;var k="";for(var i=0;i<form.length;i++){e=form.elements[i];k=e.id;if(!k)continue;if(igk.system.string.endWith(k,"[]")){k=igk.system.string.remove(k,k.length-2,2);if(typeof(p[k])=="undefined"){p[k]=[];}}switch(e.type){case "radio":case "checkbox":var vv=e.value ;if(!e.checked){vv="";}if(p[k]){var m=p[k];if(typeof(m)!="string"){m.push(vv);p[k]=m;}else{var t=[];t.push(m);t.push(vv);p[k]=t;}}else p[k]=vv;break;case "file":break;default:if(p[k]){var m=p[k];if(typeof(m)!="string"){m.push(e.value);p[k]=m;}else{var t=[];t.push(m);t.push(e.value);p[k]=t;}}else{p[k]=e.value;}break;}}e=0;var msg="";for(var i in p){if(e!=0)msg+=",";if(p[i].push)msg+=i+":["+p[i]+"]";else msg+=i+":"+p[i];e=1;}return "{"+msg+"}";},parse:function(frm){var m="";m=igk_get_form_posturi(frm);return m;}});createNS("igk.form.ajxform",{submit:function(frm){ns_igk.ajx.postform(frm,igk_form_geturi(frm),function(xhr){if(this.isReady()){var v=$igk(frm).select(".response").first();if(v){igk.ajx.fn.replace_content(v.o);}else igk.winui.notify.showMsBox("response ",this.xhr.responseText);}});}});createNS("igk.web",{setcookies:function(name,value,exdays){var exdate=new Date();if(exdays)exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+((exdays==null)? "" :"; expires="+exdate.toUTCString());document.cookie=name+"="+c_value;},getcookies:function(name){var c_value=document.cookie;var c_start=c_value.indexOf(" "+name+"=");if(c_start==-1){c_start=c_value.indexOf(name+"=");}if(c_start==-1){c_value=null;}else{c_start=c_value.indexOf("=",c_start)+1;var c_end=c_value.indexOf(";",c_start);if(c_end==-1){c_end=c_value.length;}c_value=unescape(c_value.substring(c_start,c_end));}return c_value;},clearcookies:function(){document.cookie=null;},rmcookies:function(name){var s=document.cookie+"";var i=s.indexOf(name);if(i>=0){document.cookie=name+"=;expires=-10";}}});createNS("igk.web.storage",{get:function(k,v){if(window.sessionStorage){return window.sessionStorage[k]||v;}},set:function(k,v){if(window.sessionStorage){window.sessionStorage[k]=v;}},getLocal:function(k,v){if(window.localStorage){return window.localStorage[k]||v;}},storeLocal:function(k,v){if(window.localStorage){window.localStorage[k]=v;}}});(function(){if(typeof(Event)==IGK_UNDEF){Event={prototype:{},toString:function(){return "[object igk.event]";}};}if((typeof(Event.prototype.preventDefault)==IGK_UNDEF)){Event.prototype.preventDefault=function(){};}return !0;})();var m_currentModule=null;var m_module_info=null;var m_module_loaded={};function igk_get_trace_info(_m,e,c){if(e.stack){var s=e.stack+"";var t=s.trim().split("\n");var li=[];var regex=new RegExp("((ftp|http|https)://[^:]+)");for(var i=0;i<t.length;i++){if(regex.test(t[i])){li.push(t[i]);}}c=c||li.length-1;var tt=li[c];if(tt){var uri=regex.exec(tt)[0];_m.modedule_src=uri;_m.dir=uri.substring(0,uri.lastIndexOf("/"));}_m.stack=e.stack;_m.stack_list=li;}else{var src=igk_getScriptSrc();if(src!=null){_m.modedule_src=src;_m.dir=src.substring(0,src.lastIndexOf("/"));}else{console.error("/!\\ cant get module path"+igk_getScriptSrc());return 0;}}return 1;}function igk_defineModule(n){m_currentModule=n;try{throw new Error();}catch(e){var _m={name:n,module_src:null,dir:null };igk.error.lastError=e;if(igk_get_trace_info(_m,e,1)){m_module_info=_m;}else{m_module_info=null;}}};function igk_getModule(){return m_currentModule;};function igk_getScriptSrc(){var g=document.scripts;if(g){return g[g.length-1].src;}return null;};m_LibScript=igk_getScriptSrc();createNS("igk.system",{stringProperties:function(o){var m="";var k=0;for(var i in o){if(typeof(o[i])=="function")continue;if(k==1)m+=",";m+=i+":"+o[i];k=1;}return m;},createNS:createNS,createPNS:createPNS,getScriptSrc:igk_getScriptSrc,module:igk_defineModule,getBindFunctions:function(n){var r={};if(typeof(n)=='object'){for(var i in n){if(typeof(n[i])=='function')r[i]=n[i].bind(n);}}return r;},evalScript:function(item){if(item==null)return;var t=item.getElementsByTagName("script");for(var i=0;i<t.length;i++){igk.eval(t[i].innerHTML,t[i].parentNode,t[i]);}},color:function(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a ? a :1.0;this.toString=function(){if(this.a==1.0)return "rgb("+r+","+g+","+b+")";return "rgba("+r+","+g+","+b+", "+a+")";};this.toHtml=function(){var decColor=(r<<16)+(g<<8)+b;if(decColor==0)if(this.a==0)return "#00000000";else return "#000";return "#"+decColor.toString(16).padStart(6,'0');};igk_appendProp(this,{toInt:function(){return(r<<16)+(g<<8)+b;}});},colorGetA:function(v){if(!v)return 0;if(typeof(v)=='string'){if(v.toLowerCase()=="transparent"){return 0;}if(/^#/.exec(v)){v=v.substring(1);switch(v.length){case 8:var result=/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);return Math.round(parseInt(result[1],16)*100 /255)/100;break;case 4:var result=/^([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(v);return Math.round(parseInt(result[1]+result[1],16)*100 /255)/ 100;break;}}}return 1;},colorFromString:function(value){var r=0;var g=0;var b=0;var _a=1.0;if(value){var t=/rgb\(([^\)])+\)/.exec(value,"i");if(t){var rgb=value.substring(4,value.length-1).replace(/ /g,'').split(',');r=parseInt(rgb[0]);g=parseInt(rgb[1]);b=parseInt(rgb[2]);}else if(t=/rgba\(([^\)])+\)/.exec(value,"i")){var rgb=value.substring(5,value.length-1).replace(/ /g,'').split(',');r=parseInt(rgb[0]);g=parseInt(rgb[1]);b=parseInt(rgb[2]);_a=parseFloat(rgb[3]);}else if(/^#/.exec(value)){value=value.substring(1);switch(value.length){case 6:var result=/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(value);r=parseInt(result[1],16);g=parseInt(result[2],16);b=parseInt(result[3],16);break;case 8:var result=/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(value);r=parseInt(result[2],16);g=parseInt(result[3],16);b=parseInt(result[4],16);break;case 4:var result=/^([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(value);r=parseInt(result[2]+result[2],16);g=parseInt(result[3]+result[3],16);b=parseInt(result[4]+result[4],16);break;case 3:var result=/^([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(value);r=parseInt(result[1]+result[1],16);g=parseInt(result[2]+result[2],16);b=parseInt(result[3]+result[3],16);break;}}else{if(igk.system.color[value.toLowerCase()]){return igk.system.colorFromString(igk.color[value.toLowerCase()]);}}}return new igk.system.color(r,g,b,a);},toString:function(){return "igk.system";},getNS:igk_get_namespace,include:function(u){var src=null;igk.ajx.post(u,null,function(xhr){if(this.isReady()){src=xhr.responseText;if(src)eval(src);}});}});createNS("igk.system.diagnostic",{traceinfo:igk_get_trace_info,debug:function(m){console.debug(m);},assert:function(c,m){if(c)console.assert(c,m);}});createNS("igk.system.module",{load:function(n,callback){var _m=m_module_info;var _s=null;if(!_m.dir)return;if(_m && !(n in m_module_loaded)){m_module_loaded[n]=1;var q=igk.createNode("script");if(document.head)$igk(document.head).add(q);q.reg_event("load",function(evt){if(callback){callback(q);}});q.o.src=_m.dir+n;}},getFileUri:function(f){if(igk.validator.isUri(f))return f;var _m=m_module_info;return _m.dir+f;}});igk.defineProperty(igk.system.module,"loadedModules",{get:function(){return m_module_loaded;}});igk.defineProperty(igk.system.module,"currentModuleInfo",{get:function(){return m_module_info;}});createNS("igk.system.apps",{link:null });createNS("igk.system.styles",{textShadow:function(x,y,offset,color){this.x=x;this.y=y;this.offset=offset,this.color=igk.system.createFromString(color);this.toString=function(){return "igk.system.styles.textshadow";};},textShadowCreate:function(s){if(s=="none"){return new igk.system.styles.textShadow(0,0,0,"transparent");}else{var tab=s.split(" ");if(tab.length==4){return new igk.system.styles.textShadow(igk.getNumber(tab[0]),igk.getNumber(tab[1]),igk.getNumber(tab[2]),tab[3]);}return null;}}});var m_lastError;createNS("igk.error",{});igk_defineProperty(igk.error,"lastError",{get:function(){return m_lastError;},set:function(v){m_lastError=v;}});createNS("igk.system.collections",{list:function(){var m_list=[];igk.appendProperties(this,{getCount:function(){return m_list.length;},toString:function(){return "igk.system.collections.list#"+this.getCount()},add:function(item){m_list.push(item);},clear:function(){if(this.getCount()>0){m_list=[];}},remove:function(item){var cp=[];var c=false;for (var s=0;s<m_list.length;s++){if(m_list[s]==item)continue;cp.push(m_list[s]);c=!0;}m_list=cp;return c;},removeAt:function(index){var cp=[];var c=false;for (var s=0;s<m_list.length;s++){if(s==index)continue;cp.push(m_list[s]);c=!0;}m_list=cp;return c;},indexOf:function(item){if(!item)return-1;for (var i=0;i<this.getCount();i++){if(m_list[i]==item){return i;}}return-1;},getItemAt:function(index){if((index>=0)&&(index<this.getCount()))return m_list[index];return null;},toArray:function(){var t=[];for (var i=0;i<this.getCount();i++){t.push(m_list[i]);}return t;},contains:function(item){if(!item)return !1;for (var i=0;i<this.getCount();i++){if(m_list[i]==item){return !0;}}return !1;},forEach:function(callback){if(callback){var c=this.getCount();for (var i=0;i<c;i++){callback(m_list[i],i);}}return this;}});},dictionary:function(){var m_keys=new igk.system.collections.list();var m_values=new igk.system.collections.list();var m_index=-1;var m_ck=null;var m_cv=null;igk.appendProperties(this,{it:function(){m_index=0;m_ck=null;m_cv=null;},clear:function(){m_keys.clear();m_values.clear();m_ck=null;m_cv=null;m_index=0;},moveNext:function(){if(m_index<this.getCount()){m_ck=m_keys.getItemAt(m_index);m_cv=m_values.getItemAt(m_index);m_index++;return !0;}else{m_ck=null;m_cv=null;return !1;}},getcurrentKey:function(){return m_ck;},getcurrentValue:function(){return m_cv;},toString:function(){return "igk.system.collections.dictionary#[count:"+this.getCount()+"]";},getKeys:function(){return m_keys.toArray();},getValues:function(){return m_values.toArray();},containKey:function(key){return(m_keys.indexOf(key)!=-1);},getItem:function(key){var i=m_keys.indexOf(key);if(i==-1)return null;return m_values.getItemAt(i);},getCount:function(){return m_keys.getCount();},add:function(key,value){if(!key)return;var i=m_keys.indexOf(key);if(i==-1){m_keys.add(key);m_values.add(value);}},remove:function(key){var i=m_keys.indexOf(key);if(i !=-1){m_keys.removeAt(i);m_values.removeAt(i);}}});}});createNS("igk.system.array",{isContain:function(t,u){if(t){if(t.contains){return t.contains(u);}else{for(var i=0;i<t.length;i++){if(t[i]==u)return !0;}}}return !1;},slice:function(tab,startindex){var v_otab=[];for(var i=startindex ;i<tab.length;i++){v_otab.push(tab[i]);}return v_otab;},sort:function(tab){if(tab){if(tab && Array && Array.sort){return Array.sort(tab);}else if(tab.sort){tab.sort(function(a,b){var ta=typeof(a);var tb=typeof(b);if(ta==tb){switch(ta){case 'number':if(a<b)return-1;if(a==b)return 0;return 1;break;default:break;}}return(a+'').localeCompare(b+'');});}return tab;}}});createNS("igk.html",{string:function(text){text=text.replace(/\</g,"&lt;");text=text.replace(/\>/g,"&gt;");return text;},isTextNode:function(item){return(item &&(item.nodeType==3));},closeEmptyTag:function(s,replacecallback){function replacing(m){var tag=m.trim().split(' ')[0].substring(1);m=m.replace("/>","></"+tag+">");return m;}var rg=new RegExp("((<)([^\/>])+(\/>))","ig");return s.replace(rg,replacecallback||replacing);},appendQuery:function(uri,exp){if(uri.indexOf('?')!=-1){uri=uri+"&"+exp;}else{uri=uri+"?"+exp;}return uri;},getDefinition:igk_get_html_item_definition,getDefinitionValue:igk_get_html_item_definition_value,addToHead:function(n){if(document.head)document.head.appendChild(n);else{igk.ready(function(){document.head=document.getElementsByTagName("head")[0];document.head.appendChild(n);});}}});createNS("igk.html.canva",{animate:function(callback){var animFrame=igk.animation.getAnimationFrame();var animObj={cancel:function(){igk.html.canva.cancel(this.id);}};function __doCall(){if(callback(1000/60)){setTimeout(__doCall,1000/60);}};function __runCall(){if(callback()){animObj.id=animFrame(__runCall);}};if(typeof(animFrame)=="undefined"){__doCall();}else{animObj.id=animFrame(__runCall);return animObj;}},cancel:function(id){var _canimFrame=igk.animation.getAnimationCancelFrame();if(_canimFrame){return _canimFrame(id);}}});createNS("igk.winui.events",{raise:function(t,n){var evt=new Event(n);t.dispatchEvent(evt);}});(function(){var maillink=null;createNS("igk.mail",{sendmail:function(mail){if(maillink==null)maillink=igk.createNode('a');var a=maillink;a.o.href='mailto:'+mail;document.body.appendChild(a.o);a.o.click();}});})();(function(){var m_iframes=[];function _get_loaded_text(item){var c="";if(item){try{if(item.contentDocument)item=item.contentDocument;else if(item.object){item=item.object;}}catch(ex){}if(item.childNodes==null)return;var x=item.childNodes.length;for(var i=0;i<x;i++){if(item.childNodes[i]){c+=$igk(item.childNodes[i]).getOuterHtml();}else{console.debug("i "+i);}}}return c;};createNS("igk.file",{getcontents:function(uri,callback,async){if(uri==null)return null;var c="";if(typeof(async)==IGK_UNDEF)async=!0;if(!async){igk.ajx.get(uri,null,function(xhr){if(this.isReady()){callback.apply(window,[xhr.responseText]);}},false);return;}var wait=!0;var q=igk.createNode("iframe");q.addClass("no-vibility").setAttribute("src",uri).setAttribute("async",false).reg_event("load",function(e){wait=false;e.preventDefault();c=_get_loaded_text(q.o);q.o.parentNode.removeChild(q.o);if(callback)callback.apply(window,[c]);});if(document.head)document.head.appendChild(q.o);else{var h=document.getElementsByTagName('head')[0];if(h)h.appendChild(q.o);}},get_loaded_text:_get_loaded_text});})();function __ctrl_ctr(){this.name="ctrl";};createNS("igk.html.ctrl",{ctrl:__ctrl_ctr,checkbox:new(function(){__ctrl_ctr.apply(this);igk_appendProp(this,{toggle:igk_check_all,init:function(t,c){igk.html.ctrl.checkbox.toggle(t,$igk(t).getParentByTagName('table'),t.checked,true,c);},toString:function(){return "[igk.Obj igk.html.ctrl.checkbox]";}});})(),btn:new(function(){igk_appendProp(this,{toString:function(){return "[igk.Obj igk.html.ctrl.btn]";}});})()});createNS("igk.system.string",{split:function(str,ch){var i=0;var r=[];var w="";while(i<str.length){if(str[i]==ch){r.push(w);w="";}else w+=str[i];i++;}if(w.trim().length>0){r.push(w);}return r;},rmComment:function(s){var vi=s.substr(4);return vi.substring(0,vi.length-3);}});createNS("igk.system.regex",{item_match_class:igk_item_match_class,item_inherit_class:igk_item_inherit_class,split:function(pattern,v){var q=new RegExp(pattern);var s=new RegExp("^("+pattern+")+$");if(!v.match(s)){return[v];}var r=[];while((v.length>0)&& v.match(q)){r.push(RegExp.$1);v=v.replace(q,"");}return r;}});createNS("igk.system.fonts",{installFont:function(a,uri){var s=a.getAttribute('igk-font-name');var uri=uri+'&n='+s;var frm=$igk(a).getParentForm();s=a.getAttribute("id");var top=a.offsetParent.scrollTop;igk.ajx.get(uri,null,function(xhr){if(this.isReady()){var i=igk.createNode("dummy");this.setResponseTo(i.o);var n=i.select("form").first();if(n){if(n.o.parentNode){n.o.parentNode.replaceChild(n,frm);}else{console.debug(";-) No parent found for "+frm);}n.select("#"+s).each(function(){this.o.offsetParent.scrollTop=top;return !1;});if(igk.system.apps.link)igk.system.apps.link.reload();}}});}});createNS("igk.system.convert",{parseToBool:function(i){if(typeof(i)=="string"){switch(i.toLowerCase()){case "true":case "1":return !0;}return !1;}if(i)return !0;return !1;},HexP:function(r){var g=(r>=10)? String.fromCharCode(parseInt("A".charCodeAt(0)+(r-10))):""+r;return g;},ToBase:function(d,base,length){if(typeof(length)==IGK_UNDEF)length=-1;if(typeof(d)==IGK_UNDEF)return "UX";var o="";var hpex=igk.system.convert.HexP;var ToBase=igk.system.convert.ToBase;if(base>0){var p=parseInt(d / base);var r=d% base;if(p<base){if(p!=0)o=hpex(p)+""+hpex(r);else o=hpex(r);}else{o=hpex(r)+o;o=ToBase(p,base)+o;}}if(length !=-1){for(var i=o.length;i<length;i++){o="0"+o;}}return o;}});createNS("igk.system.string",{padleft:function(m,s,l){while(m &&(m.length<l)){m=s+m;}return m;},padright:function(m,s,l){while(m &&(m.length<l)){m=m+s;}return m;},trim:function(m){if(m==null){throw new igk.exception('bad');}if(m.trim)return m.trim();while(m &&(m.length>0)&&(m[0]==' ')){m=m.substring(1);}while(m &&(m.length>0)&&(m[m.length-1]==' ')){m=m.substring(0,m.length-1);}return m;},startWith :function(m,str){if(m && m.slice)return m.slice(0,str.length)==str;return !1;},endWith :function(m,str){return m.slice(-str.length)==str;},remove :function(m,index,length){return m.substring(0,index)+m.substring(index+length,m.length);},insert:function(m,index,pattern){return m.substring(0,index)+pattern+m.substring(index,m.length);}});createNS("igk.math",{_2PI:Math.PI*2,vector2d:function(x,y){return{x:x,y:y,sub:function(d){this.x-=d.x;this.y-=d.y;return this;},add:function(d){this.x+=d.x;this.y+=d.y;return this;},distance:function(d){var dx=(this.x-d.x);var dy=(this.y-d.y);var f=Math.sqrt((dx*dx)+(dy*dy));return f;},clone:function(){return igk.math.vector2d(this.x,this.y);},toString:function(){return "vector2d{x:"+this.x+";y:"+this.y+"}"}};},matrix3x3 :function(){var m_element=[];var MATRIX_LENGTH=9;function mult_matrix(tb1,tb2){var rtb=new Array(MATRIX_LENGTH);var k=0;var offsetx=0;var offsety=0;var v_som=0;for(var k=0;k<MATRIX_LENGTH;){for(var i=0;i<4;i++){v_som=0.0;for(var j=0;j<4;j++){offsety=(4*j)+i;v_som+=tb1[offsetx+j]*tb2[offsety];}rtb[k]=v_som;k++;}offsetx+=4;}return rtb;};igk.appendProperties(this,{getElements:function(){return m_element;},reset:function(){m_element[0]=m_element[4]=m_element[8]=1;m_element[1]=m_element[2]=m_element[3]=0;m_element[5]=m_element[6]=m_element[7]=0;},translate:function(dx,dy,dz){m_element[6]+=dx;m_element[7]+=dy;if(dz){m_element[8]*=dz;}},scale:function(ex,ey,ez){m_element[0]*=ex;m_element[4]*=ey;if(ez){m_element[8]*=ez;}},rotate:function(angle){},rotateAt:function(angle,point){}});this.reset();}});createNS("igk.math.vector2d",{empty:function(){return new igk.math.vector2d(0,0);},parse:function(s){if(s==null)return new igk.math.vector2d(0,0);var t=s.split(';');var g=null;if(t.length==2)g=new igk.math.vector2d(parseFloat(t[0]),parseFloat(t[1]));else g=new igk.math.vector2d(parseInt(t),parseInt(t));return g;}});function igk_create_event_ojectManager(){var m_obj=new igk.system.collections.list();var m_value=new igk.system.collections.list();var m_key=null;var m_ukey=null;igk.appendProperties(this,{raise:function(item,method){if(!item)return;m_key=item;var i=m_obj.indexOf(item);if(i!=-1){var dic=m_value.getItemAt(i);if(dic.containKey(method)){var funcs=dic.getItem(method).funcs;var args=[item[method]];for(var s=0;s<funcs.getCount();s++){funcs.getItemAt(s).apply(item,args);}}}},register:function(item,method,func){if(!item||!func||(typeof(func)!=IGK_FUNC)||(m_key==item))return;m_key=item;var i=m_obj.indexOf(item);var o=null;if(i==-1){o={target:item,funcs:new igk.system.collections.list(),method:method};o.funcs.add(func);var dic=new igk.system.collections.dictionary();dic.add(method,o);m_obj.add(item);m_value.add(dic);}else{var dic=m_value.getItemAt(i);if(dic){if(dic.containKey(method)){dic.getItem(method).funcs.add(func);}else{var o={target:item,funcs:new igk.system.collections.list(),method:method};o.funcs.add(func);dic.add(method,o);}}}m_key=null;},unregister:function(item){var o=null;if(item==window)o=item;else o=$igk(item).o;if((!item)||(m_ukey==item))return;m_ukey=item;var i=m_obj.indexOf(o);var dic=null;if(i !=-1){dic=m_value.getItemAt(i);var tab=dic.getValues();for(var t=0;t<tab.length;t++){var c=tab[t].funcs.toArray();for(var x=0;x<c.length;x++){igk.winui.unreg_event(o,tab[t].method,c[x]);}}m_obj.removeAt(i);m_value.removeAt(i);}m_ukey=null;},toString:function(){return "igk.winui.eventObjectManager";},unregister_child:function(q){if(q)$igk(q).select("*").each(function(){this.unregister();return !0;});}});return this;};createNS("igk.winui",{toString:function(){return "igk.winui";},open:function(uri){var frm=window.open(uri);frm.onload=function(){frm.close();};},screenSize:function(){return{height:window.innerHeight,width:window.innerWidth,toString:function(){return "height:"+this.height+" ; width: "+this.width;}};},focus:function(id){var q=document.getElementById(id);if(q)q.focus();},fitfix2 :function(node,parent,onw,onh){var t=$igk(node);var l=$igk(parent);var h=onh==null?!0:onh;var w=onw==null?!0:onw;if(t){t.setCss({"position":"fixed" });if(w){t.setCss({"right":(l.fn.hasVScrollBar()? l.fn.vscrollWidth():0)+"px"});}if(h){t.setCss({"bottom":((l.fn.hasHScrollBar()? l.fn.hscrollHeight()+1:0))+"px"});}}},getEventObjectManager:function(){if(__eventObjectManager==null){__eventObjectManager=new igk_create_event_ojectManager();}return __eventObjectManager;},GetScreenPosition:function(item){var left=0;var top=0;if(item){left+=item.offsetLeft;top+=item.offsetTop;while((item.offsetParent !=igk.constants.undef)&&(item.offsetParent!=null)){left+=(item.clientLeft)?item.clientLeft:0;top+=(item.clientTop)?item.clientTop:0;item=item.offsetParent;}}return new igk.math.vector2d(left,top);},GetScreenSize :function(){var x=window.innerWidth||0 ;var y=window.innerHeight||0;return new igk.math.vector2d(x,y);},getWidth:function(){return window.innerWidth||0 ;},getHeight:function(){return window.innerHeight||0 ;},GetDocumentLocation :function(){var left=0;var top=0;left=window.pageXOffset?-window.pageXOffset:0;top=window.pageYOffset?-window.pageYOffset:0;return new igk.math.vector2d(left,top);},GetRealScreenPosition:function(item){var left=0;var top=0;left=window.pageXOffset?-window.pageXOffset:0;top=window.pageYOffset?-window.pageYOffset:0;if(item){left+=-igk.winui.GetScrollLeft(item)+((item.offsetLeft)?item.offsetLeft:0);top+=-igk.winui.GetScrollTop(item)+((item.offsetTop)?item.offsetTop:0);while((item.offsetParent !=null)){item=item.offsetParent;left+=-igk.winui.GetScrollLeft(item)+((item.offsetLeft)?item.offsetLeft:0);top+=-igk.winui.GetScrollTop(item)+((item.offsetTop)?item.offsetTop:0);}}return new igk.math.vector2d(left,top);},GetScrollPosition:function(item,parent){if(!parent)return new igk.math.vector2d(0,0);var left=0;var top=0;left=window.pageXOffset?-window.pageXOffset:0;top=window.pageYOffset?-window.pageYOffset:0;if(item){left+=-igk.winui.GetScrollLeft(item)+((item.offsetLeft)?item.offsetLeft:0);top+=-igk.winui.GetScrollTop(item)+((item.offsetTop)?item.offsetTop:0);while((item.offsetParent !=null)&&(item.offsetParent !=parent)){item=item.offsetParent;left+=-igk.winui.GetScrollLeft(item)+((item.offsetLeft)?item.offsetLeft:0);top+=-igk.winui.GetScrollTop(item)+((item.offsetTop)?item.offsetTop:0);}if(item.offsetParent !=parent){return new igk.math.vector2d(-1,-1);}}return new igk.math.vector2d(left,top);},GetRealOffsetParent:function(item){if(item){var q=item.offsetParent;while(q !=null){if(q.offsetParent==null)break;q=q.offsetParent;}return q;}return null;},GetRealScrollParent:function(item){if(item){var q=item.offsetParent;while((q !=null)&&(q.tagName.toLowerCase()!='body')){if(q.offsetParent==null)break;if($igk(q).fn.hasVScrollBar()||$igk(q).fn.hasHScrollBar())break;q=q.offsetParent ;}return q;}return null;},GetMousePoint :function(evt){return new igk.math.vector2d(evt.clientX,evt.clientY);},GetChildMouseLocation:function(item,evt){if(evt==null){return new igk.math.vector2d(0,0);}var loc=igk.winui.GetRealScreenPosition($igk(item).o);loc.x=evt.clientX-(isNaN(loc.x)?0:loc.x);loc.y=evt.clientY-(isNaN(loc.y)?0:loc.y);return loc;},GetChildTouchLocation:function(item,evt,index){var touchv={"touchstart":1,"touchmove":1,"toucancel":1,"touchend":1 };if(!evt||!touchv[evt.type])return igk.math.vector2d(0,0).clone();var i=index||0;var s=((evt.touches.length>0)&&(i<evt.touches.length))? evt.touches.item(i):null;if(s==null)return igk.math.vector2d(0,0).clone();var loc=igk.winui.GetRealScreenPosition($igk(item).o);loc.x=s.pageX-(isNaN(loc.x)?0:loc.x);loc.y=s.pageY-(isNaN(loc.y)?0:loc.y);return loc;},HasMouseInputInChild :function(item,evt){var loc=igk.winui.GetChildMouseLocation(item,evt);return igk.winui.controlUtils.HasChildContainPoint(item,loc);},GetScrollLeft :function(item){if(item==null)return 0;if(item.pageXOffset){return item.pageXOffset;}else if(item.scrollLeft)return item.scrollLeft;return 0;},GetScrollTop :function(item){if(item==null)return 0;if(item.pageYOffset){return item.pageYOffset;}else if(item.scrollTop)return item.scrollTop;return 0;},registerEventHandler:function(name,objListener){var th=name.split(" ");var n,d;;for(var i=0;i<th.length;i++){d=igk.winui.getEventHandler(th[i]);if(d){continue;}if(objListener){igk.winui.events.register.registerEvent(th[i],objListener);}}},getEventHandler:function(method){if(typeof(this.eventRegister)==IGK_UNDEF){this.eventRegister=new function(){this.m_manager={};igk.appendProperties(this,{getMethod:function(name){if(typeof(this.m_manager[name])!=IGK_UNDEF){return this.m_manager[name];}return null;},registerEvent:function(name,obj){if(typeof(this.m_manager[name])==IGK_UNDEF){this.m_manager[name]=obj;}},toString:function(){return "method register ";}});};igk.system.createNS("igk.winui.events",{register:this.eventRegister,exceptionEvent:new(function(){var m_t={};m_t["mouseleave"]={replace:"mouseout"};igk.appendProperties(this,{contain:function(m){return typeof(m_t[m])!=IGK_UNDEF;},getMethod:function(m){if(typeof(m_t[m])!=IGK_UNDEF){return m_t[m].replace;}return null;},toString:function(){return "[object igk.winui.events.exceptionEvent]";}});})()});}return this.eventRegister.getMethod(method);},reg_window_event:function(method,func,useCapture){return igk.winui.reg_system_event(window,method,func,useCapture);},unreg_window_event:function(method,func){return igk.winui.unreg_system_event(window,method,func,useCapture);},reg_system_event:function(item,method,func,useCapture){if(item==null)return !1;if(typeof(item[method])==igk.constants.undef){if(item["on"+method]+""==igk.constants.undef){var e=igk.winui.events.exceptionEvent;if(e.contain(method)){return igk.winui.reg_system_event(item,e.getMethod(method),func,useCapture);}console.debug("/!\\ can't register event on"+method);return !1;}}if(item.addEventListener){var t=item.addEventListener(method,func,typeof(useCapture)=='object'?useCapture:false);igk.winui.getEventObjectManager().register(item,method,func);return !0;}else if(item.attachEvent){if(igk.DEBUG){console.debug("attachevent "+method);}if(igk.navigator.IEVersion()==7){var ftp=function(evt){evt.preventDefault=function(){};func.apply(item,[evt]);};item.attachEvent("on"+method,ftp);igk.winui.getEventObjectManager().register(item,method,ftp);}else{var p=item.attachEvent("on"+method,func);igk.winui.getEventObjectManager().register(item,method,func);if(method=="igk-trackchange"){$igk(item).raiseEvent("igk-trackchange");}}return !0;}else{var m=item["on"+method];if(typeof(m)=="function"){item["on"+method]=function(){m.apply(this,arguments);func.apply(this,arguments);}}else{item["on"+method]=func;}igk.winui.getEventObjectManager().register(item,method,func);}return !0;},reg_event:function(item,method,func,useCapture){var g=method.split(' ');var s=0;var o=1;while(o &&(s=g.pop())){var eventHandler=igk.winui.getEventHandler(s);if(eventHandler !=null){o=o && eventHandler.reg_event(item,func,useCapture);}else o=o && igk.winui.reg_system_event(item,s,func,useCapture);}},unreg_system_event_object:function(item){if(!item)return;igk.winui.getEventObjectManager().unregister(item);},unreg_system_event:function(item,method,func){if((item==null)||((item[method]==igk.constants.undef)&&(item["on"+method]+""==igk.constants.undef)))return !1;if(item.removeEventListener){item.removeEventListener(method,func,false);}else if(item.detachEvent){item.detachEvent("on"+method,func);}else{var m=item["on"+method];if(typeof(m)=="function"){item["on"+method]=null;}else{item["on"+method]=null;}}return !0;},unreg_event:function(item,method,func){var eventHandler=igk.winui.getEventHandler(method);if(eventHandler!=null){return eventHandler.unreg_event(item,func);}return igk.winui.unreg_system_event(item,method,func);},regwindow_event:function(method,func){if(!igk.winui.reg_event(window,method,func))return igk.winui.reg_event(document,method,func);return !0;},unregwindow_event:function(method,func){if(!igk.winui.unreg_event(window,method,func))return igk.winui.unreg_event(document,method,func);return !0;},RegEventContext:function(eventContextOwner,properties){if((properties==null)||(eventContextOwner==null)||(igk_getRegEventContextByOwner(eventContextOwner)!=null)){return null;}function __eventContextObject(eventContextOwner,properties){var q=this;var m_eventContextOwner=eventContextOwner;var m_properties=properties;var m_col=new Array();function __regEventContextFunction(){var v_ts=properties;var v_ch=igk_getRegEventContext(v_ts,true,function(){return new chainUnreg(eventContextOwner,v_ts);});if(!v_ts.unregEventContext){igk.appendProperties(v_ts,{unregEventContext :function(){q.clear();v_ch.chain--;if(v_ch.chain==0){if(!igk_unRegEventContext(v_ch)){throw("item not unregister ");}}}});}else{var meth=v_ts.unregEventContext ;v_ts.unregEventContext=function(){meth();q.clear();v_ch.chain--;if(v_ch.chain==0){if(!igk_unRegEventContext(v_ch)){throw("unreg -- items");}}};v_ch.chain++;}};__regEventContextFunction();function chainUnreg(o,properties){this.o=o;this.properties=properties;this.chain=1;this.unregEventContext=function(){this.properties.unregEventContext();};this.toString=function(){return "chainUnreg["+o+":"+this.chain+"]";};}function eventCibling(target,name,func){this.name=name;this.target=target;var q=this;this.func=function(){func.apply(q.target,arguments);};this.toString=function(){return "eventcibling:"+name;};};function __unregister(s){if(igk_is_array(s)){for(var i=0;i<s.length;i++){__unregister(s[i]);}}else if(s instanceof eventCibling){igk.winui.unreg_event(s.target,s.name,s.func);}};var m_resizefuncs=[];var m_resizetimeout=0;var m_resizeevent=false;function __is_resized_event(){return m_resizeevent;}function __resizing_push(func){if(func){m_resizefuncs.push(func);}}function __resize_call_invoke(evt){for(var i=0;i<m_resizefuncs.length;i++){m_resizefuncs[i].apply(window,arguments);}}function __resize_call(evt){if(m_resizetimeout){igk.clearTimeout(m_resizetimeout);m_resizetimeout=null;}m_resizetimeout=setTimeout(function(){__resize_call_invoke(evt);},RZ_TIMEOUT);}window.igk.appendProperties(this,{clear:function(){if(m_col){for(var i in m_col){var s=m_col[i];__unregister(s);}}},reg_event:function(target,name,func){if((target==null)||!name||(func==null)){return !1;}var v_cibling=new eventCibling(target,name,func);igk.winui.reg_event(v_cibling.target,v_cibling.name,v_cibling.func);var key=name+":"+target;if(typeof(m_col[key])==igk.constants.undef)m_col[key]=v_cibling;else{var tab=m_col[key];var v_isarray=igk_is_array(tab);if(v_isarray){tab.push(v_cibling);m_col=tab;}else{var v_t=new Array();v_t.push(tab);v_t.push(v_cibling);m_col[key]=v_t;}}return !0;},reg_window:function(name,func){if(name=="resize"){__resizing_push(func);if(!__is_resized_event()){this.reg_event(window,name,__resize_call);m_resizeevent=!0;}return;}this.reg_event(window,name,func);},toString:function(){return "RegEventContext";}});}return new __eventContextObject(eventContextOwner,properties);},saveHistory:function(uri){if(typeof history.pushState=="function"){history.pushState({},document.title,uri+"&history=1");}},reg_keypress :function(func){igk.winui.reg_event(document,"keypress",func);},unreg_keypress:function(func){igk.winui.unreg_event(document,"keypress",func);},centerDialog:function(dialog,minw,minh){if(dialog==null)return;dialog.style.top="50%";dialog.style.left="50%";dialog.style.minWidth=minw?minw+"px":null;dialog.style.minHeight=minh?minh+"px":null;$igk(dialog).setCss({"position":"absolute","marginLeft":-(dialog.clientWidth/2)+"px","marginTop" :-(dialog.clientHeight/2)+"px" });if(!dialog.style.minWidth)dialog.style.minWidth=dialog.clientWidth+"px";if(!dialog.style.minHeight)dialog.style.minHeight=dialog.clientHeight+"px";var pt=igk.winui.GetRealScreenPosition(dialog);var adjusted=false;if(pt.x<0){pt.x=0;adjusted=!0;}if(pt.y<0){pt.y=0;adjusted=!0;}if(adjusted){dialog.style.margin="0";dialog.style.left=pt.x+"px";dialog.style.top=pt.y+"px";}},dragFrameManager :{target :null,box :null,startpos :null,dragstart :false,oldposition :null,locToScreen :true,dragSize :new igk.math.vector2d(4,4),toString :function(){return "igk.winui.dragmanager";},init:function(target,box){if(target==null)return null;function __construct(target,box){var self=this;var m_c=0;this.target=target;this.box=(box==null)?target:box;this.changelocation=igk.winui.dragFrameManager.changelocation;var m_eventContext=igk.winui.RegEventContext({box:this.box,toString:function(){return "dragFrameManager.BoxOwner" },properties :$igk(box)},$igk(this.box));if(m_eventContext){m_eventContext.reg_event(document,"mousemove",function(){self.changelocation.apply(self,arguments);});m_eventContext.reg_event(document,"mouseup",function(){if(self.dragstart){self.dragstart=false;};});m_eventContext.reg_event(this.target,"mousedown",function(evt){if(!self.dragstart){self.startpos=new igk.math.vector2d(evt.clientX,evt.clientY);self.oldposition=igk.winui.GetScreenPosition(self.box);self.dragstart=!0;}});m_eventContext.reg_event(this.target,"mouseup",function(evt){self.dragstart=false;});}else alert("igk.winui.dragFrameManager ... event context failed");return self;};return new __construct(target,box);},changelocation:function(evt){if(this.dragstart){var left=0;var right=0;var pt=igk.math.vector2d(this.oldposition.x+(evt.clientX-this.startpos.x),this.oldposition.y+(evt.clientY-this.startpos.y));var adjustedx=false;var adjustedy=false;if(this.locToScreen){if(pt.x<0){pt.x=0;adjustedx=true;}if(pt.y<0){pt.y=0;adjustedy=true;}if(this.box.offsetParent){if(!adjustedx)if((pt.x+this.box.clientWidth)>=this.box.offsetParent.clientWidth){pt.x=this.box.offsetParent.clientWidth-this.box.clientWidth;adjustedx=!0;}if(!adjustedy)if((pt.y+this.box.clientHeight)>=this.box.offsetParent.clientHeight){pt.y=this.box.offsetParent.clientHeight-this.box.clientHeight;adjustedy=!0;}}}this.box.style.margin="0";this.box.style.left=pt.x+"px";this.box.style.top=pt.y+"px";};}}});(function(){var m_class_control=[];var m_class_list=null;var m_init=0;var m_rg=0;var m_rcg;function __initClassControl(n){var q=$igk(this);if(q.fn.isControl)return;if(!m_rcg)m_rcg=new RegExp("((^| )+)("+m_rg+")($| )");var t=this.className;if(m_rcg.test(t)){var m=m_rcg.exec(t);var n=m[3];var g=m_class_control[n];if(!g){console.debug('test '+t);console.debug(m);console.debug(m[2]);return;}var c=g.func;q.fn.ControlName=n;c.apply(q,[n,g.data]);q.fn.isControl=1;}};createNS("igk.winui",{reloadClassList:function(){m_class_list=null;return igk.winui.getClassList();},getClassList:function(){if(m_class_list!=null)return m_class_list;var t=[];var nslist={};for(var i in m_class_control){t.push(i);t[i]=m_class_control[i];if(m_class_control[i].ns){if(!nslist[m_class_control[i].ns])nslist[m_class_control[i].ns]=[];nslist[m_class_control[i].ns].push(t[i]);}else{if(!nslist[igk.constants.namespace])nslist[igk.constants.namespace]=[];nslist[igk.constants.namespace][i]=t[i];nslist[igk.constants.namespace].push(t[i]);}}t["ns://"]=nslist;m_class_list=t;return t;},initClassObj:function(n){igk_init_node_class_obj.apply(n);},initClassControl:function(n,c,inf){if(!m_init && igk.ctrl.registerReady){m_init=1;igk.ctrl.registerReady(__initClassControl);}if(m_class_control[n])return;m_class_control[n]={data:inf||1,func:c,n:n};if(m_rg)m_rg+='|';m_rg+=n;m_rcg=null;}});function igk_init_node_class_obj(){var c=this;var b=m_class_control;var fc=null;for(var i in b){fc=b[i].data.func;if(fc){if(igk_item_match_class(b[i].n,c)){fc.apply($igk(c));}else $igk(c).select("."+b[i].n).each(function(){fc.apply(this);return !0;});}}}})();igk_defineProperty(igk,'version',{get:function(){return __version;}});igk_defineProperty(igk,'author',{get:function(){return __author;}});createNS("igk.android",{init:function(ds){if(igk.navigator.isAndroid()){$igk(document.body).addClass("igk-android");var m=igk.createNode("meta");m.setAttribute("name","viewport");m.setAttribute("content",ds);$igk(document.head).add(m);}}});(function(){var m_dlgx=[];var m_d=0;function __setupview(div){div.setCss({"height":"auto"});var _h=div.getHeight();var p=-(_h /2.0);var pn=div.getParentNode();var t=0;var h=div.getHeight()+"px";var oflow=false;if(pn){t=pn.getHeight()/2.0;}else{t=div.getTop();}if((t+p)<0){if(pn.getHeight()<div.getHeight()){h=pn.getHeight()+"px";oflow=true;}}div.setCss({"marginTop":p+"px" });}function __hide_dialog(q){q.rmClass("igk-show");if(q.data["ms-dialog-dispose"]){q.remove();m_dlgx.pop();}if(m_dlgx.length==0){igk.winui.unreg_keypress(__key_press);}q.data["ms-dialog-init"]=null;}function __key_press(evt){switch(evt.keyCode){case 27:var q=m_dlgx.pop();if(q)__hide_dialog(q);evt.preventDefault();evt.stopPropagation();return !1;}}function __show_dialog(s){s.addClass("igk-show");function __init(){if(!this.data["ms-dialog-init"]){var q=this;__setupview(q);q.select(".igk-btn-close").each(function(){var a=this;a.addClass("igk-btn igk-btn-close");a.reg_event("click",function(evt){evt.stopPropagation();evt.preventDefault();__hide_dialog(q);});});this.data["ms-dialog-init"]=1;if(m_dlgx.length==0){igk.winui.reg_keypress(__key_press);}m_dlgx.push(q);}return !0;};if(s.isSr()){s.each(__init);}else{__init.apply(s);}}createNS("igk.winui",{showDialog:function(id){var s=$igk(id);if(s!=null){__show_dialog(s);}},hideDialog:function(id){var s=$igk(id);if(s!=null){s.each(function(){if(this.hide)this.hide();});}},showDialogUri:function(uri){if(m_d==1){return;}m_d=1;igk.ajx.post(uri,null,function(xhr){if(this.isReady()){var n=igk.winui.createDialog();n.add("div").setHtml(xhr.responseText);$igk(document.body).appendChild(n);__show_dialog(n);m_d=0;}});},createDialog:function(id){var n=igk.createNode("div");n.setAttribute("id",id);n.addClass("igk-ms-dialog");n.add("a").setAttribute("href","#").addClass("igk-btn-close");n.data["ms-dialog-dispose"]=1;return n;}});})();(function(){var m_ptrframe=null;createNS("igk.winui",{openUrl:function(u,n,p){var hwn=window.open(u,n,p);return hwn;},print:function(u){var _prf=document.domain+"::/prf";var _n=(window[_prf]==null);var _wnd=window[_prf]||window.open(u,_prf,"fullscreen=0, toolbar=0,resizable=0,menubar=0,title=0, width=420, height=500, left=0, top=100");var _el=igk.winui.reg_event;if(_wnd){try{if(_n){_el(_wnd,'load',function(){if(_wnd.hide)_wnd.hide();_wnd.print();if(!igk.navigator.isChrome())_wnd.close();});}else{_wnd.location=u;}}catch(ex){console.debug("[igk.winui.print] - can't register load event  - "+ex);}}},printUrl:function(u){if(m_ptrframe==null){m_ptrframe=igk.createNode("iframe");m_ptrframe.reg_event("load",function(){m_ptrframe.o.contentWindow.focus();m_ptrframe.o.contentWindow.print();});m_ptrframe.addClass("dispn");document.body.appendChild(m_ptrframe.o);}m_ptrframe.o["href"]=u;m_ptrframe.o["src"]=u;},confirm:function(t,m,callback){var div=igk.createNode("div");div.setCss({maxWidth:"480px",margin:"auto"});div.add("div").setHtml(m);var b=div.add("div");b.addClass("igk-action-bar igk-pull-right").setCss({backgroundColor:"transparent"});var btn=b.add("input").setAttributes({type:'button',value:'confirm'}).addClass("igk-btn");btn.reg_event("click",function(evt){evt.preventDefault();if(callback)callback.apply(this,evt);igk.winui.notify.close();});igk.winui.notify.showMsBox(t,div);}});})();(function(){createNS("igk.winui",{'click':function(u){return function(e){e.stopPropagation();e.preventDefault();var a=document.createElement("a");a.href=u;document.body.appendChild(a);$igk(a).click();};}});})();(function(){var Left=1;var Right=2;var Middle=3;var None=0;igk.winui.mouseButton=function(evt){if(evt.buttons==0)return None;if(igk.navigator.isIE()&& igk.navigator.IEVersion()<10){switch(evt.button){case 1:return Left;case 4:return Middle;case 2:return Right;}}else{switch(evt.button){case 0:return Left;case 1:return Middle;case 2:return Right;}}return None;};igk_defineProperty(igk.winui.mouseButton,"Left",{get:function(){return Left;}});igk_defineProperty(igk.winui.mouseButton,"Right",{get:function(){return Right;}});igk_defineProperty(igk.winui.mouseButton,"Middle",{get:function(){return Middle;}});igk_defineProperty(igk.winui.mouseButton,"None",{get:function(){return None;}});createNS("igk.winui.mouseButton",{});igk.winui.eventTarget=function(evt){if(evt.target)return evt.target;if(evt.srcElement)return evt.srcElement;return null;};igk.winui.headDocument=function(){if(document.head)return document.head;document.head=document.getElementsByTagName("head")[0];return document.head ;};})();(function(){var m_capture;var m_r=false;var m_event_capture=false;var m_bck={};function __capturemouse(evt){if(m_r){evt.stopPropagation();return;}if(m_capture && m_event_capture){var t=null;if(typeof(evt.constructor)=='function'){t=new evt.constructor(evt.type,evt);}else{if(/mouse/.test(evt.type)){t=document.createEvent("MouseEvents");t.initMouseEvent(evt.type,evt.bubbles,evt.cancelable,evt.view,evt.detail,evt.screenX,evt.screenY,evt.clientX,evt.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,evt.button,null);}if(!t)return;}t.EventTarget=m_capture;t["igk-event-source"]="mouse-capture";m_r=!0;m_capture.dispatchEvent(t);}evt.stopPropagation();m_r=false;};igk.system.createNS("igk.winui.mouseCapture",{setCapture:function(n){if((n!=null)&&(m_capture !=n)){m_capture=n;if(n.setCapture)n.setCapture();else{m_event_capture=true;igk.winui.reg_event(window,"mousemove",__capturemouse);igk.winui.reg_event(window,"mouseup",__capturemouse);m_bck["ondragstart"]=m_capture["ondragstart"];m_bck["ondrop"]=m_capture["ondrop"];m_capture["ondragstart"]=igk.winui.fn.cancelEventArgs;m_capture["ondrop"]=igk.winui.fn.cancelEventArgs;}}},releaseCapture:function(){if(m_capture && m_capture.setCapture){m_capture.setCapture(null);}if(document.releaseCapture)document.releaseCapture();if(m_event_capture){igk.winui.unreg_event(window,"mousemove",__capturemouse);igk.winui.unreg_event(window,"mouseup",__capturemouse);m_capture["ondragstart"]=m_bck["ondragstart"];m_capture["ondrop"]=m_bck["ondrop"];}m_capture=null;m_event_capture=false;}})})();(function(){createNS("igk.winui.history",{push:function(uri,data,t){if(typeof(window.history.pushState)=="function"){window.history.pushState(data,t,uri);}else{console.debug("no history state available");}},replace:function(uri,data){if(typeof(window.history.replaceState)=="function"){window.history.replaceState(data,null,uri);}else{console.debug("no history state available");}}});function __popstate(e){e.preventDefault();var u=0;if(e.state){}};igk.winui.reg_event(window,"popstate",__popstate);})();(function(){var m_contextMenu;function __ctr(){var m_target=igk.createNode("ul");m_target.addClass("igk-context-menu");var q=this;m_target.addClass("posfix");function __click(evt){q.close();}function __scroll(evt){var b=$igk(q.contextCibling).getScreenLocation();var p=q.ciblingpos;if((p.x !=b.x)||(p.y !=b.y)){q.close();}}function __loadItemTo(n,t){t=$igk(t);for(var i=0;i<t.getChildCount();i++){__loadItem(n.add("li"),t.o.childNodes[i]);}};function __loadItem(n,t){if(!t.tagName)return;switch(t.tagName.toLowerCase()){case "li":if(t.childNodes.length==1){if(igk.html.isTextNode(t.childNodes[0])){var ajx=t.getAttribute("ajx")==1;var complete="ns_igk.ajx.fn.replace_content(this.igk.contextMenu.contextCibling)";var c=t.getAttribute("complete");if(c){complete=c;}var g=t.getAttribute("class");if(g!=null)n.setAttribute("class",g);n.add("a").setAttribute("href",t.getAttribute("uri")).appendProperties({"contextMenu":q}).setAttributeAssert(ajx,"onclick","javascript: ns_igk.ajx.post(this.href,null,"+complete+"); return !1;").setHtml(t.innerHTML);}else{__loadItemTo(n.add("ul").addClass("igk-context-sub"),t.childNodes[0]);}}else if(t.childNodes.length>1){var ul=n.add("ul").addClass("igk-context-sub");__loadItemTo(ul,t);}break;case "sep":n.addClass("igk-context-menu-sep");break;}}igk.appendProperties(this,{contextTarget:null,contextCibling:null,getTarget:function(){return m_target;},load:function(d){m_target.setHtml(null);var dummy=igk.createNode("div");dummy.setHtml(d);__loadItemTo(m_target,dummy);},close:function(){igk.winui.unreg_event(document,"click",__click);$igk(".overflow-y-a").unreg_event("scroll",__scroll);var q=m_target;m_target.addClass("igk-trans-all-200ms").setCss({"opacity":0.0}).timeOut(400,function(){m_target.rmClass("igk-trans-all-200ms igk-show");q.o.parentNode.removeChild(q.o);q.clearTimeOut();});},show:function(t,c,l){this.contextTarget=t;this.contextCibling=c;this.pos=l;this.ciblingpos=$igk(c).getScreenLocation();document.body.appendChild(m_target.o);m_target.addClass("posfix igk-show").setCss({left:l.x+"px",top:l.y+"px" }).addClass("igk-trans-all-200ms").setCss({opacity:1}).timeOut(400,function(){m_target.rmClass("igk-trans-all-200ms");});igk.winui.reg_event(document,"click",__click);$igk(".overflow-y-a").reg_event("scroll",__scroll);},toString:function(){return "igk.winui.contextmenu";}});};m_contextMenu=new __ctr();igk_defineProperty(igk.winui,'contextMenu',{get:function(){return m_contextMenu;},nopropfunc:function(){this.contextMenu=m_contextMenu;}});igk.winui.initClassControl("igk-context-menu",function(){var id=$igk(this.getAttribute("igk:for"));if(!id)return;var q=this;var v=0;q.close=function(){igk.winui.unreg_event(document,"click",__q_click);$igk(".overflow-y-a").unreg_event("scroll",__q_scroll);q.addClass("igk-trans-all-200ms").setCss({"opacity":0.0}).timeOut(400,function(){q.rmClass("igk-trans-all-200ms igk-show");q.clearTimeOut();});v=0;};function __q_click(evt){q.close();};function __q_scroll(evt){q.close();};q.show=function(){q.addClass("posfix igk-show").addClass("igk-trans-all-200ms").setCss({opacity:1}).timeOut(400,function(){q.rmClass("igk-trans-all-200ms");});igk.winui.reg_event(document,"click",__q_click);$igk(".overflow-y-a").reg_event("scroll",__q_scroll);};$igk(id).reg_event("click",function(evt){if(v==0){q.show();evt.preventDefault();evt.stopPropagation();v=1;}}).setCss({"cursor":"pointer"});},{desc:"igk context menu"});})();igk.system.createNS("igk.winui.notifyctrl",{init:function(t){igk.ready(function(){new igk.winui.notifyctrl.run(t).start();});},run:function(target){this.target=$igk(target);this.noautohide=this.target.getAttribute("igk-no-auto-hide");var q=this;this.start=function(){var self=this;if(q.noautohide==1)return;setTimeout(function(){igk.animation.fadeout(self.target.o,20,500,1.0,function(){self.target.setCss({"display":"none"}).remove();});},2000);};}});createNS("igk.winui.event",{stopPropagation :function(e){if((e!=null)&&(e.stopPropagation)){e.stopPropagation();}},preventDefault:function(e){if(e){if(e.preventDefault)e.preventDefault();}}});(function(){var m=[];createNS("igk.winui.event.fn",{handleKeypressExit:function(p){m.push(p);var fc=function(evt){switch(evt.keyCode){case 27:if(igk.winui.framebox.currentFrame==null){var t=m.pop();if(p.complete){p.complete.apply(this,[evt]);igk.winui.unreg_event(document,"keypress",fc);}}break;}};return fc;}});})();igk.winui.controlUtils={HasChildContainPoint :function(item,point){var loc=igk.winui.GetRealScreenPosition(item);var o=((point.x>=0.0)&&(point.x<=item.clientWidth)&&(point.y>=0.0)&&(point.y<=item.clientHeight));return o;}};igk.navigator=new(function(){var m_version="1.2";igk_defineProperty(this,'version',{get:function(){return m_version;},enumerable:true,configurable:true,nopropfunc:function(){this.m_version=m_version;}});})();var XBox360=false;var XBoxOne=false;if(/Xbox/.test(navigator.userAgent)){if(/Xbox One/.test(navigator.userAgent)){XBoxOne=true;}else{XBox=true;}igk.ready(function(){$igk(document.body).addClass("xbox"+(XBoxOne?'one':''));});}igk_appendProp(igk.navigator,{getLang:function(){if(window.navigator.language)return window.navigator.language+"";return window.navigator.languages+"";},isXBoxOne:function(){return XBoxOne;},isXBox360:function(){return XBox360;},isFirefox:function(){return window.navigator.userAgent.indexOf("Firefox/")!=-1;},getFirefoxVersion:function(){var i=window.navigator.userAgent.indexOf("Firefox/");if(i!=-1)return /Firefox\/([0-9]+\.[0-9]+)/.exec(window.navigator.userAgent+"")[1];return-1;},getUserMedia:(function(){return function _t(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;if(e)return e.apply(navigator,arguments);else{}}})(),getScreenWidth:function(){return igk.winui.screenSize().width;},getScreenHeight:function(){return igk.winui.screenSize().height;},getOrientation:function(){return window.orientation||0},getDevicePixelRatio:function(){return window.devicePixelRatio||(window.screen.availWidth/ document.documentElement.clientWidth)},navTo:function(uri){var a=igk.createNode("a");a.setCss({display:"none"});a.o.href=uri;document.body.appendChild(a.o);a.o.click();},isChrome:function(){var ua=window.navigator.userAgent+'';if((ua.indexOf("Chrome/")!=-1)){return !0;}return !1;},chromeVersion:function(){if(igk.navigator.isChrome()){var i=window.navigator.userAgent.indexOf("Chrome/");return(window.navigator.userAgent+"").substring(i+7).split(' ')[0];}return 0;},isIE:function(){var ua=window.navigator.userAgent+'';if((ua.indexOf("MSIE")!=-1)||ua.indexOf("Trident/")!=-1){return !0;}return !1;},isIEEdge:function(){var ua=window.navigator.userAgent+'';if(ua.indexOf("Edge/")!=-1)return !0;return !1;},getEEdgeVersion:function(){var i=window.navigator.userAgent.indexOf("Edge/");if(i!=-1)return /Edge\/([0-9]+\.[0-9]+)/.exec(window.navigator.userAgent+"")[1];return-1;},IEVersion:function(){if(!igk.navigator.isIE())return-1;var ua=window.navigator.userAgent+'';var i=ua.indexOf("MSIE");if(i!=-1){return ua.substring(i).split(';')[0].split(' ')[1];}i=ua.indexOf("Trident/");if(i !=-1){var v=ua.substring(i+8).split(';')[0];if(v==7)return 11;}return-1;},isAndroid:function(){var v=(window.navigator.userAgent+"").toLowerCase().indexOf("android");if(v!=-1){return !0;}return !1;},isIOS:function(){return 0;},isSafari:function(){var i=window.navigator.userAgent.indexOf("Safari/");if(i!=-1){return !0;}return !1;},SafariVersion:function(){var i=window.navigator.userAgent.indexOf("Safari/");if(i!=-1){return(window.navigator.userAgent+"").substring(i+7).split(' ')[0];}return 0;},FFVersion:function(){var i=window.navigator.userAgent.indexOf("Firefox/");if(i!=-1){return(window.navigator.userAgent+"").substring(i+8).split(' ')[0];}return 0;},$ActiveXObject:function(){if('ActiveXObject' in window)return 1;return 0;},toString:function(){return "igk.navigator";}});createNS("igk.animation",{init:function(o,interval,duration,initcallbackfunc,updatecallbackfunc,endcallbackfunc,properties){var m_timeout=null;var m_updatecallback=null;var m_o=o;var m_interval=interval;var m_duration=duration;var m_updatecallback=updatecallbackfunc;var m_initcallback=initcallbackfunc;var m_endcallback=endcallbackfunc;var m_ellapsed=0.0;var m_properties=properties;var m_opupdate=null;function __animInstance(){this.getOwner=function(){return m_o;};this.getInterval=function(){return m_interval;};this.getDuration=function(){return m_duration;};this.getEllapsed=function(){return m_ellapsed;};this.getStepfactor=function(){if(m_opupdate){var v_delta=Math.round(m_opupdate(m_ellapsed/m_duration)*100)/100;return v_delta;}return this.getEllapsed()/this.getDuration();};this.start=function(){m_initcallback.apply(this);m_opupdate=igk.animation.getEffect(this.properties.effect,this.properties.effectmode);this.update();};this.update=function(){var self=this;m_ellapsed+=m_interval;if((m_ellapsed<=m_duration)&&(m_updatecallback.apply(this))){m_timeout=setTimeout(function(){self.update();},this.getInterval());}else{m_endcallback.apply(this);}};this.stop=function(){if(m_timeout){igk.clearTimeout(m_timeout);m_timeout=null;}m_ellapsed=0;};this.reset=function(){this.stop();m_initcallback.apply(this);};this.toString=function(){return "igk.animation.instance";};};return new __animInstance();},InitBgAdorator :function(element,frequency,interval,fadeinterval,israndom,getimguri,defindex,updateuri){var q=new igk.animation.adorator(element,frequency,interval,fadeinterval,israndom);igk.ajx.get(getimguri,null,function(xhr){if(this.isReady()){var d=igk.createNode('datas');d.setHtml(xhr.responseText);var tt=d.getElementsByTagName('igk-img');d.select('igk-img').each_all(function(){q.add(this.getAttribute("src"));});setTimeout(function(){q.start(function(){igk.ajx.get(updateuri+q.index,null,null);});},400);}});},adorator:function(element,frequency,interval,fadeinterval,israndom){if(element==null)throw "element is null";this.element=element;igk.initprop(this.element);this.frequency=frequency;this.interval=interval;this.fadeinterval=fadeinterval;this.israndom=israndom;this.images=new Array();this.index=0;this.lasttimeout=null;this.defaultset=false;this.muststart=false;this.setDefaultIndex=function(index){if(this.images){if((index>=0)&&(index<this.images.length)){this.index=index;}this.defaultset=!0;}};this.toString=function(){return "igk.animation.adorator";};this._setStyle=function(e){e.style.width="100%";e.style.height="100%";e.style.position="absolute";e.style.top="0px";e.style.left="0px";e.style.display="block";e.className="igk-bgadorator-block";};this.loadImages=function(imgs){function __regimage(item,e){item._setStyle(e.o);item.images[item.images.length]=e;e.parentNode.removeChild(e);};var truncated=false;if(imgs.length>0){for(var i=0;i<imgs.length;i++){if(!imgs[i].complete){var self=this;var timgs=imgs;if(self.loaded){igk.clearTimeout(self.loaded);}self.loaded=setTimeout(function(){self.loadImages(timgs);},400);truncated=!0;return;}}}if(!truncated){var e=null;this.images=new Array();var self=this;var c=imgs.length;for(var i=0;i<c ;i++){e=imgs[0];if(e){__regimage(self,e);}}if(this.muststart){this.start();}}else{alert("Some Image(s) truncated");}};this.add=function(uri){var e=igk.createNode("img");e.o.src=uri;this._setStyle(e.o);this.images[this.images.length]=e;};this._init=function(){if((!this.images)&&(this.images.length<=0))return;var t=this.element.getElementsByTagName("img");var e=null;if(t.length>0){e=t[0];}else{this.element.insertBefore(this.images[0],this.element.childNodes[0]);e=this.images[0];igk.animation.fadein(e,this.frequency,this.fadeinterval);}};this.start=function(notifyfunction){if((!this.images)||(this.images.length<=0)){this.notifyfunction=notifyfunction;this.muststart=!0;return;}var t=this.element.getElementsByTagName("img");var e=null;if(t.length>0){e=t[0];}else{var v_re=this.images[0].o;var v_ce=this.element.childNodes[0];if((v_re!=null)&&(v_ce!=null)){this.element.insertBefore(v_re,v_ce);}e=this.images[0].o;igk.animation.fadein(e,this.frequency,this.fadeinterval);}var d=!this.defaultset;this.notifyfunction=notifyfunction;if(!this.defaultset){this.setDefaultIndex(Math.floor((Math.random()*this.images.length)));if(this.notifyfunction){this.notifyfunction();}}var img=this.images[this.index].o;if(img && e &&(img!==e)){this.element.replaceChild(img,e);igk.animation.fadein(img,this.frequency,this.fadeinterval);}var self=this;if(this.lasttimeout){igk.clearTimeout(this.lasttimeout);this.lasttimeout=null;}this.lasttimeout=setTimeout(function(){self.update();},this.interval);this.muststart=false;};this.update=function(){var self=this;var i=0;if(this.israndom){i=Math.floor((Math.random()*this.images.length));}else{i=((this.index+1)% this.images.length);}if(i==this.index)return;this.index=i;var e=this.element.getElementsByTagName("img")[0];var img=null;if(typeof(e)==IGK_UNDEF){}else{img=this.images[this.index];if(img==null){throw "element is null at "+this.index;}if(e !=img.o){try{if(img)$igk(e).insertAfter(img);if(e)igk.animation.fadeout(e,this.frequency,this.fadeinterval,1,function(){if(e.parentNode){e.parentNode.removeChild(e);}});if(img)igk.animation.fadein(img,this.frequency,this.fadeinterval);}catch(ex){igk.show_notify_error("Exception","Exception__adorator__ : index="+this.index+" <br />"+ex+"<p class=\"igk-trace\">"+ex.stack+"</p>");}}this.lasttimeout=setTimeout(function(){self.update();},this.interval);if(this.notifyfunction){this.notifyfunction();}}};this.stop=function(){if(this.lasttimeout){igk.clearTimeout(this.lasttimeout);this.lasttimeout=null;}};},context:function(element,style,duration,updatetype){if(element==null)throw "Context failed : Operation Not Allowed element is null";function __regAnimationContext(context,item,style){var i=null;if(typeof(item.igk.animationContext)==igk.constants.undef){i=new __primarycontext(element,style);item.igk.animationContext=new function(){var m_contexts=[];igk.appendProperties(this,{pushContext:function(style,context){m_contexts[style]=context;},getContext:function(style){if(typeof(m_contexts[style])==IGK_UNDEF){return m_contexts[style];}return null;}});};item.igk.animationContext.pushContext(style,i);}else{i=item.igk.animationContext.getContext(style);if(i==null){i=new __primarycontext(element,style);item.igk.animationContext.pushContext(style,i);}}return i;}function __primarycontext(element,style){this.element=element;this.style=style;this.interval=20;this.duration=duration? duration:1000;this.updatetype=updatetype||"timeout";this.step=0.1;this.ellapsed=0.0;this.opacity=1.0;this.endopacity=1.0;this.callback=null;this.toString=function(){return "igk.animation.context";};this.start=function(){switch(this.style){case "fadein":case "fadeout":this.element.igk.setOpacity(this.opacity);break;}this.step=this.interval/this.duration;var q=this;if(this.updatetype=="timeout"){this.lasttimeout=setTimeout(function(){q.update();},this.interval);}else{this.lasttimeout=setInterval(function(){q.update();if(q.end){clearInterval(this.lasttimeout);}},this.interval);}};this.update=function(){var end=false;switch(this.style){case 'fadein':this.opacity+=this.step;if(this.opacity>this.endopacity){this.opacity=this.endopacity;end=!0;}break;case 'fadeout':this.opacity-=this.step;if(this.opacity<this.endopacity){this.opacity=this.endopacity;end=!0;}break;}this.element.igk.setOpacity(this.opacity);var q=this;if(!end){if(this.lasttimeout){igk.clearTimeout(this.lasttimeout);}this.lasttimeout=setTimeout(function(){q.update();},this.interval);}else{this.stop();if(this.callback){this.callback();}}};this.stop=function(){if(this.updatetype=="timeout"){if(this.lasttimeout){igk.clearTimeout(this.lasttimeout);this.lasttimeout=null;}}else{if(this.lasttimeout){clearInterval(this.lasttimeout);this.lasttimeout=null;}}};};;return __regAnimationContext(this,element,style);},fadecontext :function(element,style,duration){if(element==null)throw "Context failed : Operation Not Allowed element is null";igk.animation.context.apply(this,new Array(element,style,duration));},fadein:function(element,interval,duration,opacity,callback){if(element==null)return;var c=igk.animation.context($igk(element).o,'fadein');c.stop();c.interval=interval;c.duration=duration?duration:1000;if(typeof(opacity)=="object"){c.opacity=opacity.from? opacity.from:0;c.endopacity=opacity.to? opacity.to:1;}else{c.opacity=opacity?opacity:0;c.endopacity=1;}c.callback=callback;c.start();return c;},fadeout:function(element,interval,duration,opacity,callback){if(element==null)return;var op=1;var ep=0;if(typeof(opacity)=="object"){op=opacity.from? opacity.from:1;ep=opacity.to? opacity.to:0;}else{op=opacity?opacity:1;ep=0;}if((callback==null)&& $igk(element).isCssSupportTransition()){$igk(element).setCss({opacity:op}).addClass("igk-transition-easeinout").setTransitionDuration(((duration?duration:1000)/1000.0)+'s').setCss({opacity:ep});return;}var d=duration?duration:1000;var c=igk.animation.context($igk(element).o,'fadeout',d);c.stop();c.interval=interval;c.duration=d;c.opacity=op;c.endopacity=ep;c.callback=callback;c.start();return c;},toString:function(){return "igk.animation";},autohide:function(item,startat){setTimeout(function(){igk.animation.fadeout(item,20,500,1.0,function(){$igk(item).setCss({"display":"none"});$igk(item).remove();});},startat);},animate:function(element,properties,animinfo){if(element==null){return;}var contextname=igk_getv(animinfo,"context",'animate');var v_animtype=igk_getv(animinfo,"animtype",'timeout');var v_duration=animinfo?(animinfo.duration?animinfo.duration:1000):1000;var v_animeffect=igk_getv(animinfo,"effect",'linear');var v_animeffectmode=igk_getv(animinfo,"effectmode",'easein');var v_update=igk_getv(animinfo,"update",null);var v_complete=igk_getv(animinfo,"complete",null);var c=igk.animation.context($igk(element).o,contextname,v_duration,v_animtype);c.stop();c.interval=animinfo?(animinfo.interval?animinfo.interval:20):20;c.callback=animinfo? animinfo.complete:null;c.updatecallback=animinfo? animinfo.update:null;var k=new function(){this.time=0;this.steps=new Array();};var s=null;var m=null;var step=null;var out_func=igk.animation.getEffect(v_animeffect,v_animeffectmode);for(var i in properties){switch((i+"").toLowerCase()){case "textshadow":s=window.igk.system.styles.textShadowCreate($igk(element).getComputedStyle(i));m=window.igk.system.styles.textShadowCreate(properties[i]);break;case "color":case "backgroundcolor":case "bordercolor":{s=window.igk.system.colorFromString($igk(element).getComputedStyle(i));m=window.igk.system.colorFromString(properties[i]);k.steps[i]={step :{r:(m.r-s.r),g:(m.g-s.g),b:(m.b-s.b),toString:function(){return "("+this.r+","+this.g+","+this.b+")";}},start:s,end :m,pos :{r:0,g:0,b:0},name:i,unit :igk_getUnit(m)};}break;default:s=igk_getNumber($igk(element).getComputedStyle(i));m=igk_getNumber(properties[i],$igk(element),i);k.steps[i]={step :(m-s),start:s,end :m,pos :0,name:i,unit :igk_getUnit(m)};}}c.update=function(){var q=this;var end=false;var v_delta=0.0;k.time+=q.interval;v_delta=Math.round(out_func(k.time/q.duration)*100)/100;for(var i in k.steps){if((i=="length"))continue;var h=k.steps[i];if(h.step==0)continue;var item={};var v=0;var key=i.toLowerCase();switch(key){case "opacity":h.pos=v_delta*h.step;v=(h.start+h.pos);break;case "color":case "backgroundcolor":case "bordercolor":h.pos.r=(v_delta*h.step.r);h.pos.g=(v_delta*h.step.g);h.pos.b=(v_delta*h.step.b);var r=parseInt(h.start.r+h.pos.r);var g=parseInt(h.start.g+h.pos.g);var b=parseInt(h.start.b+h.pos.b);v=new igk.system.color(r,g,b);v=v.toHtml();break;default:h.pos=v_delta*(h.end-h.start);v=parseInt((h.start+h.pos))+""+h.unit ;break;}item[i]=v;$igk(this.element).setCss(item);}if(this.updatecallback){this.ellapsed=k.time;this.updatecallback.apply(this);}end=k.time>=q.duration;if(!end){if(q.updatetype=="timeout"){if(this.lasttimeout){igk.clearTimeout(this.lasttimeout);}this.lasttimeout=setTimeout(function(){q.update();},this.interval);}}else{$igk(this.element).setCss(properties);this.stop();if(this.callback){this.callback();}}this.end=end;};c.start();return c;},animateUpdate :function(element,animinfo){if((element==null)||(animinfo==null)||(typeof(animinfo.update)===IGK_UNDEF))return;var contextname=igk_getv(animinfo,"context",'animateUpdate');var v_animtype=igk_getv(animinfo,"animtype",'timeout');var v_duration=animinfo?(animinfo.duration?animinfo.duration:1000):1000;var c=igk.animation.context($igk(element).o,contextname,v_duration,v_animtype);c.stop();c.interval=animinfo?(animinfo.interval?animinfo.interval:20):20;c.duration=v_duration;c.callback=animinfo? animinfo.complete:null;var k=new function(){this.time=0;};c.update=function(){var q=this;var end=false;k.time+=q.interval;animinfo.update.apply(this,[k]);end=k.time>=q.duration;if(!end){if(this.lasttimeout)igk.clearTimeout(this.lasttimeout);this.lasttimeout=setTimeout(function(){q.update();},this.interval);}else{$igk(this.element).setCss(properties);this.stop();if(this.callback){this.callback();}}};c.start();return c;},getAnimationFrame:function(){return igk.fn.getWindowFunc("requestAnimationFrame",__getAnimationFrame);},getAnimationCancelFrame:function(){return igk.fn.getWindowFunc("cancelAnimationFrame",__cancelAnimationFrame);}});var m_animFrames=[];var lastTime=0;function __getAnimationFrame(callback){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;}function __cancelAnimationFrame(id){clearTimeOut(id);}igk_appendProp(igk.animation,{effects:new function(){igk_appendProp(this,{"linear":function(progress){return progress;},"quad":function(progress){return Math.pow(progress,2);},"quint":function(progress){return Math.pow(progress,2);},"pow":function(progress,pow){return Math.pow(progress,pow||2);},"circ":function(progress){return 1-Math.sin(Math.acos(progress));},"back":function(progress){return Math.pow(progress,2)*((1.5+1)*progress-1.5);},"bounce":function(progress){for(var a=0,b=1,result;1;a+=b,b /=2){if(progress>=(7-4*a)/ 11){return-Math.pow((11-6*a-11*progress)/ 4,2)+Math.pow(b,2);}}},"makeEaseInOut":function(delta){return function(progress){if(progress<.5)return delta(2*progress)/ 2;else return(2-delta(2*(1-progress)))/ 2;};},"makeEaseOut":function(delta){return function(progress){return 1-delta(1-progress);};},toString:function(){return "igk.anmation.effects";}});},getEffect :function(animeffect,animeffectmode){if(!animeffect)animeffect="linear";if(!animeffectmode)animeffect="easein";var out_func=igk.animation.effects[animeffect];switch(animeffectmode){case "easein":break;case "easeout":out_func=igk.animation.effects.makeEaseOut(out_func);break;case "easeinout":out_func=igk.animation.effects.makeEaseInOut(out_func);break;}return out_func;}});createNS("igk.validator",{isUri:function(s){return /(http(s){0,1}|ftp|file):\/\/(.)+$/.test(s);},toString:function(){return igk.validator.fullname;}});function __ajx_setExtraData(ajx,extradata){if(extradata){igk_appendProp(ajx,extradata);}};function __ajx_initfunc(func){if(typeof(func)=='string'){var g=$igk(func);if(g.getCount()>0){func=function(xhr){if(this.isReady()){g.setHtml(xhr.responseText).init();}};}}return func||igk.ajx.fn.replace_or_append_to_body };(function(){var m_ajx_monitorListener;var m_hxhr ;createNS("igk.ajx",{setHeader:function(xhr){xhr.setRequestHeader("IGK-X-REQUESTED-WITH","XMLHttpRequest");},setMonitorListener:function(monitor){m_ajx_monitorListener=monitor;},isMonitoring:function(){return m_ajx_monitorListener!=null;},getCurrentXhr:function(){return m_hxhr;},GetParentHost:function(){return m_hxhr ? m_hxhr.source :null;},eval:function(n){if(typeof(n)!="string"){if(n.tagName && n.tagName.toLowerCase()=="script"){var pn=n.parentNode ? n.parentNdode :document.body;try{var v_script=$igk(n).getHtml();if(igk.system.string.trim(v_script).length>0){igk.eval(v_script,pn,n);}}catch(ex){console.debug(ex);}}else{igk_preload_image(n);var ct=$igk(n).select("script");ct.each(function(){var _t=this.getAttribute("type");if(_t=='text/balafonjs'){__bindbalafonjs.apply(this);}else{var v_script=this.getHtml();try{igk_eval(v_script,this.o);}catch(ex){console.debug(ex);}}return this;});}}},replaceBody:function(text,unregister){var c=window.igk.utils.getBodyContent(text);try{if(unregister){igk.winui.getEventObjectManager().unregister(document);igk.winui.getEventObjectManager().unregister(window);igk.winui.getEventObjectManager().unregister_child(document.body);}document.body.innerHTML="";document.body.innerHTML=c;igk.ajx.fn.initnode(document.body);igk.publisher.publish(igk.evts.dom[1],{evt:{text:text,target:document.body}});}catch(ex){igk.winui.notify.showErrorInfo("Javascript Exception","replaceBody Evaluation failed <br />"+ex);console.error(ex);}},a_postResponse:function(a,parentTag){window.igk.ajx.post(a.href,null,new window.igk.ajx.targetResponse(a,parentTag).update);return !1;},a_getResponse:function(a,parentTag){window.igk.ajx.get(a.href,null,new window.igk.ajx.targetResponse(a,parentTag).update);return !1;},aposturi:function(uri,targetNodeId){window.igk.ajx.post(uri,null,function(xhr){if(this.isReady()){this.setResponseTo(document.getElementById(targetNodeId),true);}});},ageturi:function(uri,targetNodeId){var q=$igk(targetNodeId);if(q && uri){igk.ajx.get(uri,null,function(xhr){if(this.isReady()){this.replaceResponseNode(q.o);}});}},responseNode:function(nodeId){var m_target=document.getElementById(nodeId);if(m_target){window.igk.appendProperties(this,{"response":function(xhr){if(this.isReady()){this.setResponseTo(m_target,true);}}});}},getResponseNodeFunction:function(cibling,parentNodeTag){var b=$igk(cibling).getParentByTagName(parentNodeTag);if(b){return function(xhr){if(this.isReady()){this.setResponseTo(b);}};}return null;},responseBody:function(){window.igk.appendProperties(this,{"response":function(xhr){if(this.isReady()){window.igk.ajx.replaceBody(xhr.responseText,true);}}});},targetResponse:function(item,parentTag){var m_target=null;if(parentTag){m_target=$igk(item).getParentByTagName(parentTag);}else m_target=item;if(m_target==null)return null;window.igk.appendProperties(this,{update :function(xhr){if(this.isReady()){this.setResponseTo(m_target,true);}},toString :function(){return "igk.ajx.targetResponse" }});},ajx :function(monitorlistener){var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();}else{if(igk.navigator.$ActiveXObject()){try{xhr=new ActiveXObject("Microsoft.XMLHTTP");}catch(ex){throw("No Ajax Support");}}}if((xhr==null)||(xhr.readyState+""==igk.constants.undef)){throw("No Ajax Support");}this.xhr=xhr;this.saveState=false;this.uri=null;this.postargs=null;this.method="GET";this.synchronize=false;this.isReady=function(){return((this.xhr.readyState==4)||(this.xhr.readyState==200)||((this.xhr.readyState==4)&&(this.xhr.status==200)&&(this.xhr.statusText=="OK")));};this.toString=function(){return "igk.ajx";};this.setResponseTo=function(q,unregister){if(q &&(typeof(q.innerHTML)!=IGK_UNDEF)){if(q==document.body){this.replaceBody();}else{if(unregister){igk.winui.getEventObjectManager().unregister_child(q);}q.innerHTML=this.xhr.responseText;igk.ajx.fn.initnode(q);}}};this.replaceBody=function(){igk.ajx.replaceBody(this.xhr.responseText,true)};this.replaceResponseNode=function(node,preload){var i=igk.createNode("dummy");var p=typeof(preload)==igk.constants.undef ?!0:preload;i.setHtml(this.xhr.responseText);if(node && node.parentNode){var b=i.firstChild();var g=false;var pt=$igk(node.parentNode);var ol=null;var f=0;while(b !=null){if(!g){pt.o.replaceChild(b.o,node);f=b;}else{ol.insertAfter(b.o);}igk.ajx.fn.initnode(b.o);g=!0;ol=b;b=$igk(i.o.firstChild);}if(p && g){__applyPreloadDocument(document);}return f;}};window.igk.appendProperties(this,{appendResponseTo:function(q){var s=igk.createNode("dummy");s.setHtml(this.xhr.responseText);var f=s.o.firstChild;var h=s.o.firstChild;while(f){q.appendChild(f);igk.ajx.eval(f);f=f.nextSibling;}},prependResponseTo:function(q){var s=igk.createNode("dummy");s.o.innerHTML=this.xhr.responseText;var m=q.o.firstChild;var f=s.o.firstChild;var c=f;while(f){c=c.nextSibling;q.insertBefore(f,m);igk.ajx.eval(f);f=c;}},abort:function(){this.xhr.abort();}});this.setResponseMethod=function(method){var q=this;if(method){switch(typeof(method)){case "function":q.responseMethod=method;q.xhr.onreadystatechange=function(){try{if(q.responseMethod){m_hxhr=q;igk.context='xhr';q.responseMethod(this);m_hxhr=null;igk.context=null;}}catch(ex){igk.winui.notify.showErrorInfo("Exception","<h3>AJX:__setResponseMethod__</h3><div>"+ex+"<div><code>Trace : "+ex.trace+"</code> <pre style='text-overflow:ellipsis; overflow:hidden; max-height:4em;'>"+igk.html.string(this.responseText)+"</pre><p class=\"igk-trace\" style='padding-top:1.3em' ><pre style='max-height:3em; overflow-y:auto;'>"+ex.stack +"</pre></p>" );}};break;case 'object':var fc=method.complete?function(){method.complete.apply(method,[q.xhr,method]);}:null;q.xhr.onreadystatechange=null;q.xhr.onload=fc;q.xhr.onerror=method.error;break;}}};function __initheader(){igk.ajx.setHeader(this.xhr);this.xhr.setRequestHeader("IGK_FROM",document.domain);};this.send=function(method,url,postargs,sync){this.uri=url;this.asynchronize=typeof(sync)==igk.constants.undef ? true :sync;this.postargs=postargs;this.method=method;this.xhr.open(method,url,this.asynchronize);if(this["ajx.xhr"]){igk_appendProp(this.xhr,this["ajx.xhr"]);}__initheader.apply(this);if(postargs){if(typeof(postargs)=="string"){this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=iso-8859-1");}}if(monitorlistener){this.xhr.onloadstart=monitorlistener.loadstart;this.xhr.onloadend=monitorlistener.loadend;this.xhr.onprogress=monitorlistener.loadprogress;}this.xhr.send(postargs);};},postWebRequest:function(uri,action,param,func,headers,async,savestate,extradata){if(typeof(async)==igk.constants.undef)async=!0;var ajx=new igk.ajx.ajx();ajx.saveState=(savestate)?true:false;__ajx_setExtraData(ajx,extradata);igk.appendProperties(ajx,{serviceResponse:function(){var d=document.createElementNS(igk.namespaces.xhtml,"dummy");$igk(d).setHtml(ajx.xhr.responseText);var r=$igk(d).select(action+"_result").first();if(r){return r.o.innerHTML;}return 0;}});ajx.setResponseMethod(__ajx_initfunc(func));ajx.xhr.open("POST",uri,async);ajx.xhr.setRequestHeader("Content-Type","text/plain");igk.ajx.setHeader(ajx.xhr);ajx.xhr.setRequestHeader("SOAPACTION",action);if(headers){for(var i in headers){}}var v_params="";for(var i in param){v_params+="<"+i+">"+param[i]+"</"+i+">";}var v_body="<"+action+">"+v_params+"</"+action+">";var packet='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body>'+v_body+'</soap:Body></soap:Envelope>';ajx.xhr.send(packet);return ajx;},post:function(uri,param,func,async,savestate,extradata){if(typeof(async)==igk.constants.undef)async=!0;var ajx=new igk.ajx.ajx(m_ajx_monitorListener);ajx.saveState=(savestate)?true:false;__ajx_setExtraData(ajx,extradata);ajx.setResponseMethod(__ajx_initfunc(func));ajx.send("POST",uri,param,typeof(async)==igk.constants.undef ?!0:async);return ajx;},apost :function(uri,param,func,savestate,extradata){return this.post(uri,param,func,true);},get:function(uri,param,func,async,savestate,extradata){var ajx=new igk.ajx.ajx(m_ajx_monitorListener);if(typeof(async)==igk.constants.undef)async=!0;ajx.saveState=(savestate==igk.constants.undef)?true:false;__ajx_setExtraData(ajx,extradata);ajx.setResponseMethod(__ajx_initfunc(func));ajx.send("GET",uri,param,async);return ajx;},aget:function(uri,param,func,extradata){this.get(uri,param,func,true,extradata);},postform:function(form,uri,func,sync){if(!form)return;var msg="";var e=null;var p=[];function __appendForm(id,value){if(p[id]){var tab=p[id];if(igk_is_array(tab)){tab.push(value);}else{var tt=[];tt.push(tab);tt.push(value);p[id]=tt;}}else p[id]=value;}if(igk.winui.lineWaiter){var lw=igk.winui.lineWaiter.prependTo(form);var tf=func;$igk(form).select(".actions").addClass("dispn");func=function(xhr){if(tf){tf.apply(this,[xhr]);}else{console.debug("there is no function callback");}if(this.isReady()){lw.remove();$igk(form).select(".actions").rmClass("dispn");}};}if(window.FormData){var frmData=new FormData(form);igk.ajx.post(uri,frmData,func,(sync==igk.constants.undef)?sync:true,true,{source :$igk(form)});}else{for(var i=0;i<form.length;i++){e=form.elements[i];switch(e.type){case "radio":case "checkbox":if(e.checked){__appendForm(e.id,e.value);}break;case "file":if(e.files.length>0){console.error("to check bad entrey");frmData.append(e.id,e.files[0]);}break;default:__appendForm(e.id,e.value);break;}}e=0;for(var i in p){if(e!=0)msg+="&";if(igk_is_array(p[i])){for(var t in p[i]){if(e!=0)msg+="&";msg+=i+"="+p[i][t];e=1;}}else msg+=i+"="+p[i];e=1;}igk.ajx.post(uri,msg,func,(sync==igk.constants.undef)?sync:true,true,{source :form });}},uploadInputFile:function(inputfile,uri,async,responseCallback,startcallBack,progressCallback,doneCallback){if(inputfile.files.length>0)igk.ajx.uploadFile(null,inputfile.files[0],uri,async,responseCallback,startcallBack,progressCallback,doneCallback);},uploadFile:function(osrc,file,uri,async,responseCallback,startcallBack,progressCallback,doneCallback,method){var bob=null;var reader=null;var v_ajx=new igk.ajx.ajx();v_ajx.source=osrc;var self=this;var xhr=v_ajx.xhr;var m=method?method:'blob';responseCallback=responseCallback||igk.ajx.fn.replace_or_append_to_body;if(igk.navigator.isIE()&& igk.navigator.IEVersion()){v_ajx.setResponseMethod(function(xhr){if(this.isReady()){igk.ajx.post(uri+'&ie=1',null,responseCallback);}});}else{v_ajx.setResponseMethod(responseCallback);}xhr.open("POST",uri,async);v_ajx.xhr.upload.onerror=function(evt){igk.winui.notify.showErrorInfo("Error","/!\\ uploaded failed: "+uri+"<br />"+" "+evt);console.debug("Error : "+v_ajx.xhr.statusText);console.debug(v_ajx.xhr);};if(async){v_ajx.xhr.upload.onprogress=function(evt){if(progressCallback){progressCallback.apply(this,arguments);}};v_ajx.xhr.upload.onload=function(evt){if(doneCallback){doneCallback.apply(this,arguments);}};v_ajx.xhr.upload.onloadstart=function(evt){if(startcallBack){startcallBack.apply(this,arguments);}}}xhr.overrideMimeType('text/plain; charset=x-user-defined-binary');xhr.setRequestHeader("Cache-Control","no-cache");igk.ajx.setHeader(xhr);xhr.setRequestHeader("IGK-UPLOADFILE",true);xhr.setRequestHeader("IGK-FILE-NAME",file.name);xhr.setRequestHeader("IGK-UP-FILE-SIZE",file.size);xhr.setRequestHeader("IGK-UP-FILE-TYPE",file.type);xhr.setRequestHeader("Content-Type","multipart/form-data;charset=utf-8; boundary="+Math.random().toString().substr(2));var r=file;var filer=false;if(m!='blob'){if(typeof(FileReader)!=IGK_UNDEF)filer=new FileReader();if(!filer){return;}reader=filer;reader.onprogress=function(evt){console.debug("progress read");};reader.onload=function(evt){var t=igk.winui.eventTarget(evt);if(xhr.sendAsBinary)xhr.sendAsBinary(t.result);else{xhr.send(t.result);}};if(reader.readAsBinaryString)reader.readAsBinaryString(r);else reader.readAsText(r);}else{if(r.slice){bob=r.slice(0,file.size);try{xhr.send(bob);}catch(ex){igk.winui.notify.showErrorInfo("JS Exception ",""+ex);}}}},load:function(f,callback){var async=0;var param=null;var ajx=new igk.ajx.ajx();ajx.saveState=1;ajx.setResponseMethod(callback);ajx.send("GET",f,param,async);return ajx;},toString:function(){return "igk.ajx";},globalMonitorListener:function(){igk.appendProperties(this,{loadstart:function(evt){igk.publisher.publish('sys://ajx/loadstart',{evt:evt});},loadend:function(evt){igk.publisher.publish('sys://ajx/loadend',{evt:evt});},loadprogress:function(evt){igk.publisher.publish('sys://ajx/loadprogress',{evt:evt});}});}});m_ajx_monitorListener=new igk.ajx.globalMonitorListener();})();createNS("igk.soap",{query:function(data){var ns="http://schemas.xmlsoap.org/soap/envelope/";var r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">';var g=igk.createNode("soap:Body",ns);var m=data.method;if(m){var fm=g.add(igk.createNode(m,ns));if(data.params){for(var i in data.params){fm.add(i).setHtml(data.params[i]);}}}r+=g.o.outerHTML;r+="</soap:Envelope>";igk.ajx.post(data.uri,r,function(xhr){if(this.isReady()){var q=igk.createNode("div");q.setHtml(xhr.responseText);if(xhr.status==200){if(m && data.ready){var g=q.getElementsByTagName(m+"_result")[0];data.ready({data:g.innerHTML});}}else{var g=q.getElementsByTagName("faultstring")[0];if(data.error && g)data.error({data:g.innerHTML});}}});}},{desc:"used to handle soap request"});(function(){var m_nodeReady=[];var m_initBeforeReady=[];var _postdata=[];function _bready(c){var l=m_initBeforeReady.length;if(l<=0)return;var m=$igk(c);for(var i=0;i<l ;i++){m_initBeforeReady[i].apply(m);}};function _initnode(c){_bready(c);igk.ajx.eval(c);igk.ctrl.callBindAttribData(c);igk.ajx.fn.nodeReady(c);igk.publisher.publish("sys://node/init",{target:c,rootDepth:0 });igk.publisher.publish("sys://doc/changed",{target:c,context:'initnode'});};createNS("igk.ajx.fn",{none:function(){},complete_ready:function(select){return function(xhr,q){var s=q.select(select).first();if(s)s.setHtml(xhr.responseText).init();};},postData:function(uri,n,t,m){if(uri in _postdata){_postdata[uri].abort();}var fc=null;if(typeof(t)=='string'){var g=$igk(t).first();if(g)fc=igk.ajx.fn.replace_content(g.o);}else if(typeof(t)=='function'){fc=t;}else{fc=igk.ajx.fn.replace_or_append_to_body;}var v=n.value;if(typeof(v)=='object')v=igk.JSON.convertToString(v);var _send=igk.ajx.post;var _data=n.id+"="+v;if(!m){_send=igk.ajx.get;uri+=((uri.indexOf("?")==-1)? "?":"&")+_data;}g=_send(uri,_data,function(xhr){if(this.isReady()){if(fc)fc.apply(this,[xhr]);delete(_postdata[uri]);}});_postdata[uri]=g;},appendTo:function(t){return function(xhr){if(this.isReady()){igk.ajx.fn.append_to(xhr,t);}}},scriptReplaceContent:function(m,u,t){var fc=igk.ajx.get;if(m=="post")fc=igk.ajx.post;function rp(xhr){if(this.isReady()){if(igk.winui.lineWaiter)igk.winui.lineWaiter.remove(t);igk.ajx.fn.replace_content(t).apply(this,[xhr]);}}if(igk.winui.lineWaiter){igk.winui.lineWaiter.prependTo(t);}fc.apply(window,[u,null,rp]);},getfortarget:function(u,t){if(!t)return;igk.ajx.get(u,null,function(xhr){if(this.isReady()){this.setResponseTo(t);igk.ajx.fn.initnode(t);}});},replace_body:function(xhr){if(this.isReady()){this.replaceBody();}},replace_node:function(host){return function(xhr){if(this.isReady()){this.replaceResponseNode(host,false);}}},replace_content:function(host){return function(xhr){if(this.isReady()){var g=igk.utils.getBodyContent(xhr.responseText,1);if(g!=null){$igk(document.body).setHtml('');igk.ajx.fn.replace_or_append_to(document.body).apply(this,[xhr]);}else{this.setResponseTo(host,true);}}};},replace_or_append_to:function(t){return function(xhr){if(this.isReady()){var q=igk.createNode("dummy");q.setHtml(xhr.responseText);var i=q.o.childNodes.length ;if(i>0){var vo=new igk.selector();while(i>0){var c=q.o.childNodes[0];var p=0;if(igk.ajx.fn.ctrl_replacement(c)==false){if(c.id){var ki=document.getElementById(c.id);if(ki){p=1;ki.parentNode.replaceChild(c,ki);}}}else{p=1;}if(p==0)t.appendChild(c);igk.ajx.fn.initnode(c);i--;vo.push(c);}}igk.publisher.publish(igk.evts.dom[2],{target:t,src:xhr.responseText});}};},replace_or_append_to_body:function(xhr){if(this.isReady()){var g=igk.utils.getBodyContent(xhr.responseText,1);if(g!=null)$igk(document.body).setHtml('');igk.ajx.fn.replace_or_append_to(document.body).apply(this,[xhr]);}},append_to_body:function(xhr){if(this.isReady()){igk.ajx.fn.append_to(xhr,document.body);}},prepend_to_body :function(xhr){if(this.isReady()){igk.ajx.fn.prepend_to(xhr,document.body);}},ctrl_replacement:function(c){if(c && c.tagName &&(c.tagName.toLowerCase()=='igk:replace-ctrl')){var q=$igk(c);var st=q.getAttribute("target");var h=q.getAttribute("hash");if(st){var t=$igk(st).first();if(t){var s=q.select(">>");if(s.getCount()==1){s.each(function(){t.replaceBy(this);igk.ajx.fn.initnode(this.o);return !1;})}else{var m="";s.each(function(){m+=this.o.outerHTML;return !0;});t.setHtml(m);igk.ajx.fn.initnode(t.o);}q.remove();if(h){document.location.hash=h;}return !0;}}q.select(">>").each(function(){var g=$igk("#"+this.o.id).first();if(g &&(g.getAttribute('igk-type')=="controller")){g.replaceBy(this);igk.ajx.fn.initnode(this.o);}return !0;});$igk(c).remove();return !0;}return !1;},append_to:function(xhr,target){if(xhr.responseText.length>0){var q=igk.createNode("div");var txt=igk.utils.treatBodyContent(xhr.responseText);q.setHtml(txt);var i=q.o.childNodes.length ;if(i>0){var vo=new igk.selector();var ct=0;while(i>0){var c=q.o.childNodes[ct];if(igk.ajx.fn.ctrl_replacement(c)==false){if(c.tagName &&(c.tagName.toLowerCase()=='igk-body')&&($igk(target).o==document.body)){$igk(document.body).replaceWith(c);igk.ajx.fn.initbody();ct++;}else{target.appendChild(c);igk.ajx.fn.initnode(c);}}i--;vo.push(c);}return vo;}}return null;},prepend_to:function(xhr,t){if(xhr.responseText.length>0){var q=igk.createNode("div");q.setHtml(xhr.responseText);var i=q.o.childNodes.length ;while(i>0){var c=q.o.childNodes[0];if(igk.ajx.fn.ctrl_replacement(c)==false){$igk(t).prependChild(c);igk.ajx.fn.initnode(c);}i--;}}},nodeReady:function(c){if(m_nodeReady &&(m_nodeReady.length>0)){for(var i=0;i<m_nodeReady.length;i++){m_nodeReady[i].apply(c);}}},registerNodeReady:function(f){if(typeof(f)=="function")m_nodeReady.push(f);},unregisterNodeReady:function(f){var s=[];for(var i=0;i<m_nodeReady.length;i++){if(m_nodeReady[i]==func){continue;}s.push(readyFunc[i]);}m_nodeReady=s;},initBeforeReady:function(f){if(typeof(f)=="function")m_initBeforeReady.push(f);},uninitBeforeReady:function(f){var c=[];for(var i=0;i<m_initBeforeReady.length;i++){if(m_initBeforeReady[i]==f)continue;c.push(m_initBeforeReady[i]);}m_initBeforeReady=c;},initbody:function(){igk.ajx.fn.initnode(document.body);igk.publisher.publish("system/bodychange",{target:document.body});},bindto:function(n,h){return function(xhr){if(this.isReady()){this.setResponseTo(n);igk.ajx.fn.initnode(n.o);if(h)window.igk.winui.saveHistory(h);}}},initnode:function(c){if(!c)return;if(typeof(c.nodeType)=="undefined"){throw new Error("BAD dom node initialization ... element is not a node : "+c);}function bindNode(n){this.c=n;var q=this;igk.appendProperties(this,{init:function(){_initnode(q.c);}});};if(document.readyState !='complete'){igk.ready(new bindNode(c).init);return;}_initnode(c);}});})();igk.animation.constants={gL:"gotoleft",gR:"gotoright",gT:"gototop",gB:"gotobottom",DIR_VERTICAL :"vertical",DIR_HORIZONTAL :"horizontal" };function igk_setcss_bound(i,rect){$igk(i).setCss({"left":rect.x+"px","top":rect.y+"px","width":rect.width+"px","height":rect.height+"px"});}function igk_debug_show_heararchi(node){var q=frm;while(q){igk.console_debug(q.tagName+":"+q.id);q=q.parentNode;}}function igk_debug(msg){if(igk.DEBUG){igk.console_debug(msg);}}function igk_debug_t(tag,msg){if(igk.DEBUG){igk.console_debug("["+tag+"]-"+msg);}}createNS("igk.math",{rectangle :function(x,y,w,h){this.x=x?x:0;this.y=y?y:0;this.width=w?w:0;this.height=h?w:0;this.toString=function(){return "igk.math.rectangle["+this.x+","+this.y+","+this.width+","+this.height+"]";};this.isEmpty=function(){return(this.width==0)||(this.height==0);};this.inflate=function(x,y){this.x-=x;this.y-=y;this.width+=2*x ;this.height+=2*y;};}});createNS("igk.utils",{getv:igk_getv,get_form_posturi:igk_get_form_posturi,submit_fromenter :function(k,evt){if(evt.keyCode &&(evt.keyCode==13)){k.form.submit();return !1;}return !0;},treatBodyContent:function(txt){if(!txt)throw("/!\\ txt not define");return txt.replace(/(<\/?)body( .+?)?>/gi,'$1IGK-BODY$2>',txt);},getBodyContent :function(text,bonly){var s="";var t=igk.createNode("div");if(text){s=igk.utils.treatBodyContent(text);t.setHtml(s);}var tt=t.getElementsByTagName("IGK-BODY");if(tt.length==1){var out=tt[0].innerHTML;return out;}if(bonly)return null;return s;}});igk.utils.Base64={_keyStr :"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode :function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=igk.utils.Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1 & 3)<<4)|(chr2>>4);enc3=((chr2 & 15)<<2)|(chr3>>6);enc4=chr3 & 63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}return output;},decode :function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2 & 15)<<4)|(enc3>>2);chr3=((enc3 & 3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3 !=64){output=output+String.fromCharCode(chr2);}if(enc4 !=64){output=output+String.fromCharCode(chr3);}}output=igk.utils.Base64._utf8_decode(output);return output;},_utf8_encode :function(string){if(!string)return null;string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c & 63)|128);}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)& 63)|128);utftext+=String.fromCharCode((c & 63)|128);}}return utftext;},_utf8_decode :function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c & 31)<<6)|(c2 & 63));i+=2;}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c & 15)<<12)|((c2 & 63)<<6)|(c3 & 63));i+=3;}}return string;}};function igk_check_change(uri,every){var obj={uri :uri,interval :every,doaction :function(){var self=this;igk.ajx.post(uri,null,function(xhr){if(this.isReady()){if(xhr.responseText.length>0){var q=igk.createNode("data");igk_remove_all_script(q);var tdata=q.getElementsByTagName("data");if(tdata.length !=1){var t=document.getElementById("changeresponse");if(t==null){t=igk.createNode("div");t.id="changeresponse";document.body.appendChild(t);}}setTimeout(function(){self.doaction();},self.interval);}}});}};obj.doaction();}function igk_confirm_article_del(item){if(confirm("voulez vous vraiment supprimer l'article ?\nNote: la suppression es irrversible")){item.href=item.href+'&confirm=1';return !0;}return !1;}function igk_check_all(parent,node,value,toggle,target){if(node==null){console.debug("igk_check_all: node is null. perhaps IGKcontext failed");return;}var t=null;if(!target)t=$igk(node).select("input");else t=$igk(node).select(target);function __update(){if((this.o !=parent)&&(this.o.type=="checkbox")){if(toggle){if(this.o.checked==value){this.o.checked=!value;}else{this.o.checked=value;}}else{this.o.checked=value;}}return !0;};if(t){if(t.isSr())t.each(__update);else{__update.apply(t);}}}var m_preloadFunctions=[];function __applyPreloadDocument(document){for(var i=0;i<m_preloadFunctions.length;i++){m_preloadFunctions[i].apply(document);}};function __registerHtmlPreloadDocumentCallBack(name,callback){if(callback && name){if(!m_preloadFunctions[name]){var c={funcs:[],funcCount:function(){return this.funcs.length;},apply:function(target){for(var i=0;i<this.funcs.length;i++){this.funcs[i].apply(target);}},add:function(callback){if(callback){this.funcs.push(callback);}},remove:function(callback){for(var i=0;i<this.funcs.length;i++){if(callback==this.funcs[i]){this.funcs.pop(this.funcs[i]);}}},toString:function(){return "functionRegister";}};m_preloadFunctions[name]=c;m_preloadFunctions.push(c);}var s=m_preloadFunctions[name];s.add(callback);}};function __unregisterHtmlPreloadDocumentCallBack(name,callback){if(m_preloadFunctions[name]){m_preloadFunctions.remove(callback);}}createNS("igk.configmenu",{init:function(p){var t=p.getElementsByTagName("a");var a=null;for(var i=0;i<t.length;i++){a=t[i];a.onclick=function(){return igk.configmenu.navigate(this,this.getAttribute('page'));};}},navigate:function(i,p){var frm=igk.getParentById(i,'form');if(frm==null)return;frm.action=i.href;frm.menu.value=p;frm.submit();return !1;}});(function(){var m_loadtiny=0;var b_reg=0;var m_globals=[];var __u=igk.constants.undef;createNS("igk.tinyMCE",{runOn:function(el){if(typeof(tinyMCE)!=__u){for(var i in tinyMCE.editors){if(i=='length')continue;var m=tinyMCE.editors[i];if(!$igk(m.getElement()).isOnDocument()){tinyMCE.remove(m);}}setTimeout(function(){tinyMCE.init({selector:el.elements});},100);return;}else{igk.ready(function(){console.debug("load on ready");tinyMCE.init({selector:el.elements});});}},init:function(elements,op){function __loadAndInit(){var tq={};if(op){for(var i in op){tq[i]=op[i];};}var t=elements.elements;if(typeof(t)=="string"){tq.selector=t;console.error("run selector : "+t);tinyMCE.init(tq);return;}else {for(var i in t){var q=$igk(elements[i]).first();tq.selector=elements;tinyMCE.init(tq);}}}if(typeof(tinyMCE)!=igk.constants.undef){__loadAndInit();}else{igk.ready(function(){__loadAndInit();});}function __bindGlobal(t){for(var i=0;i<m_globals.length;i++){m_globals[i].apply();}m_globals=[];}if(!b_reg){console.debug("bind global");b_reg=1;}else{m_globals.push(function(){__loadAndInit()});}},edit:function(selector,op){function __loadAndInit(){var q={selector:selector,inline:true};for(var i in op){q[i]=op[i];}tinyMCE.init(q);}if(typeof(tinyMCE)!=igk.constants.undef){__loadAndInit();}else{igk.ready(__loadAndInit);}},save:function(n,uri,callback){var g=tinyMCE.get(n);if(g){igk.ajx.post(uri,'tiny=1&clContent='+g.getContent(),function(xhr){if(this.isReady()){if(callback)callback.apply(this);igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);}});}}});})();(function(){var m_controllers=[];var m_initialize=false;var m_attrib_datas={"igk-type":{n:"igk",desc:"declare type"},"igk-js-anim-over":{n:"js",desc:"execute anim on mouseover and mouse release",code:"igk-js-anim-over=\"{backgroundColor: 'red'},{ anim property....}\""},"igk-js-anim-focus":{n:"js",desc:"execute anim on fucus ans blur"},"igk-js-eval":{n:"js",desc:"used to eval script in current context"},"igk-js-eval-init":{n:"js",desc:"used to eval script in current context after document is ready"},"igk-js-init-uri":{n:"js",desc:"uri that will be invoke on document ready"},"igk-js-bodyheight":{n:"js",desc:"indicate that this node must target the body height"},"igk-node-disable-selection":{n:"node",type:"attribute",desc:"node can be selelected. default is true"},"igk-article-options":{n:"ctrl",desc:"indicate must be considered as an article options"},"igk-ctrl-options":{n:"ctrl",desc:"indicate must be considered as a controller options node"},"igk-input-focus":{n:"js",desc:"force the cibling node to get focus"},"igk-input-data":{n:"js",desc:"setup the data used to validate the input"},"igk-form-validate":{n:"js",desc:"used with form to indicate that the form must be validate before submit."},"igk-js-fix-height":{n:"js",desc:"fix elemenet height to target height. value is a id of the element"},"igk-js-fix-width":{n:"js",desc:"fix elemenet width to target width. value is a id of the element"},"igk-js-fix-size":{n:"js",desc:"fix elemenet size to target size. value is a id of the element"},"igk-js-fix-prop":{n:"js",desc:"fix element properties on size.expect property wait: {target,prop} "},"igk-js-fix-eval":{n:"js",desc:"fix element properties on window resize property wait: {update:function()} "},"igk-ajx-form":{n:'js',desc:'bool indicate that a form is used in ajx context. mixed(0|1|[{complete:func,targetid:[id of response node]}]. used igk-ajx-form-targedid to indicated the reponse node'},"igk-js-bind-select-to":{n:"js",desc:"bind select to data from target ref #id,passing object refid or json: {id:#sample,selected:value,usecustom:0|1,allowempty:1|0,emptyvalue:value}"},"igk-ajx-form-target":{n:'js',type:'attr',desc:'used in form to set the target of the form response,(select|=|::) where=is for the current form,:: if for the entire document '}};var m_ctrl_types={"igk-ctrl-options":{n:"igk",desc:"declare controller options"},"igk-ctrl":{n:"igk",desc:"declare a controller"}};var m_attribManager=[];var m_h_ctrl={};var m_readylist=null;var m_callflag=0;function __attribToString(){return "igk.ctrl.attribManagerInfo";};function __registerAttribManager(key,callback){if(callback && key){var e=null;if(m_attribManager[key])e=m_attribManager[key];else{e={k:key,s:new Array(),toString:__attribToString};m_attribManager[key]=e;m_attribManager.push(e);}e.s.push(callback);}};function __callReadyFunc(n,de){if(!n||(m_readylist==null)||m_callflag){return;}var e=null;var i=m_readylist.getCount();var j=0;m_callflag=1;for(j=0;j<m_readylist.getCount();j++){e=m_readylist.getItemAt(j);e.apply(n,[de]);}m_callflag=0;if(i!=j)console.debug("after call to ready list "+m_readylist.getCount());}function __readyFuncEventArgs(){var m_preventContinue=false;igk.appendProperties(this,{preventContinue:function(){m_preventContinue=!0;},getPreventContinue:function(){return m_preventContinue;}});};var m_attribCtrl=[];function __loadAttribCtrl(n,k){if(!(k in m_attribCtrl)){m_attribCtrl[k]=[];}m_attribCtrl[k].push(n);}function __callBindAttribData(node){var q=$igk(node);var cnf=q.getConfig("igk:callAttribBindingData");if(cnf==1){return;}var re=new __readyFuncEventArgs();__callReadyFunc(node,re);if(re.getPreventContinue()){return;}var s=q.getAllAttribs();var r=null;var e=null;if(typeof(s)==igk.constants.undef)return;function __invoke(key,tab,node){var e=null;var n=$igk(node);for(var i=0;i<tab.length;i++){e=tab[i];try{e.apply(n,[key,n.getAttribute(key)]);__loadAttribCtrl(n,key);}catch(ex){igk.winui.notify.showErrorInfo("Exception","__invoke::Binding<br />"+ex +"<p>"+ex.stack+"</p>" +"<br /><pre style=\"max-height:200px; overflow-y:auto;\">"+e+"</pre>");}}};for(var i=0;i<m_attribManager.length;i++){e=m_attribManager[i];r=new RegExp("("+e.k+")");if(r.test(s)){__invoke(e.k,e.s,node);}}q.setConfig("igk:callAttribBindingData",1);}function __clearBindAttribData(){m_attribManager=[];}function __ctrl_utility_functions(n){var m_o=n;igk_defineProperty(this,"o",{get:function(){return m_o;}});igk.appendProperties(this,{toString:function(){return "[object igk.ctrl.utility.function]";}});}createNS("igk.ctrl",{getAttribCtrl:function(k){return m_attribCtrl[k]||null;},getAttribCtrlList:function(k){var t=[];for(var i in m_attribCtrl){if(i=="length")continue;t.push(i);}return t;},bindAttribManager:function(key,callback){if(m_attrib_datas[key]&& callback){__registerAttribManager(key,callback);}else{igk.winui.notify.showMsg("<div class=\"igk-notify igk-notify-danger\">Error No Binding Attrib registrated for \""+key+"\".<br/><div>You must register it before call the bindAttribManager function.");}},bindPreloadDocument:function(name,callback){__registerHtmlPreloadDocumentCallBack(name,callback);},getcontroller :function(item){if(item==null)return null;if(item.getAttribute &&(item.getAttribute("igk-type")=="controller"))return item;else return igk.ctrl.getcontroller(item.parentNode);},confirm:function(item,msg,uri){if((window.confirm)&& window.confirm(msg)){item.form.confirm.value=1;item.form.action=uri;return !0;}return !1;},init_controller:function(){if(m_initialize)return;var d=document.getElementsByTagName("*");var id=null;var s=null;m_controllers.length=0;if(d){for(var i=0;i<d.length;i++){s=d[i];if(s.getAttribute("igk-type")=="controller"){id=s.getAttribute("igk-type-id");m_controllers.push(s);if(id){m_controllers[id]=s;}$igk(s).fc=new __ctrl_utility_functions($igk(s));}}igk.ready(function(){igk.ctrl.callBindAttribData(document.body);});}m_initialize=!0;},getCtrlById:function(id){if(m_controllers[id])return m_controllers[id];return null;},findCtrlById:function(id){if(m_initialize){return igk.ctrl.getCtrlById(id);}var d=document.getElementsByTagName("*");var id=null;var s=null;m_controllers.length=0;if(d){for(var i=0;i<d.length;i++){s=d[i];if(s.getAttribute("igk-type")=="controller"){id=s.getAttribute("igk-type-id");if(id==id){return s;}}}}return null;},getCtrls:function(){return m_controllers;},isregCtrl:function(q){if((q.nodeType==1)&&(q.getAttribute("igk-type")=="controller")){var id=q.getAttribute("igk-type-id");if(id && !m_controllers[id]){m_controllers[id]=$igk(q);$igk(q).fc=new __ctrl_utility_functions($igk(q));}return q;}return null;},getParentController :function(node){if((node==null)||(node.parentNode==null))return null;var q=node.parentNode;while(q!=null){if(igk.ctrl.isregCtrl(q)){return q;}q=q.parentNode;}return q;},callBindAttribData:function(node){if(node){__callBindAttribData(node);if(node.getElementsByTagName){var s=node.getElementsByTagName("*");if(s){for(var i=0;i<s.length;i++){__callBindAttribData(s[i]);}}}else{switch(node.nodeType){case 3:case 8:break;default:console.debug("/!\\ getElementsByTagName function not found : "+node.nodeType);break;}}}},get_schemas:function(){return m_attrib_datas;},registerReady:function(func){if(m_readylist==null)m_readylist=new igk.system.collections.list();m_readylist.add(func);},registerAttribManager:function(name,options){if((name)&&(typeof(m_attrib_datas[name])==igk.constants.undef)){m_attrib_datas[name]=options;return !0;}return !1;},isAttribManagerRegistrated :function(name){if((name)&&(typeof(m_attrib_datas[name])!=igk.constants.undef)){return !0;}return !1;},regCtrl:function(name,baseuri){m_h_ctrl[name]=new(function(name,baseuri){this.name=name;this.baseuri=baseuri;igk.appendProperties(this,{getUri:function(funcname){if(funcname){return this.baseuri+"&f="+funcname;}return this.baseuri;}});})(name,baseuri);},getRegCtrl:function(name){return igk.get_v(m_h_ctrl,name,null);},getRegCtrls:function(){return m_h_ctrl;}});createNS("igk.ctrl",{initselect_model:function(t,o,model){var q=null;var to=null;var p=igk.getParentScript();if(igk_is_string(t)){q=$igk(p).select(t).first();}else{q=t;}if(igk_is_string(o)){to=$igk(p).select(o).first();}else to=o;if(!q||!to){return;}function __changez(evt){var v=q.o.value;var i=q.o.selectedIndex;var n=$igk(q.o[i]).getAttribute("model")||"default";var cl=null;if(model)cl=model.select("."+n).first();else cl=$igk(p).select(".igk-select-model ."+n).first();if(cl){to.setHtml(cl.getHtml());}else to.setHtml("no data");igk.winui.events.raise(window,'resize');};$igk(q).reg_event("change",__changez).reg_event("keyup",function(evt){var kc=evt.keyCode||0;switch(kc){case 37:case 38:case 39:case 40:__changez();break;}});__changez();if(q.o.form){$igk(q.o.form).reg_event("reset",function(){var s=q.select(">:option");var i=s.first();if(i){q.o.value=i.o.value;__changez();}});}}});})();createNS("igk.ctrl.utils",{check_all:igk_check_all });(function(){function __append_frametobody(responseText){var q=document.createElement("div");q.innerHTML=responseText;var c=q.childNodes[0];if(c){document.body.appendChild(c);igk.ajx.fn.initnode(c);if(c.getElementsByTagName){var tforms=c.getElementsByTagName("form")[0];var tc=$igk(c).select("form");if(tc.each){tc.each(function(){if(this.o.onsubmit==null){this.setProperties({"onsubmit":function(evt){window.igk.ajx.postform(this,this.action.split("#")[0],function(xhr){if(this.isReady()){if(global){this.replaceBody(xhr.resonseText);}else{if(m)this.setResponseTo(m);}}});this.frame.close();evt.preventDefault();return !1;}});}return this;});}}}};createNS("igk.ctrl.frames",{appendFrameResponseToBody:__append_frametobody,postframe:function(e,uri,ctrl){var m=null;var t=$igk(e).select(ctrl).first();if(ctrl !=null){m=window.igk.ctrl.getCtrlById(ctrl);}igk.ajx.get(uri,null,function(xhr){if(this.isReady()){if(t){t.setHtml(xhr.responseText).init();}else{igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);}}});}});})();createNS("igk.winui.gui",{rectangleSnippet :function(o){this.o=o;this.bound=new igk.math.rectangle(0,0,8,8);this.view=igk.createNode("div");$igk(this.view).setCss({"position":"absolute","border":"1px solid black","backgroundColor":"transparent"});$igk(this.view).setProperties({"class":"dark_op90"});igk_setcss_bound(this.view,this.bound);this.o.view.appendChild(this.view);this.setBound=function(rc){this.bound=rc;igk_setcss_bound(this.view,this.bound);}}});createNS("igk.winui.rectangleSelector",{init:function(target){if(!target)return null;$igk(target).setCss({"position":"absolute","left":"0px","top":"0px","width":"400px","height":"400px","border":"1px dotted gray","backgroundColor":"transparent","zIndex":"500"});var m_bound=new igk.math.rectangle();$igk(m_bound).setProperties({x:10,y:10,width:400,height:250});function __updatesize(){var m_rc=0;var m_snippets=this.snippets;igk_setcss_bound(this.view,this.bound);m_rc=new igk.math.rectangle(0+this.bound.width/2,0,0,0);m_rc.inflate(4,4);m_snippets[0].setBound(m_rc);m_rc=new igk.math.rectangle(0+this.bound.width,this.bound.height /2,0,0);m_rc.inflate(4,4);m_snippets[1].setBound(m_rc);m_rc=new igk.math.rectangle(0+this.bound.width/2,+this.bound.height,0,0);m_rc.inflate(4,4);m_snippets[2].setBound(m_rc);m_rc=new igk.math.rectangle(0,+this.bound.height /2,0,0);m_rc.inflate(4,4);m_snippets[3].setBound(m_rc);};function __initSippets(t){var m_snippets=new Array();m_snippets[0]=new igk.winui.rectangleSnippet(t);m_snippets[1]=new igk.winui.rectangleSnippet(t);m_snippets[2]=new igk.winui.rectangleSnippet(t);m_snippets[3]=new igk.winui.rectangleSnippet(t);return m_snippets;}return new function(){this.view=target;this.bound=m_bound;this.update=__updatesize;this.toString=function(){return "igk.winui.rectangleSelector";};this.snippets=__initSippets(this);this.update();};}});createNS("igk",{css:new(function(){var props={};var vendors=['webkit','ms','o'];function getchars(x){var t=[];for(var i=0;i<x.length;i++)t.push(x[i]);return t;}function getstring(ch){var t="";for(var i=0;i<ch.length;i++)t+=ch[i];return t;}function __setProperty(item,properties){if(item && item.style && properties){for(var i in properties){try{item.style[i]=properties[i];}catch(ex){}}}else{console.debug('propertiesno setting css ...... '+item);console.debug(properties);}}var dum=igk.createNode("div").o;var l=false;for(var i in dum.style){if(typeof(dum.style[i])!=IGK_FUNC){switch(i){case 'cssText':case 'length':case 'parentRule':continue;}if(i.indexOf('-')!=-1)continue;props[(i+'').toLowerCase()]=i;l=!0;}}if(!l && window.getComputedStyle){var txt=window.getComputedStyle(dum).cssText;if(txt){var tab=txt.split(';');for(var i=0;i<tab.length;i++){var s=tab[i].split(':')[0];var d=getchars(s);var index=1;if(s[0]=='-'){index=2;}else{}while(index>0){index=s.indexOf('-',index);if(index==-1)break;if(index+1<s.length){d[index+1]=(s[index+1]+'').toUpperCase();}index++;}s=getstring(d).replace(/( |\-)/g,"");if(typeof(props[s.toLowerCase()])==IGK_UNDEF)props[s.toLowerCase()]=s;}}}var e=['animation','transition'];var v=vendors;for(var i=0 ;i<v.length;i++){for(var j=0;j<e.length;j++){var s=(v[i]+e[j]).toLowerCase();if((typeof(props[s])==IGK_UNDEF)&& props[s+"delay"]){props[s]=v[i]+e[j][0].toUpperCase()+e[j].substring(1);}}}function __getStyleValue(stylelist,n){switch(n.toLowerCase()){case "transition":var s=stylelist[n];if(s.length>0)return s;var v_p=['property','duration','timing-function','delay'];var v_v=vendors;var v_k="";var v_prop={toString:function(){var t=v_prop.property;var di=v_prop.duration;var tf=v_prop["timing-function"];var dl=v_prop.delay;var s="";for(var i=0;i<t.length;i++){if(i>0){s+=',';}s+=t[i]+" "+di[i]+" "+tf[i]+" "+dl[i];}return s;}};var v_t=0;var v_splitcsss_pattern="([^,(]+(\\(.+?\\))?)[\\s,]*";for(var i=0;i<v_p.length;i++){v_k=n+"-"+v_p[i];if((i==0)&&(typeof(stylelist[v_k])!=igk.constants.undef))v_t=1;if(!v_t)break;s+=((i>0)? " | ":"")+stylelist[v_k];v_prop[v_p[i]]=igk.system.regex.split(v_splitcsss_pattern,stylelist[v_k]);}if(!v_t){v_t=0;for(var j=0;j<v_v.length;j++){v_prop[v_v[j]]={};if(v_t)s+="|";for(var i=0;i<v_p.length;i++){v_k=v_v[j]+n+"-"+v_p[i];s+=stylelist[v_k];v_prop[v_p[i]]=igk.system.regex.split(v_splitcsss_pattern,stylelist[v_k]);}v_t=1;}}return v_prop.toString();break;default:return stylelist[n];}}igk.appendProperties(this,{getProperties:function(){return props;},getStyleValue:function(stylelist,n){return __getStyleValue(stylelist,n);},getValue:function(item,name){var tprops=this.getProperties();var d=igk.createNode("div");var kr=tprops[name.toLowerCase()];if(tprops[kr]){return item.style[tprops[kr]];}return item.style[name];},getVendors:function(){return vendors;},isItemSupport:function(name){for(var i=0;i<name.length;i++){if(typeof(props[name[i].toLowerCase()])!=IGK_UNDEF)return !0;}for(var i=0;i<name.length;i++){if(typeof(dum.style[name[i]])!=IGK_UNDEF)return !0;}return !1;},setProperty:function(item,name,value){var k={};var n=null;if(igk.css.isItemSupport(['webkit'+name])){n=props[('webkit'+name).toLowerCase()];k[n]=value;i }else if(igk.css.isItemSupport([name])){n=props[name.toLowerCase()];k[n]=value;}__setProperty(item,k);},setProperties:function(item,properties){if((item==null)||(!item.style)){return;}var k={};var n=null;var v=null;for(var ni in properties){v=properties[ni];if(igk.css.isItemSupport(['webkit'+ni])){n=props[('webkit'+ni).toLowerCase()];if(n)k[n]=v;}else if(igk.css.isItemSupport([ni])){n=props[ni.toLowerCase()];if(n){k[n]=v;}}}__setProperty(item,k);},setTransitionDuration:function(item,time){this.setProperty(item.o,'transitionduration',time);return this;},toString:function(){return "[object igk.css]";},setTransitionDelay:function(item,time){this.setProperty(item.o,'transitiondelay',time);return this;},changeStyle:function(name,style){function changeStyle(selectorText){var theRules=new Array();if(document.styleSheets[0].cssRules){theRules=document.styleSheets[0].cssRules;}else if(document.styleSheets[0].rules){theRules=document.styleSheets[0].rules;}for(n in theRules){if(theRules[n].selectorText==selectorText){theRules[n].style=style;}}}}});return this;})()});function _is_integer(n){return parseInt(n)+""==n+"";};createNS("igk",{isInteger:function(n){var f=Number.isInteger||_is_integer;return f(n);}});igk.ctrl.registerReady(function(){var t=this.tagName?this.tagName.toLowerCase():"";if(m_tag_obj[t]&& m_tag_obj[t].func){m_tag_obj[t].func.apply(this);}});(function(){var m_nv=false;var bdiv=null;var notify_frames=[];igk.publisher.register("system/bodychange",function(){if(m_nv){if(bdiv !=null){$igk(document.body).appendChild(bdiv.o);}}});igk.winui.notify=function(){if(this.type==IGK_CLASS){if(typeof(this.notify.getInstance)==IGK_UNDEF){this.notify.getInstance=(function(){var _instance=new igk.winui.notify();return function(){return _instance;};})();}return this.notify.getInstance();}if(typeof(igk.winui.notify.getInstance)==IGK_UNDEF){igk.appendProperties(this,{name:"igk-notifybox",toString:function(){return this.name;}});igk.appendProperties(this,igk.winui.notify);igk.winui.notify.sm_instance=this;}else return igk.winui.notify.getInstance();};createNS("igk.winui.notify",{setFilterClass:function(f){if(bdiv!=null)bdiv.filters=f;},closeAlls:function(){if(notify_frames && notify_frames.length>0){for(var i=0;i<notify_frames.length;i++){notify_frames[i].close();}notify_frames=[];}},showMsg:function(msg,type,nc){if(typeof(this)==IGK_FUNC){igk.winui.notify().showMsg(msg,type,nc);return;}var div=null;var m_hide=false;var dial=null;var _sm=igk.winui.notify;if(!this.initialize){bdiv=igk.createNode("div");this.target=bdiv;this.initialize=!0;bdiv.filters="igk-bgfilter-blur";}bdiv=this.target;dial=this;if(!bdiv)return;bdiv.setHtml("");bdiv.addClass("igk-js-notify-box");var div=bdiv.add("div");var cl="igk-js-notify ";if(type){cl+=type;}div.addClass(cl).setOpacity(1);div.setAttribute("igk-js-fix-loc-scroll-width","1");div.setHtml("");if(typeof(msg)=="string"){div.setHtml(msg);}else{div.appendChild(msg);}var fc=igk.winui.event.fn.handleKeypressExit({target:this,complete:_g_close_notify });if(!nc){var close=igk.createNode("div");close.addClass("dispb posab loc_r loc_t");close.add("a",{"onclick":_g_close_notify}).setHtml("close").addClass("igk-notify-btn-close");div.appendChild(close);}function _g_close_notify(){_close_notify(null);};function _setupview(){div.setCss({"height":"auto"});var p=-(div.getHeight()/2.0);var pn=div.getParentNode();var t=0;var h=div.getHeight()+"px";var oflow=false;if(pn){t=pn.getHeight()/2.0;}else{t=div.getTop();}if((t+p)<0){p=-t;if(pn.getHeight()<div.getHeight()){h=pn.getHeight()+"px";oflow=true;}}div.setCss({"marginTop":p+"px" });if(h!=div.getComputedStyle('height')){div.animate({height:h},{duration:200,interval:10,animtype:"timeout",context:"notify-height-context",effect:"circ",effectmode:"easeinout",complete:function(){if(!oflow){$igk(div).setCss({height:"auto",overflowY:"hidden"});}else{$igk(div).setCss({overflowY:"auto"});}}});}};function _setupview_callback(){_setupview();igk.winui.unreg_event(window,"load",_setupview_callback);};_sm.Close=_close_notify;_sm.UpdateView=_setupview;var __closing=false;function _close_notify(callback){if(__closing)return;__closing=!0;igk.animation.fadeout(div.o,20,200,1.0,function(){var pn=bdiv.o.parentNode;if(pn){pn.removeChild(bdiv.o);if(bdiv.filters)$igk(pn).rmClass(bdiv.filters);}bdiv.unregister();__closing=false;m_nv=false;if(callback){callback.apply(document);}});igk.winui.unreg_event(document,"keypress",fc);m_hide=!0;dial.hide=!0;}igk.winui.reg_event(window,"load",__show);if(!nc){if(igk.navigator.isFirefox()){igk.winui.reg_event(document,"keypress",fc);}else{igk.winui.reg_event(document,"keydown",fc);}}var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",_setupview);}notify_frames.push({close:_g_close_notify });function __show(){if(m_hide)return;$igk(document.body).addClass(bdiv.filters).appendChild(bdiv.o);if(!igk.is_readyRegister(__show)){_setupview();}div.setCss({"zIndex":"800","top":"50%","overflowY":"auto","overflowX":"hidden" });igk.ctrl.callBindAttribData(div.o);bdiv.addClass("igk-show");m_nv=true;};igk.ready(__show);},showMsBox:function(t,m,cln,nc){var q=igk.createNode("div").addClass("igk-notify");if(cln){q.addClass(cln);}q=q.add("div").addClass("igk-container");var content=q.add("div");content.addClass("content-z");var tl=content.add("div");tl.addClass("title igk-title-4");if(igk_is_string(t)){tl.setHtml(t);}else{tl.add(t);}if(igk_is_string(m)){content.add("div").addClass("igk-panel igk-notify-panel").setHtml(m);}else{content.add("div").addClass("igk-panel").o.appendChild($igk(m).o);}igk.winui.notify.showMsg(q,cln,nc);},showError:function(msg){var q=igk.createNode("div").addClass("igk-notify igk-notify-danger").setHtml(msg);igk.winui.notify.showMsg(q.o.outerHTML,"igk-danger");},showErrorInfo:function(title,msg){var q=igk.createNode("div").addClass("igk-notify igk-notify-danger");q.add("div").addClass("igk-title-4").setHtml(title);q.add("div").addClass("igk-panel igk-notify-panel").setHtml(msg);igk.winui.notify.showMsg(q.o.outerHTML,"igk-danger");},close:function(){if(notify_frames.length>0){var f=notify_frames.pop();f.close();}},visible:function(){return m_nv;},init:function(){var q=$igk(igk.getParentScript());if(q &&(q.o.parentNode!=null)){igk.ready(function(){var t=q.select('.title').first().getHtml();var m=q.select('.msg').first();var i=(q.o.parentNode!=null);q.remove();if(i)igk.winui.notify.showMsBox(t,m,q.o.className);});}}});})();var igk_rmScript=function(){var c=igk_getCurrentScript();if(c && !c.src){console.debug("remove script");console.debug(c);$igk(c).remove();}};createNS("igk.balafonjs.utils",{closeDialog:function(){igk_rmScript();},closeNotify:function(g){igk.winui.notify.close();if(g)igk_rmScript();}},{desc:'balafon utility functions namespace' });createNS("igk.winui.eventArgs",{progress:function(evt){var q=this;var m_evt=evt;igk.appendProperties(this,{getEventSource:function(){return m_evt;},getTotalSize:function(){return m_evt.TotalSize;},getUploadedSize:function(){return m_evt.position;}});}});createNS("igk.winui.dragdrop",{init :function(target,properties){function dragdropManager(target,properties){if(!target)return;var m_target=$igk(target);var m_properties=properties;var m_q=target;var m_eventcontext=igk.winui.RegEventContext(m_target,$igk(m_target));if(m_eventcontext==null)return;var q=this;var m_supportlist=null;igk.appendProperties(this,{getUri:function(){if(m_properties && m_properties.uri)return m_properties.uri;return null;},getProperties:function(){return m_properties;},support:function(k){if(m_properties && m_properties.supported){if(m_supportlist==null){var e=m_properties.supported.split(",");var p=new(function(e){var m_tab=e;var m_obj={};for(var i=0;i<e.length;i++){m_obj[e[i]]=i;}this.contains=function(s){return typeof(m_obj[s])!=IGK_UNDEF;}})(e);m_supportlist=p;}return m_supportlist.contains(k);}return !0;},toString:function(){return "igk.winui.dragdrop.dragdropManager";}});m_eventcontext.reg_event(m_q,"dragenter",function(evt){evt.preventDefault();if(m_properties && m_properties.enter){m_properties.enter.apply(q,arguments);}});m_eventcontext.reg_event(m_q,"dragleave",function(evt){if(m_properties && m_properties.leave){m_properties.leave.apply(q,arguments);}});m_eventcontext.reg_event(m_q,"dragover",function(evt){evt.preventDefault();if(m_properties && m_properties.over){m_properties.over.apply(q,arguments);}});m_eventcontext.reg_event(m_q,"drop",function(evt){evt.preventDefault();if(m_properties && m_properties.drop){m_properties.drop.apply(q,arguments);return ;}if(igk.system.array.isContain(evt.dataTransfer.types,"text/html")){var n=igk.createText(evt.dataTransfer.getData("text/html"));m_target.appendChild(n);}});m_target.setAttribute("draggable",false);}return new dragdropManager(target,properties);}});function __init_drag(){var opts=igk.JSON.parse(this.getAttribute("igk-draggable-data"),this);igk.winui.dragdrop.init(this.o,opts);}igk.winui.initClassControl("igk-draggable",__init_drag,{desc:"draggable node"});(function(){var m_f=[];var m_i=null;function _get_parentscroll(p){var q=$igk(p);var c=q.getscrollParent();if(p && p.target){c=q.select(p.target);}else{c=q.select('^.igk-parentscroll').getNodeAt(0);}return c;}function fixscrollmanager(t,p,c){var q=$igk(t);$igk(c).reg_event("scroll",function(evt){if(p && p.update){p.update.apply(q,[{parent:c,scroll:{x:c.scrollLeft,y:c.scrollTop}}]);}});return this;};createNS("igk.winui.fn.fixscroll",{init:function(p){var q=igk.getParentScript();igk.ready(function(){if((q==null)||igk.system.array.isContain(m_f,q)){return ;}var c=_get_parentscroll(q);if(c){m_f.push(q);return new fixscrollmanager(q,p,c);}});}});})();createNS("igk.storage",{});createNS("igk.winui.fn",{cancelEventArgs:function(evt){evt.preventDefault();evt.stopPropagation();return !1;},close_all_frames:function(){igk.winui.notify.closeAlls();igk.ready(function(){var t=[];$igk(document.body).select(".igk-notify-box").each_all(function(){var q=this;q.remove();});});},isNodeVisible:function(n){throw "not implement[isNodeVisible]";},navigateTo:function(t,pr){var v_t=null;return function(){var c=null;if(typeof(t)=='string'){c=$igk(t).first();}else{c=$igk(t);}if(c){var p=$igk(c.o.offsetParent);if(p){p.scrollTo(c,pr);}}else{igk.show_notify_error("Item not found",t);}};}});(function(){var keys={};var m_lang={fr:['fr','fr-FR','fr-Be'],en:['en','en-En','en-US']};createNS("igk.R",{getLang:function(){var s=igk.navigator.getLang().split(',')[0];for(var i in m_lang){if(igk.system.array.isContain(m_lang[i],s))return i;}return s;},gets:function(k){if(__lang[k]){return __lang[k];}return k;}});})();(function(){function __sendFile(evt,target,async,update,startCallback,progressCallback,doneCallBack){if(evt.dataTransfer && igk.system.array.isContain(evt.dataTransfer.types,"Files")){for(var i=0;i<evt.dataTransfer.files.length;i++){if(target.support(evt.dataTransfer.files[i].type)){igk.ajx.uploadFile(null,evt.dataTransfer.files[i],target.getUri(),async,update,startCallback,progressCallback,doneCallBack);}}}else{igk.winui.notify.showMsBox("Warning","msg.browsernotsupport.drop","warning");}};createNS("igk.winui.dragdrop.fn",{update_file:function(evt){evt.preventDefault();evt.stopPropagation();var target=this;var p=target.getProperties();__sendFile(evt,target,p.async,p.update,p.start,p.progress,p.done);}});})();createNS("igk.winui.debug",{addMsg :function(msg){var d=$igk("igk-debugger").first();if(d){d.setHtml(msg);}}});(function(){createNS("igk.io.file",{download:function(t,n,v){var data=new Blob(["test ok"]);var a=igk.createNode("a");var data=new Blob([v],{"type":t});document.body.appendChild(a.o);a.o.download=n||"file.data";a.o.href=URL.createObjectURL(data);a.o.type=t;a.o.click();a.remove();return 1;}});createNS("igk.io.xml",{parseString:function(txt,type){var doc=new DOMParser();var xml=doc.parseFromString(txt,type||"text/xml");if(xml.documentElement.nodeName=="parsererror"){return false;}return xml;},parseUri:function(uri){var g=igk.ajx.get(uri,null,null,false);var s=g.xhr.responseText;return s;}});})();window.onbeforeunload=function(evt){if(igk_freeEventContext){igk_freeEventContext();}};igk.winui.reg_event(window,"unload",function(evt){});function __global_ready(evt){igk.context="global_ready";if(document.readyState=="complete"){igk.ready(null,"readystatechange");}};igk.winui.reg_event(document,"readystatechange",__global_ready);function __bindbalafonjs(){var q=this.o;igk_eval.apply(q,[q.innerHTML,q]);if(q.getAttribute("remove")){this.remove();}};igk.ready(function(){$igk(document.body).qselect("script[type='text/balafonjs']").each_all(function(){__bindbalafonjs.apply(this);});});var _udef='undefined';ns_igk._$exists=function(n){return typeof(igk.system.getNS(n))!=_udef;};})(window);(function(){if(document.head){var e=$igk(document.head).select("link");e.each(function(){if(this.getAttribute("rel")=="igkcss"){igk.ajx.get(this.getAttribute("href"),null,function(xhr){if(this.isReady()){var s=igk.createNode("style");s.innerHTML=xhr.responseText;document.head.appendChild(s);}},false);}return !0;});}})();$igk(igk.getParentScript()).select("link").each(function(){var s=(this.o.getAttribute("href")+"");if(s &&(s.indexOf("R/Styles/base.php")!=-1)){igk.system.apps.link=this;igk.appendProperties(this,{basehref:this.o.href,counter:0,reload:function(){var bck=this.basehref;this.o.href=bck+"?reload="+this.counter;this.counter++;}});}return !0;});igk.ctrl.registerAttribManager("igk-js-fix-loc-scroll-width",{desc:"register element to be fixed with scroll width"});igk.ctrl.registerAttribManager("igk-js-fix-loc-scroll-height",{desc:"register element to be fixed with scroll height"});igk.ctrl.registerAttribManager("igk-fix-loc-target",{desc:"defined target parent #id. that will content the parent class. if not defined parent with element parentNode or igk-parentscroll class"});igk.ctrl.bindAttribManager("igk-js-fix-loc-scroll-width",function(){function _fixManager(target){var animinfo={duration:200,interval:10,animtype:"timeout",context:"fix-scroll-context",effect:"circ",effectmode:"easeinout" };function __update(){var s=this.target.getAttribute("igk-js-fix-loc-scroll-width");var h=this.target.getAttribute("igk-js-fix-loc-scroll-height");var v_target=this.target;var p=this.target.getComputedStyle("position");if((p=="fixed")){var m=this.target.getAttribute("igk-fix-loc-target");var g=null;if(m==null){m=$igk(".igk-parentscroll").first();if(m==null){m=this.target.o.parentNode;}}g=$igk(m);if(g==null){return;}var animprop={};if(s==1){igk.appendProperties(animprop,{"right":"0px"});if(g.fn.hasVScrollBar()){animprop.right=g.fn.vscrollWidth()+"px";}}if(h==1){igk.appendProperties(animprop,{"bottom":"0px"});if(g.fn.hasHScrollBar()){animprop.bottom=g.fn.hscrollHeight()+"px";}}this.target.animate(animprop,animinfo);}};igk.appendProperties(this,{target:target,update:__update });var self=this;var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){self.update();});}this.update();return this;}var s=this.getAttribute("igk-js-fix-loc-scroll-width");if(s==1 &&(this.getComputedStyle("position")=="fixed")){var v_fm=new _fixManager(this);}return !1;});(function(){var context_options={};var m_items={};function __reg_key(n,t){if(m_items[n]){var b=m_items[n];if(b.length){b.push(t);}else{b=[];b.push(m_items[n]);b.push(t);m_items[n]=b;}}else{m_items[n]=t;}}function __add_prop(){var q=this;var k=this.getHtml();__reg_key(k,q);q.reg_event("contextmenu",function(evt){evt.preventDefault();var langctrl=igk.ctrl.getRegCtrl("c_l");if(langctrl){var p=q.getParentCtrl();var k=q.getHtml();var pid=p?p.o.id:'';igk.ajx.post(langctrl.getUri("mod_key&ajx=1"),"key="+k+"&ctrl="+pid,igk.ajx.fn.replace_or_append_to_body,true);}else{if(!igk.winui.notify.visible()){igk.winui.notify.showError("<div class='error-3'>/!\\ No language controller found !!! </div>");}}});}function __register_lang_key(s){if(s==null)return;s.setAttribute("igk-new-lang-key",1).appendProperties({"igk-new-lang-key-setup":1,reg_context_options:function(k,uri){context_options[k]=uri;},show_context_options:function(){var ul=igk.winui.contextMenu();ul.setHtml(null);var loc=this.getScreenLocation();var size={w:this.getWidth(),h:this.getHeight()+this.o.scrollHeight};ul.addClass("posab").setCss({zIndex:10,border:"1px solid black",padding:"8px",position:"absolute",left:loc.x+"px",minWidth:"200px",top:(loc.y+size.h)+"px" });for(var i in context_options){ul.add("li").add("a").setHtml(i).setAttribute("href","?mod=1&k="+context_options[i]);}$igk(document.body).appendChild(ul);}},true);if(s.isSr()){s.each_all(__add_prop);}else{__add_prop.apply(s);}}function __initglobalkey(){var s=$igk(".igk-new-lang-key");__register_lang_key(s);igk.unready(__initglobalkey);}igk.ready(__initglobalkey);igk.ctrl.registerAttribManager("igk-new-lang-key",{desc:"register new keys language editor"});igk.ctrl.bindAttribManager("igk-new-lang-key",function(m,n){var t=this["igk-new-lang-key-setup"];this.setCss({color:"red",cursor:"help" });if(t==null){__register_lang_key($igk(this));}});igk.system.createNS("igk.winui.langkey.fn",{update:function(n,v){if(n!=v){$igk('.igk-new-lang-key').each_all(function(){if(this.getHtml()==n){var t=igk.createText(v);this.o.parentNode.replaceChild(t.o,this.o);}});}var s=igk.getCurrentScript();if(s){$igk(s).remove();}}});})();igk.system.createNS("igk.winui.navlink",{init:function(target,link){if(typeof(this.classinit)==igk.constants.undef){this.navitems=[];this.classinit=!0;}var navitems=this.navitems;target.reg_event("click",function(evt){evt.preventDefault();var b=$igk("#"+link).first();if(b && !b.isSr()){var q=$igk(b).getscrollParent();if(q){q.scrollTo(b.o,{duration:500,interval:20,effect:"linear",effectmode:"easeinout" },null);}}else{console.debug('[IGK] - Element not found '+link);}});navitems.push(target);}});igk.ctrl.registerAttribManager("igk-nav-link",{desc:"navigation link"});igk.ctrl.bindAttribManager("igk-nav-link",function(n,m){if(!m)return;this.setAttribute("href","!#"+m);var link=null;igk.winui.navlink.init(this,m);});function animationProperty(q,s){if(s==null)throw "source is null";if(q==null)throw "item is null";var duration='0.2s';var effect="ease-in-out";var rmduration='0.2s';var rmeffect='ease-in-out';var tq=igk.JSON.parse(s);var store={};for(var m in tq.css){store[m]=q.getComputedStyle(m);if(typeof(store[m])==igk.constants.undef)store[m]=null;}if(tq.duration)duration=tq.duration;if(tq.effect)duration=tq.effect;igk.appendProperties(this,{bind:function(){if(q.isCssSupportAnimation()){if(tq.select){q.select(tq.select).setCss({transition:'all '+duration+' '+effect}).setCss(tq.css);}else{q.setCss({transition:'all '+duration+' '+effect}).setCss(tq.css);}}else{q.animate(tq.css,{duration:igk.datetime.timeToMs(duration)});}},unbind:function(){if(q.isCssSupportAnimation()){if(tq.select){q.select(tq.select).setCss({transition:'all '+rmduration+' '+effect}).setCss(store);}else{q.setCss({transition:'all '+rmduration+' '+effect}).setCss(store).timeOut(300,function(){console.debug("end transition");});}}else{q.animate(store,{duration:igk.datetime.timeToMs(rmduration)});}}});}igk.ctrl.registerAttribManager("igk-js-anim-msover",{desc:"globa animation style on mouse over"});igk.ctrl.bindAttribManager("igk-js-anim-msover",function(){var q=this;var source=this.getAttribute("igk-js-anim-msover");var store={};var duration='0.2s';var effect="ease-in-out";var rmduration='0.2s';var rmeffect='ease-in-out';var tq=null;if(!source){return;}tq=igk.JSON.parse(source);for(var m in tq.css){store[m]=q.getComputedStyle(m);if(typeof(store[m])==igk.constants.undef)store[m]=null;}if(tq.duration)duration=tq.duration;if(tq.effect)duration=tq.effect;this.reg_event("mouseover",function(evt){if(q.isCssSupportAnimation()){if(tq.select){q.select(tq.select).setCss({transition:'all '+duration+' '+effect}).setCss(tq.css);}else{q.setCss({transition:'all '+duration+' '+effect}).setCss(tq.css);}}else{q.animate(tq.css,{duration:igk.datetime.timeToMs(duration)});}});this.reg_event("mouseout",function(){if(q.isCssSupportAnimation()){if(tq.select){q.select(tq.select).setCss({transition:'all '+rmduration+' '+effect}).setCss(store);}else{q.setCss({transition:'all '+rmduration+' '+effect}).setCss(store).timeOut(300,function(){console.debug("end transition");});}}else{q.animate(store,{duration:igk.datetime.timeToMs(rmduration)});}});});igk.ctrl.bindAttribManager("igk-js-anim-focus",function(){var q=this;var source=this.getAttribute("igk-js-anim-focus");var store={};if(!source){return;}if(q.isCssSupportAnimation()){var anim=new animationProperty(q,source);q.reg_event("focus",function(){anim.bind();});q.reg_event("blur",function(){anim.unbind();});}else{var t=eval("new Array("+source+")");for(var m in t[0]){store[m]=q.getComputedStyle(m);}this.reg_event("focus",function(){eval("q.animate("+source+");");});this.reg_event("blur",function(){q.animate(store,t[1]);});}});igk.ctrl.bindAttribManager("igk-js-bind-select-to",function(n,v){var s=null;var q=this;var qv=q.getAttribute('value');if(igk.system.string.startWith(v,"#")){s=$igk(v);if(s){s.select("option").each(function(){q.appendChild(this.clone());return !0;});}}else{var s=igk.JSON.parse(v);if(s && s.id){if(s.allowempty){var opt=igk.createNode("option");opt.setAttribute("value",typeof(s.emptyvalue)!=igk.constants.undef ? s.emptyvalue :null);q.appendChild(opt);}var select=s.selected;var tag=s.tag ? s.tag :'option';var present=false;var v_sl=$igk(s.id).select(tag).each(function(){var r=null;if(tag !='option'){r=igk.createNode("option");r.copyAttributes(this);r.setHtml(this.o.innerHTML);}else r=this.clone();var vv=r.getAttribute('value');if(vv==select){r.setAttribute('selected','true');present=true;}if(tag !='option')r.o.tagName="option";q.appendChild(r);return !0;});if(!present && s.usecustom){if((select+"").length>0){var r=igk.createNode("option");r.setAttribute('value',select);r.setAttribute('selected','selected');r.setHtml(select);q.appendChild(r);}}}}});(function(){var m=[];var c=igk.createNode("div");function __disable_func(evt){evt.preventDefault();}igk.winui.registerEventHandler("click",{reg_event:function(item,func,useCapture){return igk.winui.reg_system_event(item,"click",func,useCapture);},unreg_event:function(item,func,useCapture){return igk.winui.unreg_system_event(item,"click",func);}});var m_eventDatas={};function _regEventData(n,data){var t=null;if(typeof(m_eventDatas[n])==igk.constants.undef){t=[];}else t=m_eventDatas[n];t.push(data);m_eventDatas[n]=t;};function _unregEventData(n,item,func){var t=null;var c=false;if(m_eventDatas[n]!=igk.constants.undef){t=m_eventDatas[n];var cp=[];var e=null;for (var s=0;s<t.length;s++){e=t[s];if((e.i==item)&&(e.func==func)){cp.push(e);c=!0;}}if(c)m_eventDatas[n]=cp;}return c;};function _getEventData(n,item,func){var e=null;var t=m_eventDatas[n];if(t){for (var s=0;s<t.length;s++){e=t[s];if((e.i==item)&&(e.func==func)){return e;}}}return e;}igk.winui.registerEventHandler("touchOrClick",{reg_event:function(item,func,useCapture){var c={n:'touchOrClick',index:0,i:item,h:0,"func":func,bind:function(evt){if(evt.type=="touchend"){if(evt.cancelable){evt.preventDefault();evt.stopPropagation();}c.h=1;}else if(c.h==1){c.h=0;return;}c.func.apply(item,[evt]);}};c.index=m_eventDatas[c.n]? m_eventDatas[c.n].length :0;_regEventData(c.n,c);if($igk(item).istouchable()){igk.winui.reg_system_event(item,"touchend",c.bind,useCapture);}return igk.winui.reg_system_event(item,"click",c.bind,useCapture);},unreg_event:function(item,func,useCapture){var c=_getEventData("touchOrClick",item,func);if(c){if($igk(item).istouchable()){igk.winui.unreg_system_event(item,"touchend",c.bind);}var o=igk.winui.unreg_system_event(item,"click",c.bind);return o;}}});function __mobile_device_event(n,mobe){return{reg_event:function(item,func,useCapture){var c={n:n,index:0,i:item,h:0,"func":func,bind:function(evt){if(evt.type==mobe){if(useCapture && !useCapture.passive){evt.preventDefault();evt.stopPropagation();}c.h=1;}else if(c.h==1){c.h=0;return;}c.func.apply(item,[evt]);}};c.index=m_eventDatas[c.n]? m_eventDatas[c.n].length :0;_regEventData(c.n,c);if($igk(item).istouchable()){igk.winui.reg_system_event(item,mobe,c.bind,useCapture);}return item;},unreg_event:function(item,func,useCapture){var c=_getEventData(n,item,func);var o=null;if(c){if($igk(item).istouchable()){o=igk.winui.unreg_system_event(item,mobe,c.bind);}return o;}}};};igk.winui.registerEventHandler("igkTouchStart",__mobile_device_event("igkTouchStart","touchstart"));igk.winui.registerEventHandler("igkTouchMove",__mobile_device_event("igkTouchMove","touchmove"));igk.winui.registerEventHandler("igkTouchEnd",__mobile_device_event("igkTouchEnd","touchend"));if(typeof(c.o.onmouseenter)=="undefined"){igk.winui.registerEventHandler("mouseenter",{reg_event:function(item,func,useCapture){return igk.winui.reg_system_event(item,"mouseover",func,useCapture);},unreg_event:function(item,func,useCapture){return igk.winui.unreg_system_event(item,"mouseover",func);}});}c.unregister();delete(c);})();(function(){var _N="mousewheel wheel";igk.winui.registerEventHandler(_N,{reg_event:function(item,func,useCapture){var _n=("onmousewheel" in item)? "mousewheel" :"wheel";return igk.winui.reg_system_event(item,_n,func,useCapture);},unreg_event:function(item,func,useCapture){var _n=("onmousewheel" in item)? "mousewheel" :"wheel";return igk.winui.unreg_system_event(item,_n,func);}});})();(function(){var m={};var webkit=new igk.system.collections.list();var webkit_e=new igk.system.collections.dictionary();var inchain=false;function __webkitcall(evt){var r=webkit.toArray();for(var i=0;i<r.length;i++){var s=webkit_e.getItem(r[i]);if(s!=null){__call(r[i],s.toArray(),arguments);}r[i].apply(igk.winui.eventTarget(evt),arguments);}}function __call(func,r,args){for(var i=0;i<r.length;i++){func.apply(r[i],args);}}function __reg_item_func(item,func){var s=webkit_e.getItem(func);if(s==null){s=new igk.system.collections.list();webkit_e.add(func,s);}s.add(item);}function __unreg_item_func(item,func){var s=webkit_e.getItem(func);if(s !=null){s.remove(item);if(s.getCount()<=0){webkit_e.remove(func);return !0;}return !1;}return !0;}function _reg_webkitevent(n){var kn='onwebkit'+n;return{reg_event:function(item,func,useCapture){if(item==null)return;if((typeof(item[kn])!=igk.constants.undef)||((item!=window)&&(typeof(window[kn])!=igk.constants.undef))){if(webkit.contains(func)){if(item !=window)__reg_item_func(item,func);return;}webkit.add(func);if(window[kn]==null)window[kn]=__webkitcall;else if((window[kn]!=__webkitcall)&& !inchain){var tfunc=window[kn];window[kn]=function(evt){tfunc.apply(this,arguments);__webkitcall.apply(this,arguments);};inchain=!0;}webkit_e.add(item);return;}if(item.addEventListener){item.addEventListener(n,func,useCapture);}},unreg_event:function(item,func,useCapture){if(item==null)return;if(webkit.contains(func)){if(item !=window){if(!__unreg_item_func(item,func)){return;}}webkit.remove(func);if(webkit.getCount()==0){if(!inchain){window[kn]=null;}}return;}if(item.removeEventListener){item.removeEventListener(n,func);}}};}igk.winui.registerEventHandler('transitionstart',_reg_webkitevent('transitionstart'));igk.winui.registerEventHandler('transitionend',_reg_webkitevent('transitionend'));igk.winui.registerEventHandler('animationend',_reg_webkitevent('animationend'));igk.winui.registerEventHandler('animationiteration',_reg_webkitevent('animationiteration'));})();(function(){function __gettabname(item,tab){var kn=0;var s="";for(var i=0;i<tab.length;i++){s="on"+tab[i];if(s in item){kn=tab[i];break;}}return kn;}function __initEvents(tab,fallbackitem){return{reg_event:function(item,func,useCapture){if(item==null)return;var kn=__gettabname(item,tab);if(!kn){if(fallbackitem &&(fallbackitem!=item)){kn=__gettabname(fallbackitem,tab);item=fallbackitem;}if(!kn){console.debug("can't register event : "+tab[0]);return;}}igk.winui.reg_event(item,kn,func,useCapture);},unreg_event:function(item,func,useCapture){if(item==null)return;if(item==null)return;var kn=__gettabname(item,tab);if(!kn){if(fallbackitem &&(fallbackitem!=item)){kn=__gettabname(fallbackitem,tab);item=fallbackitem;}if(!kn){console.debug("can't unregister event "+tab[0]);return;}}igk.winui.reg_event(item,kn,func,useCapture);}};};igk.winui.registerEventHandler("fullscreenchange",__initEvents(["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange","ofullscreenchange"],document));igk.winui.registerEventHandler("fullscreenerror",__initEvents(["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","msfullscreenerror","ofullscreenerror"],document));})();(function(){var m_viewarticle=false;var m_article=new igk.system.collections.list();igk.ctrl.bindAttribManager("igk-article-options",function(){var q=this;var source=igk.system.convert.parseToBool(this.getAttribute("igk-article-options"));q.show=function(){};q.hide=function(){};if(! m_viewarticle)q.hide();else{q.show();}m_article.add(q);});igk.ctrl.bindAttribManager("igk-js-fix-height",function(n,m){var r=null;if(m=="::")r=$igk(this.o.parentNode);else r=$igk(m).first();if(r==null)return;var q=this;var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){q.setCss({height:r.getHeight()+"px"});});}q.setCss({height:r.getHeight()+"px"});});igk.ctrl.bindAttribManager("igk-js-fix-width",function(n,m){var r=null;if(m=="::")r=$igk(this.o.parentNode);else r=$igk(m).first();if(r==null)return;var q=this;function __update(){q.setCss({width:(r.getWidth())+"px"});}var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){__update();});}__update();});igk.ctrl.bindAttribManager("igk-js-fix-eval",function(n,m){var o=igk.JSON.parse(m);if(o==null)return;var q=this;function __update(){o.update.apply(q);}var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){__update();});}__update();});(function(){function __evalfunction(){var s=this.getAttribute("igk-js-eval");if(s){igk.eval(s,this.o);}};igk.ctrl.bindAttribManager("igk-js-eval",__evalfunction);})();(function(){var m_initItems=[];function __init(){for(var i=0;i<m_initItems.length;i++){var s=m_initItems[i].getAttribute("igk-js-eval-init");igk.eval(s,m_initItems[i].o);}};igk.ready(__init);function __evalfunction(){var s=this.getAttribute("igk-js-eval-init");if(s){if(document.readyState=="complete")igk.eval(s,this.o);else m_initItems.push(this);}};igk.ctrl.bindAttribManager("igk-js-eval-init",__evalfunction);})();(function(){function __evalUri(){var self=this;var uri=this.getAttribute("igk-js-init-uri");if(uri){igk.ajx.get(uri,null,function(xhr){if(this.isReady()){this.replaceResponseNode(self.o,false);}},true);}}igk.ctrl.bindAttribManager("igk-js-init-uri",__evalUri);})();(function(){function __init(){var self=this;var r=this.getAttribute("igk-ajx-form");var r_obj=r &&(r!='1')? igk.JSON.parse(r):null;var noa=this.getAttribute("igk-ajx-form-no-autoreset");var no_c=this.getAttribute("igk-ajx-form-no-close");var ajxdata=igk.JSON.parse(this.getAttribute("igk-ajx-form-data"));if(((r==1)||r_obj)&&(this.o.tagName.toLowerCase()=="form")){var b=r_obj && r_obj.targetid? r_obj.targetid:self.getAttribute("igk-ajx-form-target");var s=$igk(b);this.reg_event("submit",function(evt){evt.preventDefault();igk.ajx.postform(self.o,self.o.action,function(xhr){if(this.isReady()){if(b){var k=null;switch(b){case "=":k=self;break;case "::":case "??":k=$igk(document.body);k.unregister();igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);k=null;break;default:k=$igk(b).first();break;}if(k){k.unregister();this.setResponseTo(k.o,false);}}else{var s=self.o["igk:source"];var k=$igk(s);if(k){k.unregister();this.setResponseTo(k.o,false);}else{igk.ajx.fn.append_to(xhr,document.body);}}var frame=self.o["igk:framebox"];if(!no_c && frame){frame.close();}if(!noa)self.o.reset();if(ajxdata && ajxdata.complete){ajxdata.complete.apply(self);}if(r_obj && r_obj.complete){r_obj.complete.apply(self);}}});});}}igk.ctrl.bindAttribManager("igk-ajx-form",__init);})();(function(){m_ctrl=null;igk.appendProperties(igk.ctrl,{show_article_options:function(){for(var i=0 ;i<m_article.length;i++){if(!m_viewarticle)m_article[i].show();else m_article[i].hide();}m_viewarticle=!m_viewarticle;if(m_viewarticle)igk.web.setcookies("igk-sao","1");else igk.web.setcookies("igk-sao",null);},show_ctrl_options:function(){if(m_ctrl==null){return;}for(var i=0 ;i<m_ctrl.length;i++){if(!m_viewctrl)m_ctrl[i].show();else m_ctrl[i].hide();}m_viewctrl=!m_viewctrl;if(m_viewctrl)igk.web.setcookies("igk-sco","1");else igk.web.setcookies("igk-sco",null);}});})();igk.ready(function(){function __init_roll_owner(q){q.reg_event("mouseout",function(evt){__rmClass.apply(q);});q.reg_event("mouseover",function(evt){__addClass.apply(q);});q.select(".igk-roll-in").each_all(function(){g=this.select("^.igk-roll-owner").first();if(g==q){this.rollparent=q;var self=this;this.reg_event("mouseover",function(evt){self.addClass("igk-roll-in-hover");});this.reg_event("mouseenter",function(evt){self.addClass("igk-roll-in-hover");});}});}igk.ctrl.registerReady(function(e){if(igk.system.regex.item_match_class("igk-roll-owner",this)){__init_roll_owner($igk(this));}});function __addClass(){var t=$igk(this);$igk(this).select(".igk-roll-in").each_all(function(){if(this.rollparent==t)this.addClass("igk-roll-in-hover");});}function __rmClass(){var t=$igk(this);t.select(".igk-roll-in").each_all(function(){if(this.rollparent==t){this.rmClass("igk-roll-in-hover");}});}function __toggleview(v){if(v)__addClass.apply(this);else __rmClass.apply(this);}$igk(".igk-roll-owner").each(function(){var q=this;__init_roll_owner(q);return !0;});$igk(".igk-touch-roll-owner").each(function(){this.rmClass("igk-roll-owner");var m=false;var q=this;if(this.istouchable()){this.reg_event("touchend",function(){__toggleview.apply(q,[!m]);m=!m;});}else{this.reg_event("click",function(){__toggleview.apply(q,[!m]);m=!m;});}return !0;});(function(){var m_item=new igk.system.collections.list();function __initview(n,t){if(t.o.scrollTop<=n.getHeight()){n.rmClass("igk-show");}else{n.addClass("igk-show");}}function __register(n){var id=n.getAttribute("igk:fixed-target");if(id){m_item.add(n);var c=$igk(n.select(id));if(c){if(c.isSr()){c.each_all(function(){var q=this;this.reg_event("scroll",function(evt){__initview(n,q);});__initview(n,q);});}else{$igk(c).reg_event("scroll",function(evt){__initview(n,c);});__initview(n,c);}}else{console.debug("item not found "+c);}}else{console.debug("warning: no igk-fixed-action-bar-target attribute found");}}$igk(".igk-fixed-action-bar").each(function(){__register(this);return !0;});})();});})();(function(){var m_targetResponse=null;var framebox_callback=[];function __submit_form(evt){var q=this;var c=(m_targetResponse!=null)?m_targetResponse:eval(q.getAttribute("igk-ajx-lnk-tg-response"));var clf=q.getAttribute("igk-frame-close");if(c){var m=document.getElementById(c);if(m){window.igk.ajx.postform(q,q.action,function(xhr){if(this.isReady()){if(xhr.responseText.length>0){this.setResponseTo(m);}}q.reset();},false);if(clf){q['igk:framebox'].close();}evt.preventDefault();return !1;}}return !0;}function __call_frame_closed(frameid){var v_fremoved=[];var v_args=[frameid];for(var i=0;i<framebox_callback.length;i++){var f=framebox_callback[i];if((f!=null)&&(f.apply(window,v_args))){v_fremoved.push(f);}}for(var j=0;j<v_fremoved.length;j++){framebox_callback.pop(v_fremoved[j]);}}function __close_frame(m_frame){igk.winui.framebox.frames.pop(m_frame);var tf=igk.winui.framebox.frames;igk.winui.framebox.currentFrame=tf.length>0? tf[tf.length-1]:null;}igk.system.createNS("igk.winui.framebox",{currentFrame:null,frames:new Array(),reg_frame_close:function(callback){framebox_callback.push(callback);},close_currentframe:function(node){var frm=ns_igk.winui.framebox.getdialog_frame(node);igk.ajx.get(frm.closeuri+"&ajx=1",null,null);var f=frm;$igk(f.parentNode).setCss({opacity:1}).animate({opacity:0},{interval:20,duration:200,complete:function(){ns_igk.winui.framebox.close(frm);}});},getdialog_frame:function(node){var t=null;var k="framebox-dialog";if(node.id==k)t=node;else t=igk.getParentById(node,k);if(t){igk.appendProperties(t,{"frameDialogOwner":t.parentNode });}return t;},reg_dialog:function(node){if(node==null)return;var t=igk.winui.framebox.getdialog_frame(node);var n=null;if(t!==null){n=$igk(t).select(".title").getNodeAt(0);if(n){igk.winui.dragFrameManager.init(n,t);}igk.winui.framebox.currentFrame=t;igk.winui.framebox.frames.push(t);}},init:function(p,w,h){if(p==null){return;}var m_frame=igk.winui.framebox.getdialog_frame(p);var m_closeBtn=p.getElementsByTagName("a")[0];if(m_frame==null)return;if(m_closeBtn==null){console.error("no close button");igk.winui.notify.showErrorInfo("Error",'/!\\ JS: frame init :: No close button found.');return;}igk.winui.framebox.reg_dialog(p);m_frame.closeuri=m_closeBtn.href+"&ajx=1";function __centerDialog(){igk.winui.centerDialog(p,w,h);};function __setSize(m){m.setCss({"width":(igk.winui.screenSize().width-15)+"px"});};if(igk.system.regex.item_inherit_class("igk-android",p)){var m=$igk(p).rmClass("resizable").addClass("dispb fit overflow-y-a").select(".datas");igk.winui.reg_event(window,'resize',function(){__setSize(m);});__setSize(m);}else{if(!$igk(p).supportClass("no-center"))__centerDialog();}m_frame.parentNode.close=function(){igk.winui.framebox.close(m_frame);};m_frame.close=function(){igk.winui.framebox.close(this);};var s=$igk(m_frame).select("*");m_frame.parentNode.targetResponse=m_targetResponse? m_targetResponse:document.body;s.setProperties({"igk:framebox":m_frame});$igk(m_frame).select("form").each_all(function(){var f=this.o.onsubmit;if(f){this.o.onsubmit=f;}else{this.o.onsubmit=__submit_form;}});function __a_close_ajx(){igk.ajx.get(m_frame.closeuri,null,null);var f=m_frame;$igk(f.parentNode).setCss({opacity:1}).animate({opacity:0},{interval:20,duration:200,complete:function(){igk.winui.framebox.close(f);}});}function __a_event(evt){if(igk.winui.framebox.currentFrame==m_frame){if(evt.keyCode==27){if(!evt.defaultPrevented){__a_close_ajx();evt.preventDefault();igk.winui.unreg_keypress(__a_event);__close_frame(m_frame);}}}};igk.winui.reg_keypress(__a_event);var s=(""+m_closeBtn.href).split("#")[1];var id=null;if(s &&(s.split('?')[0]=="/closeframe")){id=s.split("/closeframe?id=")[1];m_closeBtn.onclick=function(evt){var frame=igk.getParentById(p,id);if(frame){$igk(frame).setCss({opacity:1}).animate({opacity:0},{interval:20,duration:200,complete:function(){frame.parentNode.removeChild(frame);__a_close_ajx();}});}return !1;};}else if(m_closeBtn){m_closeBtn.onclick=function(evt){evt.preventDefault();__a_close_ajx();return !1;};}},close:function(frame){frame=frame ;if(frame && frame.frameDialogOwner){var p=frame.frameDialogOwner;var s=$igk(frame);if(s.unregEventContext){s.unregEventContext();}if(p && p.parentNode){p.parentNode.removeChild(p);__call_frame_closed(p.id);}}},closeCurrentFrame:function(){var f=igk.winui.framebox.currentFrame;if(f){__close_frame(f);}},init_confirm_frame:function(p,uri,ajxcontext){var frm=igk.getParentByTagName(p,'form');var r=frm.getAttribute("igk-confirmframe-response-target");if(r !=null){m_targetResponse=document.getElementById(r);}function __closeForm(){igk.winui.unreg_keypress(__keypressfunc);var v_frame=igk.winui.framebox.getdialog_frame(frm);if(t!=null){igk.winui.framebox.close(v_frame);}}function __keypressfunc(evt,document){switch(evt.keyCode){case 27:if(!ajxcontext){frm.action=uri;frm.confirm.value=0;frm.submit();}else{igk.ajx.post(frm["frame-close-uri"].value+"&id="+frm["frame-id"].value,null,null,false);__closeForm();}igk.winui.unreg_keypress(__keypressfunc);evt.preventDefault();evt.stopPropagation();return !1;case 13:igk.winui.unreg_keypress(__keypressfunc);frm.submit();evt.preventDefault();return !1;}}if(frm){igk.winui.reg_keypress(__keypressfunc);}},btn:{yes:function(q){var v_frame=q['igk:framebox'];window.igk.ajx.postform(q.form,q.form.action,function(xhr){if(this.isReady()){v_frame.close();if(v_frame.targetResponse){this.setResponseTo(v_frame.targetResponse);}else{igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);}}},false);return !1;}}});})();(function(){igk.system.createNS("igk.ctrl.menu",{init:function(target){var q=$igk(target);var e=$igk(q.getAttribute("igk-data-menu-binding")).first();if(this.namespace){if(e)return new this.init(target);return null;}var b=igk.createNode("div");b.setCss({overflowY:'auto' }).addClass("fitw fith igk-data-src");b.setHtml(e.getHtml());q.o.appendChild(b.o);igk.ajx.fn.initnode(b.o);}});var v_menu_name="igk-data-menu";if(!igk.ctrl.isAttribManagerRegistrated(v_menu_name))igk.ctrl.registerAttribManager(v_menu_name,{n:"js",desc:"menu register "});igk.ctrl.bindAttribManager(v_menu_name,function(){var q=this;var source=igk.system.convert.parseToBool(this.getAttribute(v_menu_name));if(source){igk.ctrl.menu.init(q);}});})();(function(){var m_ajx=null;function init_tab_control(){var q=this.select("ul").select("li.igk-active").first();var self=this;if(q !=null){this.o.activetab=q;}this.o.activate=function(i){var s=i.select("^li");if(self.o.activetab)self.o.activetab.rmClass("igk-active");s.addClass("igk-active");self.o.activetab=s;};this.init=!0;}igk.ready(function(){var s=$igk(".igk-tabcontrol");if(s)s.each_all(init_tab_control);});igk.winui.initClassControl("igk-tabcontrol",init_tab_control,{desc:"igk-control : tabcontrol" });igk.ctrl.registerAttribManager("igk-ajx-tab-lnk",{ns:"ajx",desc:"tabcontrol ajx link"});igk.ctrl.bindAttribManager("igk-ajx-tab-lnk",function(m,s){var tab=this.select('^.igk-tabcontrol').first();if(tab==null){console.error("/!\\ no tabcontrol found");return;}if(typeof(tab.init)=="undefined"){init_tab_control.apply(tab);}var q=tab.select('.igk-tabcontent').first();var self=this;if(s && q){this.reg_event("click",function(evt){evt.preventDefault();if(m_ajx){m_ajx.abort();}q.addClass("fade-out");m_ajx=igk.ajx.get(self.o.href,null,igk.ajx.fn.replace_content(q.o),true);tab.o.activate(self);}).reg_event("focus",function(evt){evt.preventDefault();this.blur();});;}});})();(function(){function _init_track(){var c=this.select(".igk-trb-cur").first();if(c){var r=new(function(q,c){q.addEvent("igk-trackchange",{value:null});this.target=q;this.c=c;this.data=null;var v_d=q.getAttribute("igk-trb-data");if(v_d)this.data=igk.JSON.parse(v_d);var self=this;var m_s,m_e;var m_st=false;function __update(evt){if(!m_st)return;var l=q.getScreenLocation();var W=q.getWidth();var H=q.getHeight();r=igk.getNumber(q.getComputedStyle("paddingTop"))+igk.getNumber(q.getComputedStyle("paddingBottom"));H-=r;var dirup=igk.system.regex.item_match_class("igk-dir-up",q.o);var hv=false;if(dirup){hv=!0;m_s=Math.min(100,parseInt((Math.max(0,H-Math.min(evt.clientY-l.y,H))/ H)*10000)/ 100);self.c.setCss({top:parseInt((H*(1-m_s/100)))+"px",bottom:'0px'});}else if(igk.system.regex.item_match_class("igk-dir-down",q.o)){hv=!0;m_s=Math.min(100,parseInt((Math.max(0,Math.min(evt.clientY-l.y,H))/ H)*10000)/ 100);}q.o["igk-track"]=m_s;if(hv){self.c.setCss({height:m_s+"%"});if(self.data && self.data.update){self.data.update.apply(self,[{progress:m_s,bar:self}]);}}else{m_s=parseInt((Math.max(0,Math.min(evt.clientX-l.x,W))/ W)*10000)/ 100;self.c.setCss({width:m_s+"%"});if(self.data && self.data.update){self.data.update.apply(self,[{progress:m_s,bar:self}]);}}q.o["igk-trackchange"].value=m_s;q.raiseEvent("igk-trackchange");}q.reg_event("mousedown",function(evt){if(m_st)return;m_st=!0;igk.winui.mouseCapture.setCapture(q.o);igk.winui.selection.stopselection();__update(evt);});q.reg_event("mousemove",function(evt){__update(evt);});q.reg_event("mouseup",function(evt){if(m_st){__update(evt);m_st=false;igk.winui.mouseCapture.releaseCapture();igk.winui.selection.enableselection();}});igk.appendProperties(this,{toString:function(){return "igk-trb-info"}});})(this,c);}}igk.ctrl.registerReady(function(e){if(igk.system.regex.item_match_class("igk-trb",this)){_init_track.apply($igk(this));}});})();(function(){var m_xhr=null;igk.system.createNS("igk.winui.ajx.lnk",{getLink:function(){return m_xhr.source;},getXhr:function(){return m_xhr;}});igk.ctrl.registerAttribManager("igk-ajx-lnk",{ns:"ajx",desc:"Ajax link. used in combination with 'igk-ajx-lnk-tg' properties. "});igk.ctrl.bindAttribManager("igk-ajx-lnk",function(n,m){if(!m)return;var q=this;var v=this.getAttribute("href");if(m && v){q.addClass("igk-ajx-lnk");var v_meth=m.method||igk.ajx.get;v=igk.html.appendQuery(v,"ajx-lnk=1");var fc=m.update;var obj=igk.JSON.parse(m,q);var opxhr=null;q.reg_event("click",function(evt){evt.preventDefault();if(obj.execute){obj.execute.apply(this,evt);return;}var r=$igk(obj.target)||$igk(this.getAttribute("igk:target"));if(r!=null){var t=r.first();if(t)fc=igk.ajx.fn.replace_content(t.o);}if(opxhr!=null){opxhr.abort();opxhr=null;}if(fc==null){fc=igk.ajx.fn.append_to_body;}opxhr=v_meth(v,null,function(xhr){if(this.isReady()){m_xhr=xhr;this.source=q;if(fc){fc.apply(this,[xhr]);}if(obj.complete){obj.complete.apply(this,[xhr]);}m_xhr=null;}});});}});igk.ctrl.registerAttribManager("igk-callback",{"desc":"register extra function to be called from server script"});var fcs={'hide':function(n){return function(){this.select(n).hide();};}};igk.ctrl.bindAttribManager("igk-callback",function(t,v){var c=igk.JSON.parse(v);var g={};if(c){for(var i in c){var f=c[i];if(igk.typeofs(f)&&(i in fcs)){this[i]=fcs[i](f);}else if(igk.typeoff(f)){this[i]=f;}else{console.debug("failed "+typeof(f));}}}this.callback=g;});igk.winui.initClassControl("igk-winui-ajx-lnk-replace",function(){var q=this;var _i=q.getAttribute("igk-lnk-target");var _index=q.getAttribute("igk-lnk-index")||"0";var _host=m_host||igk.ajx.GetParentHost();var ck=0;if(_host){var sl=_host.select(_i);if(sl.getCount()>0){if(_index=="*")sl.setHtml(q.o.innerHTML).init();else sl.getItemAt(_index).setHtml(q.o.innerHTML).init();ck=1;}}if(!ck){var v=$igk(document.body).select(_i).first();if(v){v.setHtml(q.o.innerHTML).init();}else console.debug("item not found "+_i);}q.remove();},{desc:"use to replace a cibling node with the inner content"})})();(function(){igk.ctrl.registerAttribManager("igk-ajx-lnk-form",{ns:"ajx",desc:"ajax link. used in combination with igk-ajx-data properties"});igk.ctrl.bindAttribManager("igk-ajx-lnk-form",function(n,m){var q=this;var v=this.getAttribute("href");if(m && v){q.reg_event("click",function(evt){evt.preventDefault();var t=$igk(q.getAttribute("igk-ajx-lnk-tg")).first();var frm=q.getParentForm();if(frm){var fc=null;if(t)fc=igk.ajx.fn.replace_node(t.o);igk.ajx.postform(frm,v,fc);}});}})})();(function(){igk.ctrl.registerAttribManager("igk-js-cn",{ns:'js',desc:"igk clone node target"});igk.ctrl.bindAttribManager("igk-js-cn",function(n,a){var q=$igk(a);if(q){var b=q.clone();b.o["id"]+="-cn";this.o.parentNode.replaceChild(b.o,this.o);}});})();(function(){igk.ctrl.registerAttribManager("igk-js-toggle",{ns:'js',desc:"igk toggle property on click"});igk.ctrl.bindAttribManager("igk-js-toggle",function(n,a){if(!a)return;var p=igk.JSON.parse(a);var self=this;var co_id=this.getAttribute("igk-js-toggle-cookies");if(!p.name)p.name="class";var pt=this.select(p.parent).first();if(!pt)return;var q=pt.select(p.target).first();var self=this;if(!q){igk.show_notify_error(n+" [not found]","can't notify error");return;}function __click(evt){evt.preventDefault();switch(p.name){case 'class':default:if(igk.system.regex.item_match_class(p.data,q.o)){q.rmClass(p.data);pt.addClass("igk-toggle");if(co_id){igk.web.setcookies(co_id,1);}}else{q.addClass(p.data);pt.rmClass("igk-toggle");if(co_id){igk.web.rmcookies(co_id);}}if(p.complete)p.complete.apply(self);break;}}if(this.istouchable()){this.reg_event("touchend",__click);}else this.reg_event("click",__click);if(co_id){var s=igk.web.getcookies(co_id);if(s){this.o.click();}}});})();(function(){igk.system.createNS("igk.ctrl.selectionmanagement",{disable_selection:function(target){if(typeof(target.onselectstart)!="undefined")target.onselectstart=function(){return !1;};if(typeof(target.style.MozUserSelect)!="undefined")target.style.MozUserSelect="none";target.onblur=function(){return !1;};target.ondragstart=function(){return false};},initnode:function(){var q=this;var source=this.getAttribute("igk-js-anim-over");var store={};if(source){var t=eval("new Array("+source+")");for(var m in t[0]){store[m]=q.getComputedStyle(m);}this.reg_event("mouseover",function(evt){if(q.supportAnimation()){var d=igk.JSON.parse(source);q.setCss({transition:'all 0.5s ease-in-out'}).setCss(d);}else{eval("q.animate("+source+");");}});this.reg_event("mouseleave",function(){if(q.supportAnimation()){q.setCss({transition:'all 0.2s ease-in-out'}).setCss(store).timeOut(300,function(){q.setCss({transition:null});});}else{q.animate(store,t[1]);}});}}});igk.ctrl.bindAttribManager("igk-node-disable-selection",function(){var s=igk.system.convert.parseToBool(this.getAttribute("igk-node-disable-selection"));if(s==true){var q=this.o;igk.ctrl.selectionmanagement.disable_selection(q);$igk(this.o).select("*").each(function(){});}});})();(function(){igk.winui.initClassControl("igk-parentscroll",function(){var q=this;q.reg_event("scroll",function(evt){igk.publisher.publish("sys://html/doc/scroll",{target:this,args:evt});});});})();(function(){igk.ctrl.registerAttribManager("igk-js-autofix",{ns:'js',desc:"igk js autofix element in document"});igk.ctrl.bindAttribManager("igk-js-autofix",function(m,n){if(!n)return;var o=igk.JSON.parse(n);var c=null;if(!o.target)c=this.select("^.igk-parentscroll").first();else c=this.select(o.target).first();if(!c)return;if(!o.style)o.style={left:"0px",top:"0px"};var t=this;var tc=igk.createNode("div");tc.setHtml("&nbsp;").addClass("no-visibility");function __initview(){var g=t.getScreenLocation();if(c.o.scrollTop>o.offset){if(!igk.system.regex.item_match_class("posfix",t.o)){t.o.parentNode.insertBefore(tc.o,t.o);tc.setCss({height:t.getHeight()+"px"});t.addClass("posfix").setCss(o.style).setCss({'width':tc.getWidth()+"px"});}}else{t.rmClass("posfix").setCss({left:'auto',top:'auto',width:'auto'});tc.remove();}};$igk(c).reg_event("scroll",function(evt){__initview();});});})();(function(){igk.system.createNS("igk.ctrl.togglebutton",{init:function(target){if(!target)return;var q=$igk(target);var s=q.getAttribute("igk-toggle-target");if(!s)return null;if(this.namespace){return new this.init(target);}var e=$igk(s).first();var t=q.getAttribute("igk-toggle-class");var toggle="visibiliy";toggle="class";this.updateState=function(){var v_state=q.getAttribute("igk-toggle-state");switch(v_state){case "expand":{if(e)e.setCss({width:200/3.0+"%"});q.setAttribute("igk-toggle-state","collapse");}break;case "collapse":if(e)e.setCss({width:0+"%"});q.setAttribute("igk-toggle-state","expand");break;}};var self=this;q.reg_event("click",function(evt){self.updateState();});this.updateState();}});if(!igk.ctrl.isAttribManagerRegistrated("igk-toggle-button")){var k=igk.ctrl.registerAttribManager("igk-toggle-button",{n:"js",desc:"register toggle button"});}igk.ctrl.bindAttribManager("igk-toggle-button",function(){var v=this.getAttribute("igk-toggle-button");var q=this;var source=igk.system.convert.parseToBool(this.getAttribute("igk-toggle-button"));if(source){igk.ctrl.togglebutton.init(q);}});})();(function(){igk.system.createNS("igk.html",{addInput:function(t,p,n,v){i=igk.createNode("input");i.o["type"]=n;i.o["class"]="cl"+n;i.o["value"]=v;t.o.appendChild(i.o);return i;}});})();igk.ready(function(){var q=$igk(".igk-parentscroll").first();if(q){q.o.focus();}});(function(){var contain_slider=false;var m_s_btn=[];var ct_sliderbtn="winui/sliderbutton";var m_datas={};function _slide_to(){var p=igk.JSON.parse($igk(this).getAttribute("igk-slider-data"));if(p){p.scrollparent=$igk($igk(p.target).first().getscrollParent());p.cibling=$igk(this);ns_igk.winui.fn.navigateTo(p.target,p.property).apply(this,null);m_datas[p.scrollparent.getCssSelector()]=p;igk.web.storage.set("igk/slider",p.scrollparent.getCssSelector());}}function _slider_click(evt){evt.preventDefault();_slide_to.apply(this);}function _view_size(){for(var i in m_datas){var p=m_datas[i];ns_igk.winui.fn.navigateTo(p.target,p.property).apply(p.cibling,null);}}function _init_slider_button(q){if(q.data.contains(ct_sliderbtn))return;if(q.istouchable()){q.reg_event("touchend",_slider_click);}else q.reg_event("click",_slider_click);m_s_btn.push(q);q.data.add(ct_sliderbtn,1);if(!contain_slider){igk.winui.reg_event(window,"resize",_view_size);var sl=igk.web.storage.get("igk/slider");contain_slider=!0;}}igk.ctrl.registerReady(function(){if(igk.system.regex.item_match_class("igk-slider-btn",this)){_init_slider_button($igk(this));}});igk.ready(function(){$igk(".igk-slider-btn").each_all(function(){_init_slider_button(this);});});igk.system.createNS("igk.winui.sliderbtn",{fn:{ajxslideToReady:function(q,p){return function(xhr){if(this.isReady()){$igk(q).setAttribute("igk-slider-data",p);_init_slider_button($igk(q));_slide_to.apply($igk(q));}}}}});})();(function(){igk.ctrl.bindAttribManager("igk-form-validate",function(n,v){if(!v){return;}var q=this;this.reg_event("submit",function(evt){if((typeof(q.o.checkValidity)!=igk.constants.undef)&& !q.o.checkValidity()){console.debug("data ivalie");evt.preventDefault();return;}var _o=false;$igk(this).select("input").each(function(){if(typeof(this.igkCheckIsInvalid)!=igk.constants.undef){_o|=this.igkCheckIsInvalid();}return !0;});if(_o)evt.preventDefault();});});})();(function(){igk.system.createNS("igk.android",{});function __initAndroid(){if(!igk.navigator.isAndroid()&& !$igk(document.body).supportClass("igk-android"))return;var m_actx=igk.createNode("android-ctx");var m_ectx=igk.winui.RegEventContext(m_actx,m_actx);if(m_ectx){m_ectx.reg_window("resize",function(){__setup_screen();});if(typeof(window.onorientationchange)!="undefined"){m_ectx.reg_window("orientationchange",function(evt){if(window.orientation==90){$igk('.igk-android').addClass("lnd-scape");}else $igk('.igk-android').rmClass("lnd-scape");});}}var mt=igk.css.getMediaType();__setup_screen();$igk(document.body).addClass(mt);var mt=igk.css.getMediaType();igk.publisher.register(igk.publisher.events.mediachanged,function(e){$igk(document.body).rmClass(mt).addClass(e.mediaType);mt=e.mediaType;});return m_actx;}function __setup_screen(){if(typeof(window.onorientationchange)=="undefined"){if(window.innerWidth>window.innerHeight){$igk('.igk-android').addClass("lnd-scape");}else{$igk('.igk-android').rmClass("lnd-scape");}}}igk.ready(function(){__initAndroid();});})();(function(){var m_types=['css','php','csharp','html','xml'];var m_reg=(function(t){var r='';for(var i=0;i<t.length;i++){if(i>0)r+='|';r+=t[i];}return new RegExp('(('+r+')code)','i');})(m_types);function __init_code_area(){var q=this;if(!q){return ;}if(q.hightlight)return;q.hightlight=1;this.addClass("dispib");var c='';var b=null;if(b=m_reg.exec(this.o.className)){c=b[2];}else{c=this.getAttribute("lang");if(!(c in m_types)){c='php';}}q.addClass("code-php");var s=this.o.innerHTML;var t=s.split('\n');this.setHtml("");var m=null;if(c){m="igk.highlightjs."+c;m=eval("new "+m+"();");}else{m=new igk_e();}var l="";for(var i=0;i<t.length;i++){l=t[i];var d=this.add("div");d.setHtml(m.evals(l));}var o=this.add('span').addClass("dispib").setHtml('_');var w=igk.getNumber(o.getComputedStyle('width'));o.remove();delete(o);w=(((m.getLines()+'').length*w)+10)& 0xFFFA;igk.css.appendRule(this.getCssSelector()+" > div > span.ln { width:"+w+"px; background-color:#444} ");}function igk_e(){var l=0;igk.appendProperties(this,{evals:function(m){l++;return m;},getLines:function(){return l;}});}var inf={ln:0,mode:0,pos:0 };function _readWord(s){var w="";var c=0;while(inf.pos<inf.ln){ch=inf.s[inf.pos];c=ch.toLowerCase().charCodeAt(0);if(((c>=48)&&(c<=57))||((c>=97)&&(c<=122))||(ch=='_')){w+=ch;}else{break;}inf.pos++;}delete(c);if(w.length==0)inf.read=0;return w;}function _readStringLitteral(ch){var w=ch;var p=ch;while(inf.pos<inf.ln){ch=inf.s[inf.pos];if(ch !=p){w+=ch;}else{if(inf.s[inf.pos-1]=="\\"){w+=ch;}else break;}inf.pos++;}return w+p;}function igk_php_eval(){igk_e.apply(this);var reserved=/((true|false)|(a(bstract|nd|rray|s))|(c(a(llable|se|tch)|l(ass|one)|on(st|tinue)))|(d(e(clare|fault)|ie|o))|(e(cho|lse(if)?|mpty|nd(declare|for(each)?|if|switch|while)|val|x(it|tends)))|(f(inal|or(each)?|unction))|(g(lobal|oto))|(i(f|mplements|n(clude(_once)?|st(anceof|eadof)|terface)|sset))|(n(amespace|ew))|(p(r(i(nt|vate)|otected)|ublic))|(re(quire(_once)?|turn))|(s(tatic|witch))|(t(hrow|r(ait|y)))|(u(nset|se))|(__halt_compiler|break|list|(x)?or|var|while))$/;var w=0;var l=1;var mode=0;this.evals=function(s){s=s.replace('<!--?php','<span class="proc">&lt;?php</span>').replace('?-->','<span class="proc">?&gt;</span>');var o='';var m=0;var tr='';o+='<span class=\'ln\'>'+l+'</span>';if(/(&lt;\?php|\?&gt;)/.test(s.trim())){o+="<span class='proc'>"+s+"</span>";}else{if(s.length==0)o+="<br />";else{inf.ln=s.length;inf.pos=0;inf.read=1;inf.s=s;var sp=igk.createNode("span");var ch="";while(inf.read &&(inf.ln>inf.pos)){ch=s[inf.pos];switch(ch){case ' ':sp.add("span").setHtml("&nbsp;");break;case '\t':sp.add("span").addClass("t").setHtml("&nbsp;");break;case "\"":case "'":if(inf.mode==0){inf.mode=1;inf.pos++;w=_readStringLitteral(ch);sp.add("span").addClass("s").setHtml(w);inf.mode=0;}break;case '/':if((inf.pos+1<inf.ln)&&(inf.s[inf.pos+1]=="/")){sp.add("span").addClass("cm").setHtml(ch+inf.s.substr(inf.pos+1));inf.read=0;}else sp.add("span").addClass("pc").setHtml("/");break;case "@":if((inf.pos+1<inf.ln)&&("\"'".indexOf(inf.s[inf.pos+1])!=-1)){inf.pos++;w=_readStringLitteral(inf.s[inf.pos++]);sp.add("span").addClass("s").setHtml("@"+w);inf.mode=0;}break;case '$':inf.pos++;w=_readWord();sp.add("span").addClass("v").setHtml("$"+w);inf.pos--;break;case "&":if(inf.mode==0){inf.start=inf.pos;inf.pos++;while((inf.pos<inf.ln)&&(s[inf.pos]!=';')){inf.pos++;}if(s[inf.pos]==';'){m=sp.add("span").addClass("pc").setHtml(s.substr(inf.start,inf.pos-inf.start));}else inf.read=0;delete(inf.start);}break;break;default:if(inf.mode==0){if(",.?|()#[]-+{}\\/%*><;:=".indexOf(ch)!=-1){m=sp.add("span").addClass("pc").setHtml(ch);}else{w=_readWord();m=sp.add("span").addClass("w").setHtml(w);if(reserved.test(w)){m.addClass("r");}inf.pos--;}}break;}inf.pos++;}o+=sp.getHtml();}}l++;return o;};this.getLines=function(){return l;};}igk.system.createNS("igk.highlightjs",{'php':igk_php_eval });function __initCode(){$igk("code").each_all(__init_code_area);}igk.ready(function(){__initCode();});igk.ctrl.registerReady(function(){if(this.tagName && this.tagName.toLowerCase()=="code"){__init_code_area.apply($igk(this));}});})();(function(){var r=igk.createNode('div');var dev=igk.createNode('div');var dum=null;var rule=null;var m_chtheme=null;dev.addClass("igk-device");r.addClass('igk-media-type');function __getRule(f){var m=null;var q=new RegExp("/"+f+"$");for(var i=0;i<document.styleSheets.length;i++){m=document.styleSheets[i];if(m.href && q.test(m.href+""))return m;}return null;}igk.system.createNS("igk.css",{getEmSize:function(c,t){var s=igk.getNumber($igk(c).getComputedStyle("font-size"));var T=s;t=t||document.body;if(t==c)return 1;while(c){c=c.o.parentNode;if(c &&(c!=t)){c=$igk(c);T=igk.getNumber($igk(c).getComputedStyle("font-size"));if(T!=s)break;}else{c=null;}}s=Math.round(s / T,3);return s;},appendRule:function(c){rule=rule||__getRule("balafon.css.php");if(rule)rule.insertRule(c,rule.cssRules.length);},appendStyle:function(uri){var e=document.createElement("link");$igk(e).setAttribute("href",uri).setAttribute("type","text/css").setAttribute("rel","stylesheet");document.head.appendChild(e);return document.styleSheets[document.styleSheets.length-1];},getMediaType:function(){return(r.getComputedStyle('content',':before')+"").replace(/\"/g,"");},getMediaIndex:function(){return(r.getComputedStyle('z-index',':before')+"").replace(/\"/g,"");},getDevice:function(){return(dev.getComputedStyle('content',':before')+"").replace(/\"/g,"");},changeTheme:function(uri,value){igk.ajx.get(uri+"/"+value,null,function(xhr){if(this.isReady()){rule=rule||__getRule("balafon.css.php");if(rule){while(rule.cssRules.length>0){rule.deleteRule(0);}if(m_chtheme!=null){$igk(m_chtheme).remove();}var s=document.createElement("style");s["type"]="text/css";s.innerText=xhr.responseText;document.head.appendChild(s);m_chtheme=s;}}});},selectStyle:function(rx,callback){var d=document.styleSheets;if(d.length<=0)return 0;var match=[];var k=[];for(var i in rx){for(var j=0;j<d.length;j++){if(!match[j]&& rx[i].test(d[j][i])){callback(d[j]);match[j]=1;k.push(d[j]);}}}return k;},getComputedClassStyle:function(c,p,j){if(dum==null){dum=igk.createNode('div');if(igk.navigator.isChrome()){igk.ready(function(){$igk(document.body).add(dum);});}else $igk(h).add(dum);dum.addClass(c);}var g=dum.getComputedStyle(p,j);dum.remove();dum=null;return g;},getComputedSrcStyle:function(h,c,p,j){h=h||document.body;if(dum==null){dum=igk.createNode('div');if(igk.navigator.isChrome()){igk.ready(function(){$igk(h).add(dum);});}else $igk(h).add(dum);dum.addClass("dispn").addClass(c);}var g=dum.getComputedStyle(p,j);dum.remove();dum=null;return g;},appendTempStyle:function(c){var q=$igk("select#tempsp").first();if(!q){q=$igk(document.body).add("style");q.o["type"]="text/css";}q.setHtml(c);},clearTempStyle:function(){var q=$igk("select#tempsp").first();if(q){q.setHtml('');}},isMatch:function(t,p){if((/^#[\w\-_]+$/.exec(p))){b=$igk(t).getParentById(p.substring(1));if(b)v_sl.push(b);}else if((/^\./.exec(p))){p=p.substring(1);var s=$igk(t).o;var rx=new RegExp("("+p+")(\\s|$)","i");if(rx.exec(""+s.className)){return 1;}}else{if(item.tagName.toLowerCase()==pattern)return 1;}return 0;}});igk.defineProperty(igk.css,"rule",{get:function(){return rule;}});igk.ready(function(){var B=$igk(document.body);if(igk.navigator.isChrome()){B.add("div").setCss({position:'absolute',visibility:'hidden',overflow:'hidden','height':'0px','bottom':'0px'}).addClass("igk-m-i").add(r). t.add(dev);igk.css.appendRule(".igk-media-type:before{position:absolute;}");igk.css.appendRule(".igk-device:before{position:absolute;}");}var dev=igk.css.getDevice();var m_c=igk.css.getMediaType();function __checkMedia(){var i=igk.css.getMediaType();var d=null;if(i !=m_c){B.rmClass(m_c).addClass(i);__raiseMedia(i);}};function __raiseMedia(i){m_c=i;igk.publisher.publish(igk.publisher.events.mediachanged,{mediaType:i,mediaIndex:igk.css.getMediaIndex(),device:igk.css.getDevice()});};B.addClass(m_c);__raiseMedia(m_c);igk.winui.reg_event(window,'resize',__checkMedia);});var e={};e.mediachanged=1;for(var s in e){e[s]='sys://events/'+s;}igk.system.createNS("igk.publisher.events",e);})();var _g_canva=new igk.createNode("canvas");var _g_ctx=_g_canva.o.getContext("2d");function _get_filter_exp(f){if(f==null)return "none";var s="";var m="";for(var i in f){m=i;switch(m){case "huerotate":m="hue-rotate";break;case "dropshadow":m="drop-shadow";break;}if(s.length>0)s+=" ";s+=m+"("+f[i]+")";}return s;}function igk_str_padEnd(l,v){var hl=this.length;var s=this.toString();while(hl<l){s+=''+v;hl++;}return s;}igk.system.createNS("igk.canvas",{supportFilter:function(){return "filter" in _g_ctx;},getFilterExpression:function(c){var f=null;if(c!=null){if(!String.prototype.padEnd)String.prototype.padEnd=igk_str_padEnd;var s=(c+"").padEnd(20,0);var u=[];for(var i=0;i<10;i++){u[i]="0x"+s.substring(i*2,(i*2)+2);}var sfilter={};sfilter.grayscale=Math.round((eval(u[0])/100 /255.0)*10000)+"%";sfilter.huerotate=Math.round((eval(u[1])/100 /255.0)*36000)+"deg";sfilter.blur=eval(u[2])+"px";sfilter.sepia=Math.round((eval(u[3])/100 /255.0)*10000)+"%";sfilter.saturate=(100-Math.round((eval(u[4])/100 /255.0)*10000))+"%";sfilter.invert=Math.round((eval(u[5])/100 /255.0)*10000)+"%";sfilter.opacity=(100-Math.round((eval(u[6])/100 /255.0)*10000))+"%";sfilter.brightness=(100-Math.round((eval(u[7])/100 /255.0)*20000))+"%";sfilter.contrast=(100-Math.round((eval(u[8])/100 /255.0)*10000))+"%";f=sfilter;}return _get_filter_exp(f);},getFilterString:_get_filter_exp });(function(){var items=[];function __hideSubmenu(q){q.rmClass("igk-show");}function __showSubmenu(q){q.addClass("igk-show");}function __initMenu(q){if(!q||q.data["system/menu"])return;$igk(q.o.parentNode).reg_event("mouseover",function(){__showSubmenu(q);}).reg_event("mouseleave",function(){__hideSubmenu(q);});q.data["system/menu"]=1;}function __init(){$igk("ul.igk-hmenu").select('li ul').each(function(){items.push(this);__initMenu(this);return !0;});}igk.ready(function(){__init();igk.ajx.fn.registerNodeReady(function(){__init();});});})();(function(){igk.system.createNS("igk.ctrl",{initMemoryUsage:function(uri){var p=$igk(igk.getParentScript());var tout=null;function __getMemory(){if(p.o.parentNode==null){return;}if(tout){clearTimeout(tout);tout=null;}igk.ajx.get(uri,null,function(xhr){if(this.isReady()){var pt=igk.createNode("dummy");pt.setHtml(xhr.responseText);var q=$igk(pt.o.children[0]);if(q){p.setHtml(q.getHtml());}setTimeout(__getMemory,2000);}});}igk.ready(__getMemory);}});})();(function(){var s=ns_igk.createNode("input");s.setAttribute("type","file");s.o.id="clFile";s.o.name="clFile";s.addClass("posab");s.setCss({visibility:'hidden'});var _pic=0;igk.system.createNS("igk.system.io",{pickfile:function(uri,p,osrc){$igk(document.body).prepend(s);function __change(){igk.ajx.uploadFile(osrc,s.o.files[0],uri,true,p? p.complete :null,p? p.start:null,p? p.progress:null,p? p.done:null );s.unreg_event('change',__change);s.remove();}s.unreg_event('change',__change);s.reg_event('change',__change);s.o.accept=null;console.debug(p);if(p.accept){s.o.accept=p.accept;}s.o.files=null;s.o.click();_src=null;},getData:function(uri,callback,mimetype){var ob=igk.createNode('object');var __loaded=!1;ob.o.width=100;ob.o.height=100;ob.o.type=mimetype||"text/xml";ob.o.data=uri;ob .addClass("bdr-1");ob.reg_event("loadeddata",function(){console.debug("loaded data : dsss");});ob.reg_event("load",function(evt){if(callback){var o=ob.o;if(ob.o.data==""){console.debug("load error data is empty "+ob.o);var e=callback.error;if(e)e();}else{callback(ob.o);}}ob.remove();});ob.reg_event("error",function(evt){if(__loaded||(igk.navigator.isFirefox()&& igk.navigator.getFirefoxVersion()>=50)){return;}console.error("/!\\ Error when try to load file :"+uri+" : "+ob.o.type);var e=callback.error;if(e)e();});$igk(document.body).prepend(ob);}});igk.system.io.pickfile.getSrc=function(){return _src;};igk.winui.initClassControl("igk-js-pickfile",function(){var q=this;var s=igk.JSON.parse(q.getAttribute("igk:data"));if(s && igk.is_object(s)){this.reg_event("click",function(){igk.system.io.pickfile(s.uri,s.options,q);});}});})();(function(){igk.winui.initClassControl("igk-debuggernode",function(){var q=this;this.reg_event("click",function(){q.setHtml("");});},{desc:"debugger node"});})();(function(){igk.ctrl.registerAttribManager("igk-tooltip",{desc:"for tooltip component"});igk.ctrl.bindAttribManager("igk-tooltip",function(n,m){var p=igk.JSON.parse(m);var q=this;var tip=null;this.reg_event("mouseover",function(evt){if(tip==null)tip=igk.winui.tooltip.show(q,p.data);else tip.show();});});var _tip_offset=200;var _tip_c=1000;function _tip(){var t=igk.createNode("div");t.setOpacity(0.2).addClass("igk-trans-all dispb posab pad-a-4").setCss({zIndex:_tip_offset+_tip_c,padding:"4px",backgroundColor:"white",border:"1px solid black",cursor:"pointer" }).setHtml(" ");var _m_closing=false;var _m_t="";igk.appendProperties(this,{show:function(){if(_m_closing)return;_m_closing=1;t.setOpacity(1.0).setHtml(this.data);var b=this.owner.getScreenBounds();var loc=this.owner.getScreenLocation();t.setCss({left:loc.x+"px",top:(loc.y+(b.h/2))+"px"});document.body.appendChild(t.o);},hide:function(){if(_m_closing==1){t.setOpacity(0.1);}}});var self=this;t.reg_event("mouseover",function(){self.show();}).reg_event("mouseout",function(evt){self.hide();}).reg_event("transitionend",function(evt){if(evt.propertyName=="opacity")if(_m_closing){t.remove();_m_closing=0;}});};igk.winui.tooltip=function(){};igk.system.createNS("igk.winui.tooltip",{show:function(q,data){var d=new _tip();d.data=data;d.owner=q;d.show();return d;}});})();igk.ready(function(){function __load(j){if(j.data["img-js.loaded"]){return !1;}if(j.getisVisible()){j.data["img-js.loaded"]=1;var i=document.createElement("img");$igk(i).reg_event("load",function(evt){console.debug("complete ....");igk.dom.copyAttributes(j.o,i,{'data':1});j.o.parentNode.replaceChild(i,j.o);});i["src"]=j.getAttribute("data");return !0;}return !1;};function __fcScroll(evt){var tab=$igk(evt.target).data["img-js"].items;var _ctab=[];for(var i=0;i<tab.length;i++){var j=tab[i];if(!__load(j)){_ctab.push(j);}}$igk(evt.target).data["img-js"].items=_ctab;if(_ctab.length==0){$igk(evt.target).unreg_event("scroll",__fcScroll);}console.debug(""+tab.length);}$igk(document.body).select("igk-img-js").each(function(){var p=this.o.offsetParent;if(p!=null){var q=$igk(p);if(!q.data["img-js.parentScroll"]){q.reg_event("scroll",__fcScroll);q.data["img-js.parentScroll"]=1;q.data["img-js"]={items:[]};}q.data["img-js"].items.push(this);}return !0;});});(function(){function __fcScroll(q){if(q.loaded||q.loading||!q.getisVisible())return !1;q.loading=!0;igk.ajx.get(q.getAttribute('data'),null,function(xhr){if(this.isReady()){q.loaded=!0;q.loading=false;q.unreg_event("scroll",__load);qh=this.replaceResponseNode(q.o);if(qh)qh.view();}});return !0;};function __load(){var d=$igk(this);var k="igk-scroll-loader.items";var h=d.data[k];if(h.length==0){d.unreg_event("scroll",__load);d.data[k]=null;return;}console.debug("scrolling ..."+h.length);for(var i=0;i<h.length;i++){if(__fcScroll(h[i])){h.splice(i,1);i--;}}}function __init_doc_scrollloader(){$igk(document.body).select("igk-scroll-loader").each(function(){__init_tag(this);return !0;});}function __init_tag(t){var p=null;if(t.data["igk-scroll-loader"])return;p=t.getscrollParent().o;var sk="igk-scroll-loader.parentScroll";if(p!=null){var q=$igk(p);if(!q.data[sk]){q.reg_event("scroll",__load);q.data[sk]=1;q.data["igk-scroll-loader.items"]=[];}var h=q.data["igk-scroll-loader.items"];h.push(t);t.data["igk-scroll-loader"]=1;if(t.getisVisible()){__fcScroll(t);}}else{console.debug("no scrolling ");}}igk.reg_tag_component("igk-scroll-loader",{desc:"scroll loader",func:function(){__init_tag($igk(this));}});igk.ready(__init_doc_scrollloader);})();(function(){igk.ctrl.registerAttribManager("igk:bind-data-ajx",{desc:"used to bind data for selection"});igk.ctrl.bindAttribManager("igk:bind-data-ajx",function(n,m){var q=this;switch(this.o.tagName.toLowerCase()){case 'select':igk.ajx.post(m,null,function(xhr){if(this.isReady()){q.setHtml(xhr.responseText);console.debug(xhr.responseText);}});break;}});})();(function(){function __init_waiter(){var q=this;var _running=true;var _dat=null;igk.appendProperties(this.data,{canva:null,dir:1,penWidth:2,render:function(v,cl,of_set){var w=igk.getNumber(this.canva.getComputedStyle("width"));var h=igk.getNumber(this.canva.getComputedStyle("height"));var v1=0;var v2=0;var cx=w/2;var cy=h/2;var penw=this.penWidth||4;var r=Math.min(w/2,h/2)-(penw/2);this.canva.setAttribute("width",w);this.canva.setAttribute("height",h);var ctx=this.canva.o.getContext('2d');ctx.lineWidth=penw;ctx.clearRect(0,0,w,h);ctx.strokeStyle=''+cl;ctx.beginPath();var offset=-(Math.PI / 2);var _s=_getData();switch(_s.mode){case 2:if(this.dir==1){v1=offset;v2=offset+(2*Math.PI)*v;}else{v1=offset+(2*Math.PI)*(1-v);v2=offset+(2*Math.PI);}break;case 1:if(this.dir==1){v1=offset+(of_set*(Math.PI*2));v2=offset+(2*Math.PI)*v;}else{v1=offset+(2*Math.PI)*(1-v);v2=offset+((2*Math.PI)*(1-of_set));}break;}if(v1!=v2)ctx.arc(cx,cy,r,v1,v2,false);ctx.stroke();delete(ctx);}});function _getData(){if(_dat==null){var _s=q.data.storyboard.getComputedStyle('content',':before');var _t=/^"((.)+)"$/i.exec(_s);_dat=igk.JSON.init_data({stop:'width',mode:1},(_t? _t[1].replace(/\\\"/g,"\""):null),function(s){s.stop=(_t? _t[1]:null)||'width';});q.data.penWidth=q.data.storyboard.getComputedStyle('border-size',':before');}return _dat;}this.data.canva=this.add("canvas").addClass("posab fitw fith loc_t loc_l");this.data.storyboard=this.add("div").addClass("igk-anim-time-board").reg_event("transitionend",function(evt){var _m=_getData();if(evt.propertyName==_m.stop){if(q.data.dir==1){q.data.storyboard.setCss({'width':'0px',height:'0px'}).rpClass("igk-cl-1","igk-cl-2");q.data.dir=-1;}else{q.data.storyboard.setCss({'width':'100px',height:'100px'}).rpClass("igk-cl-2","igk-cl-1");q.data.dir=1;}_running=false;setTimeout(function(){_running=!0;},2000);}}).reg_event("transitionstart",function(evt){}).setCss({"width":"0px","height":"0px"}).addClass("igk-cl-2").setHtml(" ");setTimeout(function(){var n=q.data.storyboard;n.setCss({width:'100px',height:'100px'}).rpClass("igk-cl-2","igk-cl-1");q.data.render(0,'transparent',0);igk.html.canva.animate(function(e){if(!q.data.end){var x=igk.getNumber(n.getComputedStyle("width"));var y=igk.getNumber(n.getComputedStyle("height"));var cl=n.getComputedStyle('color');q.data.render(Math.round((x/100.0)*100)/100,cl,Math.round((y/100.0)*100)/100 );return _running;}q.data.render(1.0,"",1.0);return _running;});},1000);return !0;}igk.winui.initClassControl("igk-circle-waiter",__init_waiter);})();(function(){function _a(p,t){var m=p.select(t).first();var s=p.getscrollParent();var y=0;if(m && s){var cH=s.o.clientHeight;var sT=m.o.parentNode.offsetTop;if(sT>0){if(!(sT<cH)){y=sT-cH+Math.ceil(igk.getNumber(m.getComputedStyle('height')));p.setCss({'transform':'translateY(-'+(y)+'px)'});}}}return y;};function __init_scroll(orn){var q=this;if(q.data["igk-scroll-b"]){throw("already igk-scroll-b init");return;}var cur=q.add("div").addClass("igk-scroll-cur");var p=$igk(q.o.parentNode);var cibling=p.select(this.getAttribute("igk:cibling")).first();var m_spos=0;if(cibling){m_spos=_a(cibling,q.getAttribute("igk:target"));}var m_enable=false;var m_init=0;q.data["igk-scroll-b"]=1;p.addClass("igk-scroll-host");function init_view(){var x=0;var s=0;var t=0;if(orn=='h'){x=p.o.offsetWidth / p.o.scrollWidth;s=Math.max(32,(x*p.o.clientWidth));cur.setCss({width:s+"px"});}else{x=p.o.offsetHeight / p.o.scrollHeight;if(x<1){s=Math.max(32,(x*p.o.clientHeight));cur.setCss({height:s+"px"});}}if(x<1){if(!m_init){if(orn=='v'){t=Math.floor(p.o.offsetHeight*(m_spos / p.o.scrollHeight));cur.setCss({top:t+'px'});}else{t=Math.floor(p.o.offsetWidth*(m_spos / p.o.scrollWidth));cur.setCss({top:t+'px'});}m_init=1;}q.addClass("igk-show");m_enable=1;}else{q.rmClass("igk-show");m_enable=0;var e=__init_data();e.start=0;e.end=0;e.value=0;_u_cur(cur,e,0);}};function __stop_capture(){igk.winui.mouseCapture.releaseCapture();cur.data["s:/msdown"]=null;cur.data["s:/msprop_s"]=null;};igk.android.log.add('is touchable '+p.istouchable());if(p.istouchable()){var tlog=null;var vlog=null;p.reg_event("touchstart",function(evt){if(evt.touches.length==1){tlog=igk.createNode("div");igk.android.log.add(tlog);vlog=igk.createNode("div");igk.android.log.add(vlog);init_view();}}).reg_event("touchend",function(evt){q.rmClass("igk-show");}).reg_event("touchmove",function(evt){var _th=evt.touches[0];}).reg_event("touchcancel",function(evt){});;}var passive=igk.features.supportPassive?{passive:true}:false;p.reg_event("mouseover",function(){init_view();}).reg_event("mouseleave",function(){if(cur.data["s:/msdown"])return;q.rmClass("igk-show");}).reg_event("mouseup",function(evt){if(!p.getScreenBounds().contains(evt.clientX,evt.clientY)){q.rmClass("igk-show");}}).reg_event("mousewheel",function(evt){evt.stopPropagation();evt.preventDefault();if(!m_enable)return;var e=__init_data();e.start=0;e.end=0;e.value=0;var dir=evt.deltaY>0?-1:1;_u_cur(cur,e,dir*10);},false).reg_event("scroll",function(evt){evt.stopPropagation();evt.preventDefault();},false);igk.publisher.register("sys://doc/changed",function(o){if((o.target==p.o)||igk.dom.isChild(o.target,p.o)){__update();}});function __init_data(evt){var x=evt?(orn=="h"?evt.clientX:evt.clientY):0;var f=igk.winui.transform.getData;var c=cibling;var v=c?(orn=="h"?f(c).getX():f(c).getY()):0;return{top:cur.getTop(),start:x,end:x,value:v,childs:p.select('>>')};}function _u_cur(cur,e,y){e.end=y;e.diff=e.end-e.start;var t=e.top+e.diff;var maxt=(q.getHeight()-cur.getHeight());if(t<0)t=0;else t=Math.min(t,maxt);cur.setCss({"top":t+"px"});e.value=(t / maxt);var d=(p.o.scrollHeight-p.o.offsetHeight)*e.value;e.childs.each(function(){if((this !=q)&& !this.data["igk-scroll-b"]){var data=igk.winui.transform.getData(this);data.setTranslateY(-d);this.setCss({"transform":data.toString()});}return !0;});};function __update(){var e=__init_data();var v=e.value*-1;if(!m_init){e.start=0;e.end=0;e.value=0;}_u_cur(cur,e,v);}cur.reg_event("mousedown",function(evt){if(!cur.data["s:/msdown"]){igk.winui.mouseCapture.setCapture(cur.o);cur.data["s:/msdown"]=1;igk.winui.selection.stopselection();var e=__init_data(evt);};if(orn=='h'){e.start=evt.clientX;e.end=evt.clientX;e.left=cur.getLeft();}cur.data["s:/msprop_s"]=e;}).reg_event("mousemove",function(evt){if(cur.data["s:/msdown"]){if(igk.winui.mouseButton(evt)!=igk.winui.mouseButton.Left){return;}e=cur.data["s:/msprop_s"];if(orn=='v'){_u_cur(cur,e,evt.clientY);}else{e.end=evt.clientX;e.diff=e.end-e.start;var t=e.left+e.diff;var maxt=(q.getWidth()-cur.getWidth());if(t<0)t=0;else t=Math.min(t,maxt);cur.setCss({"left":t+"px"});e.value=(t / maxt);var d=(p.o.scrollWidth-p.o.offsetWidth)*e.value;e.childs.each(function(){if((this !=q)&& !this.data["igk-scroll-b"]){var data=igk.winui.transform.getData(this);data.setTranslateX(-d);this.setCss({"transform":data.toString()});}return !0;});}}}).reg_event("mouseup",function(evt){__stop_capture();igk.winui.selection.enableselection();});}igk.winui.initClassControl("igk-vscroll",function(){__init_scroll.apply(this,['v']);},{"desc":"vertical scroll bar"});igk.winui.initClassControl("igk-hscroll",function(){__init_scroll.apply(this,['h']);},{"desc":"horizontal scroll bar"});})();igk.system.createNS("igk.system",{dateTime:function(date){if(!date)return null;function _dateTimeObj(date){this.date=date;igk.appendProperties(this,{format:function(str){var o="";for(var i=0;i<str.length;i++){var m=str[i];switch(m){case "m":o+=this.date.getMinutes();break;case "M":o+=(this.date.getMonth()+1);break;case "d":o+=this.date.getDate();break;case "Y":o+=this.date.getFullYear();break;case "h":o+=this.date.getHours();break;case "s":o+=this.date.getSeconds();break;default:o+=m;}}return o;}});};return new _dateTimeObj(date);}});(function(){var slog=null;igk.system.createNS("igk.android.log",{add:function(m){if(slog==null)return;if(typeof(m)=='string'){var d=new Date();slog.add('div').setHtml(igk.system.dateTime(d).format('d:M:Y')+"=> "+m);}else{slog.add('div').add(m);}},clear:function(m){slog.setHtml('');}});function __initAndroidLog(){if(slog)return;slog=this;igk.android.log.add('start');};igk.winui.initClassControl("igk-android-log",__initAndroidLog);})();(function(){function __transform_data(s){var m0=1,m1=0,m2=0,m3=1,tx=0,ty=0,tz=0;var mz=0;var t='2d';if(/^matrix\(/i.exec(s)){var tb=s.match(/^matrix\((.+)\)$/)[1].split(',');m0=parseFloat(tb[0]);m1=parseFloat(tb[1]);m2=parseFloat(tb[2]);m3=parseFloat(tb[3]);tx=parseFloat(tb[4]);ty=parseFloat(tb[5]);}else if(s=='none'){}else{throw "Matrix not found :::: "+s;}function __get_s(){return "matrix("+m0+","+m1+","+m2+","+m3+","+tx+","+ty+")";};igk.appendProperties(this,{getX:function(){return tx;},getY:function(){return ty;},getz:function(){return tz;},setTranslateX:function(d){tx=d;},setTranslateY:function(d){ty=d;},setTranslateZ:function(d){tz=d;},setScaleX:function(d){m0=d;},setScaleY:function(d){m3=d;},setScaleZ:function(d){},toString:__get_s });};igk.system.createNS("igk.winui.transform",{getData:function(n){var s=$igk(n).getComputedStyle("transform");return new __transform_data(s);}});})();(function(){var s=0;function __no_select(evt){evt.preventDefault();evt.stopPropagation();};igk.system.createNS("igk.winui.selection",{stopselection:function(){igk.winui.selection.clear();if(typeof(document.onselectstart)!='undefined')$igk(document).reg_event('selectstart',__no_select);else if(typeof(document.body.style.MozUserSelect)!='undefined')document.body.style.MozUserSelect='none';s=1;},enableselection:function(){if(typeof(document.onselectstart)!='undefined')$igk(document).unreg_event('selectstart',__no_select);else if(typeof(document.body.style.MozUserSelect)!='undefined')document.body.style.MozUserSelect='';s=0;},clear:function(){var sel=window.getSelection ? window.getSelection():document.selection;if(sel){var fc=sel.removeAllRanges||sel.empty;fc.apply(sel);}}});})();(function(){igk.winui.initClassControl("igk-ctrl-options",function(){});})();(function(){function __init_card_id(){var q=this;var _2PI=igk.math._2PI;var _src=q.getAttribute('igk:link');q.o.removeAttribute('igk:link');var _data={img:_src==null? null:q.add("img").addClass("posab dispn").setAttribute("src",_src).reg_event("load",function(evt){_data.render();q.o.removeAttribute('igk:link');}).reg_event("error",function(evt){console.error("/!\\ Error on loading image "+_src);}),storyline:(function(){var s=q.add("div").addClass("posab dispn story-line");var bg=s.add("div").addClass("posab dispn bg");var bdr=s.add("div").addClass("posab dispn bdr");return{"bg":bg,"bdr":bdr };})(),canva:q.add("canvas"),ctx:null,render:function(w,h){if(this.ctx==null){this.ctx=this.canva.o.getContext('2d');}var w=igk.getNumber(this.canva.getComputedStyle("width"));var h=igk.getNumber(this.canva.getComputedStyle("height"));var v_bdrcl=_data.storyline.bdr.getComputedStyle("color");var v_bg=_data.storyline.bg.getComputedStyle("background-color");var v_bdrs=igk.getNumber(_data.storyline.bdr.getComputedStyle("height"))||4;var _ctx=this.ctx;var cx=w/2;var cy=h/2;var penw=v_bdrs;var minR=Math.min(w/2,h/2);var R=minR-(penw/2);var r=minR-(penw/2)-10;this.canva.setAttribute("width",w);this.canva.setAttribute("height",h);if((R<0)||(r<0))return;_ctx.clearRect(0,0,w,h);_ctx.fillStyle=v_bg;_ctx.arc(cx,cy,R,0,_2PI,false);_ctx.closePath();_ctx.fill();_ctx.save();_ctx.clip();if(this.img && this.img.o.complete){var _W=w-8;var _H=h-8;var zx=_W / this.img.o.width ;var zy=_H / this.img.o.height;var zx=Math.min(zx,zy);_ctx.drawImage(this.img.o,4+((_W-(this.img.o.width*zx))/2),4,this.img.o.width*zx,this.img.o.height*zx);}_ctx.restore();_ctx.strokeStyle=v_bdrcl;_ctx.lineWidth=v_bdrs;console.debug("R is "+R);_ctx.arc(cx,cy,R,0,_2PI,false);_ctx.closePath();_ctx.stroke();}};_data.render();};igk.winui.initClassControl("igk-card-id",__init_card_id,{desc:"igk card id" });})();(function(){igk.system.createNS("igk.balafonjs",{initComponent :function(t){t=t||igk.getParentScript();if(!t)return;var st=igk.winui.getClassList();$igk(t).add("div").setHtml(st);}});igk.ctrl.registerAttribManager("igk-balafonjs",{});igk.ctrl.bindAttribManager("igk-balafonjs",function(m,v){eval(v);});})();(function(){function __init(){var q=this;var def=[];var v_idx=0;var cur=0;var m_roles={};var m_autosweep=0;igk.appendProperties(q,{movenext:function(){if(v_idx<=def.length-1){goTo(def[v_idx]);v_idx++;update_role();}},moveback:function(){if((v_idx>1)&&(def.length>0)){goTo(def[v_idx-2]);v_idx--;update_role();}}});function reg_role(t,n){if(!(t in m_roles)){m_roles[t]=[];}m_roles[t].push(n);};function update_role(){var t=m_roles["prev"];for(var s=0;s<t.length;s++){if(v_idx<=1){t[s].addClass("dispn");}else{t[s].rmClass("dispn");}}t=m_roles["next"];var s=(def.length>0)&&(v_idx<def.length);for(var k=0;k<t.length;k++){if(s){t[k].rmClass("dispn");}else{t[k].addClass("dispn");}}}function goBack(){if(v_idx>0){v_idx--;q.scrollTo(def[v_idx]);}};function goTo(o){q.scrollTo(o.o);cur=o;};q.select(">>").each(function(){if(this.o.tagName && this.o.tagName.toLowerCase()=="div"){var obj=igk.JSON.parse(this.getAttribute("igk-hpageview-data"));var id=this.getAttribute("id")||((def.length+1)+"");def[id]=this;def.push(this);if(!obj){obj={p:null,n:null};}if(m_autosweep){this.reg_event("click",function(){q.movenext();});}}return !0;});q.getParentNode().select("input").each_all(function(){var s=this.getAttribute("igk-hpageview-role");if(s){reg_role(s,this);}});if(def.length>0)v_idx=1;q.scrollTo(def[0]);igk.winui.reg_event(window,"resize",function(){var b=q.getComputedStyle("transition");if(b){q.setTransition("none");}setTimeout(function(){if(cur){goTo(cur);}},2000);});update_role();};igk.winui.initClassControl("igk-hpageview",__init,{desc:"igk-pageview control" });})();(function(){var START_ELEMENT=1;var END_ELEMENT=2;var ATTRIBUTE=3;var TEXT=4;var PROCESSOR=5;var IGK_TAGNAME_CHAR_REGEX=/[0-9a-z\-\:_\.]/;function _html_domProperty(){return{createElement:function(t){return document.createElement(t);},createTextElement:function(v){return document.createTextNode(v);},getNS:function(){return null;}};};igk.system.createNS("igk.dom",{isChild:function(o,p){while(o &&(o!=p)){o=o.parentNode;}return o!=null;},loadDocument:function(txt,p){p=p||_html_domProperty();var c=new igk.dom.reader(txt);var n=null;var root=null;var cnode=null;var o=0;var ns=p.getNS();var stop=1;while(stop && c.read()){switch(c.type){case ATTRIBUTE:for(i in c.attribs){cnode.setAttribute(i,c.attribs[i]);}break;case TEXT:if(cnode){if(cnode.childNodes.length==0){cnode.innerHTML=c.value;}else{cnode.appendChild(p.createTextElement(c.value));}}break;case START_ELEMENT:var m=p.createElement(c.name,c);if(ns){m.setAttribute("xmlns",ns);}if(m.tagName=="SCRIPT"){c.readScript(m);}if(root==null){root=m;cnode=root;}else{if(cnode==null){cnode=p.createElement("dummy");cnode.appendChild(root);root=cnode;cnode.appendChild(m);cnode=m;}else{cnode.appendChild(m);cnode=m;}}break;case END_ELEMENT:if(cnode)cnode=cnode.parentNode;break;default:console.debug("element ignored "+c.type);break;}o++;}return root;},reader:function(txt){this.txt=txt;this.pos=0;this.isEmpty=1;this.hasAttrib=0;this.attribs=null;var self=this;function __canRead(){return((self.pos>=0)&&(self.txt && txt.length>=0)&& (self.pos<self.txt.length));};function __readName(){var v="";while(__canRead()&& IGK_TAGNAME_CHAR_REGEX.exec(self.txt[self.pos])){v+=self.txt[self.pos];self.pos++;}return v;};function __readLine(){var v="";var v_ch=0;while(self.pos<self.txt.length){v_ch=self.txt[self.pos];if(v_ch=="\n"){break;}v+=v_ch;self.pos++;}return v;};function __readAttributes(){var v="";while(__canRead()){v+=self.txt[self.pos];if(v.length>2 &&(v.substring(v.length-2)=="/>")){v=v.substring(0,v.length-2);self.isEmpty=1;break;}else if((v.length>0)&&(v.substring(v.length-1)==">")){v=v.substring(0,v.length-1);self.isEmpty=0;break;}self.pos++;}return igk.system.string.trim(v);};function __readTo(end){var v="";var ln=end.length;while(__canRead()){v+=self.txt[self.pos];if(v.length>=ln &&(v.substring(v.length-ln)==end)){v=v.substring(0,v.length-ln);break;}self.pos++;}return igk.system.string.trim(v);}function __loadAttribs(h){var s={};h.replace(igk.regex().attribs,function(m){var t=m.split('=');var kl=/^("|')/.exec(t[1])? t[1].substring(1,t[1].length-1):t[1];s[t[0]]=kl;});return s;}igk.appendProperties(this,{"name":null,"value":null,"type":null,read:function(){if(this.type==START_ELEMENT){var h=__readAttributes();if(h.length>0){this.hasAttrib=1;this.type=ATTRIBUTE;this.attribs=__loadAttribs(h);return 1;}else if(this.isEmpty){this.type=END_ELEMENT;return 1;}}else if((this.type==ATTRIBUTE)&&(this.isEmpty)){this.type=END_ELEMENT;return 1;}var v_r=1;var v_enter=0;var v_tmp="";while(__canRead()){v_r=0;v_ch=this.txt[this.pos];switch(v_ch){case "<":v_enter=1;break;case ">":if((this.type==ATTRIBUTE)||(this.type==START_ELEMENT)){var c_pos=this.pos++;v_ch="";v_temp=__readTo("<");if(v_temp.length>0){this.type=TEXT;this.value=v_temp;this.isEmpty=false;this.hasAttrib=false;return 1;}else this.pos=c_pos;}break;case "?":if(v_enter){v_tmp=__readTo("?>");}break;case "!":if(v_enter){v_tmp=__readTo("-->");}break;case "/":if(v_enter){this.pos++;this.type=END_ELEMENT;this.name=__readName();this.value=null;this.isEmpty=false;this.hasAttrib=false;return true;}break;default:if(v_enter){if(v_ch==" ")throw new Error("empty char not valid");this.name=__readName();this.value=null;this.type=START_ELEMENT;this.isEmpty=false;this.hasAttrib=false;v_enter=0;return true;}break;}this.pos++;}if(v_r){return false;}return true;},skip:function(){if(this.type==START_ELEMENT){if(!_isEmpty){$n=this.name.lowerCase();var depth=0;var end=0;while(!end && this.Read()){switch(this.type){case START_ELEMENT:depth++;break;case END_ELEMENT:if((!depth)&&(this.name.lowerCase()==n)){end=true;}else if(depth>0)depth--;break;}}return end;}}return 0;},readScript:function(m){var q=this;var v="";var i={};var dx=0;var v_ch=0;var attribs=__readAttributes();if(attribs.length>0){q.type=ATTRIBUTE;q.attribs=__loadAttribs(attribs);for(i in q.attribs){m.setAttribute(i,q.attribs[i]);}}var e=0;while(!e && __canRead()){q.pos++;v_ch=q.txt[q.pos];switch(v_ch){case ">":break;case "<":if(q.txt[q.pos+1]=="/"){q.pos+=2;var n=__readName();if(n.toLowerCase()==m.tagName.toLowerCase()){q.type=END_ELEMENT;q.value=n;e=1;break;}}v+=v_ch;break;case "\'":case '"':var spos=q.pos;while((dx=q.txt.indexOf(v_ch,q.pos+1))!=-1){if(dx>0){if(q.txt[dx-1]=="\\"){q.pos=dx;continue;}}break;}if(dx>spos){v+=q.txt.substr(spos,dx-spos+1);q.pos=dx;}break;case "/":if(q.txt.length-1>q.pos){switch(q.txt[q.pos+1]){case "/":v+=__readLine();break;case "*":dx=q.txt.indexOf("*/",q.pos+2);v+="/*"+q.txt.substr(q.pos,dx-q.pos);q.pos=dx+1;break;}}break;default:v+=v_ch;break;}}m.innerText=v;console.debug("done :"+v);}});},childToArray:function(n){var t=$igk(n).o.childNodes;var o=[];if(t){for(var s=0;s<t.length;s++){o.push(t[s]);}}return o;}});})();(function(){var m_symbols=[];var m_noloads=[];var m_keyloads={};var m_ns="http://www.w3.org/2000/svg";function __loadSvg(text){return igk.dom.loadDocument(text,{createElement:function(tag){return document.createElementNS(m_ns,tag)},getNS:function(){return m_ns;}});};function __init(){var n=this.getAttribute("igk:svg-name");var g=m_symbols[n];if(g){var c=g.clone();c.setAttribute("class",this.getAttribute("class"));this.o.parentNode.replaceChild(c.o,this.o);}else{m_noloads.push(this);var kobj={name:n,t:this};if(!m_keyloads[n])m_keyloads[n]=[];m_keyloads[n].push(kobj);}};function __initsymbol(){var n=this.getAttribute("id");if(!m_symbols[n]){var ot=this.o.outerHTML;var doc=ot? $igk(__loadSvg(ot)):null;if(!doc){m_symbols.push(this);m_symbols[n]=this;}else{m_symbols.push(doc);m_symbols[n]=doc;}if(m_keyloads[n]){for(var ii=0;ii<m_keyloads[n].length;ii++){var t=m_keyloads[n][ii].t;__init.apply(t);}m_keyloads[n]=null;delete(m_keyloads[n]);}}};function __loadSymbols(f,ajx){if(igk.getSettings().nosymbol){return;}igk.io.file.load(f,function(d){if(typeof(d.data)!="string"){if(d.error){return;}}var q=igk.createNode("div").setHtml(d.data);var svg_c=0;var t=q.select(">>").each(function(){if(this.o.tagName){switch(this.o.tagName.toLowerCase()){case "svgs":var m=this;m.select(">> svg").each_all(function(){this.fn.svg=f;__initsymbol.apply(this);});break;case "svg":__initsymbol.apply(this);svg_c++;break;}}return !0;});igk.publisher.publish("sys://svg/lds",{target:this,file:f});});};igk.system.createNS("igk.svg",{loadSymbols:__loadSymbols,append:function(n,t){var sv=igk.svg.newSvg(n);t.add(sv);sv.init();},getLoadedKey:function(){var t=[];for(var i=0;i<m_symbols.length;i++){t.push(m_symbols[i].getAttribute("id"));}return t;},newSvg:function(n){var q=igk.createNode("div");q.setAttribute('igk:svg-name',n).addClass("igk-svg-symbol "+n);return q;}});igk.winui.initClassControl("igk-svg-symbol",__init,{desc:"igk-svg-symbol item. get a symbol from a svg document files and render it to content" });var n=igk.createNode("div");n.addClass("igk-svg-symbol-lists");igk.ready(function(){if(igk.getSettings().nosymbol){return;}document.body.appendChild(n.o);var h=n.getComputedStyle("content",":before");if(h &&(h !='none')){var lst=h.replace(/"/g,'').split(',');for(var i=0;i<lst.length;i++){igk.svg.loadSymbols(lst[i]);}}n.remove();});})();(function(){function __init(){igk.initpowered(this.o);}igk.winui.initClassControl("igk-powered",__init,{desc:"manage powered message" });})();(function(){function __init(){var hr=this.getAttribute("href");var n=this.getAttribute("igk:title");this.reg_event("click",function(){window.open(hr);});this.add(igk.svg.newSvg(n));}igk.winui.initClassControl("igk-comm-lnk",__init,{desc:"represent a communication link node. image will be by default a igk-svg-symbol" });})();(function(){var m_pages=[];function __init(){m_pages.push(this);var s=igk.winui.screenSize();var w=s.width;var h=s.height;_update_i(this,w,h);};function _update_i(k,w,h){var m=k.getComputedStyle("height");k.setCss({height:"auto"});if(k.o.offsetHeight<h){k.setCss({height:h+"px" });}else{k.setCss({height:k.o.offsetHeight+"px" });}}function __update(){var s=igk.winui.screenSize();var w=s.width;var h=s.height;for(var i=0;i<m_pages.length;i++){var k=m_pages[i];_update_i(k,w,h);}}igk.winui.initClassControl("igk-page",__init,{desc:"page management" });igk.winui.reg_event(window,"resize",function(){if(m_pages.length>0){__update();}});})();(function(){igk.winui.initClassControl("igk-js-btn-show-dialog",function(){var _id=this.getAttribute("igk:dialog-id");if(_id){this.reg_event("click",function(evt){ns_igk.winui.showDialog(_id);return !1;});}},{desc:"JS Component to show inline ms dialog button" });})();(function(){function __init_input_regex(ctx){if(!this.o.tagName||(this.o.tagName.toLowerCase()!='input')||! /(text|password|email)/i.exec(this.o.type))return;var q=this;var def="sys://control/inputregex";if(q.data[def]){return !1;}q.data[def]=1;q.data[def+"/class"]=ctx;var _rg=this.getAttribute("igk:char-regex");var _rg_opt=this.getAttribute("igk:char-regex-option")||"i";var _ig=this.getAttribute("igk:input-regex");var _ig_opt=this.getAttribute("igk:input-regex-options")||"i";var _e_msg=this.getAttribute("igk:error-msg");var _e_id_msg=this.getAttribute("igk:error-target-id");var _ms_n=null;if(_ig){_ig=new RegExp("^"+_ig+"$",_ig_opt);this.reg_event("change",function(evt){q.igkCheckIsInvalid();});q.igkIsInvalid=function(){return _ig.exec(q.o.value);};q.igkCheckIsInvalid=function(){if(_ms_n){$igk(_ms_n).remove();_ms_n=null;}if(q.igkIsInvalid()){q.rmClass("igk-invalid");return !1;}else{q.addClass("igk-invalid");_ms_n=igk.createNode('div');_ms_n.addClass("igk-e-msg");if(_e_id_msg){var _st=$igk(_e_id_msg);if(_st){_ms_n.setHtml("?????"+_st.getHtml());}}else{if(_e_msg){_ms_n.setHtml(_e_msg);}}q.insertAfter(_ms_n.o);return !0;}};}if(!_rg)return;var _emsg=this.getAttribute("igk:error-msg");_rg=new RegExp(_rg,_rg_opt);this.reg_event("invalid",function(){q.o.setCustomValidity(_emsg);});this.reg_event("keypress",function(evt){evt.stopPropagation();var c=evt.charCode||evt.keyCode;var ctrlkey=evt.ctrlKey;var altKey=evt.altKey ;var ch=evt.char||evt.key;if(!ctrlkey && !altKey &&(c>31)&& !_rg.exec(ch))evt.preventDefault();return !1;});this.reg_event("input",function(evt){q.o.setCustomValidity("");});this.reg_event("paste",function(evt){if(evt.clipboardData.types<=0)return;var t=evt.clipboardData.types[0];var d=evt.clipboardData.getData("text/plain");for(var i=0;i<d.length;i++){if(!_rg.exec(d[i])){evt.stopPropagation();evt.preventDefault();break;}}return !1;});if(q.o.value)q.igkCheckIsInvalid();return !0;}igk.ctrl.registerAttribManager("igk-input-regex",{desc:"used to validate inform balafon js to validate data",ns:'validation' });igk.ctrl.bindAttribManager("igk-input-regex",function(a,v){if(!v){return;}__init_input_regex.apply(this,['attrib']);});igk.winui.initClassControl("igk-input-regex",function(){if(!this.o.tagName||(this.o.tagName.toLowerCase()!='input'))return;__init_input_regex.apply(this,['class']);},{desc:"JS input-regex component" });})();(function(){function inputdata(target,b){this.target=target;this.options=b;var a=$igk(target);var self=this;function __updatecal(){if(self.options.update)self.options.update(a.o.value);}function __removeSelectedChars(target){var h=(target.value+"");var i=target.selectionStart;target.value=igk.system.string.remove(h,target.selectionStart,target.selectionEnd-target.selectionStart);target.selectionStart=i;target.selectionEnd=i;}a.reg_event("keypress",function(evt){if(evt.key){if(evt.charCode>0){var old=""+evt.target.value;var p=null;var v_update=false;if(evt.target.selectionStart==evt.target.value.length){old=old+""+evt.key;}else{p=evt.target.selectionStart;if(p !=evt.target.selectionEnd){var m=igk.system.string.remove(old,p,evt.target.selectionEnd-p);old=igk.system.string.insert(m,p,evt.key)}else old=igk.system.string.insert(old,p,evt.key);p++;}if(new RegExp(self.options.regex).exec(old)){if(old=="-")evt.target.value="-";else{evt.target.value=old;}v_update=!0;}if(v_update &&(p !=null)){evt.target.selectionStart=p;evt.target.selectionEnd=p;}__updatecal();evt.preventDefault();}else{if(!(evt.keyCode>0)){evt.preventDefault();}else{var s=evt.getPreventDefault();if(!s){var i=evt.target.selectionStart;var h=(evt.target.value+"");switch(evt.keyCode){case 8:if(i>=0){if(h.length==i){evt.target.value=h.substring(0,i-1);}else{if(i==evt.target.selectionEnd){evt.target.value=igk.system.string.remove(h,i-1,1);evt.target.selectionStart=i-1;evt.target.selectionEnd=i-1;}else{__removeSelectedChars(evt.target);}}__updatecal();}evt.preventDefault();break;case 46:if((evt.target.selectionStart==evt.target.selectionEnd)&&(i<h.length)){evt.target.value=igk.system.string.remove(h,i,1);evt.target.selectionStart=i;evt.target.selectionEnd=i;}else if(i !=evt.target.selectionEnd){__removeSelectedChars(evt.target);}__updatecal();evt.preventDefault();break;}}}}}return !1;});}function __init(){var NUMBER_REGEX=/^(-)?([0-9]+)(\.[0-9]*)?$/;var INT_REGEX=/^(-)?([0-9]+)$/;var s=this.getAttribute("igk-input-data");var b=null;b=eval("("+s+")");if(b && b.regex){new inputdata(this,b);}}igk.ctrl.bindAttribManager("igk-input-data",__init);})();(function(){igk.winui.initClassControl("IGK_FROM-sbtn",function(){var q=this;if(q.o.tagName.toLowerCase()=="a"){var f=q.getAttribute("href");var frm=q.getParentByTagName("form");if(frm){q.reg_event("click",function(evt){evt.stopPropagation();evt.preventDefault();if((f=='#')||(f=='')){switch(q.getAttribute("igk:rel")){case "rel":default:frm.reset();break;}}else{frm["action"]=f;frm.submit();}return !1;});}}});igk.winui.initClassControl("IGK_FROM-sbtn-ajx",function(){var q=this;if(q.o.tagName.toLowerCase()=="a"){var f=q.getAttribute("href");var c=0;q.reg_event("click",function(evt){evt.stopPropagation();evt.preventDefault();if(c==0){c=1;igk.ajx.post(f,null,function(xhr){if(this.isReady()){igk.ajx.fn.replace_or_append_to_body.apply(this,arguments);c=0;}});}return !1;});}});})();(function(){igk.winui.initClassControl("igk-ajx-pickfile",function(n,m,o){var q=this;var u=this.getAttribute("igk:uri");if(u==null){console.error("/!\\ igk-ajx-pickfile: no uri found found ");return;}var s=this.getAttribute("igk:param");var p=igk.JSON.parse(s,this);if(q.o.tagName.toLowerCase()=="input"){var n=igk.dom.replaceTagWith(q,"div");var v=q.getAttribute("value");n.setHtml(v? v:"Pick File...");n.o.removeAttribute("value");n.o.removeAttribute("type");n.o.removeAttribute("igk:uri");n.o.removeAttribute("igk:param");q=n;}q.reg_event('click',function(evt){evt.preventDefault();evt.stopPropagation();var cp={};cp.complete=(p ? p.complete :null)||function(s){if(this.isReady()){if(p && p.complete){p.complete.apply(this,[s,q]);}else{this.source=q;igk.ajx.fn.replace_or_append_to_body.apply(this,arguments);}}};cp.progress=p ? p.progress:null;cp.start=p ? p.start:null;cp.accept=p? p.accept:null;igk.system.io.pickfile(u,cp);});},{desc:"Used to pick file in ajx context" });})();(function(){igk.winui.initClassControl("igk-xsl-node",function(o,m){var u=igk.JSON.parse(this.getAttribute("igk:xslt-data"));if(u){var q=this;igk.ready(function(){igk.dom.transformXSLUri(u.xml,u.xsl,function(d){if(u.target){var s=$igk(d).select(u.target);var t=s &&(s.o.length==1)&& s.first();if(t){q.setHtml(t.o.innerHTML);q.select('>>').each_all(function(){igk.ajx.fn.initnode(this.o);});igk.publisher.publish("sys://doc/changed",igk.publisher.createEventData());return;}}q.o.appendChild(d);igk.publisher.publish("sys://doc/changed",igk.publisher.createEventData());});});}},{desc:'used no build xsl node',create:function(xml,xsl){if((!xml)||(!xsl)){throw('Arguments not valid');}var n=igk.createNode('div');n.addClass("igk-xsl-node");n.setAttribute("igk:xslt-data",igk.JSON.convertToString({xml:xml,xsl:xsl}));return n;}});})();(function(){function __update(v){var q=this;var w=igk.getNumber(q.getComputedStyle("width"));var h=igk.getNumber(q.getComputedStyle("height"));var exp=eval('obj='+v+';');this.setCss(exp);}function __init(attr,v){var q=this;var g=null;function __runfix(){__update.apply(q,[v]);};igk.appendProperties(q,{"fix":{"update":__runfix }});igk.winui.reg_event(window,"resize",g=function(){__update.apply(q,[v]);});q.fix.update();igk.publisher.register("sys://html/doc/scroll",__runfix);}igk.ctrl.registerAttribManager("igk-attr-fix-position",{desc:'used to correct element position according to expression'});igk.ctrl.bindAttribManager("igk-attr-fix-position",__init);})();(function(){igk.system.createNS("igk.thread",{wait:function(t,tg,fc){if(t<=0){fc.apply(tg);return;}var s=1;var m=100;function _th_wait_fc(){s=0;fc.apply(tg);};setTimeout(_th_wait_fc,t);}});igk.winui.initClassControl("igk-ajx-uri-loader",function(){var u=this.getAttribute("igk:href");var a=this.getAttribute("igk:append");var self=this;if(u){var lw=this.add("div").addClass("igk-google-line-waiter");var q=$igk(this.o.parentNode);var ta=q.select(a).first();igk.ajx.get(u,null,function(xhr){if(this.isReady()){var x=this;igk.thread.wait(0,xhr,function(){if(a){if(ta){igk.ajx.fn.replace_or_append_to(ta).apply(x,[xhr]);}else igk.ajx.fn.replace_or_append_to(q).apply(x,[xhr]);}else{q.setHtml(xhr.responseText).init();}lw.remove();self.remove();});}},true);}},{desc:'used load uri content in ajx context' });})();(function(){var m_contexts=[];var _params=null;var m_gl=0;var _def=0;var _pause=0;var _log=0;function _Run(ol){var gl=ol.gl;var fc=igk.animation.getAnimationFrame();var e=0;var loop=function(){if(!_pause){ol.listener.tick(gl);e=gl.getError();if(e){throw "render failed cause of an error "+e;}}fc(loop);};fc(loop);};igk.system.createNS("igk.html5.drawing",{gameContextListener:function(){var _p_data=_params;var _canvas=_p_data.canvas;var _self=this;var _p_settings=null;$igk(_canvas).addClass("igk-game-surface");igk.winui.reg_event(window,'resize',function(){_self.updateSize(_p_data.gl);_self.raise("sizeChanged");});_params=null;igk.appendProperties(this,{toString:function(){return "[class: igk.html5.drawing.gameContextListener]";},raise:function(n){var e={target:this};if(arguments.length>1){e.param=arguments[1];}igk.publisher.publish("igk.bge://"+n,e);return this;},on:function(n,callback){igk.publisher.register("igk.bge://"+n,callback);return this;},setBgColor:function(bg){_bgCl=bg;},initContext:function(gl){},initGame:function(gl){},render:function(gl){gl.clearColor(_bgCl.r,_bgCl.g,_bgCl.b,_bgCl.a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);},updateWorld:function(gl){},loadContent:function(gl){},unloadContent:function(gl){},updateSize:function(gl){},tick:function(gl){this.updateWorld(gl);this.render(gl);},capture:function(u,w,h){_pause=1;var c=$igk(this.canvas).getParent().select(".scene").first();var v_bck=$igk(this.canvas).o.style;$igk(this.canvas).setCss({position:"fixed"});this.updateSize(_def.gl,w,h);this.tick(_def.gl);var i=this.canvas.toDataURL();this.updateSize(_def.gl,null,null);$igk(this.canvas).o.style=v_bck;_pause=0;if(u){igk.ajx.post(u,"data="+i,igk.ajx.fn.none);}return i;},fullscreen:function(){var c=$igk(this.canvas);var fc=igk.fn.getItemFunc(c.o,"requestFullScreen");if(fc){this.raise("fullsizeRequest");fc.apply(c.o);}}});igk.defineProperty(this,"canvas",{get:function(){return _canvas;}});igk.defineProperty(this,"gl",{get:function(){return _p_data.gl;}});igk.defineProperty(this,"settings",{get:function(){return _p_settings;}});_currentGame=this;},FreeContext:function(gl){gl=gl||m_gl;if(gl){c=gl.getExtension('WEBGL_lose_context');if(c){c.loseContext();}}if(m_gl==gl)m_gl=null;},CreateContext:function(q,listener){var canvas=q.o;var _ol=listener||q.getAttribute("igk-webgl-game-attr-listener");var gl=canvas.getContext("webgl")||canvas.getContext('experimental-webgl');var _m=$igk(q.o.parentNode).add("div").addClass("scene dispn posfix");var _mcl=_m.getComputedStyle("backgroundColor");var _clbg=igk.system.colorFromString(_m.getComputedStyle("backgroundColor")).toInt();if(!gl){if(igk.navigator.isSafari())return 0;ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle=igk.system.colors.cornflowerblue;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=igk.system.colors.darkblue;ctx.font="12pt courrier new";ctx.fillText("Sorry but your browser does not support WEBGL. try with another one",0,(canvas.height /2),100 );return 0;}delete gl;igk.winui.reg_event(window,"unload",function(){gl=null;q.remove();});if(!canvas.getAttribute("width"))canvas.width=200;if(!canvas.getAttribute("height"))canvas.height=200;_params={canvas:q.o,gl:gl,enable_error_handler:1 };function _createOl(fc){return new fc();};if(_ol){switch(typeof(_ol)){case 'string':{var ns=igk.system.getNS(_ol);if(typeof(ns)=='function'){_ol=_createOl(ns);}else{console.debug("/!\\ No game definition class found. [ "+_ol+" ]");_ol=null;}}break;case "function":_ol=_createOl(_ol);break;}}else{console.error("/!\\ igk-webgl-game-attr-listener not provided. ");_ol=0;}var cl=igk.system.colors.toFloatArray(_clbg);if(!_ol){gl.clearColor(cl.r,cl.g,cl.b,cl.a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);return 0;}else{gl.TRUE=1;gl.FALSE=0;_ol.setBgColor(cl);_ol.initGame(gl);_ol.updateSize(gl);_ol.initContext(gl);_ol.loadContent(gl);var ol={listener:_ol,gl:gl };m_gl=gl;igk.winui.reg_event(window,"unload",function(){igk.html5.drawing.FreeContext(gl);});_def=ol;_Run(ol);}return ol;}});igk.winui.initClassControl("igk-webgl-game-surface",function(){var q=this;setTimeout(function(){var n=q.add(igk.createNode('canvas'));var g=igk.html5.drawing.CreateContext(n,q.o.getAttribute("igk-webgl-game-attr-listener"));if(!g){console.log('/!\\ can not attach webgl to surface . something bad happen');n.remove();return;}q.add(n);g.listener.canvas.setAttribute("id",q.o.getAttribute("id"));q.o.removeAttribute("id");},500);},{desc:'webgl graphic surface',create:function(listener){var n=igk.createNode('canvas');n.addClass('igk-webgl-game-surface');if(listener)n.setAttribute("igk-webgl-game-attr-listener",listener);return n;}});})();(function(){igk.system.createNS("igk.html5",{audioContext :window.AudioContext||window.webkitAudioContext,createWebGLContext:function(c){return c.getContext("webgl")||c.getContext('experimental-webgl');}});var _no_context="no-audio-context";igk.system.createNS("igk.html5.audioBuilder",{getComponents :function(){if(!igk.html5.audioContext)return _no_context;var s=new igk.html5.audioContext();var i=0;var o=[];var m="";if(s){for(var a in s){if(typeof(s[a])=="function" && /^create/.test(a)){if(i)m+=",";m+=a.substring(6);i=1;}}}return m;},getComponentsDescriptionFile:function(){function _getargs(nn){var args={"Buffer":[2,20500,41100],"PeriodicWave":[new Float32Array(3),new Float32Array(3)],"MediaStreamSource":[null],"MediaElementSource":[igk.createNode("audio")]};if(nn in args)return args[nn];return[];};var r=igk.html5.audioBuilder.getComponents();if(r==_no_context)return;var s=new igk.html5.audioContext();var t=r.split(',');var m=igk.createNode("webaudiodef");var k=null;for(var i=0;i<t.length;i++){k=m.add("node");k.setAttribute("Name",t[i]);k.setAttribute("desc","");try{var d=s["create"+t[i]].apply(s,_getargs(t[i]));for(var jj in d){k.add("property").setAttribute("name",jj);}}catch(e){console.debug("error "+e);}}igk.io.file.download("application/xml","data.xml",m.render());return 1;}});})();(function(){function __media_setting(q,b){q.setAttribute("style","display:none !important");var m_inf={};function __media_change(){var c=igk.css.getMediaType();if((c!='global')&& !(c in m_inf)){var d=document.createElement("div");w=igk.getNumber(q.getComputedStyle("width"));h=igk.getNumber(q.getComputedStyle("height"));d.setAttribute("width",w);d.setAttribute("height",h);$igk(d).addClass(q.o.className+" "+c).setCss({width:w+"px",height:h+"px","backgroundImage":"url('"+b+"&w="+w+"&h="+h+"')"});$igk(d).setConfig("igk:callAttribBindingData",1);$igk(d).setConfig("igk:initnode",1);q.o.parentNode.appendChild(d);m_inf[c]=d;}};igk.appendProperties(this,{change:__media_change });igk.publisher.register(igk.publisher.events.mediachanged,this.change);}igk.winui.initClassControl("igk-winui-media-img",function(){var q=this;var b=q.getAttribute("igk:base");var c=new __media_setting(q,b);c.change();});})();(function(){var parallax=[];function __i_parallax(){var q=this;var p=q.getAttribute("igk:param");q.setCss({backgroundImage:"url('"+p+"')",backgroundPosition:"center" });var m=new function(){igk.appendProperties(this,{callback:function(evt){var of;var m_t=$igk(evt.target).getscrollMaxTop();var v_c=q.o;var c_h=q.o.scrollHeight;if(m_t>0)of=parseInt((evt.target.scrollTop/m_t)*100.0);else{of=0;}var p=Math.round((of/200.0)*10)*2;var cl="igk-pos-"+p;if(!(new RegExp(cl+"$")).test(q.o.className)){q.rmAllClass("^igk-pos-(.)+$").addClass(cl);}}});};igk.publisher.register('sys://html/doc/scroll',m.callback);};igk.winui.initClassControl("igk-winui-parallax",__i_parallax);})();(function(){igk.winui.initClassControl("igk-winuin-jsa-ex",function(){if(igk.canInvoke()){this.rmClass("dispn");var q=this;var c=this.getAttribute("igk:data");var p=igk.JSON.parse(c);this.reg_event("click",function(){igk.invoke(p.m,p.args);});}else this.remove();});})();(function(){var dialgs=[];var sk=0;function __close(evt){this.remove();}function n_dialog(g){var q=this;q.options=null;q.closeByEscape=0;q.closeBySubmit=1;igk.appendProperties(this,{mediachanged:function(e){q.initLoc();},close:function(evt){__close.apply(g,evt);var m=0;while(m=dialgs.pop()){if(m==q)break;}},showOpts:function(evt){if(q.options){q.options.toggleClass("dispn");}},initLoc:function(){var W=igk.getNumber(g.getComputedStyle("width"));var w=-(W/2);var h=(-igk.getNumber(g.getComputedStyle("height"))/2);if(W !=igk.winui.screenSize().width){g.setCss({position:"fixed",top:'50%',left:'50%',marginLeft:w+"px",marginTop:h+"px" });}else{g.setCss({position:"absolute",top:'auto',left:'auto',marginLeft:"auto",marginTop:"auto" });}},subfunc:function(frm){return function(evt){evt.preventDefault();igk.ajx.postform(frm.o,frm.getAttribute("action"),function(xhr){if(this.isReady()){if(q.closeBySubmit)__close.apply(g,evt);igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);}});};}});}function __press(evt){if(dialgs.length>0){switch(evt.keyCode){case 27:var m=dialgs[dialgs.length-1];if(m.closeByEscape){m.close();evt.preventDefault();evt.stopPropagation();}break;}}};igk.winui.initClassControl("igk-winui-dialogbox",function(){var g=new n_dialog(this);var v_d=this.getAttribute("igk:data");if(v_d){var e=igk.JSON.parse(v_d);for(var i in g){if(typeof(g[i])=="function")continue;g[i]=e[i];}}this.select(".cls").first().reg_event("click",g.close);var o=this.select(".opts").first().reg_event("click",g.showOpts);g.options=this.select(".d-opts").first();var frm=this.select("form").first();if(frm){frm.reg_event("submit",g.subfunc(frm));frm.select("input").reg_event("keyup keydown keypress",function(evt){if(evt.keyCode==13){evt.preventDefault();return false;}});}if(g.options){g.options.addClass("dispn");g.options.select("a").each_all(function(){var r=this.getAttribute("href");switch(r){case "::close":this.reg_event("click",function(evt){evt.preventDefault();g.close(evt);});break;}});}else{o.addClass("dispn");}this.addClass("posfix ");g.initLoc();igk.publisher.register(igk.publisher.events.mediachanged,g.mediachanged);if(!sk){igk.winui.reg_keypress(__press);}dialgs.push(g);});})();(function(){function _rm_js_hide(){$igk(".igk-js-hide").each_all(function(){this.rmClass("igk-js-hide");});}igk.ready(_rm_js_hide);igk.publisher.register(igk.evts.dom[1],function(d){if(d.evt.target==document.body){_rm_js_hide();}});})();(function(){var c_toast=null;function __transition_end(evt){if((c_toast==null)||(evt.target !=c_toast.o)||(evt.propertyName !="opacity"))return;igk.winui.unreg_event(c_toast,"transitionend",__transition_end);c_toast.remove();c_toast=null;};function __init_toast(){if(c_toast){igk.winui.unreg_event(c_toast,"transitionend",__transition_end);c_toast.remove();}var i=this.getHtml();if(this.getAttribute("noHide"))return;this.setCss({opacity:1.0 });var q=this;var _fo=0;setTimeout(function(){if(_fo)return;c_toast=q;igk.winui.reg_event(q,"transitionend",__transition_end);q.setCss({opacity:0.0});_fo=1;},3000);};igk.system.createNS("igk.winui.controls",{toast:function(){}});igk.winui.controls.toast.initDemo=function(){var d=igk.createNode("div").addClass("igk-winui-toast");d.setHtml("Toast Demonstration");$igk(document.body).add(d);d.init();};igk.winui.initClassControl("igk-winui-toast",__init_toast);})();(function(){igk.winui.initClassControl("framebox-dialog",function(n,s){var d=igk.JSON.parse(this.getAttribute("data"));if(!d){d={w:null,h:null};}this.select(".framebox-title").each(function(){igk.ctrl.selectionmanagement.disable_selection(this.o);});igk.winui.framebox.init(this.o,d.w,d.h);});})();(function(){igk.system.createNS("igk.winui.stateBtn",{init:function(q){var o=$igk(q.o.parentNode).select('input').first().o;q.reg_event("click",function(e){e.stopPropagation();e.preventDefault();o.click();});}});})();(function(){function __init_function(){var self=this;var s=this.getAttribute("igk:target");var tv=this.select(">>").first();var _initl=[];var fc=function(t){var c=this;if(t.target==self.o){for(var i=0;i<_initl.length;i++){_initl[i].init();}igk.publisher.unregister("sys://node/init",c.caller);}};igk.publisher.register("sys://node/init",fc);if(s && tv){this.remove();var m={d:s};var q=eval(s+";");if(q){var g=$igk(q);if(g.isSr()){var i=0;g.each_all(function(){var _ie=tv;if(i){_ie=tv.clone();}this.o.parentNode.replaceChild(_ie.o,this.o );_initl.push(_ie);i=1;});}else{g.o.parentNode.replaceChild(tv.o,g.o );}}}}igk.winui.initClassControl("igk-ajx-update-view",__init_function);})();(function(){function __init_function(){var self=this;var s=this.getAttribute("igk:target");var tv=this.select(">>");if(!s||(tv.getCount()==0))return;var q=eval(s+";");if(q){if(q.isSr()){q.each_all(function(){var m=this;tv.each_all(function(){m.add(this.clone());});});}else{tv.each_all(function(){q.add(this.clone());});}}}igk.winui.initClassControl("igk-ajx-append-view",__init_function);})();(function(){var m_item={};function __init_svg_i(){var n=this.getAttribute("igk:svg-name");if(m_item[n]){var g=$igk(m_item[n]).clone();this.o.parentNode.replaceChild(g.o,this.o);}else{console.debug("item not found :"+n);}};function __initlist(){for(var i=0;i<this.o.childNodes.length;i++){var j=this.o.childNodes[i];m_item[j.tagName.toLowerCase()]=$igk(j).select("svg").first();}this.remove();};function __init_svg_l(){$igk(document.body).select(".igk-svg-lst").each_all(__initlist);var s=$igk(document.body).add("style");s.o["type"]="text/css";}igk.ready(__init_svg_l);igk.winui.initClassControl("igk-svg-lst",function(){__initlist.apply(this);});igk.ajx.fn.initBeforeReady(function(){$igk(this).select(".igk-svg-lst").each_all(__initlist);});igk.winui.initClassControl("igk-svg-lst-i",__init_svg_i);})();(function(){igk.ajx.fn.registerNodeReady(function(){if(!this.tagName||this.tagName.toLowerCase()!="style")return;var f=$igk("#"+$igk(this).getAttribute("igk:from")).first();if(f){f.setHtml(this.innerHTML);$igk(this).remove();}});})();(function(){var iframes=[];function __init_iframe(){var f=igk.createNode("iframe");igk.dom.copyAttributes(this.o,f.o);f.reg_event("error",function(){}).reg_event("load",function(){});igk.dom.replaceChild(this.o,f.o);};igk.ready(function(){$igk(document.body).select("igk-iframe").each_all(__init_iframe);});})();(function(){function __init_ptr_btn(){var q=this;var g=igk.JSON.parse(q.getAttribute("igk:data"));var u=0;if(g){if(typeof(g)=='string')u=g;else u=g.uri;}this.reg_event('click',function(e){if(u){ns_igk.winui.print(u);}else{igk.winui.reg_event(window,'beforeprint',function(e){console.debug("before print");console.debug(e);});window.print();}igk.stop_event(e);});};igk.winui.initClassControl('igk-ptr-btn',__init_ptr_btn);})();(function(){igk.winui.initClassControl('igk-ajx-replace-source',function(){var s=igk.ajx.getCurrentXhr().source;if(!s)return;var d=this.getAttribute("igk:data");var sl=s.select(d);var o=this.getHtml();sl.setHtml(o).init();this.remove();});})();(function(){var doc_e=0;var m_d=0;igk.winui.initClassControl("igk-winui-popup-menu",function(){var d=igk.createNode("div");d.addClass("igk-guide-menu posfix igk-sm-only igk-xsm-only menu").setCss({"backgroundColor":"black","bottom":"0px"});var dc=$igk(document.body);var attr=0;this.reg_event("click",function(evt){dc.prepend(d);attr=this.getAttribute("igk:target");var c=$igk(attr).first();if(c){d.setHtml("<ul>"+c.getHtml()+"</ul>");d.toggleClass("igk-show");}evt.stopPropagation();evt.preventDefault();m_d=d;});if(!doc_e){igk.winui.reg_event(document,"click",function(){if(m_d && m_d.supportClass("igk-show"))m_d.rmClass("igk-show");});doc_e=1;}});})();(function(){function __render_xml_view_tag(q,n){var tab=[];var s=0;var m=0;var tb=0;var attrs=0;tab.push({n:n,p:q,l:0});while(s=tab.pop()){if(s.e){console.debug("end");m=igk.createNode("div").addClass("l");m.add("span").setHtml("&lt;");m.add("span").addClass("tag").setHtml(s.n.tagName.toLowerCase());m.add("span").setHtml("/&gt;");s.p.add(m);continue;}switch(s.n.nodeType){case 1:if(s.n.tagName){m=igk.createNode("div").addClass("l");m.add("span").setHtml("&lt;");m.add("span").addClass("tag").setHtml(s.n.tagName.toLowerCase());if(s.n.hasAttributes){attrs=s.n.attributes;for(var ai=0;ai<attrs.length;ai++){var la=m.add("span").addClass("attr");la.add("span").addClass("n").setHtml(attrs[ai].name);la.add("span").setHtml("=");la.add("span").addClass("v").setHtml("\""+attrs[ai].value+"\"");}}s.p.add(m);}else{m=igk.createNode("span");m.setHtml("NoTAG ");s.p.add(m);}var tb=s.n.childNodes;if((tb.length==0)||(s.n.innerHTML.trim()=="")){m.add("span").setHtml("/&gt;");}else{m.add("span").setHtml("&gt;");var quote=m.add("quote");tab.push({n:s.n,e:1,p:m});for(var mm=tb.length-1;mm>=0;mm--){tab.push({n:tb[mm],p:quote,l:s.l+1});}}break;case 3:break;case 8:var d=s.p.add("div");d.add("span").setHtml("&lt;").addClass("pr");d.add("span").setHtml(s.n.nodeValue);d.add("span").setHtml("&gt;").addClass("pr");break;}}}igk.winui.initClassControl("igk-xml-viewer",function(){if(this.getAttribute("igk:loaded"))return;var t=igk.dom.childToArray(this);this.setHtml("");for(var i=0;i<t.length;i++){var b=t[i];__render_xml_view_tag(this,b);}console.debug(t.length);});})();"uses strict";igk.system.createNS("igk.winui.paneview",{loadfromUri :function(target,uri){(new function(target,uri){this.target=target;this.uri=uri;this.load=function(){var t=this.target;igk.ajx.get(this.uri,null,function(xhr){if(this.isReady()){t.innerHTML=xhr.responseText;igk.winui.paneview.init(t.target);}});}}(target,uri)).load();},init:function(parent){var p=parent? parent:igk.getParentScript();var s=$igk(p).select(".pane-view-groupitem");var prop={interval:20,duration:200,speed :1,orientation:"vertical"};function __viewType(evt,index){var t=this.getAttribute("pane-view-type");var tab=this.getElementsByTagName("div");switch(t){case "fade":if(index==1){igk.animation.fadeout(tab[0],20,500,1.0);igk.animation.fadein(tab[1],20,500,0.0);}else{igk.animation.fadeout(tab[1],20,500,1.0);igk.animation.fadein(tab[0],20,500,0.0);}break;case "scrollh":prop.orientation="horizontal";$igk(this).scrollTo(tab[index],prop);break;case "scroll":default:prop.orientation="vertical";$igk(this).scrollTo(tab[index],prop);break;}evt.stopPropagation();}s.each(function(){var t=this.getAttribute("pane-view-type");switch(t){case "fade":$igk(this).addClass("posr");var s=$igk(this).select(".pane-view-block");s.each(function(){$igk(this).addClass("posab loc_t loc_l");return true;});s.getNodeAt(0).style.zIndex=1;s.getNodeAt(1).style.zIndex=0;break;case "scrollh":this.addClass("nowrap");var s=$igk(this).select(".pane-view-block");s.each(function(){$igk(this).addClass("dispib");return true;});break;}this.reg_event("mouseover",function(evt){__viewType.call(this,evt,1);});this.reg_event("mouseout",function(evt){var e=evt.toElement||evt.relatedTarget;if((e)&&((e.parentNode==this)||(e==this))){return;}__viewType.call(this,evt,0);});return true;});}});"use strict";(function(){igk.system.createNS("igk.winui.ajxview",{init:function(uri,func){(function(q){$ns_igk.ready(function(){$ns_igk.ajx.apost(uri,null,function(xhr){if(this.isReady()){var s=igk.createNode("dummy");var t=igk.utils.getBodyContent(xhr.responseText);if(func)func.apply(this,[{response:s}]);else{$igk(q).setHtml(t);igk.ajx.fn.initnode(q);}}})});})($ns_igk.getParentScript());}});})();"uses strict";(function(){igk.system.createNS("igk.winui.controls",{init :function(){var t=document.getElementsByTagName("textarea");for(var i=0;i<t.length;i++){var s=t[i].getAttribute("defaulttext");if(s){new igk.winui.controls.textareamanager(t[i],s);}}},textareamanager:function(item,text){this.item=item;this.tip=text;this.text="";var q=this;function update(){if(q.text.length==0){q.item.value=q.tip;q.item.selectionStart=0;q.item.selectionEnd=0;$igk(q.item).addClass("cltextareatip");$igk(q.item).setCss({color:"gray"});}else{$igk(q.item).rmClass("cltextareatip");$igk(q.item).setCss({color:"black"});}};function updateKey(evt){q.text=this.value;update();};function keypress(evt){evt.preventDefault();evt.stopPropagation();igk.show_prop(evt);q.text=this.value;console.debug(q.text);};function updatedown(evt){if(q.text.length==0){if(evt.key.length==1){q.text=evt.key;q.item.value=q.text;q.item.selectionStart=1;q.item.selectionEnd=1;}evt.preventDefault();}}$igk(this.item).reg_event("change",update);$igk(this.item).reg_event("keyup",updateKey);$igk(this.item).reg_event("keydown",updatedown);update();}});igk.ready(igk.winui.controls.init);})();igk.system.createNS("igk.winui.navigationbar",{fitfix :function(node,parent){var t=$igk(node);var l=$igk(parent);if(t){t.setCss({"position":"fixed","right":(l.fn.hasVScrollBar()? l.fn.vscrollWidth()+1 :0)+"px","bottom":((l.fn.hasHScrollBar()? l.fn.hscrollHeight()+1:0))+"px","top":"auto" });}},init:function(node,parent,properties){if((node==null)||(parent==null))return ;var m_node=node;var m_parent=parent;var m_properties=igk.utils.getv(properties,"properties",{duration:1000,interval:20,"orientation":"vertical"});var m_autodetect=igk.utils.getv(properties,"autodetect",true);var m_autonavigate=igk.utils.getv(properties,"autonavigate",true);var m_dictionary=[];var m_manual_scroll=true;var m_scrollTimeout=null;var m_currentpage=null;function __initLink(info){igk.appendProperties(this,info);var self=this;this.detectview=function(){var y=$igk(m_parent).getscrollTop();var t=$igk(this.target);var m=t.o.offsetHeight;var cy=t.getLocation().y;var vH=y-cy;if(this.selected){if(!((vH>=0)&&(vH<m))){self.selected=false;if(this.bgview)igk.animation.fadeout(this.bgview.o,20,500,1.0,function(){self.selected=false;});}}else{if((vH>=0)&&(vH<m)){self.selected=true;var s=(""+self.a.href).split('#')[1];m_currentpage=s.split('/')[1];var v_uri=(document.location+"").split('?')[0].split("#")[0];window.history.pushState({"html":"data","pageTitle":v_uri+"#"+s},"",v_uri+"#"+s);if(this.bgview){igk.animation.fadein(this.bgview.o,20,500,0.0,function(){self.selected=true;});}}}};if(this.options){if(this.options.scroll){var func=function(){self.options.scroll(self,m_parent);};igk.winui.reg_event(m_parent,"scroll",func);func();}}if(!this.options||!this.options.nomenu){this.bgview=$igk(this.a.parentNode).add("div",{"className":"posab fitw fith loc_l loc_t zback navigationbg","class":"posab fitw fith loc_l loc_t zback navigationbg" });this.bgview.setOpacity(0.0);}this.a.onfocus=function(){this.blur();return false;};this.a.onclick=function(){var a=self.a;if(document.location !=a.href){var s=(""+document.location).split('?')[0].split("#")[0];var hash=(""+a.href).split('#')[1];document.location.href=s+"#"+hash;__navigateTo();}else{__navigateTo();}return false;}};function __gettarget(n){if(m_dictionary[n])return m_dictionary[n].target;return null;};function __navigateTo(){var l=(""+document.location);if(/#\//.exec(l)){var n=l.split('#/')[1];if(m_currentpage !=n){m_currentpage=n;var i=$igk(__gettarget(n));if(i){m_manual_scroll=false;$igk(m_parent).scrollTo(i.o,m_properties,function(){__detectnode();m_manual_scroll=true;});}}else{var i=$igk(__gettarget(n));if(i){m_manual_scroll=false;$igk(m_parent).scrollTo(i.o,m_properties,function(){__detectnode();m_manual_scroll=true;});}}}};function __detectnode(){if(!m_autodetect)return;for(var i=0;i<m_dictionary.length;i++){m_dictionary[i].detectview();}}(function(node){var v_nodes=node.getElementsByTagName("a");var v_key=null;var v_taget=null;var v_ainfo=null;var p=m_node;for(var i=0;i<v_nodes.length ;i++){v_a=v_nodes[i];if(/#/.exec(v_a.href)){n=v_a.href.split('#')[1];v_key=((v_key=v_a.getAttribute("igk-navigation-key"))==null)? n:v_key;v_target=v_a.getAttribute("igk-navigation-target");if(m_parent.id==v_target){hp=$igk(m_parent);}else hp=$igk(m_parent).getChildById(v_target);if(hp==null){continue;}v_ainfo={"name":n,"offset":0,"target":hp,"targetname" :v_target,"options":igk.JSON.parse(v_a.getAttribute("igk-navigation-options")),"a":v_a,"allownavigation":true,"selected":false };if(!v_ainfo.options||!v_ainfo.options.nomenu){v_ainfo.allownavigation=false;}v_a.href="#/"+v_key;m_dictionary[v_key]=new __initLink(v_ainfo);m_dictionary.push(m_dictionary[v_key]);}}if(p){var m_eventContext=igk.winui.RegEventContext(p);if(m_eventContext){m_eventContext.reg_window("hashchange",function(){__navigateTo();});m_eventContext.reg_window("load",function(){if(m_autonavigate)__navigateTo();});m_eventContext.reg_window("resize",function(){if(m_autonavigate)__navigateTo();});m_eventContext.reg_event(m_parent,"scroll",function(){if(m_manual_scroll){if(m_scrollTimeout)clearTimeout(m_scrollTimeout);m_scrollTimeout=setTimeout(__detectnode,100);}});}__detectnode();if(m_autonavigate){__navigateTo();}}})(m_node);}});(function(){igk.system.createNS("igk.winui.querytextbox",{init:function(target,uri){if(target==null)return;var m_target=target;var m_uri=uri;function querytextboxobj(){var m_target=target;var m_uri=uri;var q=this;this.ajx=null;this.update=update;this.view=document.createElement("div");this.ul=null;m_target.parentNode.appendChild(this.view);$igk(m_target).reg_event("keyup",function(evt){q.update(this.value);});function _hideDiv(){$igk(q.view).setCss({display:"none"});}function _changeValue(select){m_target.value=select[select.selectedIndex].innerHTML;_hideDiv();}function _updateValue(value){m_target.value=value;_hideDiv();}function update(){if(this.ajx!=null)this.ajx.xhr.abort();this.ajx=igk.ajx.apost(m_uri+"&t="+m_target.value,null,function(xhr){if(this.isReady()){var loc=$igk(m_target).getScreenLocation();$igk(q.view).setCss({display:"block",position:"fixed",left:(loc.x)+"px",top:(loc.y+m_target.clientHeight+2)+"px",minWidth:m_target.clientWidth+"px",maxHeight:"200px",overflow:"auto",overflowX:"hidden",zIndex :1010,backgroundColor :"white" });q.ajx=null;if(q.ul==null){q.ul=document.createElement("ul");$igk(q.ul).addClass("clselect dispb fitw fith");}var md=document.createElement("div");md.innerHTML=xhr.responseText;md=md.getElementsByTagName("response")[0];$igk(md).select("item").replaceTagWith("li" ).each(function(){var a=document.createElement("a");var name=this.getAttribute("name");var desc=this.getAttribute("description");var value=this.getHtmlContent();var idata="";if(name){idata+="<span>"+name+"</span>";}if(desc){idata+="<div>"+desc+"</div>";}a.innerHTML=idata;a.href="#";a.setAttribute("value",value);this.setHtmlContent("");this.o.appendChild(a);return this;});q.view.innerHTML="";q.view.appendChild(q.ul);q.ul.innerHTML=md.innerHTML;$igk(q.ul).select("a").each(function(){this.addClass("queryboxitem dispb fitw").reg_event("click",function(evt){_updateValue($igk(this).getAttribute("value"));evt.preventDefault();});return this;});}});};};return new querytextboxobj(target,uri);}});})();igk.system.createNS("igk.winui.utils",{fixfit:function(node,parent,properties){var t=$igk(node);var l=$igk(parent);if(t){if(properties==null){t.setCss({"right":(l.fn.hasVScrollBar()? l.fn.vscrollWidth()+"px" :"0px")});t.setCss({"bottom":((l.fn.hasHScrollBar()? l.fn.hscrollHeight():0))+"px"});t.setCss({"top":"auto"});}else{if(properties.right)t.setCss({"right":(l.fn.hasVScrollBar()? l.fn.vscrollWidth():0)+"px"});if(properties.bottom)t.setCss({"bottom":(l.fn.hasHScrollBar()? l.fn.hscrollHeight():0)+"px"});}}}});(function(){if(igk.winui.paginationview)return;var popstate=0;var current=[];igk.system.createNS("igk.winui.paginationview",{init:function(){function _page_ready(q,i,t,cl,r){return function(xhr){if(this.isReady()){if(i.target)q.select(i.target).setHtml(xhr.responseText).init();else igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);if(typeof(r)=='undefined'){igk.winui.history.push(t,{title:'change','igk-rol':'pagination','olduri':cl},'history page ');}else{igk.winui.history.replace(t);}var p=$igk('.location').first();if(p){p.setHtml(cl);}}};};var q=$igk(igk.getParentScript());var i=igk.initObj(igk.JSON.parse(q.getAttribute("igk:data")),{baseuri:window.location.href,ajx:0,history:0,refresh:0,cookie:0 });var uri=encodeURI(i.baseuri).replace("?",'\\?');i.regex=new RegExp("^"+uri+"");if(!popstate){igk.winui.reg_event(window,'popstate',function(e){var du=document.location.href;var ldu=du+(du.indexOf("?")!=-1 ? "?":"")+"?reset=1";if(i.cookie){var nc='local_com/'+i.cookie;igk.web.rmcookies(nc);}if(i.regex.test(document.location.href)){igk.ajx.get(du,null,_page_ready(q,i,du,du,1));current.pop();}else{current.pop();current.push(document.location.href);igk.ajx.get(ldu,null,_page_ready(q,i,du,du,1));}e.preventDefault();e.stopPropagation();return;});popstate=1;}q.select("span").each_all(function(){this.addClass("igk-btn").reg_event("click",function(e){e.preventDefault();e.stopPropagation();var c=this.getAttribute("rol");var u=i.baseuri;var t=0;if(!c){t=u+this.innerHTML;}else{var s=i.selected;switch(c){case "next":if(s<i.max)t=u+(s+1);break;case "prev":if(s>i.min)t=u+(s-1);break;}}if(t){if(i.ajx){var cl=document.location.href;if(t==cl){if(i.refresh){igk.ajx.get(t,null,null);}}else{igk.ajx.get(t,null,_page_ready(q,i,t,cl));current.push(t);}}else{document.location=t;}}});});}});})();(function(){window.igk.system.createNS("igk.web",{"a_posturi":function(item,uri,callback){var self=null;var func=(callback==null)?null:function(xhr){callback.apply(this,[xhr,item ]);};var __self={'target':item,post:function(){if(igk.ajx){igk.ajx.post(uri,null,func);}}};__self.post();return false;}});})();igk.system.createNS("igk.media.webplayer",{init:function(target,uri,width,height){target.style.backgroundImage="url('"+uri+"')";var img=document.createElement("img");img.src=uri;var m_imgw=img.width;img=null;target.style.backgroundRepeat="no-repeat";target.style.width=width? width:"32px";target.style.height=height? height:"32px";function __construct(){var m_timeout=null;var m_isplaying=false;var m_pos=0;var m_width=m_imgw;this.target=target;this.play=function(){var q=this;m_isplaying=true;q.update();};this.update=function(){if(m_isplaying){m_pos=(m_pos+32)% m_width;var q=this;this.target.style.backgroundPosition=-m_pos+"px 0px";m_timeout=setTimeout(function(){q.update()},72);}};this.pause=function(){clearTimeout(m_timeout);m_isplaying=false;};this.stop=function(){this.pause();m_pos=0;};}var o=new __construct();o.play();return o;}});"uses strict;";(function(){var m_ei;igk.system.createNS("igk.winui",{textEdit:function(t,o){var q=$igk(t);if(q && !q.isTextEdit)q.isTextEdit=1;else{return;}function _restore(g){g.o.parentNode.replaceChild(q.o,g.o);m_ei=null;delete(g.o);}function _edit(){if(m_ei){m_ei.restore();m_ei=null;}var g=igk.createNode("input");g.addClass("igk-textedit");g.o['id']=o.id;g.o["value"]=q.getHtml();g.reg_event("keypress",function(e){switch(e.keyCode){case 27:_restore(g);break;case 13:igk.ajx.post(o.uri,o.id+"="+g.o.value,function(xhr){if(this.isReady()){q.setHtml(g.o["value"]);_restore(g);igk.ajx.fn.replace_or_append_to_body.apply(this,[xhr]);}});break;}});q.o.parentNode.replaceChild(g.o,q.o);m_ei={q:q,g:g,restore:function(){_restore(this.g);}};};q.reg_event("click",function(e){e.preventDefault();e.stopPropagation();_edit();});this.edit=_edit;}});igk.system.createNS("igk.winui.textEdit",{getCurrent:function(){return m_ei;}});function __itextEdit(){var q=this;var o=igk.JSON.parse(q.getAttribute("igk:data"));var ce=new igk.winui.textEdit(q,o);};igk.winui.initClassControl("igk-textedit",__itextEdit);})();"use strict";(function(){var m_items=[];function __loadSymbols(data,symLoader){var gkds=new igk.wo.gkds();gkds.canva=igk.createNode("canvas");var xml=$igk(igk.createNode("dummy").setHtml(data).o.getElementsByTagName("gkds")[0]);var m_node=null;if(xml){var s=xml.select("documents").select(">>");s.each(function(){if(this.o.tagName &&(this.o.tagName.toLowerCase()=="layerdocument")){var doc=new igk.wo.documents(gkds);doc.load(this);doc.id=this.getAttribute("id");doc.gkds=gkds;m_items.push(doc);}return true;});m_node=xml;}symLoader.loadItems(m_items);__initglobalsymbol();}function __symbolLoader(uri,p){var ob=igk.createNode("object");var m_init=false;ob.addClass("no-visible bdr-1 dispb posab");ob.setCss({"width":"48px","height":"48px"});var m_data=null;var self=this;var m_items=[];var m_rdata=false;ob.reg_event("error",function(evt){console.error("/!\\ Error : [ igk.gkds.symbolManager] - Loading symbols failed.... "+uri);});function _r_fc(evt){if(!ob.o.contentDocument||ob.o.contentDocument.readyState!="complete")return;if(!ob.o.contentDocument.childNodes)return;m_rdata=true;var c=ob.o.contentDocument.childNodes.length;var dummy=igk.createNode("dummy");while(c>0){dummy.o.appendChild(ob.o.contentDocument.childNodes[0]);c--;}m_data=dummy.getHtml();if(m_data==null){return;}__loadSymbols(m_data,self);ob.remove();ob=null;};if(typeof(ob.o.onload)!='undefined'){ob.reg_event("load",_r_fc);}else ob.reg_event("readystatechange",_r_fc);if(!m_init||(ob.o.parentNode !=document.body)){ob.o.type="text/xml";ob.o.width=1;ob.o.height=1;igk.ready(function(){if(igk.getSettings().nosymbol){$igk(".igk-symbol").each_all(function(){this.addClass("dispn");this.remove();});return;}if(igk.navigator.isIEEdge()){$igk(document.body).prepend(ob);ob.o.data=uri;}else{ob.o.data=uri;$igk(document.body).prepend(ob);}});m_init=true;}igk.appendProperties(this,{getSymbolBitmapData:function(id,w,h,p){var c=m_items[id];if(!c)return null;if(igk.is_notdef(w)){w=100;}if(igk.is_notdef(h)){h=100;}c.gkds.canva.o.width=w;c.gkds.canva.o.height=h;var ctx=c.gkds.canva.o.getContext('2d');ctx.clearRect(0,0,100,100);ctx.scale(w/100.0,h/100.0);var s={fillStyle:p && p.fillStyle ? p.fillStyle :"#f0f",fillOpacity:p && p.fillOpacity? p.fillOpacity :1,strokeStyle:p && p.strokeStyle? p.strokeStyle :"#000",strokeOpacity:p && p.strokeOpacity? p.strokeOpacity :"0",fillMode:p && p.fillMode? p.fillMode :"evenodd",base:1 };c.render(c.gkds.canva,ctx,s);var h=c.gkds.canva.o.toDataURL();return "url('"+h+"')";},loadItems:function(tab){for(var i=0;i<tab.length;i++){if(!m_items[tab[i].id])m_items.push(tab[i]);m_items[tab[i].id]=tab[i];}m_isloaded=true;igk.publisher.publish("sys://gkds/itemloaded");if(p && p.complete)p.complete.apply(this);}});}var m_loader=null;var m_isloaded=false;igk.system.createNS("igk.gkds.symbolManager",{load:function(uri,p){},getIsLoaded:function(){return m_isloaded;},getSymbolBitmapData:function(id,w,h,p){if(m_loader){return m_loader.getSymbolBitmapData(id,w,h,p);}return null;}});function __init_symbol(){var d=this.getHtml();var t=d.charCodeAt(0).toString(16)+"";t=igk.system.string.padleft(t,"0",3);var self=this;var cl=self.getComputedStyle("color");var op=self.getComputedStyle("opacity");var s=igk.JSON.parse(self.getAttribute("igk-symbol-data"));this.setHtml(" ");function __view(){m_re=true;__store();__render();m_re=false;};function __render(){var w=s? s.w :igk.getNumber(self.getComputedStyle('width'));var h=s? s.h :igk.getNumber(self.getComputedStyle('height'));var cl=self.getComputedStyle('color');self.setCss({backgroundImage:igk.gkds.symbolManager.getSymbolBitmapData('_'+t,w,h,{fillStyle:cl,fillOpacity:1.0,fillMode:'nonzero',strokeStyle:s && s.strokeStyle? s.strokeStyle:"#000",strokeOpacity:s && s.strokeOpaticy? s.strokeOpacity:0.0 })});}var data={color:0,content:'' };function __store(){for(var i in data){data[i]=self.getComputedStyle(i);}}__store();var m_re=false;if(igk.navigator.isSafari()){}else if(this.o.addEventListener){if(MutationObserver){var mut=new MutationObserver(function(mutation){});mut.observe(this.o,{attributes:1});}else{this.o.addEventListener("DOMAttrModified",function(evt){if(m_re){return;}var n=evt.attrName;if((n=="style")||(n=="class")){var r=false;for(var i in data){if(data[i]!=self.getComputedStyle(i)){r=true;break;}}if(r){__view();}}});}}this.data["igk-symbol-init"]=1;if(igk.gkds.symbolManager.getIsLoaded()){__render();}else{var _f=function(){__render();};igk.publisher.register("sys://gkds/itemloaded",_f);}}function __initglobalsymbol(){if(m_items.length<=0)return;var i=0;$igk(".igk-symbol").each(function(){if(!this.data["igk-symbol-init"]){__init_symbol.apply(this);}i++;return true;});};igk.ajx.fn.registerNodeReady(__initglobalsymbol);})();"uses stricts";(function(){var _gameButtons=["A","B","X","Y","LB","RB","LT","RT","SL","SM","L3","R3","PadT","PadB","PadL","PadR"];var _playerKey=["One","Two","Three","Four"];var _gamePads=[];var gamePadButton={};var j=0;for(var i in _gameButtons){gamePadButton[_gameButtons[i]]=j++;}var _getPadsFunc=(function(){if(navigator.getGamepads)return function(){return navigator.getGamepads();};if(window.webKitNavigator && webKitNavigator.getGamepads)return function(){webKitNavigator.getGamepads();};return null;})();if(!_getPadsFunc){console.error('/!\\ no gamepad available');igk.system.createNS("igk.html5.input",{gamePads:function(){return undefined;}});return;}var m_manager=null;igk.system.createNS("igk.html5.input",{gamePads:function(){if(m_manager)return m_manager;if(this instanceof igk.object){if(m_manager==null)return new igk.html5.input.gamePads();}igk.appendProperties(this,{update:function(){var _pads=_getPadsFunc();var _p=null;var _pi=null;for(var i=0;i<_pads.length;i++){_p=_pads[i];if(_p){if(_p.mapping=="standard"){_pi="player"+_playerKey[_p.index];if(this[_pi])this[_pi].update(_p);else this[_pi]=new __gameInput(_p);}}}}});m_manager=this;}});igk.defineProperty(igk.html5.input,"gameButtons",{get:function(){return gamePadButton;}});function __gameInput(pad){var m_gamepad=pad;var m_downkeys=[];igk.appendProperties(this,{isKeyPressed:function(a){return m_gamepad.buttons[a].pressed;},isKeyRelease:function(a){if(this.isKeyPressed(a)){m_downkeys[a]=1;return 0;}if(m_downkeys[a]){m_downkeys[a]=0;return 1;}return 0;},keyValue:function(a){return m_gamepad.buttons[a].value;},update:function(pad,release){m_gamepad=pad;}});function __toStringAxe(){return "{x:"+this.x+"y:"+this.y+"}";};igk.defineProperty(this,"LAxe",{get:function(){return{x:m_gamepad.axes[0],y:m_gamepad.axes[1],toString:__toStringAxe};}});igk.defineProperty(this,"RAxe",{get:function(){return{x:m_gamepad.axes[2],y:m_gamepad.axes[3],toString:__toStringAxe};}});}})();"use strict";(function(){igk.winui.initClassControl("igk-webaudio",function(){var q=this;var _ol=q.getAttribute("igk-webaudio-attr-listener");if(_ol &&(typeof(_ol)=='string')){var ns=igk.system.getNS(_ol);if(typeof(ns)=='function'){_ol=new ns();}}else{console.error("/!\\ igk-webaudio-attr-listener not found or not valid: !"+_ol);}},{"desc":"init a webaudio control" });})();"use strict";(function(){var static_canva;var _sfigure=0;function __append_bezier(ctx,x1,y1,x2,y2,x3,y3){ctx.bezierCurveTo(x1,y1,x2,y2,x3,y3);}function gdip_near_zero(v){return((v>=-0.0001)&&(v<=0.0001));}function append_ellipse(ctx,x,y,width,height){var rx=width / 2.0;var ry=height / 2.0;var cx=x+rx;var cy=y+ry;var C1=0.552285;cx.moveTo(cx+rx,cy);__append_bezier(ctx,cx+rx,cy-C1*ry,cx+C1*rx,cy-ry,cx,cy-ry);__append_bezier(ctx,cx-C1*rx,cy-ry,cx-rx,cy-C1*ry,cx-rx,cy);__append_bezier(ctx,cx-rx,cy+C1*ry,cx-C1*rx,cy+ry,cx,cy+ry);__append_bezier(ctx,cx+C1*rx,cy+ry,cx+rx,cy+C1*ry,cx+rx,cy);close_figure();};function __append_arcs(ctx,x,y,width,height,startAngle,sweepAngle){var i;var drawn=0;var increment;var endAngle;var enough=false;if(Math.abs(sweepAngle)>=360){__append_ellipse(ctx,x,y,width,height);return;}endAngle=startAngle+sweepAngle;increment=(endAngle<startAngle)?-90 :90;for(i=0;i<4;i++){var current=startAngle+drawn;var additional;if(enough)return;additional=endAngle-current;if(Math.abs(additional)>90){additional=increment;}else{if(gdip_near_zero(additional))return;enough=true;}__append_arc(ctx,_sfigure &&(i==0),x,y,width,height,current,current+additional);drawn+=additional;}}function __append_arc(ctx,start,x,y,width,height,startAngle,endAngle){var _2PI=(Math.PI*2);var M_PI=3.14159265358979323846;var delta,bcp;var sin_alpha,sin_beta,cos_alpha,cos_beta;var rx=width / 2;var ry=height / 2;var cx=x+rx;var cy=y+ry;var alpha=(startAngle*Math.PI / 180.0);var beta=(endAngle*Math.PI / 180.0);alpha=Math.atan2(rx*Math.sin(alpha),ry*Math.cos(alpha));beta=Math.atan2(rx*Math.sin(beta),ry*Math.cos(beta));if(Math.abs(beta-alpha)>M_PI){if(beta>alpha)beta-=_2PI;else alpha-=_2PI;}delta=beta-alpha;bcp=(4.0 / 3*(1-Math.cos(delta / 2))/ Math.sin(delta / 2));sin_alpha=Math.sin(alpha);sin_beta=Math.sin(beta);cos_alpha=Math.cos(alpha);cos_beta=Math.cos(beta);if(start){var sx=(cx+rx*cos_alpha);var sy=(cy+ry*sin_alpha);ctx.moveTo(sx,sy);}__append_bezier(ctx,(cx+rx*(cos_alpha-bcp*sin_alpha)),(cy+ry*(sin_alpha+bcp*cos_alpha)),(cx+rx*(cos_beta+bcp*sin_beta)),(cy+ry*(sin_beta-bcp*cos_beta)),(cx+rx*cos_beta),(cy+ry*sin_beta));}function __addArc(ctx,rc,starta,sweepa){__append_arcs(ctx,rc.x,rc.y,rc.w,rc.h,starta,sweepa);};function __build_round_rec(ctx,rc,rounddef){var vtl_dx=!rounddef?0.1:Math.max(rounddef.topLeft.x*2,0.1);var vtl_dy=!rounddef?0.1:Math.max(rounddef.topLeft.y*2,0.1);var vtr_dx=!rounddef?0.1:Math.max(rounddef.topRight.x*2,0.1);var vtr_dy=!rounddef?0.1:Math.max(rounddef.topRight.y*2,0.1);var vbr_dx=!rounddef?0.1:Math.max(rounddef.bottomRight.x*2,0.1);var vbr_dy=!rounddef?0.1:Math.max(rounddef.bottomRight.y*2,0.1);var vbl_dx=!rounddef?0.1:Math.max(rounddef.bottomLeft.x*2,0.1);var vbl_dy=!rounddef?0.1:Math.max(rounddef.bottomLeft.y*2,0.1);_sfigure=1;ctx.beginPath();__addArc(ctx,{x:rc.x,y:rc.y,w:vtl_dx,h:vtl_dy},180.0,90.0);_sfigure=0;ctx.lineTo(rc.x+rc.w-rounddef.topRight.x,rc.y);__addArc(ctx,{x:rc.x+rc.w-vtr_dx,y:rc.y,w:vtr_dx,h:vtr_dy},-90.0,90.0);ctx.lineTo(rc.x+rc.w,rc.y+rc.h-(vbr_dy/2.0));__addArc(ctx,{x:rc.x+rc.w-vbr_dx,y:rc.y+rc.h-vbr_dy,w:vbr_dx,h:vbr_dy},0.0,90.0);ctx.lineTo(rc.x+(vbl_dx/2.0),rc.y+rc.h);__addArc(ctx,{x:rc.x,y:rc.y+rc.h-vbl_dy,w:vbl_dx,h:vbl_dy},90.0,90.0);ctx.lineTo(rc.x,rc.y+(vtl_dy/2.0));ctx.closePath();};function _build_rec(ctx,x,y,w,h){ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+w,y);ctx.lineTo(x+w,y+h);ctx.lineTo(x,y+h);ctx.closePath();};function _build_circle(ctx,c,r){ctx.beginPath();ctx.arc(c.x,c.y,r,0,Math.PI*2,false);ctx.closePath();};igk.system.createNS("igk.html.canva",{canvaDocument:function(){igk.appendProperties(this,{index:0,toString:function(){return "canvaDocument";}});return this;},canvaObj :function(id,code){this.id=id;this.code=code;this.matrix=new function(){this.m_matrix=new igk.math.matrix3x3();var self=this;this.transform=function(v_context){var e=self.m_matrix.getElements();v_context.setTransform(e[0],e[1],e[3],e[4],e[6],e[7]);};this.reset=function(){self.m_matrix.reset();};this.rotate=function(angle){self.m_matrix.rotate(angle);};this.translate=function(dx,dy){self.m_matrix.translate(dx,dy,0);};this.scale=function(ex,ey){self.m_matrix.scale(ex,ey,1);};this.toString=function(){return "canvaObjInternalMatrix";};};igk.appendProperties(this,{render:function(v_context){if(!v_context){return;}v_context.save();this.matrix.transform(v_context);eval(this.code);v_context.restore();},translate:function(x,y){this.matrix.translate(x,y);},resetTransform:function(){this.matrix.reset();}});},canvaObjDocument:function(context,width,height){if(context==null)throw new Exception("canvaObjDocument require a context");var m_count=0;var m_childs=[];var m_names={};var m_context=context;var m_w=width;var m_h=height;var self=this;igk.appendProperties(this,{getCount:function(){return m_childs.length;},getElementById:function(id){var e=null;for(var i=0;i<m_childs.length;i++){e=m_childs[i];if(e.id==id)return e;}return null;},render:function(v_context){for(var i in m_childs){m_childs[i].render(v_context);}},add:function(id,v_code){if(!m_names[id]){var t=new igk.html.canva.canvaObj(id,v_code);m_names[id]=t;m_childs.push(t);}},update:function(){m_context.clearRect(0,0,m_w,m_h);this.render(m_context);},toString:function(){return "canvaObjDocument" }});},drawText:function(cx,t,x,y,ft,st,maxwith){cx.font=ft;cx.fillStyle=st;cx.fillText(t,x,y,maxwith);},buildCircle:_build_circle,buildRect:_build_rec,drawRoundRec:function(cx,rc,rounddef,close){__build_round_rec(cx,rc,rounddef);cx.stroke();},drawRect2p:function(cx,sp,ep){_build_rec(cx,Math.min(sp.x,ep.x),Math.min(sp.y,ep.y),Math.abs(sp.x-ep.x),Math.abs(sp.y-ep.y));cx.stroke();},fillRect2p:function(cx,sp,ep){_build_rec(cx,Math.min(sp.x,ep.x),Math.min(sp.y,ep.y),Math.abs(sp.x-ep.x),Math.abs(sp.y-ep.y));cx.fill();},drawLine:function(cx,st,en){cx.beginPath();cx.moveTo(st.x,st.y);cx.lineTo(en.x,en.y);cx.stroke();},fillRoundRec:function(cx,rc,rounddef,close){cx.beginPath();cx.moveTo(rc.x,rc.y);__addArc(cx,rc,180,270);if(close)cx.closePath();cx.fill('evenodd');},drawArc:function(cx,rc,starta,sweepa){__addArc(cx,rc,starta,sweepa);cx.stroke();},fillArc:function(cx,rc,starta,sweepa){__addArc(cx,rc,starta,sweepa);cx.fill('eventodd');},loadObj:function(uri,callback){igk.ajx.get(uri,null,function(xhr){if(this.isReady()){var obj=eval(xhr.responseText);if(obj && obj.length==1){callback(obj[0]);}}});}});var coph=null;function __init_gkds_canva_obj(){var self=this;var a=this.getAttribute("igk-canva-gkds-obj-data");var data=igk.JSON.parse(a);if(data){this.setTransition(data.transition||"all 1s ease-in-out");igk.html.canva.loadObj(data.uri,function(o){if(typeof(o.length)=='undefined'){self.setHtml("");var c=self.add("canvas");var p={canva:c,obj:o,getElementById:function(id){var q=this.obj;var l=null;var j=0;var m=0;var i=0;var p=null;while(q){if(q.id &&(q.id==id))return q;if((m==0)&& q.layers){m=1;l=q.layers[j];p=q;j++;i=0;q=l[i];i++;continue;}else{if(m==1){if(i<l.length){q=l[i];i++;continue;}else if(j<p.layers.length){l=p.layers[j];j++;i=0;q=l[i];i++;continue;}}}break;}},render:function(ini){if(this.rendering)return;var ctx=this.canva.o.getContext("2d");var q=this;var w=this.canva.o.width;var h=this.canva.o.height;function __render(){ctx.clearRect(0,0,w,h);if(data.init)data.init.apply(self,[ctx]);igk.html.canva.render_document_obj(ctx,q.obj);};function __transition(evt){complete=true;q.rendering=false;self.unreg_event('transitionend',__transition);};if(ini||(getComputedStyle(self.o)['transitionDuration']=="0s")){__render();}else{var complete=false;self.reg_event('transitionend',__transition);igk.html.canva.animate(function(t){__render();return !complete;});q.rendering=true;}}};igk.appendProperties(self.data,{"igk-canva-gkds-obj":p });p.render(true);self.reg_event("mouseenter",function(){p.render();});self.reg_event("mouseout",function(){if(igk.navigator.isFireFox()){setTimeout(function(){p.render();},20);}else p.render();});}});}}igk.system.createNS("igk.html.canva",{render_document_obj:function(ctx,obj){var v_ctx=ctx;for(var i=0;i<obj.layers.length;i++){var l=obj.layers[i];for(var j=0;j<l.length;j++){eval(l[j].p);ctx.fill("evenodd");ctx.stroke();}}}});igk.winui.initClassControl("igk-canva-gkds-obj",function(){__init_gkds_canva_obj.apply(this);},{desc:"item to render canva object"});})();window.igk.system.createNS("igk.html",{appendFile :function(target,fileobj){switch(fileobj.type){case "image/jpeg":var img=document.createElement("img");img.src=window.URL.createObjectURL(fileobj);img.alt=fileobj.name;target.appendChild(img);break;}},URL :window.URL? window.URL :window.webkitURL });(function(){igk.system.createNS("igk.gkds.io.icwjs",{read:function(canva,uri){var v_ctx=canva.getContext('2d');igk.ajx.post(uri,null,function(xhr){if(this.isReady()){eval("(function(){"+xhr.responseText+"})();");}});}});})();"use strict";(function(){var m_offscreen=igk.createNode('canvas');function __addPolygon(tab){var d="";d+="ctx.moveTo("+tab[0].x+", "+tab[0].y+");";for(var i=1;i<tab.length;i++){d+="ctx.lineTo("+tab[i].x+", "+tab[i].y+");";}return d;}function __addClosedCurve(tab,t){var d="";var ctangents=__GetCurveTangents(1,tab,tab.length,t,false);d+=__appendCurve(tab,ctangents,0,tab.length,true);return d;}function __GetCurveTangents(terms,points,count,tension,open){var coefficient=tension /3.0;var tangents=[];if(count<=2)return tangents;for(var i=0;i<count;i++){var r=i+1;var s=i-1;if(r>=count){if(!open)r=0;else r=count-1;}if(open){if(s<0)s=0;}else{if(s<0)s+=count;}tangents[i]=new igk.math.vector2d((coefficient*(points[r].x-points[s].x)),(coefficient*(points[r].y-points[s].y)));}return tangents;}function append_bezier(x1,y1,x2,y2,x3,y3){return "ctx.bezierCurveTo("+x1+", "+y1+", "+x2+", "+y2+", "+x3+", "+y3+");";}function close_figure(){return "";}function __appendCurve(points,tangents,startindex,Length,closed){var ptype=((closed)||(points.length==0))? 0 :1 ;var i,x1,x2,x3,y1,y2,y3;var d="";d+="ctx.moveTo("+points[0].x+", "+points[0].y+");";for(i=startindex;i<startindex+Length-1;i++){var j=i+1;x1=points[i].x+tangents[i].x;y1=points[i].y+tangents[i].y;x2=points[j].x-tangents[j].x;y2=points[j].y-tangents[j].y;x3=points[j].x;y3=points[j].y;d+=append_bezier(x1,y1,x2,y2,x3,y3);}if(closed){x1=points[i].x+tangents[i].x;y1=points[i].y+tangents[i].y;x2=points[0].x-tangents[0].x;y2=points[0].y-tangents[0].y;x3=points[0].x;y3=points[0].y;d+=append_bezier(x1,y1,x2,y2,x3,y3);d+=close_figure();}return d;};igk.system.createNS("igk.wo",{renderitem:function(){var m_childs=[];var m_n=null;var m_p=null;var m_matrix=new igk.wo.gkds.matrix();function __getFillBrush(m){var b=igk.wo.gkds.extractdef(m.trim());var d="";if(b==null)return d;if(b.Type){switch(b.Type.toLowerCase()){case "solid":d+="ctx.fillStyle = '"+window.igk.system.colorFromString(b.Colors)+"';";var a=ns_igk.system.colorGetA(b.Colors);if(a<1){d+="ctx.globalAlpha = "+a+";";}return d;case "lineargradient":d+="if (!grd) var grd =null; grd = ctx.createLinearGradient(0, 0, 150, 0);";var tb=b.Colors.split(' ');for(var i=0;i<tb.length;i++){var cl=tb[i];d+="grd.addColorStop("+i+",  '"+window.igk.system.colorFromString(cl)+"');";}d+="ctx.fillStyle = grd;";break;}}return d;};igk.appendProperties(this,{$super:this,contains:function(x,y){var ctx=m_offscreen.o.getContext('2d');return false;},toString:function(){if(m_n){return "gkdsitem#"+m_n.o.tagName+":"+this.getType();}return "gkdsitem";},getType:function(){return "no-type";},getParent:function(){return m_p;},getGkds:function(){if(m_gkds!=null)return m_gkds;return m_p ? m_p.getGkds():null;},clear:function(){m_childs=[];},loadChilds:function(n){var ln=n.o.childNodes.length;for(var i=0;i<ln;i++){var b=n.o.childNodes[i];if(b.tagName){var k=b.tagName.toLowerCase();var ii=igk.wo.gkds.createItem(k,$igk(b));if(ii!=null){m_childs.push(ii);ii.m_p=this;}}}},load:function(n){if(!n)return;m_n=$igk(n);m_n.gkds=this;if(n.o.childNodes){this.loadChilds(n);}this.initialize();},initialize:function(){},loadMatrix:function(){var m=this.o.getAttribute("Matrix");if(m){this.Matrix.loadMatrixs(m);return this.Matrix.getCode();}return "";},getFillStyle:function(){var m=this.o.getAttribute("FillBrush");if(m){return __getFillBrush(m);}return "ctx.fillStyle = \"white\";";},getStrokeStyle:function(){var m=this.o.getAttribute("StrokeBrush");if(!m){return "ctx.strokeStyle = \"black\"; ctx.globalAlpha=0;";}var b=igk.wo.gkds.extractdef(m.trim());var d="";if(b.Width){d+="ctx.lineWidth= "+b.Width+";";}if(b.Type){switch(b.Type.toLowerCase()){case "solid":var cl=ns_igk.system.colorFromString(b.Colors);d+="ctx.strokeStyle = \""+cl+"\";";var a=ns_igk.system.colorGetA(b.Colors);if(a<1){d+=" ctx.globalAlpha = "+a+"; ";}break;}}return d;},getFillMode:function(){var m=this.o.getAttribute("FillMode");if(m=="Alternate"){}return "evenodd";},getStrokeM:function(){var d="ctx.lineCap = \"butt\";";d+="ctx.lineJoin = \"miter\";";return d;},renderStyle:function(style){if(style==null)return "";var d="";var fg=style.base ? "ctx.fillStyle = '"+style.fillStyle+"';":this.getFillStyle();var fs=style.base ? "ctx.strokeStyle = '"+style.strokeStyle+"';":this.getStrokeStyle();var sm=style.base ? style.strokeMode :this.getStrokeM();var fm=style.base ? style.fillMode :this.getFillMode();if(style.base){d+="ctx.globalAlpha=1;";d+=fg;if(typeof(style.fillOpacity)!="undefined"){d+="ctx.globalAlpha="+style.fillOpacity+";";}d+="ctx.fill(\""+fm+"\");";d+=fs;if(typeof(style.strokeOpacity)!="undefined"){d+="ctx.globalAlpha="+style.strokeOpacity+";";}d+="ctx.stroke();";}else{if(style.fillStyle !=fg){style.fillStyle=fg;}d+="ctx.globalAlpha=1;";d+=fg;if(style.fillMode !=fm){style.fillMode+=fm;}d+="ctx.fill(\""+fm+"\");";if(style.strokeStyle !=fs){style.strokeStyle+=fs;}d+=fs;if(style.strokeMode !=sm){style.strokeMode=sm;d+=sm;}d+="ctx.stroke();";}return d;},render:function(c,ctx,style){ctx.save();if(m_childs.length>0){for(var i=0;i<m_childs.length;i++){m_childs[i].render(c,ctx,style);}}ctx.restore();}});igk.defineProperty(this,"o",{get:function(){return m_n;}});igk.defineProperty(this,"Matrix",{get:function(){return m_matrix;}});},document:function(){igk.wo.renderitem.apply(this);},layer:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getType:function(){return "layer";}});},nonvisible:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getType:function(){return "nonvisible";}});},documents:function(gkds){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getGkds:function(){return gkds;}});},circle:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getCode:function(){return "";},loadMatrix:function(){var m=this.o.getAttribute("Matrix");if(m){this.Matrix.loadMatrixs(m);return this.Matrix.getCode();}return "";},render:function(c,ctx,style){var cx=0,cy=0;var t=igk.math.vector2d.parse(this.o.getAttribute("Center"));var r=igk.wo.gkds.radius(this.o.getAttribute("Radius"));var d="";d=this.loadMatrix();cx=t.x;cy=t.y;if(typeof(r)!="object")d+=" ctx.beginPath(); ctx.arc(cx, cy, "+r+",0, 2*Math.PI, false); ctx.closePath();";else{for(var i=0;i<r.length;i++){d+="ctx.beginPath();";if(i>0){var b=parseFloat(cx)+parseFloat(r[i]);d+="ctx.moveTo("+b+", cy);";}if((i>0)&&((i%2)!=0)){d+="  ctx.arc(cx, cy, "+r[i]+",0, -2*Math.PI, false);";}else d+="  ctx.arc(cx, cy, "+r[i]+",0, 2*Math.PI, false);";d+="ctx.closePath();";}d+="ctx.closePath();";}ctx.save();eval(d+" "+this.renderStyle(style));ctx.restore();},getType:function(){return "circle";}});},star:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getCode:function(){return "";},render:function(c,ctx,style){var PI_C=Math.PI/180.0;var t=this.o.getAttribute("Tension");var et=igk.bool_parse(this.o.getAttribute("EnableTension"));var oa=(this.o.getAttribute("OffsetAngle")||0)*PI_C;var fm=this.o.getAttribute("FillMode");var vc=igk.math.vector2d.parse(this.o.getAttribute("Center"));var a=(this.o.getAttribute("Angle")||0)*PI_C;var count=(this.o.getAttribute("Count")||5)*2;var ir=parseFloat(this.o.getAttribute("InnerRadius"));var or=parseFloat(this.o.getAttribute("OuterRadius"));var step=(360/count)*PI_C;var d="";d=this.loadMatrix();d+="ctx.beginPath();";var vtab=[];for(var i=0;i<count;i++){if((i% 2)==0){vtab.push(new igk.math.vector2d((vc.x+(ir*Math.cos((i*step)+(a+oa)))),(vc.y+(ir*Math.sin((i*step)+a+oa)))));}else {vtab.push(new igk.math.vector2d((vc.x+(or*Math.cos(i*step+a))),(vc.y+(or*Math.sin(i*step+a)))));}}if(vtab.length>1){if(et)d+=__addClosedCurve(vtab,t);else d+=__addPolygon(vtab);}d+="ctx.closePath();";ctx.save();eval(d+" "+this.renderStyle(style));ctx.restore();}});},polygon:function(){igk.wo.renderitem.apply(this);var c_center;var c_radius;var c_count;var c_angle;var c_etension;var c_tension;var c_def="";igk.appendProperties(this,{initialize:function(n){c_count=parseInt($igk(this.o).getAttribute("count"))||5;c_angle=parseFloat($igk(this.o).getAttribute("angle"))||0;c_radius=$igk(this.o).getAttribute("radius").split(';');c_etension=$igk(this.o).getAttribute("enabletension");c_tension=parseFloat($igk(this.o).getAttribute("tension"))||0;c_center=igk.math.vector2d.parse($igk(this.o).getAttribute("center"));c_def="";if(c_count<=2)return;var vtab=new Array(c_count);var step=(360 / c_count)*(Math.PI / 180.0);var v_angle=(c_angle*Math.PI/ 180.0);var rd=0;for(var j=0;j<c_radius.length;j++){for(var i=0;i<c_count;i++){rd=igk.math.vector2d.parse(c_radius[j]);vtab[i]=new igk.math.vector2d((c_center.x+rd.x*Math.cos(i*step+v_angle)),(c_center.y+rd.y*Math.sin(i*step+v_angle)));}if(c_etension){c_def+=__addClosedCurve(vtab,c_tension);}else c_def+=__addPolygon(vtab);}},render:function(c,ctx,style){var d="";d=this.loadMatrix();d+="ctx.beginPath();";d+=c_def;d+="ctx.closePath();";ctx.save();eval(d+" "+this.renderStyle(style));ctx.restore();}});},rectangle:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{getCode:function(){return "";},render:function(c,ctx,style){var x=0,y=0,w=0,h=0;var t=igk.wo.gkds.rectangle(this.o.getAttribute("Bounds"));var d="";d=this.loadMatrix();var x=t.x;var y=t.y;var w=t.w;var h=t.h;d+="ctx.beginPath();";d+=" ctx.rect(x,y,w,h);";d+="ctx.closePath();";ctx.save();eval(d+" "+this.renderStyle(style));ctx.restore();}});},arc:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{});},ellipse:function(){igk.wo.renderitem.apply(this);igk.appendProperties(this,{});},path:function(){igk.wo.renderitem.apply(this);var types=[];var points=[];igk.appendProperties(this,{loadChilds:function(n){},initialize:function(n){var p=this.o.getElementsByTagName('PointTypes')[0];var st=p.innerHTML;types=igk.system.string.split(st+"",';');points=$igk(this.o.getElementsByTagName('Points')[0]).getHtml().split(' ');if(types.length !=points.length){console.debug("can't create path. length miss match");return false;}},render:function(c,ctx,style){var d="";d=this.loadMatrix();d+="ctx.beginPath();";var close=0;var v_bezierPoint=[];function _jointBezier(pts){var s="";for(var i=0;i<pts.length;i++){if(i !=0)s+=",";s+=pts[i].x+", "+pts[i].y;}return s;};function _getPoint(pts){var pt=pts.split(';');pt[0]=parseFloat(pt[0]);pt[1]=parseFloat(pt[1]);return new igk.math.vector2d(pt[0],pt[1]);};function _getBezierCurve(tab){var q0,q1,q2;if(tab.length==4){q0=tab[1];q1=tab[2];q2=tab[3];}else{q0=tab[0];q1=tab[1];q2=tab[2];}var d="ctx.bezierCurveTo("+_jointBezier([q0,q1,q2])+");";return d;};var phc=0;var revert=0;function __pushdata(data){d+=data;};function __get_reservesePoint(types,points,dat){var ct=[];var cp=[];var index=dat.i;ct.push(types[index]);cp.push(points[index]);var i=dat.i+1;var l=1;while(i<types.length){ct.push(types[i]);cp.push(points[i]);if((types[i]& 0x80)==0x80)break;i++;l++;}ct.reverse();cp.reverse();var loffset=0;for(var j=0;j<ct.length;j++){if(ct[j]==0)types[index+j]=0x80+loffset;else if((ct[j]& 0x80)==0x80){loffset=(ct[j]-0x80);types[index+j]=0;}else types[index+j]=ct[j];points[index+j]=cp[j];}dat.ct=ct;dat.cp=cp;dat.l=l;return "/*reverse data*/";}var safreverse=false;for(var i=0 ;i<types.length;i++){close=0;var pt=_getPoint(points[i]);var t=parseInt(types[i]);if(t==0){phc++;if(safreverse &&((phc%2)==0)){revert=1;var dat={i:i};d+=__get_reservesePoint(types,points,dat);i=dat.i;}}switch(t){case 0:v_bezierPoint=[];__pushdata("ctx.moveTo("+pt.x+", "+pt.y+");");break;case 1:if(v_bezierPoint.length>0){console.debug("there are unfinshed bezier "+v_bezierPoint.length);if(v_bezierPoint==3){v_bezierPoint.push(pt);__pushdata(_getBezierCurve(v_bezierPoint));}}__pushdata("ctx.lineTo("+pt.x+", "+pt.y+");");v_bezierPoint=[];break;case 3:v_bezierPoint.push(pt);switch(v_bezierPoint.length){case 3:__pushdata(_getBezierCurve(v_bezierPoint));v_bezierPoint=[];break;}break;default:var end=false;if((t & 32)==32){t-=32;}if((t & 0x80)==0x80){t-=0x80;end=true;}if(end){switch(t){case 1:__pushdata("ctx.lineTo("+pt.x+", "+pt.y+");");break;case 3:switch(v_bezierPoint.length){case 2:v_bezierPoint.push(pt);__pushdata(_getBezierCurve(v_bezierPoint));break;default:console.debug("error ...."+v_bezierPoint.length);break;}break;}v_bezierPoint=[];d+="ctx.closePath();";}break;}}d+=" ";d+="ctx.closePath();";d+=" "+this.renderStyle(style);ctx.save();eval(d);ctx.restore();}});},gkds:function(){var m_items=[];var m_node=null;igk.appendProperties(this,{canva:null,getElementsByTagName:function(tag){return m_node.select(tag);},loadGkds:function(content){var xml=$igk(igk.createNode("dummy").setHtml(content).o.getElementsByTagName("gkds")[0]);var self=this;if(xml){xml.select("documents").each(function(){var doc=new igk.wo.documents(self);doc.load(this);doc.gkds=self;m_items.push(doc);return true;});m_node=xml;}},render:function(canvaobj){var c=canvaobj? canvaobj.o :this.canva.o;var ctx=c.getContext ? c.getContext("2d"):null;if(ctx==null){return;}var s={fillStyle:"#fff",strokeStyle:"#000",fillMode:"evenodd" };for(var i=0;i<m_items.length ;i++){m_items[i].render(c,ctx,s);}},getItemCount:function(){return m_items.length;},getItemAt:function(i){if((i>=0)&&(i<m_items.length))return m_items[i];return null;}});}});igk.system.createNS("igk.wo.gkds",{brush:function(n){return "#000";},extractdef:function(m){var o={};var tr=m.split(";");for(var i=0;i<tr.length;i++){if(tr[i].trim()=="")continue;var b=tr[i].split(':');o[b[0]]=b[1];}return o;},rectangle:function(n){var t={x:0,y:0,w:0,h:0};var h=n.trim().split(';');t.x=parseFloat(h[0]);t.y=parseFloat(h[1]);t.w=parseFloat(h[2]);t.h=parseFloat(h[3]);return t;},radius:function(n){if(!n)return 0;var t=n.split(' ');var r=null;if((typeof(t)!="string")&&(t.length>1)){r=[];for(var i=0;i<t.length;i++){if(t[i].length>0)r.push(parseFloat(t[i]));}}else r=parseFloat(n);return r;},matrix:function(){var m_isIdentity=true;var m1,m2,m3,m4,m5,m6;m1=m4=1;m2=m3=m5=m6=0;function _reset(){m1=m4=1;m2=m3=m5=m6=0;m_isIdentity=true;}_reset();igk.appendProperties(this,{getCode:function(){return "ctx.transform("+m1+", "+m2+","+m3+", "+m4+","+m5+", "+m6 +");";},reset:_reset,loadMatrixs:function(s){var t=s.trim().split(',');switch(t.length){case 6:m_isIdentity=false;m1=parseFloat(t[0]);m2=parseFloat(t[1]);m3=parseFloat(t[2]);m4=parseFloat(t[3]);m5=parseFloat(t[4]);m6=parseFloat(t[5]);break;case 16:m_isIdentity=false;m1=parseFloat(t[0]);m2=parseFloat(t[1]);m3=parseFloat(t[4]);m4=parseFloat(t[5]);m5=parseFloat(t[12]);m6=parseFloat(t[13]);default:break;}}});igk.defineProperty(this,"isIdentity",{get:function(){return m_isIdentity;}});},createItem:function(tagname,n){if(typeof(igk.wo[tagname])!="undefined"){var b=new igk.wo[tagname]();b.load(n);return b;}console.debug("not define "+tagname);var b=new igk.wo.nonvisible();b.load(n);return b;},createFrom:function(uri,canva){var t=new igk.wo.gkds();t.canva=canva;function replacing(m){var tag=m.trim().split(' ')[0].substring(1);m=m.replace("/>","></"+tag+">");return m;}function closeemptytag(s){var rg=new RegExp("((<)([^\/>])+(\/>))","ig");var b=s.replace(rg,replacing);return s;}var xhr=new XMLHttpRequest();var p=$igk("#progress");igk.ajx.get(uri,null,function(xhr){if(this.isReady()){var s=xhr.responseText;s=igk.html.closeEmptyTag(s);t.loadGkds(s);}else{if((xhr.readyState==1)&& p){xhr.onprogress=function(evt){p.setHtml(Math.round(((evt.loaded/evt.total)*100))+"");};}}});}});igk.ready(function(){var e=$igk("igk:gkds");e.each(function(){var src=this.getAttribute("src");if(src){var div=igk.createNode("canvas");div.setAttribute("width","400px");div.setAttribute("height","300px");div.setCss({width:"400px",height:"300px",border:"none"});igk.wo.gkds.createFrom(this.getAttribute("src"),div);this.o.parentNode.replaceChild(div.o,this.o);}return true;});});})();(function(){igk.system.createNS("igk.editor.phpcodearea",{init:function(tn,props){var s=$igk(igk.getParentScript()).select('#'+tn);var t=null;if(s.getCount()>0){t=s.o.getNodeAt(0);}if(t==null)return;}});})();"uses strict";(function(){function __cssbuilder(s,t){var m_styles={};var q=$igk(t);var m_reloading=false;function reloadStyle(m_styles){if(m_reloading)return;m_reloading=true;for(var i in m_styles){var v=s.o.style[i]+'';if(v=="undefined"){v=null;}m_styles[i].o.value=v;}m_reloading=false;}function __click_func(evt){evt.preventDefault();var s=this.innerHTML;if(igk.system.string.endWith(s.toLowerCase(),'color')){}};function __valkey(evt){if(evt.keyCode==13){var k=$igk(this).getAttribute("cssproperty");var e={};e[k]=this.value;s.o.style[k]=this.value;igk.winui.style_editor.setProperties(e);reloadStyle();}}function __loadProp(s,pattern,m_styles){q.select('*').each(function(){this.unregister();return true;});q.setHtml("");if(pattern=="")pattern==null;var b=m_keys;var v_tab=m_tab;for(var i=0;i<b.length;i++){if((pattern !=null)&&(b[i].indexOf(pattern)==-1)){continue;}k=v_tab[b[i]];m=igk.createNode("li");m.setCss({paddingLeft:"10px",paddingRight:"10px"});m.add("a").addClass("dispb").setAttribute("href","#").reg_event("click",__click_func).setHtml(""+k);var v=s.o.style[k];if(v=="undefined")v=null;var input=m.add("input");m_styles[k]=input;input.addClass("igk-form-control dispb").setAttribute("type","text").setAttribute("value",v).setAttribute("cssproperty",k).reg_event("keyup",__valkey).reg_event("change",(function(k){var m_k=k;return function(evt){if(m_reloading)return;try{s.o.style[k]=this.value;reloadStyle();}catch(ex){igk.show_notify_error("Exception : ",k+" <br />"+ex);}}})(k));q.appendChild(m);}}igk.appendProperties(this,{getCssList:function(){var t="";var v_tab=igk.css.getProperties();var m=null;var k=null;var b=[];for(var i in v_tab){if(i=="csstext")continue;b.push(i);}igk.system.array.sort(b);m_keys=b;m_tab=v_tab;__loadProp(s,null,m_styles);},loadPattern:function(pattern){__loadProp(s,pattern,m_styles);}});}var m_tbuilder;igk.system.createNS("igk.cssbuilder",{init:function(){var b=igk.getParentScript();if(b){m_tbuilder=new __cssbuilder(igk.createNode("dummy"),b);m_tbuilder.getCssList();}},initsearch:function(){var q=$igk(igk.getParentScript());q.reg_event('keyup',function(){igk.cssbuilder.searchProperty(q.o.value.toLowerCase());});q.setCss({"border":'1px solid rgb(187, 187, 187)'});},searchProperty:function(pattern){if(m_tbuilder)m_tbuilder.loadPattern(pattern);},openwindow:function(uri){var editor=window.open(uri,'igk-wnd-coloreditor','width=400px, height=300px ,statusbar=no, adressbar=no, size=no');editor['igk-parentWindow']=window;},initmediaview:function(t){var d=$igk(igk.getParentScript());if(!d)return;pwnd=window['igk-parentWindow']||window.opener;var frm=d.getParentForm();function __initInfo(hwnd){hwnd.igk.publisher.register("config/mediachanged",function(e){d.setHtml("Media:"+e.mediaType);frm.clMediaType.value=e.mediaType;igk.winui.style_editor.reset();});var k=hwnd.igk.css.getMediaType();d.setHtml("Media:"+k);frm.clMediaType.value=k;}if(pwnd){__initInfo(pwnd);pwnd.unload=function(){alert("unloading");};pwnd.load=function(){alert("loading");};pwnd.complete=function(){alert("loading dd");};}else{alert("no parent");}}});})();(function(){var frm=null;var wnd=null;var item=null;var m_sl=null;function __init(){frm=$igk(igk.getParentScript()).getParentForm();wnd=window['igk-parentWindow']||window.opener;if(wnd==null){wnd=window;}item=igk.createNode('dummy');$igk(frm.clSelector).reg_event('change',function(evt){__checkvalue();}).reg_event("keyup",function(evt){__checkvalue();});}function __checkvalue(){var t=frm.clSelector.value;m_sl=$igk(wnd.document).select(t);$igk(frm).select('.cls-v').getItemAt(0).setHtml("Items: "+m_sl.getCount());}function _resetStyle(){var t=frm.clSelector.value;if(t){item.o.style.cssText="";frm.clValue.value="";var s=$igk(wnd.document).select(t);if(s){s.each_all(function(){this.o.style.cssText='';});}}}function _save(){igk.ajx.postform(frm,frm.action);}igk.system.createNS("igk.winui.style_editor",{init:__init,reset:_resetStyle,save:_save,setProperties:function(p){item.setCss(p);frm.clValue.value=item.o.style.cssText;var s=$igk(wnd.document).select(frm.clSelector.value);if(s){s.each(function(){this.setCss(p);return true;});}},maketransparent:function(evt){var p=null;if(frm.clMode.value==1){p={backgroundColor:'transparent'};}else{p={color:'transparent'};}igk.winui.style_editor.setProperties(p);},initcolor:function(evt){var p=null;if(frm.clMode.value==1){p={backgroundColor:evt.value};}else{p={color:evt.value};}igk.winui.style_editor.setProperties(p);}});})();(function(){})();igk.system.createNS("igk.ctrl.changement",{init :function(uri,interval){if(!window.igk){return;}var target=window.igk.getParentScript();var m_timeout=null;var m_checkinterval=interval?interval :5000;var m_viewbox=null;function update(){m_timeout=setTimeout(checkforupdate,m_checkinterval);}function checkforupdate(){igk.ajx.post(uri,null,function(xhr){if(this.isReady()){if(xhr.responseText){if(m_viewbox==null){m_viewbox=document.createElement("div");document.body.appendChild(m_viewbox);}$igk(m_viewbox).setCss({"height":"32px","backgroundColor":"red"}).addClass("fitw posfix loc_t loc_l");m_viewbox.innerHTML=xhr.responseText;igk.animation.fadeout(m_viewbox,20,1000,1.0,function(){update();m_viewbox.parentNode.removeChild(m_viewbox);m_viewbox=null;});}else{update();}}},true);}igk.ready(checkforupdate);}});igk.ctrl.bindPreloadDocument("igk:canvas",function(){$igk(document).select("igk:canvas").each(function(){var i=this;var canva=document.createElement("canvas");i.$.dom.copyAttributes(i.o,canva,{src:"1"});i.$.ajx.get(i.getAttribute("src"),null,function(xhr){if(this.isReady()){eval(xhr.responseText);i.$.dom.replaceChild(i.o,canva);}},false);return true;});});(function(){function __forceFocus(){var s=this.getAttribute("igk-input-focus");if(s==1){this.focus();}}igk.ctrl.bindAttribManager("igk-input-focus",__forceFocus);})();(function(){igk.system.createNS("igk.ctrl.optionsmanager",{init:function(){var s=$igk(document.body).select(":igk-type");if(s){s.each(function(){if(this.getAttribute("igk-type")=="ctrl-options"){this.setCss({fontSize:"1em",width:"100px",height:"32px",top:"0px",left:"0px" });this.getParentNode().setCss({}).reg_event("click",function(evt){});}return true;});}}});igk.ready(igk.ctrl.optionsmanager.init);})();(function(){igk.system.createNS("igk.ctrl.page_zone",{init:function(){var s=$igk(document.body).select(".page_zone");if(s){var size=igk.window.GetScreenSize();s.each(function(){this.setCss({display:"inline-block",textAlign:"left",position:"relative",maxWidth:"auto",minWidth:"auto" });this.animate({width:(size.x-200)},{duration:200});return true;});}}});})();"use strict";(function(){var m_initialize=false;var m_cibling=null;igk.system.createNS("igk.ctrl.pageeditor",{hide:function(btn){var q=$igk($igk(btn).getParentCtrl());if(q){if(q.fc && q.fc.hide)q.fc.hide();else console.debug("bad: parent controller item does't contain hide function. not initialized "+q);}},init:function(p){if(p==null){p=igk.getParentScript();}var pctrl=$igk(igk.ctrl.isregCtrl(p)||$igk(p).getParentCtrl());if(m_cibling==p){return;}var m_target=$igk(pctrl);m_cibling=p;m_target.setCss({boxShadow :"0px 0px 4px #4E4E4E",padding:"4px",whiteSpace:"nowrap",left:"50%" });$igk(m_target).setOpacity(0.0);igk.ready(function(){var pp={hide:function(){pctrl.setCss({display:'none'});},show:function(){pctrl.setCss({display:'block'});}};if(pctrl.fc){igk.appendProperties(pctrl.fc,pp);}else pctrl.fc=pp;var w=m_target.o.clientWidth;$igk(m_target).animate({opacity :1.0,marginLeft :-(w/2)+"px" },{duration:200,interval:20,context:"pageeditortranslation",update:function(){},complete:function(){}});});m_initialize=true;}});})();(function(){igk.ctrl.bindPreloadDocument("igk-reset-body-management",function(){igk.ready(function(){$igk(document.body).select(".igk-reset-body").each(function(){function getRuleName(i){var reg=new RegExp("([A-Z])","g");return i.replace(reg,"-$1").toLowerCase();}function getRule(p){var msg="";for(var i in p){msg+=getRuleName(i)+":"+p[i]+";";}return msg;}var b=$igk(document.body);var p={};var index=igk.system.apps.link.o.sheet.cssRules.length;var cl=this.o.className;this.rmClass(cl);var rTab=["fontSize","lineHeight","textAlign","margin","padding","border","backgroundColor","color"];for(var i in rTab){i=rTab[i];if(/(length|parentRule|cssText)/.exec(i)||(typeof(this.o.style[i])=="function")){continue;}if(b.getComputedStyle(i)!=this.o.style[i]){p[i]=b.getComputedStyle(i)+"";}}igk.system.apps.link.o.sheet.insertRule(".igk-reset-body{"+getRule(p)+"}",0);this.addClass(cl);return true;});});});igk.ctrl.bindAttribManager("igk-js-bodyheight",function(){var source=this.getAttribute("igk-js-bodyheight");if(source){var q=this;this.setCss({"minHeight":document.body.clientHeight+"px"});var m_eventContext=igk.winui.RegEventContext(this,$igk(this));if(m_eventContext){m_eventContext.reg_window("resize",function(){q.setCss({"minHeight":document.body.clientHeight+"px"});});}}});if(igk.ctrl.selectionmanagement)igk.ctrl.bindAttribManager("igk-js-anim-over",igk.ctrl.selectionmanagement.initnode);var m_article=new Array();var m_ctrl=new Array();var m_viewctrl=false;if(igk.web.getcookies("igk-sao")==1)m_viewarticle=true;if(igk.web.getcookies("igk-sco")==1){m_viewctrl=true;}igk.ctrl.bindAttribManager("igk-ctrl-options",function(){var q=this;var source=igk.system.convert.parseToBool(this.getAttribute("igk-ctrl-options"));q.show=function(){this.setCss({display:"block",position:"relative"});};q.hide=function(){this.setCss({display:"none",position:"absolute"});};if(!m_viewctrl){q.hide();}else{q.show();}m_ctrl.push(q);});})();(function(){function __init_font_tool(){this.addClass("posr");var d=igk.createNode("div");var p=new igk.winui.tooltip(this,d);d.setHtml(this.getAttribute("igk-font-tool-tip"));d.addClass("igk-tooltip");if(this.getAttribute("igk-font-drop-font")){__init_drop_font.apply(this);}return true;};function __init_drop_font(){this.setCss({width:"64px"});var d=igk.createNode("div");var img=igk.createNode("img");var v=this.getAttribute("igk-font-drop-font-uri");var cv=this.getAttribute("igk-font-drop-font-uri");var self=this;img.o.src=v;img.reg_event("click",function(){igk.ajx.post(self.getAttribute("igk-font-drop-font"),null,function(xhr){if(this.isReady()){window.igk.ajx.replaceBody(xhr.responseText);$igk(document).scrollTo($igk(document).select(".font_list").getNodeAt(0));}});});img.o.alt="d";d.setSize("18px").setCss({"border":"none","top":"4px","fontSize":"100%","right":"4px"}).addClass("posab");d.appendChild(img);this.appendChild(d);};window.igk.system.createNS("igk.ctrl.theme",{init:function(){var t=$igk(document).select(':igk-font-tool-tip').each(__init_font_tool);}});igk.ctrl.bindPreloadDocument("igk.ctrl.theme",igk.ctrl.theme.init);igk.ctrl.registerAttribManager("igk-font-tool-tip",{desc:'font-tool-tip'});igk.ctrl.bindAttribManager("igk-font-tool-tip",function(){__init_font_tool.apply(this);});})();"use strict";(function(){var cibling="igk-top-nav-bar";igk.system.createNS("igk.ctrl.topnavbar",{init:function(target){var q=$igk(target);var s=null;var _t=q.getAttribute("igk-nav-bar-target")||"^.igk-parentscroll";var _opts=igk.JSON.parse(q.getAttribute("igk-nav-bar-options"))||{offset:0 };s=q.select(_t);var offp=s.getItemAt(0);var tg_id=(tg_id=($igk(_opts["offset-target"])||null))? tg_id.getItemAt(0):null;if(tg_id){var g=igk.winui.GetScreenPosition(tg_id.o);_opts.offset=g.y+tg_id.o.scrollHeight;}function __bind(p){var dx=p.scrollTop-_opts.offset;if((dx)>0){igk.winui.fitfix2(q,p,true,false);q.addClass("igk-show");}else{q.rmClass("igk-show");}}function parentOffset(i){var st=i.parentNode;while(st &&(st.parentNode!=null)&&(st.parentNode !=document.body)){st=st.parentNode;}return st;}igk.load(function(){if(offp)var p=null;if(offp)p=offp.o;else p=parentOffset(target.o);if(p){ns_igk.winui.reg_event(p,"scroll",function(evt){__bind(p);});__bind(p);}else{console.debug("there is no parent offset");}});}});if(!igk.ctrl.isAttribManagerRegistrated(cibling))igk.ctrl.registerAttribManager(cibling,{n:"js",desc:"register top nav bar"});igk.ctrl.bindAttribManager(cibling,function(){var q=this;var source=igk.system.convert.parseToBool(this.getAttribute(cibling));if(source){igk.ctrl.topnavbar.init(q);}});})();igk.system.createNS("igk.ctrl",{ca_update:function(xhr,target){if(this.isReady()){var f=igk.getParentByTagName(target,'form');var q=document.createElement('tr');q.innerHTML=xhr.responseText;var t=igk.getElementsByTagName(f,'table')[0];if(t)t.appendChild(q);}},ca_updatetable:function(xhr,target){var f=igk.getParentByTagName(target,'form');var q=document.createElement('table');q.innerHTML=xhr.responseText;var t=igk.getElementsByTagName(f,'table')[0];if(t)t.innerHTML=q.innerHTML;},ca_update_checkchange:function(a,name){var q=a.form[name];if(q){if((q.length)&&(q.length>0)){for(var s=0;s<a.form[a.name].length;s++){if(a.form[a.name][s]==a){q[s].value=a.checked? "1":"0";break;}}}else{q.value=a.checked? "1":"0";}}else alert("element not found : "+name);},ca_ctrl_change:function(uri,q){if(!q)return;window.igk.ajx.post(uri+q.value,null,function(xhr){if(this.isReady()){var s=$igk(q.form);s=s.getChildById('view_frame');this.setResponseTo(s);}});}});"use strict";(function(){var _sblock=0;igk.system.createNS("igk.ctrl.sessionblock",{init:function(){var target=igk.getParentScript();if(!target||(target==window)||$igk(target).data['session.init']){console.error("/!\ can't init sessession ....");return;}var script=igk.getCurrentScript();if(script){target.removeChild(script);}_sblock=script;var content=target.innerHTML;var info=null;target.innerHTML="&nbsp";var m_nodeChild=document.createElement("div");var m_visible=false;var m_oldh=0;m_nodeChild.innerHTML=content;igk.ajx.fn.initnode(m_nodeChild);function hide_info(d){$igk(d).animate({height:"0px","opacity":0},{duration:200,interval:20,complete:function(){$igk(d).addClass("dispn").setCss({padding:"0px" });if(d.parentNode){d.parentNode.removeChild(d);}info=null;}});}function show_info(evt){if(info!=null){hide_info(info);return;}var d=m_nodeChild;$igk(d).addClass("igk-session-block no-print" ).setCss({minWidth:"300px",height:"0px",display:"inline-block",overflow:"hidden",top:(igk.getNumber(target.offsetTop)+32)+"px",zIndex:parseInt(q.getComputedStyle('zIndex'))+1,right:"32px",padding:"10px" });if(d.parentNode==null)document.body.appendChild(d);var h=d.scrollHeight;if(h==0)h=m_oldh;else m_oldh=h;$igk(d).setOpacity(0).rmClass("dispn").animate({height:(h+10)+"px",opacity:1},{interval:1,duration:20});info=d;};var q=$igk(target);q.addClass("igk-session-button").setCss({"width":"24px","height":"24px","backgroundRepeat":"no-repeat","backgroundPosition":"0px 0px","backgroundColor":"transparent","position":"fixed","overflow":"hidden","right":"32px",}).reg_event("mouseover",function(){q.setCss({"backgroundPosition":"0px -24px"});}).reg_event("mouseleave",function(){$igk(target).setCss({"backgroundPosition":"0px 0px"});}).reg_event("click",show_info);q.data['session.init']=1;}});})();"uses strict";(function(){var m_charts=[];function init_round_chart(){igk.appendProperties(this.data,{"chart-data":{}});var ch_data=this.getAttribute("chart-data");var dk=(ch_data !=null)? igk.JSON.parse(ch_data):null;var data=0;var m_animate=false;var m_duration=500;var self=this;if((dk !=null)&&(typeof(dk)=="object")){data=dk.value;m_animate=dk.animate||false;m_duration=dk.duration||m_duration;}else data=dk;var d=self.add("def").setCss({visibility:'hidden',position:'absolute'});var b1=d.add("div").addClass('bar1').setHtml("bar1");var b2=d.add("div").addClass('bar2').setHtml("bar2");var btx=d.add("div").addClass('text').setHtml("text");var cl1=b1.getComputedStyle('color')||"#5148fe";var cl2=b2.getComputedStyle('color')||"#dedede";var cl3=btx.getComputedStyle('color')||"#888";var w=igk.getNumber(this.getComputedStyle("width"));var h=igk.getNumber(this.getComputedStyle("height"));self.data.canva=igk.createNode("canvas");self.data.canva.addClass("posab");function render(data){var t=igk.chart.round_chart_data(self.data.canva,cl1,cl2,w,h,data)+"";var d=null;if(!self.text){self.setHtml("");d=self.add("div");self.text=d;self.prependChild(self.data.canva.o);}else d=self.text;d.addClass("alignc alignm disptabc");d.setCss({fontSize:"4em",width:w+"px",height:h+"px",color:cl3});d.setHtml(Math.round((data*100))+"%");}render(m_animate? 0.0:data);if(m_animate){var d=m_duration;var t=0;var n=igk.createNode("div");var y=Math.round(data*100);n.setCss({width:"0px",transition:'all 0.5s ease-in-out',border:"none","position":"absolute","visibility":"hidden"});self.prependChild(n.o);setTimeout(function(){n.setCss({width:y+'px'});igk.html.canva.animate(function(e){var x=igk.getNumber(n.getComputedStyle("width"));if(x<y){render(x/100.0);return true;}render(y/100.0);return false;});},100);}}igk.system.createNS("igk.chart",{round_chart_data:function(c,cl1,cl2,w,h,data){if(data==null)return;c.setAttribute("width",w);c.setAttribute("height",h);var ctx=c.o.getContext('2d');var cx=w/2;var cy=h/2;var r=Math.max(igk.getNumber(c.getComputedStyle("fontSize")),(Math.min(w,h)-20))/2;ctx.clearRect(0,0,w,h);if(data==0)data=40;ctx.lineWidth=8.5;ctx.strokeStyle=cl1;ctx.beginPath();ctx.arc(cx,cy,r,-(Math.PI / 2)+(2*Math.PI)*data,(2*Math.PI)-(Math.PI / 2),false);ctx.stroke();ctx.lineWidth=9.5;ctx.strokeStyle=cl2;ctx.beginPath();ctx.arc(cx,cy,r,-(Math.PI / 2),-(Math.PI / 2)+(2*Math.PI)*data,false);ctx.stroke();return c.o.toDataURL();}});igk.winui.initClassControl("igk-round-chart",init_round_chart,{desc:"circle percentage chart"});})();"uses strict";(function(){function __init_canva_editor(){var q=this;var data={};var c=q.add("canvas");var m_items=new igk.system.collections.list();var ms_down=false;q.data["canva_editor"]=data;igk.appendProperties(q,{addItem:function(i){m_items.add(i);},removeItem:function(i){m_items.remove(i);},save:function(){},clear:function(){m_items.clear();data.render();},print:function(){}});if(c.istouchable()){c.reg_event("touchstart",function(evt){evt.preventDefault();var e=igk.winui.GetChildTouchLocation(c,evt);var b=igk.winui.mouseButton.Left;ms_down=1;data.mecanism.start(b,e.x,e.y);igk.winui.mouseCapture.setCapture(c.o);data.render();});c.reg_event("touchmove",function(evt){if(!ms_down){return;}var e=igk.winui.GetChildTouchLocation(c,evt);var b=igk.winui.mouseButton.Left;data.mecanism.update(b,e.x,e.y);data.render();});c.reg_event("touchend",function(evt){ms_down=0;igk.winui.mouseCapture.releaseCapture();data.render();});c.reg_event("touchcancel",function(evt){console.debug("cancel");ms_down=0;igk.winui.mouseCapture.releaseCapture();data.mecanism.cancel();data.render();});}c.reg_event("mousedown",function(evt){if(ms_down)return;var e=igk.winui.GetChildMouseLocation(c,evt);var b=igk.winui.mouseButton(evt);ms_down=1;data.mecanism.start(b,e.x,e.y);igk.winui.mouseCapture.setCapture(c.o);data.render();});c.reg_event("mousemove",function(evt){if(!ms_down){return;}var loc=igk.winui.GetRealScreenPosition(c.o);var e=igk.winui.GetChildMouseLocation(c,evt);var b=igk.winui.mouseButton(evt);data.mecanism.update(b,e.x,e.y);data.render();});c.reg_event("mouseup",function(){ms_down=0;igk.winui.mouseCapture.releaseCapture();data.render();});c.reg_event("mouseleave",function(){data.render();});function __init_rendering_data(){var m_zoomX=1.0;var m_zoomY=1.0;var m_posX=0.0;var m_posY=0.0;igk.appendProperties(this,{});igk.defineProperty(this,"ZoomX",{get:function(){return m_zoomX;}});igk.defineProperty(this,"ZoomY",{get:function(){return m_zoomX;}});};igk.appendProperties(data,{renderData:new __init_rendering_data(),mecanism:null,ctx :c.o.getContext('2d'),render:function(){var ctx=this.ctx;var w=c.getComputedStyle("width");var h=c.getComputedStyle("height");c.setAttribute("width",w);c.setAttribute("height",h);ctx.clearRect(0,0,w,h);for(var i=0;i<m_items.getCount();i++){var v_q=m_items.getItemAt(i);if(v_q){v_q.render(ctx,this.renderData);}}if(this.mecanism){}}});data.mecanism=new igk.app.canvaEditor.mecanisms.CreateMecanism("circle");data.mecanism.setParent(q);data.render();};(function(){igk.system.createNS("igk.app.canvaEditor",{mecanisms:{Bases:function(){var m_fill="transparent";var m_stroke="#000";var m_p=null;var m_st=new igk.math.vector2d(0,0);var m_se=new igk.math.vector2d(0,0);igk.appendProperties(this,{initBrush:function(ctx){},start:function(b,x,y){m_st.x=x;m_st.y=y;m_se.x=x;m_se.y=y;},update:function(b,x,y){},complete:function(b,x,y){},render:function(ctx){},getParent:function(){return m_p;},setParent:function(p){m_p=p;},toString:function(){return "BaseMecanism";}});}}});var __super=igk.app.canvaEditor.mecanisms.Bases;igk.system.createNS("igk.app.canvaEditor.mecanisms",{CreateMecanism:function(name){if(typeof(igk.app.canvaEditor.mecanisms[name])!=igk.constants.undef){return new igk.app.canvaEditor.mecanisms[name]();}var s=new igk.app.canvaEditor.mecanisms.line();s.objecttype=name;return s;},line:function(){__super.apply(this);var m_s=igk.math.vector2d(0,0);var m_e=igk.math.vector2d(0,0);var m_o=null;igk.appendProperties(this,{objecttype:"line",start:function(b,x,y){m_o=new igk.app.canvaEditor[this.objecttype]();this.getParent().addItem(m_o);m_s.x=x;m_s.y=y;m_o.Start=m_s.clone();m_o.End=m_s.clone();},update:function(b,x,y){if(!m_o){return;}m_e.x=x;m_e.y=y;m_o.End=m_e.clone();},end:function(b,x,y){this.update(b,x,y);m_o=null;},render:function(ctx,data){if(m_o){igk.html.canva.drawLine(ctx,m_s,m_e);}},toString:function(){return "line";}});}});})();(function(){igk.system.createNS("igk.app.canvaEditor",{Bases:function(){igk.appendProperties(this,{render:function(ctx,data){}});}});var __super=igk.app.canvaEditor.Bases;igk.system.createNS("igk.app.canvaEditor",{line:function(){__super.apply(this);var m_st=igk.math.vector2d.empty();var m_se=igk.math.vector2d.empty();igk.appendProperties(this,{render:function(ctx,data){igk.html.canva.drawLine(ctx,m_st,m_se);}});igk.defineProperty(this,"Start",{get:function(){return m_st;},set:function(v){m_st=v;}});igk.defineProperty(this,"End",{get:function(){return m_se;},set:function(v){m_se=v;}});},rectangle:function(){igk.app.canvaEditor.line.apply(this);igk.appendProperties(this,{render:function(ctx,data){igk.html.canva.fillRect2p(ctx,this.Start,this.End);igk.html.canva.drawRect2p(ctx,this.Start,this.End);}});},circle:function(){igk.app.canvaEditor.rectangle.apply(this);igk.appendProperties(this,{render:function(ctx,data){igk.html.canva.buildCircle(ctx,this.Start,this.End.distance(this.Start));ctx.fill();ctx.stroke();}});}});})();igk.winui.initClassControl("igk-canva-editor",__init_canva_editor);})();"use strict";(function(){igk.system.createNS("igk.animation",{sequence:function(){var m_sq=new igk.system.collections.list();var m_a=false;var m_i=0;var self=this;function __sequencetrans(evt){if(m_a){if((m_i>=(m_sq.getCount()-1))&&(self.loop)){m_i=-1;}if(m_i<(m_sq.getCount()-1)){m_i++;var s=m_sq.getItemAt(m_i);self.target.setCss({transition:s.properties[0]+' '+s.duration+' '+(s.effect||'ease-in-out')});__loadv(self);}else{m_a=false;}}};function __loadv(q){var s=m_sq.getItemAt(m_i);var n=s.properties[0];q.target.o.style[n]=s.value;}igk.appendProperties(this,{target:null,loop:false,timeout:100,start:function(){if(!this.target||m_a||(m_sq.getCount()==0))return;m_i=0;var s=m_sq.getItemAt(m_i);this.target.unreg_event('transitionend',__sequencetrans);var m=s.properties[0]+' '+s.duration+' '+(s.effect||'ease-in-out');this.target.setCss({transition:m});var q=this;setTimeout(function(){m_a=true;__loadv(q);var n=s.properties[0];q.target.o.style[n]=s.value;q.target.reg_event('transitionend',__sequencetrans);},q.timeout);},stop:function(){},pause:function(){},add:function(s){m_sq.add(s);},remove:function(s){m_sq.remove(s);},clear:function(){m_sq.clear();},toString:function(){return "igk.animation.sequence[object]";}});}});igk.system.createNS("igk.animation.sequence",{init:function(){}});})();(function(){var m_info="android info";var m_name="android script model";if(window.igk){window.igk.system.createNS("igk.android",{});}})();"uses strict";(function(){igk.system.createNS("igk.winui.canva",{initctrl :function(uri){var p=igk.getParentScript();if(!p||(p.tagName.toLowerCase()!='canvas'))return;function evalScript(text){var canva=p;var v_context=canva.getContext ? canva.getContext("2d"):null;if(v_context==null)return;try{eval(text);}catch(ex){igk.winui.notify.showErrorInfo("Exception","Error : <br />"+ex);}}window.igk.ajx.aget(uri,null,function(xhr){if(this.isReady()){evalScript.apply(p,new Array(xhr.responseText));}});}});})();"use strict";(function(){igk.system.createNS("igk.google",{});igk.system.createNS("igk.google.controls",{addCircleWaiter:function(b){var n=igk.createNode("div");n.addClass("igk-google-circle-waiter");b.add(n);igk.ajx.fn.initnode(n.o);},addLineWaiter:function(b){var n=igk.createNode("div");n.addClass("igk-google-line-waiter");b.add(n);igk.ajx.fn.initnode(n.o);}});function __circle_waiter_init(s){var q=this;igk.appendProperties(q,{start:function(){if(_running)return;_do_anim();_running=1;},stop:function(){_running=false;}});var _running=true;var _dat=null;var _2PI=(2*Math.PI);var _3PI2=(Math.PI / 2)*3;var _10Deg=(30/360)*_2PI;var _ta=0;igk.appendProperties(this.data,{canva:null,dir:1,penWidth:2,oldClass:1,catchm:0,T1:0,T2:_3PI2,update:function(){var s=q.data.storyboard_1;if(q.data.catchm){q.data.catchm=0;s.setCss({width:"100px"});q.data.T2+=_3PI2;}else{q.data.catchm=1;q.data.T1=q.data.T2-_10Deg;s.setCss({width:"0px"});}},render:function(v,cl,of_set,bg){var w=igk.getNumber(this.canva.getComputedStyle("width"));var h=igk.getNumber(this.canva.getComputedStyle("height"));var cx=w/2;var cy=h/2;var penw=this.penWidth||4;var R=Math.min(w/2,h/2)-(penw/2);var r=Math.min(w/2,h/2)-(penw/2)-10;this.canva.setAttribute("width",w);this.canva.setAttribute("height",h);var ctx=this.canva.o.getContext('2d');ctx.clearRect(0,0,w,h);ctx.strokeStyle=''+cl;if(bg){ctx.beginPath();ctx.fillStyle="#ddd";ctx.arc(cx,cy,R,0,_2PI,false);ctx.closePath();ctx.fill();}ctx.lineWidth=penw;ctx.beginPath();var offset=-(Math.PI / 2)+(v*_2PI);var _s=_getData();if(r>0){if(!this.catchm){ctx.arc(cx,cy,r,offset+this.T1+((this.T2-this.T1-_10Deg)*of_set),offset+this.T2,false);}else{ctx.arc(cx,cy,r,offset+this.T1,offset+this.T2+(_3PI2*(1-of_set)),false);}}ctx.stroke();}});function _getData(){if(_dat==null){var _s=q.data.storyboard.getComputedStyle('content',':before');var _t=/^"((.)+)"$/i.exec(_s);_dat=igk.JSON.init_data({stop:'width',mode:1},(_t? _t[1].replace(/\\\"/g,"\""):null),function(s){s.stop=(_t? _t[1]:null)||'width';});q.data.penWidth=q.data.storyboard.getComputedStyle('border-size',':before');}return _dat;}this.data.canva=this.add("canvas").addClass("igk-canva-bg");this.data.storyboard=this.add("div").addClass("igk-anim-time-board i-1").reg_event("transitionend",function(evt){var _m=_getData();if((evt.target==q.data.storyboard.o)&&(evt.propertyName==_m.stop)){var _oc=q.data.oldClass;var _nc=((_oc+1)% 5)||1;if(q.data.dir==1){q.data.storyboard.setCss({'width':'0px'}).rpClass("igk-cl-"+_oc,"igk-cl-"+_nc);q.data.dir=-1;}else{q.data.storyboard.setCss({'width':'100px'}).rpClass("igk-cl-"+_oc,"igk-cl-"+_nc);q.data.dir=1;}q.data.oldClass=_nc;}}).reg_event("transitionstart",function(evt){}).setCss({"width":"0px","height":"0px"}).addClass("igk-cl-2").setHtml(" ");this.data.storyboard_1=this.add("div").addClass("igk-anim-time-board i-2").reg_event("transitionend",function(evt){var s=q.data.storyboard_1;if((evt.propertyName=="width")&&((evt.target==s.o))){q.data.update();}});function _do_anim(){if(!q.o.parentNode||!q.isOnDocument()){_running=false;return false;}q.data.storyboard .setCss({width:'100px',height:'100px'}).rpClass("igk-cl-2","igk-cl-1");q.data.storyboard_1 .setCss({width:'100px'});q.data.render(0,'transparent',0);igk.html.canva.animate(function(e){if(!q.o.parentNode){console.error("not animable no parent. stop animate canvas");return false;}if(!q.getisVisible()){return _running;}if(!q.data.end){var n=q.data.storyboard;var n1=q.data.storyboard_1;var x=igk.getNumber(n.getComputedStyle("width"));var y=igk.getNumber(n1.getComputedStyle("width"));var cl=n.getComputedStyle('color');if(q.data.dir==-1)x=100-x;q.data.render(Math.round((x/100.0)*100)/100,cl,Math.round((y/100.0)*100)/100 );return _running;}q.data.render(1.0,"",1.0);return _running;});};setTimeout(_do_anim,1000);return true;};function __line_waiter_init(s){return;var q=this;var _ctx=null;var _data={};var _lstart=0;var _anim_id=0;if(q.remove){var f=q.remove;q.remove=function(){if(_anim_id)_anim_id.cancel();f.apply(q);};}igk.appendProperties(_data,{cur:q.add("div").setCss({right:(q.getWidth())+"px",left:"0px"}).addClass("cur"),end:0,running:1,getctx:function(){if(!_ctx){_ctx=this.canva.o.getContext('2d');}return _ctx;},render:function(){}});function _init_cur(){return;var _trans=_data.cur.getComputedStyle("transition");_data.cur.setCss({transition:'none',right:(q.getWidth())+"px",left:"0px"});_lstart=0;_data.cur.getComputedStyle("transition");_data.cur.setCss({transition:_trans,right:'0px'});};function _do_anim(){if(!q.o.parentNode)return false;_data.cur.setCss({right:"0px"});_anim_id=igk.html.canva.animate(function(e){if(!q.o.parentNode)return false;var _X=q.getWidth();var _x=igk.getNumber(_data.cur.getComputedStyle("right"));var _y=igk.getNumber(_data.cur.getComputedStyle("left"));if(_X>0){if(!_lstart &&((1-(_x/_X))>0.3)){_data.cur.setCss({left:_X+"px"});_lstart=1;}if(_lstart &&(_x<=0)&&(_y>=_X)){_init_cur();}}return _data.running;});};setTimeout(_do_anim,200);var _resizing=0;igk.winui.reg_event(window,'resize',function(){if(_resizing)return;_resizing=1;_init_cur();_resizing=0;});};igk.winui.initClassControl("igk-google-circle-waiter",__circle_waiter_init,{desc:"google circle waiter" });igk.winui.initClassControl("igk-google-line-waiter",__line_waiter_init,{desc:"google line waiter" });})();(function(){igk.system.createNS("igk.drawing.effect",{stackBlur:function(ctx,x,y,w,h,radius,iterations){boxBlurCanvasObjRGB(ctx,x,y,w,h,radius||2,iterations||2);}});})();"use strict";(function(){function hierachilist(p){var tab=[];var rt=[{i:p,t:''}];var q=0;while(q=rt.pop()){for(var u in q.i){tab[q.t+u]=(q.t+u).replace(/\./g," ");tab.push(q.t+u);if(typeof(q.i[u])=="object"){rt.push({i:q.i[u],t:q.t+u+"."});}}}return tab;}function _getProperty(n_h){var cl=igk.convert.toHtmlColor(n_h.getComputedStyle("color"));var disp=n_h.getComputedStyle("visibility");var ms=[];ms.push({color:cl});if(disp!="visible")ms.push({visibility:'off'});return ms;}function initDisplayStyle(map,t){var p={administrative:{country:1,land_parcel:1,locality:1,neighborhood:1,province:1},landscape:{man_made:1,natural:{terrain:1,landcoder:1}},poi:{attraction:1,business:1,government:1,medical:1,park:1,place_of_worship:1,school:1,sports_complex:1},road:{arterial:1,hightway:{controlled_access:1},local:1},transit:{line:1,station:{airport:1,bus:1,rail:1}},whater:1 };var m={all:1,geometry:{fill:1,stroke:1},labels:{icon:1,text:{fill:1,stroke:1}}};var tab=hierachilist(p);var ptab=hierachilist(m);var styles=[];var dc=igk.convert.toHtmlColor(igk.css.getComputedSrcStyle(t,"","color"));var gc=34;var ok=1;var tset={};var pset={};var out=igk.createNode("div");var ti=1;var n_h=$igk(t).add("div").addClass("dispn");var ms=_getProperty(n_h);var bvjs=JSON.stringify(ms);for(var l=0;l<tab.length;l++){var ss=tab[l];for(var y=ptab.length-1;y>=0;y--){var k=(ss+" "+ptab[y]).replace(/\./g," ");var parent=ss.substr(0,ss.trim().lastIndexOf("."));n_h.o.className=k;ms=_getProperty(n_h);var vjs=JSON.stringify(ms);if(bvjs==vjs)continue;if(parent.length>0){if(tset[parent]==vjs){continue;}var dcb=0;while(parent.indexOf(".")!=-1){parent=parent.substr(0,parent.lastIndexOf("."));if(tset[parent]==vjs){dcb=1;break;}}if(dcb)continue;}else{tset[ss]=vjs;}out.add("div").setHtml((ti++)+": "+ss+"=="+k+":"+vjs);styles.push({featureType:tab[l],elementType:ptab[y],stylers:ms });}}n_h.remove();var STYLE_LENGTH=2047;var v_ct=JSON.stringify(styles);t.parentNode.appendChild(out.o);}var m_maps=[];var m_sys=0;function _initmaps(){$igk(document).reg_event("transitionend",function(e){if("width|height".indexOf(e.propertyName)!=-1){for(var i=0;i<m_maps.length;i++){google.maps.event.trigger(m_maps[i],'resize');}}});};function _markerInfo(){var m_marks=[];igk.appendProperties(this,{clearAll:function(){for(var i=0;i<m_marks.length;i++){m_marks[i].setMap(null);}m_marks=[];},add:function(m){if(m_marks)m_marks.push(m);}});};function _refresh(m){google.maps.event.trigger(m,"resize");}igk.system.createNS("igk.google.maps",{getMapAtIndex:function(i){return m_maps[i];},getMapCount:function(){return m_maps.length;},refresh:function(i){var m=m_maps[i];if(m)google.maps.event.trigger(m,"resize");},addMarker:function(map,x,y,l,t){return new google.maps.Marker({position:{lat:x,lng:y},map:map,title:t||'title',label:l,icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png' });},setMarker:function(map,markers,opts){if(typeof(map)=='number'){map=m_maps[map];}if(!map)return;var v_cm=$igk(map);if(v_cm.markers){v_cm.markers.clearAll();}else{v_cm.markers=new _markerInfo();}var mxi=0,mxa=0,myi=0,mya=0;var bounds=0;for(var i=0;i<markers.length;i++){var m=markers[i];var mk=igk.google.maps.addMarker(map,parseFloat(m.lat),parseFloat(m.lng));mk.icon=m.icon;mk.title=m.title;mk.inf=m;if(opts && opts.click){mk.addListener('click',opts.click);}v_cm.markers.add(mk);if(i==0){mxi=m.lat;mxa=m.lat;myi=m.lng;mya=m.lng;bounds=new google.maps.LatLngBounds(m,m);}else{mxi=Math.min(mxi,m.lat);mxa=Math.max(mxa,m.lat);myi=Math.min(myi,m.lng);mya=Math.max(mya,m.lng);bounds.extend(mk.getPosition());}}var center={lat :mxi+(mxa-mxi)/2.0,lng :myi+(mya-myi)/2.0 };setTimeout(function(){map.fitBounds(bounds);map.setCenter(center);_refresh(map);},500);},initMap:function(t){t=t||igk.getParentScript();if(!t){console.debug('not found');return;}if(!m_sys){_initmaps();m_sys=1;}var q=$igk(t);var s=q.getAttribute("igk:data");var data=igk.initObj(igk.JSON.parse(s),{zoom:7,center:{lat:50.41438075875331,lng:4.904006734252908}});var map=new google.maps.Map(t,{zoom:data.zoom,center:data.center,disableDefaultUI:true});if(data.markers){var mxi=0,mxa=0,myi=0,mya=0;for(var i=0;i<data.markers.length;i++){var m=data.markers[i];var mk=igk.google.maps.addMarker(map,parseFloat(m.lat),parseFloat(m.lng));mk.icon=data.icons[m.idx]||m.icon||data.iconmark;mk.title=m.title;mk.addListener('click',(function(mk,data,m){return function(d){var d=igk.createNode('div');var c=$igk(m.target).first();d.add('h2').setHtml(mk.title);d.add('div').setHtml(c ? c.getHtml():"");var wnd=new google.maps.InfoWindow({content:d.getHtml()});wnd.open(map,this);};})(mk,data,m));if(i==0){mxi=m.lat;mxa=m.lat;myi=m.lng;mya=m.lng;}else{mxi=Math.min(mxi,m.lat);mxa=Math.max(mxa,m.lat);myi=Math.min(myi,m.lng);mya=Math.max(mya,m.lng);}}var center={lat :mxi+(mxa-mxi)/2.0,lng :myi+(mya-myi)/2.0 };map.setCenter(center);}m_maps.push(map);if(document.readyState!="complete"){igk.ready(function(){google.maps.event.trigger(map,"resize");});}if(data.styles){map.setOptions({styles:data.styles});}}});})();(function(){"use strict";igk.system.createNS("igk.winui.articleviewer",{init:function(){var p=igk.getParentScript();if(!p)return;var h=igk.winui.articleviewer.initViewBox(p,"igk-article-viewer-box",true,false);return h;},initViewBox:function(target,classname,updatesize,withanimation){if((!target)||(!classname))return;var p=target;var m_sel=$igk(p).select("."+classname);if(m_sel.getCount()<=0)return;var m_width=0;var m_height=0;var d=null;var m_withanimation=false;if(typeof(withanimation)==igk.constants.undef)m_withanimation=true;else m_withanimation=withanimation;var dummy=document.createElement("div");$igk(dummy).addClass(classname).setCss({display:"none"});var j=0;var m_blocks=new Array();$igk(p).setCss({overflow:"hidden",width:"100%" });function updateSize(autoAnimate){var columns=[];function getColumnInfo(index){if(columns[index])return columns[index];c={bottom:0 };columns.push(c);return c;};function getMaxHeight(){var h=0;for(var i=0;i<columns.length;i++){h=Math.max(h,columns[i].bottom);}return h;};if((p.clientWidth !=m_width)&&(m_blocks.length>0)){var c=m_blocks[0];var w=$igk(dummy).getPixel("width",c);var h=$igk(dummy).getPixel("height",c);var mLeft=$igk(dummy).getPixel("marginLeft");var mRight=$igk(dummy).getPixel("marginRight");var mTop=$igk(dummy).getPixel("marginTop");var mBottom=$igk(dummy).getPixel("marginBottom");var offsetx=mLeft;var offsety=mTop;m_width=p.clientWidth;var v_W=m_width-(mLeft+mRight);var xs=Math.max(1,Math.floor(v_W /(w+mRight+mLeft)));var column=xs;var offsetx=0;if(column>1)offsetx=mLeft+(m_width/2)-(((w+mRight+mLeft)*column)/2);else{offsetx=(m_width/2)-(((w-(mRight+mLeft))*column)/2);w-=(mLeft+mRight);}var j=0;var x=offsetx;var y=mTop;var item=null;var cinfo=0;for(var i=0;i<m_blocks.length;i++){cinfo=getColumnInfo(i%column);if((i>0)&&((i%column)==0)){x=offsetx;y+=(h+mTop);j++;}item=m_blocks[i];h=$igk(item).getPixel("height",c);y=cinfo.bottom+mTop;$igk(item).setCss({width:w+"px",height:h+"px",overflow:"auto",margin:"0px"});if(autoAnimate){igk.animation.animate(item,{left:x+"px",top:y+"px"},{duration:200,complete:function(){}});}else{$igk(item).setCss({left:x+"px",top:y+"px"});}x+=w+mRight+mLeft;cinfo.bottom=y+h;}igk.animation.animate(p,{height:(getMaxHeight()+mBottom)+"px"},{duration:200,complete:function(){if(m_width !=p.clientWidth){updateSize(p);return;}}});}};m_sel.each(function(){var d=this.owner;m_blocks[j]=d;$igk(d).setCss({position:"absolute",verticalAlign:"top" });j++;return true;});var m_eventContext=igk.window.RegEventContext(p,$igk(p));if(m_eventContext){m_eventContext.reg_window("resize",function(){updateSize(true);});}else{alert("igk.winui.articleviewer ... event context failed");}var v_out={updateSize:updateSize };if(updatesize){igk.ctrl.bindPreloadDocument("articleviewer",function(){v_out.updateSize(m_withanimation);});}return v_out;}});})();(function(){"uses strict";igk.system.createNS("igk.ctrl.cookieswarning",{close:function(id){var t=document.getElementById(id);$igk(t).setCss({opacity:"1"}).animate({opacity :0 },{duration:200,interval:20,update:function(){},complete:function(){t.parentNode.removeChild(t);igk.web.setcookies("igk-app-cookieswarning-inform","true");}});}});})();"uses strict";(function(){igk.system.createNS("igk.services",{invoke:function(m,c){var uri=window.location.href.split('#')[0];function _sendRequest(){igk.ajx.postWebRequest(uri,m,"",function(xhr){if(this.isReady()){igk.winui.notify.showMsBox("Service : "+m+"_response ",xhr.responseText);}});}if(c>0){igk.winui.notify.showMsBox("ServiceParam","/!\\sorry this service method : <b>"+m+"</b>: required some parameter(s). if no parameter set correctly you will get an error.");}else _sendRequest();}});})();"use strict";(function(){function get_auto_height(q){var o=q.getComputedStyle('height');q.setCss({height:"auto"});var r=q.getComputedStyle('height');q.setCss({height:o});return r;}function __init_content(){this.setCss({height:"auto"});this.trans={maxHeight:this.getComputedStyle("height")};var q=this;if(!q.open){q.open=function(){var bck=q.getComputedStyle('transition');if(bck){q.setCss({"transition":'none'});}var h=get_auto_height(q);if(bck){q.setCss({"transition":bck});}q.setCss({height:h});};}if(!q.close){q.close=function(){q.setCss({height:"0px"});};}this.setCss({height:null});}function __click_h(evt){var q=this;var d="igk-collapse";var t="igk-toggle";var cf=$igk(q.o.parentNode).select(".igk-c").getItemAt(0);if(igk.system.regex.item_match_class(t,q.o)){q.rmClass(t);cf.close();}else{cf.open();q.addClass(t);}evt.stopPropagation();}function is_scrolling(q){var g=q.fn["sys://winui/accordeon"];if(g.owner.fn["sys://scrolling"]){delete(g.owner.fn["sys://scrolling"]);return 1;}return 0;};function __click(q){return function(evt){if(is_scrolling(q)){return;}__click_h.apply(q,[evt]);}}igk.system.createNS("igk.winui.accordeon",{init:function(){var q=$igk(igk.getParentScript());igk.ready(function(){q.select(".igk-c").each(function(){__init_content.apply(this);return true;});q.select(".igk-panel-heading").each(function(){var self=this;self.fn["sys://winui/accordeon"]={owner:q };this.reg_event("touchOrClick",__click(self));igk.ctrl.selectionmanagement.disable_selection(this.o);return true;});});var starttouch=0;function __binds(){if(!q.fn["sys://scrolling"]&& starttouch){q.fn["sys://scrolling"]=1;starttouch=0;}}q.reg_event("scroll",function(){console.debug("item scroll");});igk.winui.reg_event(window,"scroll",function(){__binds();},true);igk.winui.reg_event(document,"scroll",function(){__binds();},true);$igk(".igk-parentscroll").reg_event("scroll",function(evt){__binds();},true);q.reg_event("igkTouchStart igkTouchMove",function(evt){if(evt.type=="touchstart")starttouch=0;if(!q.fn["sys://scrolling"]&& !starttouch){q.fn["sys://scrolling"]=0;starttouch=1;}},igk.features.supportPassive?{passive:true}:false);}});})();"use strict";(function(){function __calcobj(q,i){var self=this;var s=q.select("span").getItemAt(0);var defv=i.getAttribute("default-v")||i.o.value;if(typeof(defv)=="undefined")defv=0;i.reg_event("input",function(evt){evt.preventDefault();var t=Math.round((i.o.value-defv)*100)/ 100;s.rmClass("igk-danger");s.rmClass("igk-success");if(t>0){s.addClass("igk-success");}else{s.addClass("igk-danger");}s.setHtml(t);});igk.appendProperties(this,{toString:function(){return "igk:[#calc]"}});}igk.system.createNS("igk.calc",{init:function(q){if(!q)return;var i=q.select("#clValue").getItemAt(0);if(!i)return;return new __calcobj(q,i);}});igk.ready(function(){var e=$igk(".igk-calc").each(function(){igk.calc.init(this);return true;});igk.ctrl.registerReady(function(n,p){if(igk.system.regex.item_match_class("igk-calc",this)){igk.calc.init($igk(this));}});});})();"use strict";(function(){function __colorPicker(p){var q=$igk(p);igk.appendProperties(this,{init:function(){var _r=q.select("#clr").getItemAt(0);var _g=q.select("#clg").getItemAt(0);var _b=q.select("#clb").getItemAt(0);var _o=igk.createNode("div");var e="igk-trackchange";var r=0,g=0,b=0;q.o.appendChild(_o.o);function _update_cl(){var txt="rgb("+r+", "+g+", "+b+")";_o.setHtml(txt+" #"+igk.system.convert.ToBase(r,16,2)+igk.system.convert.ToBase(g,16,2)+igk.system.convert.ToBase(b,16,2));_o.setCss({backgroundColor:txt});if(q.getAttribute("demo")){var gp=$igk(".igk-row").setCss({backgroundColor:txt});}}_r.postRegisterEvent(e,function(evt){r=parseInt(255*(evt.value/100.0));_update_cl();});_g.postRegisterEvent(e,function(evt){g=parseInt(255*(evt.value/100.0));_update_cl();});_b.postRegisterEvent(e,function(evt){b=parseInt(255*(evt.value/100.0));_update_cl();});}});}function __circlecolorPicker(p){var RADIUS=110;var rRadius=255;var q=$igk(p);var m_cl={r:0,g:0,b:0};var m_angle=0;var m_d=0;var r=q.select(".igk-circ-pan").getItemAt(0);var m_st=false;var cur=igk.createNode("div");var trackv=q.select(".igk-circ-v").getItemAt(0);var trackb=q.select(".igk-trb").getItemAt(0);var m_data=igk.JSON.parse(q.getAttribute("igk-data"));var tvalue=q.select("#clvalue").getItemAt(0);if(tvalue){tvalue.addClass("alignc");}trackb.o['trb']={trackv:trackv,update:function(v){this.trackv.setHtml(v);rRadius=parseInt(v*255 / 100);m_cl=__getColor(m_angle,m_d);__updateview();}};trackb.o.setAttribute("igk-trb-data","{update: function(d){ if (!d.bar.rep) d.bar.rep = d.bar.target.o['trb']; d.bar.rep.update(d.progress); } }");cur.setCss({border:"1px solid black",backgroundColor:"white",width:"4px",height:"4px",position:'absolute' });var ti=igk.createNode("div");ti.setCss({border:"1px solid #444",backgroundColor:"white",width:"100%",top:'50%',height:"1px",position:'absolute' });var tr=igk.createNode("div");tr.setCss({border:"1px solid #444",backgroundColor:"white",width:"1px",height:"100%",top:"0px",marginLeft:"50%",position:'absolute' });r.o.appendChild(cur.o);r.o.appendChild(tr.o);r.o.appendChild(ti.o);q.addEvent("igk-valuechange",{value:null,hexValue:null});igk.appendProperties(this,{init:function(){var W=r.getWidth();var H=r.getHeight();cur.setCss({"left":((W/2))+"px","top":((H/2))+"px" });}});function __getAngle(x1,y1,x2,y2){var dx,dy;dx=x2-x1;dy=y2-y1;if((dx==0.0)&&(dy==0.0)){return 0.0;}if(dx==0.0){if(dy>0){return(Math.PI / 2.0);}else return(-Math.PI / 2.0);}var angle=Math.atan2(dy,dx);if((dx<0)&&(dy<0))angle+=(2*Math.PI);return angle;}function __getColor(a,r){var h=(a*255 / 360.0);var s=(r / 110)*255.0;var v=rRadius;if(h<0)h=255+h;return igk.color.HSVtoColor(h,s,v);}function __updateview(){var cl=m_cl;var txt="rgb("+cl.r+", "+cl.g+", "+cl.b+")";if(q.getAttribute("demo")){var txt="rgb("+cl.r+", "+cl.g+", "+cl.b+")";var gp=$igk(".igk-row").setCss({backgroundColor:txt});}var e=q.o["igk-valuechange"];e.value=txt;e.hexValue="#"+igk.system.convert.ToBase(cl.r,16,2)+igk.system.convert.ToBase(cl.g,16,2)+igk.system.convert.ToBase(cl.b,16,2);if(tvalue !=null){tvalue.o.value=e.hexValue;}if(m_data && m_data.update){m_data.update.apply(q,[e]);}q.raiseEvent("igk-valuechange");};function __update(evt){if(!m_st)return;var l=r.getScreenLocation();var W=r.getWidth();var H=r.getHeight();var Cx=W/2;var Cy=H/2;var m_s=parseInt(Math.max(0,Math.min(evt.clientX-l.x,W))-Cx);var m_y=parseInt(Math.max(0,Math.min(evt.clientY-l.y,H))-Cy);var d=Math.sqrt((m_s*m_s)+(m_y*m_y));var PI=3.1415926;m_angle=__getAngle(0,0,m_s,m_y)*180/ PI;d=Math.min(RADIUS,d);m_d=d;var loc={x:Cx-2+parseInt((d*Math.cos(m_angle*PI / 180))),y:Cy-2+parseInt((d*Math.sin(m_angle*PI / 180)))};cur.setCss({"left":loc.x+"px","top":loc.y+"px" });m_cl=__getColor(m_angle,d);__updateview();}r.reg_event("mousedown",function(evt){if(m_st)return;m_st=true;igk.winui.mouseCapture.setCapture(q.o);__update(evt);});r.reg_event("mousemove",function(evt){if(!m_st)return;__update(evt);});r.reg_event("mouseup",function(evt){igk.winui.mouseCapture.releaseCapture();if(!m_st)return;__update(evt);m_st=false;});}igk.system.createNS("igk.winui.components.colorpicker",{init:function(){var q=igk.getParentScript();if(q){var p=new __colorPicker(q);igk.ready(function(){p.init();})}}});igk.system.createNS("igk.winui.components.circleColorPicker",{init:function(){var q=igk.getParentScript();if(q){var p=new __circlecolorPicker(q);igk.ready(function(){p.init();})}}});})();"use strict";(function(){var g_panes=[];var ckeys=['.igk-pane-page','.igk-pane','.hpane-bz'];var ifc=igk.fn.isItemStyleSupport;var support_transition=0;igk.winui.horizontalScrollPane=function(t){this.host=t;var m_init=0;var _idx=g_panes.length;var pane=t.select(ckeys[1]).first();var bz=t.select(ckeys[2]).first();var _pos=0;var _bullets=[];var opts=igk.initObj(igk.JSON.parse(t.getAttribute("igk:data")),{style:'rotation',showBullets:1,showNav:1,animDuration:5000,autoAnim:1 });var q=this;var tout=0;function __startAnim(){if(tout)clearTimeout(tout);if((_pos+1)<__items().getCount()){q.goNext();}else{_pos=0;q.scrollTo(0);}};function __restartAnim(){if(tout)clearTimeout(tout);if(opts.autoAnim){tout=setTimeout(__startAnim,opts.animDuration);}}function __items(){return pane.select(ckeys[0]);};function __updateBullet(){if(!opts.showBullets)return;if(_bullets.active){_bullets.active.rmClass("igk-active");}_bullets.active=_bullets[_pos];_bullets.active.addClass("igk-active");};igk.appendProperties(this,{remove:function(){t.remove();delete(this);},goNext:function(){var s=pane.select(ckeys[0]);if((_pos>=0)&&(_pos<s.getCount()-1)){_pos++;this.scrollTo(_pos);}},goPrev:function(){var s=pane.select(ckeys[0]);if(_pos>0){_pos--;this.scrollTo(_pos);}},scrollTo:function(c){var s=pane.select(ckeys[0]);if(igk.isInteger(c)){c=s.getItemAt(c).o;}var posx,posy;if(igk.navigator.isFirefox()){if(!m_init){s.each_all(function(){this.setCss({"left":"0%"});});m_init=1;}if(c.offsetLeft !=0){var l=$igk(c).getComputedStyle('left');posx=((c.offsetLeft-igk.getNumber(l))/pane.o.offsetWidth)*100;s.each_all(function(){this.setCss({"left":-posx+"%"});});}}else{posx=100*c.offsetLeft / pane.o.offsetWidth;posy=100*c.offsetTop / pane.o.offsetHeight;var f="translate(-"+posx+"%, -"+posy+"%)";s.each_all(function(){this.setCss({"transform":f});});}__updateBullet();__restartAnim();},reset:function(){if(igk.navigator.isFirefox()){__items().each_all(function(){this.setCss({"left":"0px"});});}else{__items().each_all(function(){this.o.style.transform=null;});}var fl=pane.o.scrollTo||pane.o.scroll;if(fl)fl.apply(pane.o,[0,0]);_pos=0;__updateBullet();}});g_panes[_idx]=this;var l=__items().getCount();bz.setHtml("");if(opts.showBullets){for(var i=0;(l>1)&&(i<l);i++){var e=igk.createNode("div").addClass("hpane-b").reg_event('click',(function(i){return function(e){_pos=i;q.scrollTo(i);};})(i));bz.add(e);_bullets.push(e);}__updateBullet();}if(opts.showNav){t.add("div").addClass("hpane-btn hpane-btn-n").setCss({"right":"2px","top":"50%","marginTop":"-24px"}).reg_event("click",function(){q.goNext();});t.add("div").addClass("hpane-btn hpane-btn-p").setCss({"left":"2px","top":"50%","marginTop":"-24px"}).reg_event("click",function(){q.goPrev();});}if(opts.autoAnim){setTimeout(__startAnim,opts.animDuration);}};var _class_=igk.winui.horizontalScrollPane;igk.system.createNS("igk.winui.horizontalScrollPane",{init:function(t){var q=$igk(t);var pane=new _class_(q);pane.reset();window.pan=pane;return pane;},item:function(i){return g_panes[i];}});igk.ready(function(){support_transition=ifc(document.body,'transition')&& ifc(document.body,'transform');});})();"use strict";(function(){function _sliderObj(q,p){var btnl=igk.createNode("div").addClass("igk-btn-slider igk-pull-left");var btnr=igk.createNode("div").addClass("igk-btn-slider igk-pull-right");var sliderz=igk.createNode("div").addClass("igk-slider-z");var pages=[];var m_vpage=0;var self=this;var property={orientation:'horizontal',filter:_filter};if(p.orientation &&(p.orientation=='vertical')){q.addClass("vertical");property.orientation="vertical";}function _update(){if(m_vpage>0){btnl.addClass("igk-active");}else btnl.rmClass("igk-active");if((m_vpage>=0)&&(m_vpage<(pages.length-1))){btnr.addClass("igk-active");}else btnr.rmClass("igk-active");}function _filter(i){if((i.o.tagName.toLowerCase()=='script')||(i.o==btnl.o)||(i.o==btnr.o))return true;return false;}function _init(){pages=[];q.select(".igk-slider-page").each(function(){if(this.o.parentNode==q.o){pages.push(this);sliderz.add(this);}return true;});_update();}function _moveleft(evt){evt.preventDefault();if(m_vpage>0){m_vpage--;ns_igk.winui.fn.navigateTo(pages[m_vpage].o,property).apply(this,evt);}_update();};function _moveright(evt){evt.preventDefault();if(m_vpage<self.getCount()-1){m_vpage++;ns_igk.winui.fn.navigateTo(pages[m_vpage].o,property).apply(this,evt);}_update();};btnl.reg_event("click",_moveleft);btnr.reg_event("click",_moveright);q.add(sliderz);q.add(btnl);q.add(btnr);igk.appendProperties(this,{getVisiblePageIndex:function(){return m_vpage;},getCount:function(){return pages.length;},init:_init });_init();}igk.system.createNS("igk.winui.slider",{init:function(p){var q=$igk(igk.getParentScript());var slider=new _sliderObj(q,p);}});})();"uses strict";(function(){function __create(){var d=igk.createNode("div");d.addClass("igk-line-waiter");d.setAttribute("model","js");d.add("div").addClass("igk-line-waiter-cur");d.add("div").addClass("igk-line-waiter-cur");d.add("div").addClass("igk-line-waiter-cur");d.control={initialize:false,type:'linewaiter'};return d;}igk.system.createNS("igk.winui.lineWaiter",{init:function(q){q=q||$igk(igk.getParentScript());if(q.control &&(q.control.type=='linewaiter')){if(q.control.initialize)return;q.control.initialize=true;}igk.ready(function(){var s=q.select(".igk-line-waiter-cur");if(s.getCount()>0)s.waitInterval(500,function(){var self=this;var levent=null;function _t_e(evt){var g=$igk(igk.winui.eventTarget(evt));if((self.o==g.o)&&(evt.propertyName=="right")){if(igk.system.regex.item_match_class("igk-animate",g.o)){g.rmClass("igk-animate");}else{g.addClass("igk-animate");}}}this.reg_event("transitionend",_t_e).addClass("igk-animate");});});},addTo:function(t){var d=__create();$igk(t).add(d);igk.winui.lineWaiter.init(d);return d;},prependTo:function(t){var d=__create();$igk(t).prepend(d);igk.winui.lineWaiter.init(d);return d;},remove:function(t){$igk(t).select(".igk-line-waiter").each(function(){this.remove();return true;});}});})();(function(){var defs={};var register_3795=function(id){var module=dem(id);var fragments=id.split('.');var target=Function('return this;')();for(var i=0;i<fragments.length-1;++i){if(target[fragments[i]]===undefined)target[fragments[i]]={};target=target[fragments[i]];}target[fragments[fragments.length-1]]=module;};var instantiate=function(id){var actual=defs[id];var dependencies=actual.deps;var definition=actual.defn;var len=dependencies.length;var instances=new Array(len);for(var i=0;i<len;++i)instances[i]=dem(dependencies[i]);var defResult=definition.apply(null,instances);if(defResult===undefined)throw 'module ['+id+'] returned undefined';actual.instance=defResult;};var def=function(id,dependencies,definition){if(typeof id !=='string')throw 'module id must be a string';else if(dependencies===undefined)throw 'no dependencies for '+id;else if(definition===undefined)throw 'no definition function for '+id;defs[id]={deps:dependencies,defn:definition,instance:undefined};};var dem=function(id){var actual=defs[id];if(actual===undefined)throw 'module ['+id+'] was undefined';else if(actual.instance===undefined)instantiate(id);return actual.instance;};var req=function(ids,callback){var len=ids.length;var instances=new Array(len);for(var i=0;i<len;++i)instances[i]=dem(ids[i]);callback.apply(null,instances);};var ephox={};ephox.bolt={module:{api:{define:def,require:req,demand:dem}}};var define=def;var require=req;var demand=dem;var defineGlobal=function(id,ref){define(id,[],function(){return ref;});};defineGlobal("global!Array",Array);defineGlobal("global!Error",Error);define('ephox.katamari.api.Fun',['global!Array','global!Error'],function(Array,Error){var noop=function(){};var noarg=function(f){return function(){return f();};};var compose=function(fa,fb){return function(){return fa(fb.apply(null,arguments));};};var constant=function(value){return function(){return value;};};var identity=function(x){return x;};var tripleEquals=function(a,b){return a===b;};var curry=function(f){var args=new Array(arguments.length-1);for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];return function(){var newArgs=new Array(arguments.length);for(var j=0;j<newArgs.length;j++)newArgs[j]=arguments[j];var all=args.concat(newArgs);return f.apply(null,all);};};var not=function(f){return function(){return !f.apply(null,arguments);};};var die=function(msg){return function(){throw new Error(msg);};};var apply=function(f){return f();};var call=function(f){f();};var never=constant(false);var always=constant(true);return{noop:noop,noarg:noarg,compose:compose,constant:constant,identity:identity,tripleEquals:tripleEquals,curry:curry,not:not,die:die,apply:apply,call:call,never:never,always:always};});defineGlobal("global!window",window);defineGlobal("global!Object",Object);define('ephox.katamari.api.Option',['ephox.katamari.api.Fun','global!Object'],function(Fun,Object){var never=Fun.never;var always=Fun.always;var none=function(){return NONE;};var NONE=(function(){var eq=function(o){return o.isNone();};var call=function(thunk){return thunk();};var id=function(n){return n;};var noop=function(){};var me={fold:function(n,s){return n();},is:never,isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||'error: getOrDie called on none.');},or:id,orThunk:call,map:none,ap:none,each:noop,bind:none,flatten:none,exists:never,forall:always,filter:none,equals:eq,equals_:eq,toArray:function(){return[];},toString:Fun.constant("none()")};if(Object.freeze)Object.freeze(me);return me;})();var some=function(a){var constant_a=function(){return a;};var self=function(){return me;};var map=function(f){return some(f(a));};var bind=function(f){return f(a);};var me={fold:function(n,s){return s(a);},is:function(v){return a===v;},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,or:self,orThunk:self,map:map,ap:function(optfab){return optfab.fold(none,function(fab){return some(fab(a));});},each:function(f){f(a);},bind:bind,flatten:constant_a,exists:bind,forall:bind,filter:function(f){return f(a)? me :NONE;},equals:function(o){return o.is(a);},equals_:function(o,elementEq){return o.fold(never,function(b){return elementEq(a,b);});},toArray:function(){return[a];},toString:function(){return 'some('+a+')';}};return me;};var from=function(value){return value===null||value===undefined ? NONE :some(value);};return{some:some,none:none,from:from};});defineGlobal("global!String",String);define('ephox.katamari.api.Arr',['ephox.katamari.api.Option','global!Array','global!Error','global!String'],function(Option,Array,Error,String){var rawIndexOf=(function(){var pIndexOf=Array.prototype.indexOf;var fastIndex=function(xs,x){return pIndexOf.call(xs,x);};var slowIndex=function(xs,x){return slowIndexOf(xs,x);};return pIndexOf===undefined ? slowIndex :fastIndex;})();var indexOf=function(xs,x){var r=rawIndexOf(xs,x);return r===-1 ? Option.none():Option.some(r);};var contains=function(xs,x){return rawIndexOf(xs,x)>-1;};var exists=function(xs,pred){return findIndex(xs,pred).isSome();};var range=function(num,f){var r=[];for(var i=0;i<num;i++){r.push(f(i));}return r;};var chunk=function(array,size){var r=[];for(var i=0;i<array.length;i+=size){var s=array.slice(i,i+size);r.push(s);}return r;};var map=function(xs,f){var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i,xs);}return r;};var each=function(xs,f){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i,xs);}};var eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i,xs);}};var partition=function(xs,pred){var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i,xs)? pass :fail;arr.push(x);}return{pass:pass,fail:fail};};var filter=function(xs,pred){var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i,xs)){r.push(x);}}return r;};var groupBy=function(xs,f){if(xs.length===0){return[];}else{var wasType=f(xs[0]);var r=[];var group=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var type=f(x);if(type !==wasType){r.push(group);group=[];}wasType=type;group.push(x);}if(group.length !==0){r.push(group);}return r;}};var foldr=function(xs,f,acc){eachr(xs,function(x){acc=f(acc,x);});return acc;};var foldl=function(xs,f,acc){each(xs,function(x){acc=f(acc,x);});return acc;};var find=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i,xs)){return Option.some(x);}}return Option.none();};var findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i,xs)){return Option.some(i);}}return Option.none();};var slowIndexOf=function(xs,x){for(var i=0,len=xs.length;i<len;++i){if(xs[i]===x){return i;}}return-1;};var push=Array.prototype.push;var flatten=function(xs){var r=[];for(var i=0,len=xs.length;i<len;++i){if(! Array.prototype.isPrototypeOf(xs[i]))throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);push.apply(r,xs[i]);}return r;};var bind=function(xs,f){var output=map(xs,f);return flatten(output);};var forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i,xs)!==true){return false;}}return true;};var equal=function(a1,a2){return a1.length===a2.length && forall(a1,function(x,i){return x===a2[i];});};var slice=Array.prototype.slice;var reverse=function(xs){var r=slice.call(xs,0);r.reverse();return r;};var difference=function(a1,a2){return filter(a1,function(x){return !contains(a2,x);});};var mapToObject=function(xs,f){var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var pure=function(x){return[x];};var sort=function(xs,comparator){var copy=slice.call(xs,0);copy.sort(comparator);return copy;};var head=function(xs){return xs.length===0 ? Option.none():Option.some(xs[0]);};var last=function(xs){return xs.length===0 ? Option.none():Option.some(xs[xs.length-1]);};return{map:map,each:each,eachr:eachr,partition:partition,filter:filter,groupBy:groupBy,indexOf:indexOf,foldr:foldr,foldl:foldl,find:find,findIndex:findIndex,flatten:flatten,bind:bind,forall:forall,exists:exists,contains:contains,equal:equal,reverse:reverse,chunk:chunk,difference:difference,mapToObject:mapToObject,pure:pure,sort:sort,range:range,head:head,last:last};});defineGlobal("global!document",document);define('ephox.katamari.api.Global',[],function(){var global=typeof window !=='undefined' ? window :Function('return this;')();return global;});define('ephox.katamari.api.Resolve',['ephox.katamari.api.Global'],function(Global){var path=function(parts,scope){var o=scope !==undefined ? scope :Global;for(var i=0;i<parts.length && o !==undefined && o !==null;++i)o=o[parts[i]];return o;};var resolve=function(p,scope){var parts=p.split('.');return path(parts,scope);};var step=function(o,part){if(o[part]===undefined||o[part]===null)o[part]={};return o[part];};var forge=function(parts,target){var o=target !==undefined ? target :Global;for(var i=0;i<parts.length;++i)o=step(o,parts[i]);return o;};var namespace=function(name,target){var parts=name.split('.');return forge(parts,target);};return{path:path,resolve:resolve,forge:forge,namespace:namespace};});define('ephox.sand.util.Global',['ephox.katamari.api.Resolve'],function(Resolve){var unsafe=function(name,scope){return Resolve.resolve(name,scope);};var getOrDie=function(name,scope){var actual=unsafe(name,scope);if(actual===undefined)throw name+' not available on this browser';return actual;};return{getOrDie:getOrDie};});define('ephox.sand.api.URL',['ephox.sand.util.Global'],function(Global){var url=function(){return Global.getOrDie('URL');};var createObjectURL=function(blob){return url().createObjectURL(blob);};var revokeObjectURL=function(u){url().revokeObjectURL(u);};return{createObjectURL:createObjectURL,revokeObjectURL:revokeObjectURL};});defineGlobal("global!matchMedia",matchMedia);defineGlobal("global!navigator",navigator);define('tinymce.core.Env',['ephox.sand.api.URL','global!document','global!matchMedia','global!navigator','global!window'],function(URL,document,matchMedia,navigator,window){var nav=navigator,userAgent=nav.userAgent;var opera,webkit,ie,ie11,ie12,gecko,mac,iDevice,android,fileApi,phone,tablet,windowsPhone;var matchMediaQuery=function(query){return "matchMedia" in window ? matchMedia(query).matches :false;};opera=window.opera && window.opera.buildNumber;android=/Android/.test(userAgent);webkit=/WebKit/.test(userAgent);ie=!webkit && !opera &&(/MSIE/gi).test(userAgent)&&(/Explorer/gi).test(nav.appName);ie=ie && /MSIE (\w+)\./.exec(userAgent)[1];ie11=userAgent.indexOf('Trident/')!=-1 &&(userAgent.indexOf('rv:')!=-1||nav.appName.indexOf('Netscape')!=-1)? 11 :false;ie12=(userAgent.indexOf('Edge/')!=-1 && !ie && !ie11)? 12 :false;ie=ie||ie11||ie12;gecko=!webkit && !ie11 && /Gecko/.test(userAgent);mac=userAgent.indexOf('Mac')!=-1;iDevice=/(iPad|iPhone)/.test(userAgent);fileApi="FormData" in window && "FileReader" in window && "URL" in window && !!URL.createObjectURL;phone=matchMediaQuery("only screen and (max-device-width: 480px)")&&(android||iDevice);tablet=matchMediaQuery("only screen and (min-width: 800px)")&&(android||iDevice);windowsPhone=userAgent.indexOf('Windows Phone')!=-1;if(ie12){webkit=false;}var contentEditable=!iDevice||fileApi||userAgent.match(/AppleWebKit\/(\d*)/)[1]>=534;return{opera:opera,webkit:webkit,ie:ie,gecko:gecko,mac:mac,iOS:iDevice,android:android,contentEditable:contentEditable,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:ie !=8,range:window.getSelection && "Range" in window,documentMode:ie && !ie12 ?(document.documentMode||7):10,fileApi:fileApi,ceFalse:(ie===false||ie>8),canHaveCSP:(ie===false||ie>11),desktop:!phone && !tablet,windowsPhone:windowsPhone};});defineGlobal("global!clearInterval",clearInterval);defineGlobal("global!clearTimeout",clearTimeout);defineGlobal("global!setInterval",setInterval);defineGlobal("global!setTimeout",setTimeout);define('tinymce.core.util.Promise',[],function(){if(window.Promise){return window.Promise;}var asap=Promise.immediateFn||(typeof setImmediate==='function' && setImmediate)||function(fn){setTimeout(fn,1);};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments);};}var isArray=Array.isArray||function(value){return Object.prototype.toString.call(value)==="[object Array]";};function Promise(fn){if(typeof this !=='object')throw new TypeError('Promises must be constructed via new');if(typeof fn !=='function')throw new TypeError('not a function');this._state=null;this._value=null;this._deferreds=[];doResolve(fn,bind(resolve,this),bind(reject,this));}function handle(deferred){var me=this;if(this._state===null){this._deferreds.push(deferred);return;}asap(function(){var cb=me._state ? deferred.onFulfilled :deferred.onRejected;if(cb===null){(me._state ? deferred.resolve :deferred.reject)(me._value);return;}var ret;try{ret=cb(me._value);}catch(e){deferred.reject(e);return;}deferred.resolve(ret);});}function resolve(newValue){try{if(newValue===this)throw new TypeError('A promise cannot be resolved with itself.');if(newValue &&(typeof newValue==='object'||typeof newValue==='function')){var then=newValue.then;if(typeof then==='function'){doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this));return;}}this._state=true;this._value=newValue;finale.call(this);}catch(e){reject.call(this,e);}}function reject(newValue){this._state=false;this._value=newValue;finale.call(this);}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i]);}this._deferreds=null;}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled=typeof onFulfilled==='function' ? onFulfilled :null;this.onRejected=typeof onRejected==='function' ? onRejected :null;this.resolve=resolve;this.reject=reject;}function doResolve(fn,onFulfilled,onRejected){var done=false;try{fn(function(value){if(done)return;done=true;onFulfilled(value);},function(reason){if(done)return;done=true;onRejected(reason);});}catch(ex){if(done)return;done=true;onRejected(ex);}}Promise.prototype['catch']=function(onRejected){return this.then(null,onRejected);};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject));});};Promise.all=function(){var args=Array.prototype.slice.call(arguments.length===1 && isArray(arguments[0])? arguments[0]:arguments);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val &&(typeof val==='object'||typeof val==='function')){var then=val.then;if(typeof then==='function'){then.call(val,function(val){res(i,val);},reject);return;}}args[i]=val;if(--remaining===0){resolve(args);}}catch(ex){reject(ex);}}for(var i=0;i<args.length;i++){res(i,args[i]);}});};Promise.resolve=function(value){if(value && typeof value==='object' && value.constructor===Promise){return value;}return new Promise(function(resolve){resolve(value);});};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value);});};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject);}});};return Promise;});define('tinymce.core.util.Delay',['global!clearInterval','global!clearTimeout','global!document','global!setInterval','global!setTimeout','global!window','tinymce.core.util.Promise'],function(clearInterval,clearTimeout,document,setInterval,setTimeout,window,Promise){var requestAnimationFramePromise;var requestAnimationFrame=function(callback,element){var i,requestAnimationFrameFunc=window.requestAnimationFrame,vendors=['ms','moz','webkit'];var featurefill=function(callback){window.setTimeout(callback,0);};for(i=0;i<vendors.length && !requestAnimationFrameFunc;i++){requestAnimationFrameFunc=window[vendors[i]+'RequestAnimationFrame'];}if(!requestAnimationFrameFunc){requestAnimationFrameFunc=featurefill;}requestAnimationFrameFunc(callback,element);};var wrappedSetTimeout=function(callback,time){if(typeof time !='number'){time=0;}return setTimeout(callback,time);};var wrappedSetInterval=function(callback,time){if(typeof time !='number'){time=1;}return setInterval(callback,time);};var wrappedClearTimeout=function(id){return clearTimeout(id);};var wrappedClearInterval=function(id){return clearInterval(id);};var debounce=function(callback,time){var timer,func;func=function(){var args=arguments;clearTimeout(timer);timer=wrappedSetTimeout(function(){callback.apply(this,args);},time);};func.stop=function(){clearTimeout(timer);};return func;};return{requestAnimationFrame:function(callback,element){if(requestAnimationFramePromise){requestAnimationFramePromise.then(callback);return;}requestAnimationFramePromise=new Promise(function(resolve){if(!element){element=document.body;}requestAnimationFrame(resolve,element);}).then(callback);},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){if(!editor.removed){callback();}},time);},setEditorInterval:function(editor,callback,time){var timer;timer=wrappedSetInterval(function(){if(!editor.removed){callback();}else{clearInterval(timer);}},time);return timer;},debounce:debounce,throttle:debounce,clearInterval:wrappedClearInterval,clearTimeout:wrappedClearTimeout};});define('tinymce.core.dom.EventUtils',['global!document','global!window','tinymce.core.Env','tinymce.core.util.Delay'],function(document,window,Env,Delay){"use strict";var eventExpandoPrefix="mce-data-";var mouseEventRe=/^(?:mouse|contextmenu)|click/;var deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1};var hasIsDefaultPrevented=function(event){return event.isDefaultPrevented===returnTrue||event.isDefaultPrevented===returnFalse;};var returnFalse=function(){return false;};var returnTrue=function(){return true;};var addEvent=function(target,name,callback,capture){if(target.addEventListener){target.addEventListener(name,callback,capture||false);}else if(target.attachEvent){target.attachEvent('on'+name,callback);}};var removeEvent=function(target,name,callback,capture){if(target.removeEventListener){target.removeEventListener(name,callback,capture||false);}else if(target.detachEvent){target.detachEvent('on'+name,callback);}};var getTargetFromShadowDom=function(event,defaultTarget){var path,target=defaultTarget;path=event.path;if(path && path.length>0){target=path[0];}if(event.deepPath){path=event.deepPath();if(path && path.length>0){target=path[0];}}return target;};var fix=function(originalEvent,data){var name,event=data||{},undef;for(name in originalEvent){if(!deprecated[name]){event[name]=originalEvent[name];}}if(!event.target){event.target=event.srcElement||document;}if(Env.experimentalShadowDom){event.target=getTargetFromShadowDom(originalEvent,event.target);}if(originalEvent && mouseEventRe.test(originalEvent.type)&& originalEvent.pageX===undef && originalEvent.clientX !==undef){var eventDoc=event.target.ownerDocument||document;var doc=eventDoc.documentElement;var body=eventDoc.body;event.pageX=originalEvent.clientX+(doc && doc.scrollLeft||body && body.scrollLeft||0)-(doc && doc.clientLeft||body && body.clientLeft||0);event.pageY=originalEvent.clientY+(doc && doc.scrollTop||body && body.scrollTop||0)-(doc && doc.clientTop||body && body.clientTop||0);}event.preventDefault=function(){event.isDefaultPrevented=returnTrue;if(originalEvent){if(originalEvent.preventDefault){originalEvent.preventDefault();}else{originalEvent.returnValue=false;}}};event.stopPropagation=function(){event.isPropagationStopped=returnTrue;if(originalEvent){if(originalEvent.stopPropagation){originalEvent.stopPropagation();}else{originalEvent.cancelBubble=true;}}};event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue;event.stopPropagation();};if(hasIsDefaultPrevented(event)===false){event.isDefaultPrevented=returnFalse;event.isPropagationStopped=returnFalse;event.isImmediatePropagationStopped=returnFalse;}if(typeof event.metaKey=='undefined'){event.metaKey=false;}return event;};var bindOnReady=function(win,callback,eventUtils){var doc=win.document,event={type:'ready'};if(eventUtils.domLoaded){callback(event);return;}var isDocReady=function(){return doc.readyState==="complete"||(doc.readyState==="interactive" && doc.body);};var readyHandler=function(){if(!eventUtils.domLoaded){eventUtils.domLoaded=true;callback(event);}};var waitForDomLoaded=function(){if(isDocReady()){removeEvent(doc,"readystatechange",waitForDomLoaded);readyHandler();}};var tryScroll=function(){try{doc.documentElement.doScroll("left");}catch(ex){Delay.setTimeout(tryScroll);return;}readyHandler();};if(doc.addEventListener && !(Env.ie && Env.ie<11)){if(isDocReady()){readyHandler();}else{addEvent(win,'DOMContentLoaded',readyHandler);}}else{addEvent(doc,"readystatechange",waitForDomLoaded);if(doc.documentElement.doScroll && win.self===win.top){tryScroll();}}addEvent(win,'load',readyHandler);};var EventUtils=function(){var self=this,events={},count,expando,hasFocusIn,hasMouseEnterLeave,mouseEnterLeave;expando=eventExpandoPrefix+(+new Date()).toString(32);hasMouseEnterLeave="onmouseenter" in document.documentElement;hasFocusIn="onfocusin" in document.documentElement;mouseEnterLeave={mouseenter:'mouseover',mouseleave:'mouseout'};count=1;self.domLoaded=false;self.events=events;var executeHandlers=function(evt,id){var callbackList,i,l,callback,container=events[id];callbackList=container && container[evt.type];if(callbackList){for(i=0,l=callbackList.length;i<l;i++){callback=callbackList[i];if(callback && callback.func.call(callback.scope,evt)===false){evt.preventDefault();}if(evt.isImmediatePropagationStopped()){return;}}}};self.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,win=window;var defaultNativeHandler=function(evt){executeHandlers(fix(evt||win.event),id);};if(!target||target.nodeType===3||target.nodeType===8){return;}if(!target[expando]){id=count++;target[expando]=id;events[id]={};}else{id=target[expando];}scope=scope||target;names=names.split(' ');i=names.length;while(i--){name=names[i];nativeHandler=defaultNativeHandler;fakeName=capture=false;if(name==="DOMContentLoaded"){name="ready";}if(self.domLoaded && name==="ready" && target.readyState=='complete'){callback.call(scope,fix({type:name}));continue;}if(!hasMouseEnterLeave){fakeName=mouseEnterLeave[name];if(fakeName){nativeHandler=function(evt){var current,related;current=evt.currentTarget;related=evt.relatedTarget;if(related && current.contains){related=current.contains(related);}else{while(related && related !==current){related=related.parentNode;}}if(!related){evt=fix(evt||win.event);evt.type=evt.type==='mouseout' ? 'mouseleave' :'mouseenter';evt.target=current;executeHandlers(evt,id);}};}}if(!hasFocusIn &&(name==="focusin"||name==="focusout")){capture=true;fakeName=name==="focusin" ? "focus" :"blur";nativeHandler=function(evt){evt=fix(evt||win.event);evt.type=evt.type==='focus' ? 'focusin' :'focusout';executeHandlers(evt,id);};}callbackList=events[id][name];if(!callbackList){events[id][name]=callbackList=[{func:callback,scope:scope}];callbackList.fakeName=fakeName;callbackList.capture=capture;callbackList.nativeHandler=nativeHandler;if(name==="ready"){bindOnReady(target,nativeHandler,self);}else{addEvent(target,fakeName||name,nativeHandler,capture);}}else{if(name==="ready" && self.domLoaded){callback({type:name});}else{callbackList.push({func:callback,scope:scope});}}}target=callbackList=0;return callback;};self.unbind=function(target,names,callback){var id,callbackList,i,ci,name,eventMap;if(!target||target.nodeType===3||target.nodeType===8){return self;}id=target[expando];if(id){eventMap=events[id];if(names){names=names.split(' ');i=names.length;while(i--){name=names[i];callbackList=eventMap[name];if(callbackList){if(callback){ci=callbackList.length;while(ci--){if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler;var fakeName=callbackList.fakeName,capture=callbackList.capture;callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));callbackList.nativeHandler=nativeHandler;callbackList.fakeName=fakeName;callbackList.capture=capture;eventMap[name]=callbackList;}}}if(!callback||callbackList.length===0){delete eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);}}}}else{for(name in eventMap){callbackList=eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);}eventMap={};}for(name in eventMap){return self;}delete events[id];try{delete target[expando];}catch(ex){target[expando]=null;}}return self;};self.fire=function(target,name,args){var id;if(!target||target.nodeType===3||target.nodeType===8){return self;}args=fix(null,args);args.type=name;args.target=target;do{id=target[expando];if(id){executeHandlers(args,id);}target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow;}while(target && !args.isPropagationStopped());return self;};self.clean=function(target){var i,children,unbind=self.unbind;if(!target||target.nodeType===3||target.nodeType===8){return self;}if(target[expando]){unbind(target);}if(!target.getElementsByTagName){target=target.document;}if(target && target.getElementsByTagName){unbind(target);children=target.getElementsByTagName('*');i=children.length;while(i--){target=children[i];if(target[expando]){unbind(target);}}}return self;};self.destroy=function(){events={};};self.cancel=function(e){if(e){e.preventDefault();e.stopImmediatePropagation();}return false;};};EventUtils.Event=new EventUtils();EventUtils.Event.bind(window,'ready',function(){});return EventUtils;});define('tinymce.core.dom.Sizzle',[],function(){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-(new Date()),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true;}return 0;},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i;}}return-1;},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={"ID":new RegExp("^#("+identifier+")"),"CLASS":new RegExp("^\\.("+identifier+")"),"TAG":new RegExp("^("+identifier+"|[*])"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"CHILD":new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"bool":new RegExp("^(?:"+booleans+")$","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-0x10000;return high !==high||escapedWhitespace ? escaped :high<0 ? String.fromCharCode(high+0x10000):String.fromCharCode(high>>10|0xD800,high & 0x3FF|0xDC00);};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType;}catch(e){push={apply:arr.length ? function(target,els){push_native.apply(target,slice.call(els));}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1;}};}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context ? context.ownerDocument||context :preferredDoc)!==document){setDocument(context);}context=context||document;results=results||[];if(!selector||typeof selector !=="string"){return results;}if((nodeType=context.nodeType)!==1 && nodeType !==9){return[];}if(documentIsHTML && !seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem && elem.parentNode){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(context.ownerDocument &&(elem=context.ownerDocument.getElementById(m))&& contains(context,elem)&& elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results;}else if((m=match[3])&& support.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results;}}if(support.qsa &&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9 && selector;if(nodeType===1 && context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&");}else{context.setAttribute("id",nid);}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i]);}newContext=rsibling.test(selector)&& testContext(context.parentNode)||context;newSelector=groups.join(",");}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){}finally{if(!old){context.removeAttribute("id");}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed);}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()];}return(cache[key+" "]=value);}return cache;}function markFunction(fn){fn[expando]=true;return fn;}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler;}}function siblingCheck(a,b){var cur=b && a,diff=cur && a.nodeType===1 && b.nodeType===1 &&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff;}if(cur){while((cur=cur.nextSibling)){if(cur===b){return-1;}}}return a ? 1 :-1;}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input" && elem.type===type;};}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&& elem.type===type;};}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}function testContext(context){return context && typeof context.getElementsByTagName !==strundefined && context;}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem &&(elem.ownerDocument||elem).documentElement;return documentElement ? documentElement.nodeName !=="HTML" :false;};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node ? node.ownerDocument||node :preferredDoc,parent=doc.defaultView;function getTop(win){try{return win.top;}catch(ex){}return null;}if(doc===document||doc.nodeType !==9||!doc.documentElement){return document;}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent && parent !==getTop(parent)){if(parent.addEventListener){parent.addEventListener("unload",function(){setDocument();},false);}else if(parent.attachEvent){parent.attachEvent("onunload",function(){setDocument();});}}support.attributes=true;support.getElementsByTagName=true;support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=true;Expr.find["ID"]=function(id,context){if(typeof context.getElementById !==strundefined && documentIsHTML){var m=context.getElementById(id);return m && m.parentNode ?[m]:[];}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId;};};Expr.find["TAG"]=support.getElementsByTagName ? function(tag,context){if(typeof context.getElementsByTagName !==strundefined){return context.getElementsByTagName(tag);}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem);}}return tmp;}return results;};Expr.find["CLASS"]=support.getElementsByClassName && function(className,context){if(documentIsHTML){return context.getElementsByClassName(className);}};rbuggyMatches=[];rbuggyQSA=[];support.disconnectedMatch=true;rbuggyQSA=rbuggyQSA.length && new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length && new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)? function(a,b){var adown=a.nodeType===9 ? a.documentElement :a,bup=b && b.parentNode;return a===bup||!!(bup && bup.nodeType===1 &&(adown.contains ? adown.contains(bup):a.compareDocumentPosition && a.compareDocumentPosition(bup)& 16));}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true;}}}return false;};sortOrder=hasCompare ? function(a,b){if(a===b){hasDuplicate=true;return 0;}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;}compare=(a.ownerDocument||a)===(b.ownerDocument||b)? a.compareDocumentPosition(b):1;if(compare & 1||(!support.sortDetached && b.compareDocumentPosition(a)===compare)){if(a===doc||a.ownerDocument===preferredDoc && contains(preferredDoc,a)){return-1;}if(b===doc||b.ownerDocument===preferredDoc && contains(preferredDoc,b)){return 1;}return sortInput ?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0;}return compare & 4 ?-1 :1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc ?-1 :b===doc ? 1 :aup ?-1 :bup ? 1 :sortInput ?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0;}else if(aup===bup){return siblingCheck(a,b);}cur=a;while((cur=cur.parentNode)){ap.unshift(cur);}cur=b;while((cur=cur.parentNode)){bp.unshift(cur);}while(ap[i]===bp[i]){i++;}return i ? siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc ?-1 :bp[i]===preferredDoc ? 1 :0;};return doc;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem);}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector && documentIsHTML &&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document && elem.document.nodeType !==11){return ret;}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0;};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context);}return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem);}var fn=Expr.attrHandle[name.toLowerCase()],val=fn && hasOwn.call(Expr.attrHandle,name.toLowerCase())? fn(elem,name,!documentIsHTML):undefined;return val !==undefined ? val :support.attributes||!documentIsHTML ? elem.getAttribute(name):(val=elem.getAttributeNode(name))&& val.specified ? val.value :null;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable && results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i);}}while(j--){results.splice(duplicates[j],1);}}sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while((node=elem[i++])){ret+=getText(node);}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" ";}return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0]);}match[4]=+(match[4]? match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd");}else if(match[3]){Sizzle.error(match[0]);}return match;},"PSEUDO":function(match){var excess,unquoted=!match[6]&& match[2];if(matchExpr["CHILD"].test(match[0])){return null;}if(match[3]){match[2]=match[4]||match[5]||"";}else if(unquoted && rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess);}return match.slice(0,3);}},filter:{"TAG":function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*" ? function(){return true;}:function(elem){return elem.nodeName && elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&& classCache(className,function(elem){return pattern.test(typeof elem.className==="string" && elem.className||typeof elem.getAttribute !==strundefined && elem.getAttribute("class")||"");});},"ATTR":function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}if(!operator){return true;}result+="";return operator==="=" ? result===check :operator==="!=" ? result !==check :operator==="^=" ? check && result.indexOf(check)===0 :operator==="*=" ? check && result.indexOf(check)>-1 :operator==="$=" ? check && result.slice(-check.length)===check :operator==="~=" ?(" "+result+" ").indexOf(check)>-1 :operator==="|=" ? result===check||result.slice(0,check.length+1)===check+"-" :false;};},"CHILD":function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1 && last===0 ? function(elem){return !!elem.parentNode;}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple !==forward ? "nextSibling" :"previousSibling",parent=elem.parentNode,name=ofType && elem.nodeName.toLowerCase(),useCache=!xml && !ofType;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType ? node.nodeName.toLowerCase()===name :node.nodeType===1){return false;}}start=dir=type==="only" && !start && "nextSibling";}return true;}start=[forward ? parent.firstChild :parent.lastChild];if(forward && useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns && cache[1];diff=cache[0]===dirruns && cache[2];node=nodeIndex && parent.childNodes[nodeIndex];while((node=++nodeIndex && node && node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1 &&++diff && node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break;}}}else if(useCache &&(cache=(elem[expando]||(elem[expando]={}))[type])&& cache[0]===dirruns){diff=cache[1];}else{while((node=++nodeIndex && node && node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType ? node.nodeName.toLowerCase()===name :node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff];}if(node===elem){break;}}}}diff-=last;return diff===first||(diff% first===0 && diff / first>=0);}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())? markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]? markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return !results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"lang":markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang);}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML ? elem.lang :elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0;}}while((elem=elem.parentNode)&& elem.nodeType===1);return false;};}),"target":function(elem){var hash=window.location && window.location.hash;return hash && hash.slice(1)===elem.id;},"root":function(elem){return elem===docElem;},"focus":function(elem){return elem===document.activeElement &&(!document.hasFocus||document.hasFocus())&& !!(elem.type||elem.href||~elem.tabIndex);},"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input" && !!elem.checked)||(nodeName==="option" && !!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}return elem.selected===true;},"empty":function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;}}return true;},"parent":function(elem){return !Expr.pseudos["empty"](elem);},"header":function(elem){return rheader.test(elem.nodeName);},"input":function(elem){return rinputs.test(elem.nodeName);},"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input" && elem.type==="button"||name==="button";},"text":function(elem){var attr;return elem.nodeName.toLowerCase()==="input" && elem.type==="text" &&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text");},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0 ? argument+length :argument];}),"even":createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0 ? argument+length :argument;for(;--i>=0;){matchIndexes.push(i);}return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0 ? argument+length :argument;for(;++i<length;){matchIndexes.push(i);}return matchIndexes;})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i);}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i);}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly ? 0 :cached.slice(0);}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}groups.push((tokens=[]));}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length);}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}if(!matched){break;}}return parseOnly ? soFar.length :soFar ? Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value;}return selector;}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base && dir==="parentNode",doneName=done++;return combinator.first ? function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&& oldCache[0]===dirruns && oldCache[1]===doneName){return(newCache[2]=oldCache[2]);}else{outerCache[dir]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true;}}}}}};}function elementMatcher(matchers){return matchers.length>1 ? function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}return true;}:matchers[0];}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}return results;}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map !=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}return newUnmatched;}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter && !postFilter[expando]){postFilter=setMatcher(postFilter);}if(postFinder && !postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType ?[context]:context,[]),matcherIn=preFilter &&(seed||!selector)? condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher ? postFinder||(seed ? preFilter :preexisting||postFilter)?[]:results :matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}postFinder(null,(matcherOut=[]),temp,xml);}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder ? indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results ? matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative ? 1 :0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative &&(xml||context !==outermostContext))||((checkContext=context).nodeType ? matchContext(elem,context,xml):matchAnyContext(elem,context,xml));}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}return setMatcher(i>1 && elementMatcher(matchers),i>1 && toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" " ? "*" :""})).replace(rtrim,"$1"),matcher,i<j && matcherFromTokens(tokens.slice(i,j)),j<len && matcherFromTokens((tokens=tokens.slice(j))),j<len && toSelector(tokens));}matchers.push(matcher);}}return elementMatcher(matchers);}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed &&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement && Expr.find["TAG"]("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null ? 1 :Math.random()||0.1),len=elems.length;if(outermost){outermostContext=context !==document && context;}for(;i !==len &&(elem=elems[i])!=null;i++){if(byElement && elem){j=0;while((matcher=elementMatchers[j++])){if(matcher(elem,context,xml)){results.push(elem);break;}}if(outermost){dirruns=dirrunsUnique;}}if(bySet){if((elem=!matcher && elem)){matchedCount--;}if(seed){unmatched.push(elem);}}}matchedCount+=i;if(bySet && i !==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml);}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}setMatched=condense(setMatched);}push.apply(results,setMatched);if(outermost && !seed && setMatched.length>0 &&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}return unmatched;};return bySet ? markFunction(superMatcher):superMatcher;}compile=Sizzle.compile=function(selector,match ){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector);}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector;}return cached;};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function" && selector,match=!seed && tokenize((selector=compiled.selector||selector));results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2 &&(token=tokens[0]).type==="ID" && support.getById && context.nodeType===9 && documentIsHTML && Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results;}else if(compiled){context=context.parentNode;}selector=selector.slice(tokens.shift().value.length);}i=matchExpr["needsContext"].test(selector)? 0 :tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&& testContext(context.parentNode)||context))){tokens.splice(i,1);selector=seed.length && toSelector(tokens);if(!selector){push.apply(results,seed);return results;}break;}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&& testContext(context.parentNode)||context);return results;};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=true;return Sizzle;});define('tinymce.core.util.Arr',[],function(){var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};var toArray=function(obj){var array=obj,i,l;if(!isArray(obj)){array=[];for(i=0,l=obj.length;i<l;i++){array[i]=obj[i];}}return array;};var each=function(o,cb,s){var n,l;if(!o){return 0;}s=s||o;if(o.length !==undefined){for(n=0,l=o.length;n<l;n++){if(cb.call(s,o[n],n,o)===false){return 0;}}}else{for(n in o){if(o.hasOwnProperty(n)){if(cb.call(s,o[n],n,o)===false){return 0;}}}}return 1;};var map=function(array,callback){var out=[];each(array,function(item,index){out.push(callback(item,index,array));});return out;};var filter=function(a,f){var o=[];each(a,function(v,index){if(!f||f(v,index,a)){o.push(v);}});return o;};var indexOf=function(a,v){var i,l;if(a){for(i=0,l=a.length;i<l;i++){if(a[i]===v){return i;}}}return-1;};var reduce=function(collection,iteratee,accumulator,thisArg){var i=0;if(arguments.length<3){accumulator=collection[0];}for(;i<collection.length;i++){accumulator=iteratee.call(thisArg,accumulator,collection[i],i);}return accumulator;};var findIndex=function(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++){if(predicate.call(thisArg,array[i],i,array)){return i;}}return-1;};var find=function(array,predicate,thisArg){var idx=findIndex(array,predicate,thisArg);if(idx !==-1){return array[idx];}return undefined;};var last=function(collection){return collection[collection.length-1];};return{isArray:isArray,toArray:toArray,each:each,map:map,filter:filter,indexOf:indexOf,reduce:reduce,findIndex:findIndex,find:find,last:last};});define('tinymce.core.util.Tools',['global!window','tinymce.core.Env','tinymce.core.util.Arr'],function(window,Env,Arr){var whiteSpaceRegExp=/^\s*|\s*$/g;var trim=function(str){return(str===null||str===undefined)? '' :(""+str).replace(whiteSpaceRegExp,'');};var is=function(obj,type){if(!type){return obj !==undefined;}if(type=='array' && Arr.isArray(obj)){return true;}return typeof obj==type;};var makeMap=function(items,delim,map){var i;items=items||[];delim=delim||',';if(typeof items=="string"){items=items.split(delim);}map=map||{};i=items.length;while(i--){map[items[i]]={};}return map;};var hasOwnProperty=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);};var create=function(s,p,root){var self=this,sp,ns,cn,scn,c,de=0;s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s);cn=s[3].match(/(^|\.)(\w+)$/i)[2];ns=self.createNS(s[3].replace(/\.\w+$/,''),root);if(ns[cn]){return;}if(s[2]=='static'){ns[cn]=p;if(this.onCreate){this.onCreate(s[2],s[3],ns[cn]);}return;}if(!p[cn]){p[cn]=function(){};de=1;}ns[cn]=p[cn];self.extend(ns[cn].prototype,p);if(s[5]){sp=self.resolve(s[5]).prototype;scn=s[5].match(/\.(\w+)$/i)[1];c=ns[cn];if(de){ns[cn]=function(){return sp[scn].apply(this,arguments);};}else{ns[cn]=function(){this.parent=sp[scn];return c.apply(this,arguments);};}ns[cn].prototype[cn]=ns[cn];self.each(sp,function(f,n){ns[cn].prototype[n]=sp[n];});self.each(p,function(f,n){if(sp[n]){ns[cn].prototype[n]=function(){this.parent=sp[n];return f.apply(this,arguments);};}else{if(n !=cn){ns[cn].prototype[n]=f;}}});}self.each(p['static'],function(f,n){ns[cn][n]=f;});};var extend=function(obj,ext){var i,l,name,args=arguments,value;for(i=1,l=args.length;i<l;i++){ext=args[i];for(name in ext){if(ext.hasOwnProperty(name)){value=ext[name];if(value !==undefined){obj[name]=value;}}}}return obj;};var walk=function(o,f,n,s){s=s||this;if(o){if(n){o=o[n];}Arr.each(o,function(o,i){if(f.call(s,o,i,n)===false){return false;}walk(o,f,n,s);});}};var createNS=function(n,o){var i,v;o=o||window;n=n.split('.');for(i=0;i<n.length;i++){v=n[i];if(!o[v]){o[v]={};}o=o[v];}return o;};var resolve=function(n,o){var i,l;o=o||window;n=n.split('.');for(i=0,l=n.length;i<l;i++){o=o[n[i]];if(!o){break;}}return o;};var explode=function(s,d){if(!s||is(s,'array')){return s;}return Arr.map(s.split(d||','),trim);};var _addCacheSuffix=function(url){var cacheSuffix=Env.cacheSuffix;if(cacheSuffix){url+=(url.indexOf('?')===-1 ? '?' :'&')+cacheSuffix;}return url;};return{trim:trim,isArray:Arr.isArray,is:is,toArray:Arr.toArray,makeMap:makeMap,each:Arr.each,map:Arr.map,grep:Arr.filter,inArray:Arr.indexOf,hasOwn:hasOwnProperty,extend:extend,create:create,walk:walk,createNS:createNS,resolve:resolve,explode:explode,_addCacheSuffix:_addCacheSuffix};});define('tinymce.core.dom.DomQuery',['global!document','tinymce.core.dom.EventUtils','tinymce.core.dom.Sizzle','tinymce.core.Env','tinymce.core.util.Tools'],function(document,EventUtils,Sizzle,Env,Tools){var doc=document,push=Array.prototype.push,slice=Array.prototype.slice;var rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/;var Event=EventUtils.Event,undef;var skipUniques=Tools.makeMap('children,contents,next,prev');var isDefined=function(obj){return typeof obj !=='undefined';};var isString=function(obj){return typeof obj==='string';};var isWindow=function(obj){return obj && obj==obj.window;};var createFragment=function(html,fragDoc){var frag,node,container;fragDoc=fragDoc||doc;container=fragDoc.createElement('div');frag=fragDoc.createDocumentFragment();container.innerHTML=html;while((node=container.firstChild)){frag.appendChild(node);}return frag;};var domManipulate=function(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem)){sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]));}else if(sourceItem.length && !sourceItem.nodeType){sourceItem=DomQuery.makeArray(sourceItem);if(reverse){for(i=sourceItem.length-1;i>=0;i--){domManipulate(targetNodes,sourceItem[i],callback,reverse);}}else{for(i=0;i<sourceItem.length;i++){domManipulate(targetNodes,sourceItem[i],callback,reverse);}}return targetNodes;}if(sourceItem.nodeType){i=targetNodes.length;while(i--){callback.call(targetNodes[i],sourceItem);}}return targetNodes;};var hasClass=function(node,className){return node && className &&(' '+node.className+' ').indexOf(' '+className+' ')!==-1;};var wrap=function(elements,wrapper,all){var lastParent,newWrapper;wrapper=DomQuery(wrapper)[0];elements.each(function(){var self=this;if(!all||lastParent !=self.parentNode){lastParent=self.parentNode;newWrapper=wrapper.cloneNode(false);self.parentNode.insertBefore(newWrapper,self);newWrapper.appendChild(self);}else{newWrapper.appendChild(self);}});return elements;};var numericCssMap=Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom',' ');var booleanMap=Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected',' ');var propFix={'for':'htmlFor','class':'className','readonly':'readOnly'};var cssFix={'float':'cssFloat'};var attrHooks={},cssHooks={};var DomQuery=function(selector,context){return new DomQuery.fn.init(selector,context);};var inArray=function(item,array){var i;if(array.indexOf){return array.indexOf(item);}i=array.length;while(i--){if(array[i]===item){return i;}}return-1;};var whiteSpaceRegExp=/^\s*|\s*$/g;var trim=function(str){return(str===null||str===undef)? '' :(""+str).replace(whiteSpaceRegExp,'');};var each=function(obj,callback){var length,key,i,undef,value;if(obj){length=obj.length;if(length===undef){for(key in obj){if(obj.hasOwnProperty(key)){value=obj[key];if(callback.call(value,key,value)===false){break;}}}}else{for(i=0;i<length;i++){value=obj[i];if(callback.call(value,i,value)===false){break;}}}}return obj;};var grep=function(array,callback){var out=[];each(array,function(i,item){if(callback(item,i)){out.push(item);}});return out;};var getElementDocument=function(element){if(!element){return doc;}if(element.nodeType==9){return element;}return element.ownerDocument;};DomQuery.fn=DomQuery.prototype={constructor:DomQuery,selector:"",context:null,length:0,init:function(selector,context){var self=this,match,node;if(!selector){return self;}if(selector.nodeType){self.context=self[0]=selector;self.length=1;return self;}if(context && context.nodeType){self.context=context;}else{if(context){return DomQuery(selector).attr(context);}self.context=context=document;}if(isString(selector)){self.selector=selector;if(selector.charAt(0)==="<" && selector.charAt(selector.length-1)===">" && selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}if(match){if(match[1]){node=createFragment(selector,getElementDocument(context)).firstChild;while(node){push.call(self,node);node=node.nextSibling;}}else{node=getElementDocument(context).getElementById(match[2]);if(!node){return self;}if(node.id !==match[2]){return self.find(selector);}self.length=1;self[0]=node;}}else{return DomQuery(context).find(selector);}}else{this.add(selector,false);}return self;},toArray:function(){return Tools.toArray(this);},add:function(items,sort){var self=this,nodes,i;if(isString(items)){return self.add(DomQuery(items));}if(sort !==false){nodes=DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));self.length=nodes.length;for(i=0;i<nodes.length;i++){self[i]=nodes[i];}}else{push.apply(self,DomQuery.makeArray(items));}return self;},attr:function(name,value){var self=this,hook;if(typeof name==="object"){each(name,function(name,value){self.attr(name,value);});}else if(isDefined(value)){this.each(function(){var hook;if(this.nodeType===1){hook=attrHooks[name];if(hook && hook.set){hook.set(this,value);return;}if(value===null){this.removeAttribute(name,2);}else{this.setAttribute(name,value,2);}}});}else{if(self[0]&& self[0].nodeType===1){hook=attrHooks[name];if(hook && hook.get){return hook.get(self[0],name);}if(booleanMap[name]){return self.prop(name)? name :undef;}value=self[0].getAttribute(name,2);if(value===null){value=undef;}}return value;}return self;},removeAttr:function(name){return this.attr(name,null);},prop:function(name,value){var self=this;name=propFix[name]||name;if(typeof name==="object"){each(name,function(name,value){self.prop(name,value);});}else if(isDefined(value)){this.each(function(){if(this.nodeType==1){this[name]=value;}});}else{if(self[0]&& self[0].nodeType && name in self[0]){return self[0][name];}return value;}return self;},css:function(name,value){var self=this,elm,hook;var camel=function(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});};var dashed=function(name){return name.replace(/[A-Z]/g,function(a){return '-'+a;});};if(typeof name==="object"){each(name,function(name,value){self.css(name,value);});}else{if(isDefined(value)){name=camel(name);if(typeof value==='number' && !numericCssMap[name]){value+='px';}self.each(function(){var style=this.style;hook=cssHooks[name];if(hook && hook.set){hook.set(this,value);return;}try{this.style[cssFix[name]||name]=value;}catch(ex){}if(value===null||value===''){if(style.removeProperty){style.removeProperty(dashed(name));}else{style.removeAttribute(name);}}});}else{elm=self[0];hook=cssHooks[name];if(hook && hook.get){return hook.get(elm);}if(elm.ownerDocument.defaultView){try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name));}catch(ex){return undef;}}else if(elm.currentStyle){return elm.currentStyle[camel(name)];}}}return self;},remove:function(){var self=this,node,i=this.length;while(i--){node=self[i];Event.clean(node);if(node.parentNode){node.parentNode.removeChild(node);}}return this;},empty:function(){var self=this,node,i=this.length;while(i--){node=self[i];while(node.firstChild){node.removeChild(node.firstChild);}}return this;},html:function(value){var self=this,i;if(isDefined(value)){i=self.length;try{while(i--){self[i].innerHTML=value;}}catch(ex){DomQuery(self[i]).empty().append(value);}return self;}return self[0]? self[0].innerHTML :'';},text:function(value){var self=this,i;if(isDefined(value)){i=self.length;while(i--){if("innerText" in self[i]){self[i].innerText=value;}else{self[0].textContent=value;}}return self;}return self[0]?(self[0].innerText||self[0].textContent):'';},append:function(){return domManipulate(this,arguments,function(node){if(this.nodeType===1||(this.host && this.host.nodeType===1)){this.appendChild(node);}});},prepend:function(){return domManipulate(this,arguments,function(node){if(this.nodeType===1||(this.host && this.host.nodeType===1)){this.insertBefore(node,this.firstChild);}},true);},before:function(){var self=this;if(self[0]&& self[0].parentNode){return domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this);});}return self;},after:function(){var self=this;if(self[0]&& self[0].parentNode){return domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling);},true);}return self;},appendTo:function(val){DomQuery(val).append(this);return this;},prependTo:function(val){DomQuery(val).prepend(this);return this;},replaceWith:function(content){return this.before(content).remove();},wrap:function(content){return wrap(this,content);},wrapAll:function(content){return wrap(this,content,true);},wrapInner:function(content){this.each(function(){DomQuery(this).contents().wrapAll(content);});return this;},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes);});},clone:function(){var result=[];this.each(function(){result.push(this.cloneNode(true));});return DomQuery(result);},addClass:function(className){return this.toggleClass(className,true);},removeClass:function(className){return this.toggleClass(className,false);},toggleClass:function(className,state){var self=this;if(typeof className !='string'){return self;}if(className.indexOf(' ')!==-1){each(className.split(' '),function(){self.toggleClass(this,state);});}else{self.each(function(index,node){var existingClassName,classState;classState=hasClass(node,className);if(classState !==state){existingClassName=node.className;if(classState){node.className=trim((" "+existingClassName+" ").replace(' '+className+' ',' '));}else{node.className+=existingClassName ? ' '+className :className;}}});}return self;},hasClass:function(className){return hasClass(this[0],className);},each:function(callback){return each(this,callback);},on:function(name,callback){return this.each(function(){Event.bind(this,name,callback);});},off:function(name,callback){return this.each(function(){Event.unbind(this,name,callback);});},trigger:function(name){return this.each(function(){if(typeof name=='object'){Event.fire(this,name.type,name);}else{Event.fire(this,name);}});},show:function(){return this.css('display','');},hide:function(){return this.css('display','none');},slice:function(){return new DomQuery(slice.apply(this,arguments));},eq:function(index){return index===-1 ? this.slice(index):this.slice(index,+index+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++){DomQuery.find(selector,this[i],ret);}return DomQuery(ret);},filter:function(selector){if(typeof selector=='function'){return DomQuery(grep(this.toArray(),function(item,i){return selector(i,item);}));}return DomQuery(DomQuery.filter(selector,this.toArray()));},closest:function(selector){var result=[];if(selector instanceof DomQuery){selector=selector[0];}this.each(function(i,node){while(node){if(typeof selector=='string' && DomQuery(node).is(selector)){result.push(node);break;}else if(node==selector){result.push(node);break;}node=node.parentNode;}});return DomQuery(result);},offset:function(offset){var elm,doc,docElm;var x=0,y=0,pos;if(!offset){elm=this[0];if(elm){doc=elm.ownerDocument;docElm=doc.documentElement;if(elm.getBoundingClientRect){pos=elm.getBoundingClientRect();x=pos.left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft;y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop;}}return{left:x,top:y};}return this.css(offset);},push:push,sort:[].sort,splice:[].splice};Tools.extend(DomQuery,{extend:Tools.extend,makeArray:function(object){if(isWindow(object)||object.nodeType){return[object];}return Tools.toArray(object);},inArray:inArray,isArray:Tools.isArray,each:each,trim:trim,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;if(not){expr=":not("+expr+")";}while(i--){if(elems[i].nodeType !=1){elems.splice(i,1);}}if(elems.length===1){elems=DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[];}else{elems=DomQuery.find.matches(expr,elems);}return elems;}});var dir=function(el,prop,until){var matched=[],cur=el[prop];if(typeof until !='string' && until instanceof DomQuery){until=until[0];}while(cur && cur.nodeType !==9){if(until !==undefined){if(cur===until){break;}if(typeof until=='string' && DomQuery(cur).is(until)){break;}}if(cur.nodeType===1){matched.push(cur);}cur=cur[prop];}return matched;};var sibling=function(node,siblingName,nodeType,until){var result=[];if(until instanceof DomQuery){until=until[0];}for(;node;node=node[siblingName]){if(nodeType && node.nodeType !==nodeType){continue;}if(until !==undefined){if(node===until){break;}if(typeof until=='string' && DomQuery(node).is(until)){break;}}result.push(node);}return result;};var firstSibling=function(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName]){if(node.nodeType==nodeType){return node;}}return null;};each({parent:function(node){var parent=node.parentNode;return parent && parent.nodeType !==11 ? parent :null;},parents:function(node){return dir(node,"parentNode");},next:function(node){return firstSibling(node,'nextSibling',1);},prev:function(node){return firstSibling(node,'previousSibling',1);},children:function(node){return sibling(node.firstChild,'nextSibling',1);},contents:function(node){return Tools.toArray((node.nodeName==="iframe" ? node.contentDocument||node.contentWindow.document :node).childNodes);}},function(name,fn){DomQuery.fn[name]=function(selector){var self=this,result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes);}else{result.push(nodes);}}});if(this.length>1){if(!skipUniques[name]){result=DomQuery.unique(result);}if(name.indexOf('parents')===0){result=result.reverse();}}result=DomQuery(result);if(selector){return result.filter(selector);}return result;};});each({parentsUntil:function(node,until){return dir(node,"parentNode",until);},nextUntil:function(node,until){return sibling(node,'nextSibling',1,until).slice(1);},prevUntil:function(node,until){return sibling(node,'previousSibling',1,until).slice(1);}},function(name,fn){DomQuery.fn[name]=function(selector,filter){var self=this,result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes);}else{result.push(nodes);}}});if(this.length>1){result=DomQuery.unique(result);if(name.indexOf('parents')===0||name==='prevUntil'){result=result.reverse();}}result=DomQuery(result);if(filter){return result.filter(filter);}return result;};});DomQuery.fn.is=function(selector){return !!selector && this.filter(selector).length>0;};DomQuery.fn.init.prototype=DomQuery.fn;DomQuery.overrideDefaults=function(callback){var defaults;var sub=function(selector,context){defaults=defaults||callback();if(arguments.length===0){selector=defaults.element;}if(!context){context=defaults.context;}return new sub.fn.init(selector,context);};DomQuery.extend(sub,this);return sub;};var appendHooks=function(targetHooks,prop,hooks){each(hooks,function(name,func){targetHooks[name]=targetHooks[name]||{};targetHooks[name][prop]=func;});};if(Env.ie && Env.ie<8){appendHooks(attrHooks,'get',{maxlength:function(elm){var value=elm.maxLength;if(value===0x7fffffff){return undef;}return value;},size:function(elm){var value=elm.size;if(value===20){return undef;}return value;},'class':function(elm){return elm.className;},style:function(elm){var value=elm.style.cssText;if(value.length===0){return undef;}return value;}});appendHooks(attrHooks,'set',{'class':function(elm,value){elm.className=value;},style:function(elm,value){elm.style.cssText=value;}});}if(Env.ie && Env.ie<9){cssFix['float']='styleFloat';appendHooks(cssHooks,'set',{opacity:function(elm,value){var style=elm.style;if(value===null||value===''){style.removeAttribute('filter');}else{style.zoom=1;style.filter='alpha(opacity='+(value*100)+')';}}});}DomQuery.attrHooks=attrHooks;DomQuery.cssHooks=cssHooks;return DomQuery;});define('ephox.katamari.api.Thunk',[],function(){var cached=function(f){var called=false;var r;return function(){if(!called){called=true;r=f.apply(null,arguments);}return r;};};return{cached:cached};});defineGlobal("global!Number",Number);define('ephox.sand.detect.Version',['ephox.katamari.api.Arr','global!Number','global!String'],function(Arr,Number,String){var firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x;}return undefined;};var find=function(regexes,agent){var r=firstMatch(regexes,agent);if(!r)return{major :0,minor :0};var group=function(i){return Number(agent.replace(r,'$'+i));};return nu(group(1),group(2));};var detect=function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0)return unknown();return find(versionRegexes,cleanedAgent);};var unknown=function(){return nu(0,0);};var nu=function(major,minor){return{major:major,minor:minor};};return{nu:nu,detect:detect,unknown:unknown};});define('ephox.sand.core.Browser',['ephox.katamari.api.Fun','ephox.sand.detect.Version'],function(Fun,Version){var edge='Edge';var chrome='Chrome';var ie='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var isBrowser=function(name,current){return function(){return current===name;};};var unknown=function(){return nu({current:undefined,version:Version.unknown()});};var nu=function(info){var current=info.current;var version=info.version;return{current:current,version:version,isEdge:isBrowser(edge,current),isChrome:isBrowser(chrome,current),isIE:isBrowser(ie,current),isOpera:isBrowser(opera,current),isFirefox:isBrowser(firefox,current),isSafari:isBrowser(safari,current)};};return{unknown:unknown,nu:nu,edge:Fun.constant(edge),chrome:Fun.constant(chrome),ie:Fun.constant(ie),opera:Fun.constant(opera),firefox:Fun.constant(firefox),safari:Fun.constant(safari)};});define('ephox.sand.core.OperatingSystem',['ephox.katamari.api.Fun','ephox.sand.detect.Version'],function(Fun,Version){var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var osx='OSX';var solaris='Solaris';var freebsd='FreeBSD';var isOS=function(name,current){return function(){return current===name;};};var unknown=function(){return nu({current:undefined,version:Version.unknown()});};var nu=function(info){var current=info.current;var version=info.version;return{current:current,version:version,isWindows:isOS(windows,current),isiOS:isOS(ios,current),isAndroid:isOS(android,current),isOSX:isOS(osx,current),isLinux:isOS(linux,current),isSolaris:isOS(solaris,current),isFreeBSD:isOS(freebsd,current)};};return{unknown:unknown,nu:nu,windows:Fun.constant(windows),ios:Fun.constant(ios),android:Fun.constant(android),linux:Fun.constant(linux),osx:Fun.constant(osx),solaris:Fun.constant(solaris),freebsd:Fun.constant(freebsd)};});define('ephox.sand.detect.DeviceType',['ephox.katamari.api.Fun'],function(Fun){return function(os,browser,userAgent){var isiPad=os.isiOS()&& /ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&& !isiPad;var isAndroid3=os.isAndroid()&& os.version.major===3;var isAndroid4=os.isAndroid()&& os.version.major===4;var isTablet=isiPad||isAndroid3||(isAndroid4 && /mobile/i.test(userAgent)===true);var isTouch=os.isiOS()||os.isAndroid();var isPhone=isTouch && !isTablet;var iOSwebview=browser.isSafari()&& os.isiOS()&& /safari/i.test(userAgent)===false;return{isiPad :Fun.constant(isiPad),isiPhone:Fun.constant(isiPhone),isTablet:Fun.constant(isTablet),isPhone:Fun.constant(isPhone),isTouch:Fun.constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:Fun.constant(iOSwebview)};};});define('ephox.sand.detect.UaString',['ephox.katamari.api.Arr','ephox.sand.detect.Version','global!String'],function(Arr,Version,String){var detect=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return Arr.find(candidates,function(candidate){return candidate.search(agent);});};var detectBrowser=function(browsers,userAgent){return detect(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version};});};var detectOs=function(oses,userAgent){return detect(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version};});};return{detectBrowser:detectBrowser,detectOs:detectOs};});define('ephox.katamari.str.StrAppend',[],function(){var addToStart=function(str,prefix){return prefix+str;};var addToEnd=function(str,suffix){return str+suffix;};var removeFromStart=function(str,numChars){return str.substring(numChars);};var removeFromEnd=function(str,numChars){return str.substring(0,str.length-numChars);};return{addToStart:addToStart,addToEnd:addToEnd,removeFromStart:removeFromStart,removeFromEnd:removeFromEnd};});define('ephox.katamari.str.StringParts',['ephox.katamari.api.Option','global!Error'],function(Option,Error){var first=function(str,count){return str.substr(0,count);};var last=function(str,count){return str.substr(str.length-count,str.length);};var head=function(str){return str==='' ? Option.none():Option.some(str.substr(0,1));};var tail=function(str){return str==='' ? Option.none():Option.some(str.substring(1));};return{first:first,last:last,head:head,tail:tail};});define('ephox.katamari.api.Strings',['ephox.katamari.str.StrAppend','ephox.katamari.str.StringParts','global!Error'],function(StrAppend,StringParts,Error){var checkRange=function(str,substr,start){if(substr==='')return true;if(str.length<substr.length)return false;var x=str.substr(start,start+substr.length);return x===substr;};var supplant=function(str,obj){var isStringOrNumber=function(a){var t=typeof a;return t==='string'||t==='number';};return str.replace(/\${([^{}]*)}/g,function(a,b){var value=obj[b];return isStringOrNumber(value)? value :a;});};var removeLeading=function(str,prefix){return startsWith(str,prefix)? StrAppend.removeFromStart(str,prefix.length):str;};var removeTrailing=function(str,prefix){return endsWith(str,prefix)? StrAppend.removeFromEnd(str,prefix.length):str;};var ensureLeading=function(str,prefix){return startsWith(str,prefix)? str :StrAppend.addToStart(str,prefix);};var ensureTrailing=function(str,prefix){return endsWith(str,prefix)? str :StrAppend.addToEnd(str,prefix);};var contains=function(str,substr){return str.indexOf(substr)!==-1;};var capitalize=function(str){return StringParts.head(str).bind(function(head){return StringParts.tail(str).map(function(tail){return head.toUpperCase()+tail;});}).getOr(str);};var startsWith=function(str,prefix){return checkRange(str,prefix,0);};var endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length);};var trim=function(str){return str.replace(/^\s+|\s+$/g,'');};var lTrim=function(str){return str.replace(/^\s+/g,'');};var rTrim=function(str){return str.replace(/\s+$/g,'');};return{supplant:supplant,startsWith:startsWith,removeLeading:removeLeading,removeTrailing:removeTrailing,ensureLeading:ensureLeading,ensureTrailing:ensureTrailing,endsWith:endsWith,contains:contains,trim:trim,lTrim:lTrim,rTrim:rTrim,capitalize:capitalize};});define('ephox.sand.info.PlatformInfo',['ephox.katamari.api.Fun','ephox.katamari.api.Strings'],function(Fun,Strings){var normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/;var checkContains=function(target){return function(uastring){return Strings.contains(uastring,target);};};var browsers=[{name :'Edge',versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){var monstrosity=Strings.contains(uastring,'edge/')&& Strings.contains(uastring,'chrome')&& Strings.contains(uastring,'safari')&& Strings.contains(uastring,'applewebkit');return monstrosity;}},{name :'Chrome',versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search :function(uastring){return Strings.contains(uastring,'chrome')&& !Strings.contains(uastring,'chromeframe');}},{name :'IE',versionRegexes:[/.*?msie\?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return Strings.contains(uastring,'msie')||Strings.contains(uastring,'trident');}},{name :'Opera',versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search :checkContains('opera')},{name :'Firefox',versionRegexes:[/.*?firefox\/\?([0-9]+)\.([0-9]+).*/],search :checkContains('firefox')},{name :'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os([0-9]+)_([0-9]+).*/],search :function(uastring){return(Strings.contains(uastring,'safari')||Strings.contains(uastring,'mobile/'))&& Strings.contains(uastring,'applewebkit');}}];var oses=[{name :'Windows',search :checkContains('win'),versionRegexes:[/.*?windows\nt\?([0-9]+)\.([0-9]+).*/]},{name :'iOS',search :function(uastring){return Strings.contains(uastring,'iphone')||Strings.contains(uastring,'ipad');},versionRegexes:[/.*?version\/\?([0-9]+)\.([0-9]+).*/,/.*cpu os([0-9]+)_([0-9]+).*/,/.*cpu iphone os([0-9]+)_([0-9]+).*/]},{name :'Android',search :checkContains('android'),versionRegexes:[/.*?android\?([0-9]+)\.([0-9]+).*/]},{name :'OSX',search :checkContains('os x'),versionRegexes:[/.*?os\x\?([0-9]+)_([0-9]+).*/]},{name :'Linux',search :checkContains('linux'),versionRegexes:[]},{name :'Solaris',search :checkContains('sunos'),versionRegexes:[]},{name :'FreeBSD',search :checkContains('freebsd'),versionRegexes:[]}];return{browsers:Fun.constant(browsers),oses:Fun.constant(oses)};});define('ephox.sand.core.PlatformDetection',['ephox.sand.core.Browser','ephox.sand.core.OperatingSystem','ephox.sand.detect.DeviceType','ephox.sand.detect.UaString','ephox.sand.info.PlatformInfo'],function(Browser,OperatingSystem,DeviceType,UaString,PlatformInfo){var detect=function(userAgent){var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=UaString.detectBrowser(browsers,userAgent).fold(Browser.unknown,Browser.nu);var os=UaString.detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent);return{browser:browser,os:os,deviceType:deviceType};};return{detect:detect};});define('ephox.sand.api.PlatformDetection',['ephox.katamari.api.Thunk','ephox.sand.core.PlatformDetection','global!navigator'],function(Thunk,PlatformDetection,navigator){var detect=Thunk.cached(function(){var userAgent=navigator.userAgent;return PlatformDetection.detect(userAgent);});return{detect:detect};});define("global!console",[],function(){if(typeof console==="undefined")console={log:function(){}};return console;});define('ephox.sugar.api.node.Element',['ephox.katamari.api.Fun','ephox.katamari.api.Option','global!Error','global!console','global!document'],function(Fun,Option,Error,console,document){var fromHtml=function(html,scope){var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){console.error('HTML does not have a single root node',html);throw 'HTML must have a single root node';}return fromDom(div.childNodes[0]);};var fromTag=function(tag,scope){var doc=scope||document;var node=doc.createElement(tag);return fromDom(node);};var fromText=function(text,scope){var doc=scope||document;var node=doc.createTextNode(text);return fromDom(node);};var fromDom=function(node){if(node===null||node===undefined)throw new Error('Node cannot be null or undefined');return{dom:Fun.constant(node)};};var fromPoint=function(doc,x,y){return Option.from(doc.dom().elementFromPoint(x,y)).map(fromDom);};return{fromHtml:fromHtml,fromTag:fromTag,fromText:fromText,fromDom:fromDom,fromPoint:fromPoint};});define('ephox.sugar.api.node.NodeTypes',[],function(){return{ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12};});define('ephox.sugar.api.node.Node',['ephox.sugar.api.node.NodeTypes'],function(NodeTypes){var name=function(element){var r=element.dom().nodeName;return r.toLowerCase();};var type=function(element){return element.dom().nodeType;};var value=function(element){return element.dom().nodeValue;};var isType=function(t){return function(element){return type(element)===t;};};var isComment=function(element){return type(element)===NodeTypes.COMMENT||name(element)==='#comment';};var isElement=isType(NodeTypes.ELEMENT);var isText=isType(NodeTypes.TEXT);var isDocument=isType(NodeTypes.DOCUMENT);return{name:name,type:type,value:value,isElement:isElement,isText:isText,isDocument:isDocument,isComment:isComment};});define('ephox.katamari.api.Type',['global!Array','global!String'],function(Array,String){var typeOf=function(x){if(x===null)return 'null';var t=typeof x;if(t==='object' && Array.prototype.isPrototypeOf(x))return 'array';if(t==='object' && String.prototype.isPrototypeOf(x))return 'string';return t;};var isType=function(type){return function(value){return typeOf(value)===type;};};return{isString:isType('string'),isObject:isType('object'),isArray:isType('array'),isNull:isType('null'),isBoolean:isType('boolean'),isUndefined:isType('undefined'),isFunction:isType('function'),isNumber:isType('number')};});define('ephox.katamari.api.Obj',['ephox.katamari.api.Option','global!Object'],function(Option,Object){var keys=(function(){var fastKeys=Object.keys;var slowKeys=function(o){var r=[];for(var i in o){if(o.hasOwnProperty(i)){r.push(i);}}return r;};return fastKeys===undefined ? slowKeys :fastKeys;})();var each=function(obj,f){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i,obj);}};var objectMap=function(obj,f){return tupleMap(obj,function(x,i,obj){return{k:i,v:f(x,i,obj)};});};var tupleMap=function(obj,f){var r={};each(obj,function(x,i){var tuple=f(x,i,obj);r[tuple.k]=tuple.v;});return r;};var bifilter=function(obj,pred){var t={};var f={};each(obj,function(x,i){var branch=pred(x,i)? t :f;branch[i]=x;});return{t:t,f:f};};var mapToArray=function(obj,f){var r=[];each(obj,function(value,name){r.push(f(value,name));});return r;};var find=function(obj,pred){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];if(pred(x,i,obj)){return Option.some(x);}}return Option.none();};var values=function(obj){return mapToArray(obj,function(v){return v;});};var size=function(obj){return values(obj).length;};return{bifilter:bifilter,each:each,map:objectMap,mapToArray:mapToArray,tupleMap:tupleMap,find:find,keys:keys,values:values,size:size};});define('ephox.sugar.api.properties.Attr',['ephox.katamari.api.Type','ephox.katamari.api.Arr','ephox.katamari.api.Obj','ephox.sugar.api.node.Node','global!Error','global!console'],function(Type,Arr,Obj,Node,Error,console){var rawSet=function(dom,key,value){if(Type.isString(value)||Type.isBoolean(value)||Type.isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attr.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set=function(element,key,value){rawSet(element.dom(),key,value);};var setAll=function(element,attrs){var dom=element.dom();Obj.each(attrs,function(v,k){rawSet(dom,k,v);});};var get=function(element,key){var v=element.dom().getAttribute(key);return v===null ? undefined :v;};var has=function(element,key){var dom=element.dom();return dom && dom.hasAttribute ? dom.hasAttribute(key):false;};var remove=function(element,key){element.dom().removeAttribute(key);};var hasNone=function(element){var attrs=element.dom().attributes;return attrs===undefined||attrs===null||attrs.length===0;};var clone=function(element){return Arr.foldl(element.dom().attributes,function(acc,attr){acc[attr.name]=attr.value;return acc;},{});};var transferOne=function(source,destination,attr){if(has(source,attr)&& !has(destination,attr))set(destination,attr,get(source,attr));};var transfer=function(source,destination,attrs){if(!Node.isElement(source)||!Node.isElement(destination))return;Arr.each(attrs,function(attr){transferOne(source,destination,attr);});};return{clone:clone,set:set,setAll:setAll,get:get,has:has,remove:remove,hasNone:hasNone,transfer:transfer};});define('ephox.sugar.api.node.Body',['ephox.katamari.api.Thunk','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','global!document'],function(Thunk,Element,Node,document){var inBody=function(element){var dom=Node.isText(element)? element.dom().parentNode :element.dom();return dom !==undefined && dom !==null && dom.ownerDocument.body.contains(dom);};var body=Thunk.cached(function(){return getBody(Element.fromDom(document));});var getBody=function(doc){var body=doc.dom().body;if(body===null||body===undefined)throw 'Body is not available yet';return Element.fromDom(body);};return{body:body,getBody:getBody,inBody:inBody};});define('ephox.sugar.impl.Style',[],function(){var isSupported=function(dom){return dom.style !==undefined;};return{isSupported:isSupported};});define('ephox.sugar.api.properties.Css',['ephox.katamari.api.Type','ephox.katamari.api.Arr','ephox.katamari.api.Obj','ephox.katamari.api.Option','ephox.sugar.api.properties.Attr','ephox.sugar.api.node.Body','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.impl.Style','ephox.katamari.api.Strings','global!Error','global!console','global!window'],function(Type,Arr,Obj,Option,Attr,Body,Element,Node,Style,Strings,Error,console,window){var internalSet=function(dom,property,value){if(!Type.isString(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(Style.isSupported(dom))dom.style.setProperty(property,value);};var internalRemove=function(dom,property){if(Style.isSupported(dom))dom.style.removeProperty(property);};var set=function(element,property,value){var dom=element.dom();internalSet(dom,property,value);};var setAll=function(element,css){var dom=element.dom();Obj.each(css,function(v,k){internalSet(dom,k,v);});};var setOptions=function(element,css){var dom=element.dom();Obj.each(css,function(v,k){v.fold(function(){internalRemove(dom,k);},function(value){internalSet(dom,k,value);});});};var get=function(element,property){var dom=element.dom();var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);var v=(r==='' && !Body.inBody(element))? getUnsafeProperty(dom,property):r;return v===null ? undefined :v;};var getUnsafeProperty=function(dom,property){return Style.isSupported(dom)? dom.style.getPropertyValue(property):'';};var getRaw=function(element,property){var dom=element.dom();var raw=getUnsafeProperty(dom,property);return Option.from(raw).filter(function(r){return r.length>0;});};var getAllRaw=function(element){var css={};var dom=element.dom();if(Style.isSupported(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var isValidValue=function(tag,property,value){var element=Element.fromTag(tag);set(element,property,value);var style=getRaw(element,property);return style.isSome();};var remove=function(element,property){var dom=element.dom();internalRemove(dom,property);if(Attr.has(element,'style')&& Strings.trim(Attr.get(element,'style'))===''){Attr.remove(element,'style');}};var preserve=function(element,f){var oldStyles=Attr.get(element,'style');var result=f(element);var restore=oldStyles===undefined ? Attr.remove :Attr.set;restore(element,'style',oldStyles);return result;};var copy=function(source,target){var sourceDom=source.dom();var targetDom=target.dom();if(Style.isSupported(sourceDom)&& Style.isSupported(targetDom)){targetDom.style.cssText=sourceDom.style.cssText;}};var reflow=function(e){return e.dom().offsetWidth;};var transferOne=function(source,destination,style){getRaw(source,style).each(function(value){if(getRaw(destination,style).isNone())set(destination,style,value);});};var transfer=function(source,destination,styles){if(!Node.isElement(source)||!Node.isElement(destination))return;Arr.each(styles,function(style){transferOne(source,destination,style);});};return{copy:copy,set:set,preserve:preserve,setAll:setAll,setOptions:setOptions,remove:remove,get:get,getRaw:getRaw,getAllRaw:getAllRaw,isValidValue:isValidValue,reflow:reflow,transfer:transfer};});define('ephox.katamari.data.Immutable',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','global!Array','global!Error'],function(Arr,Fun,Array,Error){return function(){var fields=arguments;return function(){var values=new Array(arguments.length);for(var i=0;i<values.length;i++)values[i]=arguments[i];if(fields.length !==values.length)throw new Error('Wrong number of arguments to struct. Expected "['+fields.length+']", got '+values.length+' arguments');var struct={};Arr.each(fields,function(name,i){struct[name]=Fun.constant(values[i]);});return struct;};};});define('ephox.katamari.util.BagUtils',['ephox.katamari.api.Arr','ephox.katamari.api.Type','global!Error'],function(Arr,Type,Error){var sort=function(arr){return arr.slice(0).sort();};var reqMessage=function(required,keys){throw new Error('All required keys ('+sort(required).join(', ')+') were not specified. Specified keys were: '+sort(keys).join(', ')+'.');};var unsuppMessage=function(unsupported){throw new Error('Unsupported keys for object: '+sort(unsupported).join(', '));};var validateStrArr=function(label,array){if(!Type.isArray(array))throw new Error('The '+label+' fields must be an array. Was: '+array+'.');Arr.each(array,function(a){if(!Type.isString(a))throw new Error('The value '+a+' in the '+label+' fields was not a string.');});};var invalidTypeMessage=function(incorrect,type){throw new Error('All values need to be of type: '+type+'. Keys ('+sort(incorrect).join(', ')+') were not.');};var checkDupes=function(everything){var sorted=sort(everything);var dupe=Arr.find(sorted,function(s,i){return i<sorted.length-1 && s===sorted[i+1];});dupe.each(function(d){throw new Error('The field: '+d+' occurs more than once in the combined fields: ['+sorted.join(', ')+'].');});};return{sort:sort,reqMessage:reqMessage,unsuppMessage:unsuppMessage,validateStrArr:validateStrArr,invalidTypeMessage:invalidTypeMessage,checkDupes:checkDupes};});define('ephox.katamari.data.MixedBag',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Obj','ephox.katamari.api.Option','ephox.katamari.util.BagUtils','global!Error','global!Object'],function(Arr,Fun,Obj,Option,BagUtils,Error,Object){return function(required,optional){var everything=required.concat(optional);if(everything.length===0)throw new Error('You must specify at least one required or optional field.');BagUtils.validateStrArr('required',required);BagUtils.validateStrArr('optional',optional);BagUtils.checkDupes(everything);return function(obj){var keys=Obj.keys(obj);var allReqd=Arr.forall(required,function(req){return Arr.contains(keys,req);});if(! allReqd)BagUtils.reqMessage(required,keys);var unsupported=Arr.filter(keys,function(key){return !Arr.contains(everything,key);});if(unsupported.length>0)BagUtils.unsuppMessage(unsupported);var r={};Arr.each(required,function(req){r[req]=Fun.constant(obj[req]);});Arr.each(optional,function(opt){r[opt]=Fun.constant(Object.prototype.hasOwnProperty.call(obj,opt)? Option.some(obj[opt]):Option.none());});return r;};};});define('ephox.katamari.api.Struct',['ephox.katamari.data.Immutable','ephox.katamari.data.MixedBag'],function(Immutable,MixedBag){return{immutable:Immutable,immutableBag:MixedBag};});define('ephox.sugar.alien.Recurse',[],function(){var toArray=function(target,f){var r=[];var recurse=function(e){r.push(e);return f(e);};var cur=f(target);do{cur=cur.bind(recurse);}while(cur.isSome());return r;};return{toArray:toArray};});define('ephox.sand.api.Node',['ephox.sand.util.Global'],function(Global){var node=function(){var f=Global.getOrDie('Node');return f;};var compareDocumentPosition=function(a,b,match){return(a.compareDocumentPosition(b)& match)!==0;};var documentPositionPreceding=function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_PRECEDING);};var documentPositionContainedBy=function(a,b){return compareDocumentPosition(a,b,node().DOCUMENT_POSITION_CONTAINED_BY);};return{documentPositionPreceding:documentPositionPreceding,documentPositionContainedBy:documentPositionContainedBy};});define('ephox.sugar.api.search.Selectors',['ephox.katamari.api.Arr','ephox.katamari.api.Option','ephox.sugar.api.node.Element','ephox.sugar.api.node.NodeTypes','global!Error','global!document'],function(Arr,Option,Element,NodeTypes,Error,document){var ELEMENT=NodeTypes.ELEMENT;var DOCUMENT=NodeTypes.DOCUMENT;var is=function(element,selector){var elem=element.dom();if(elem.nodeType !==ELEMENT)return false;else if(elem.matches !==undefined)return elem.matches(selector);else if(elem.msMatchesSelector !==undefined)return elem.msMatchesSelector(selector);else if(elem.webkitMatchesSelector !==undefined)return elem.webkitMatchesSelector(selector);else if(elem.mozMatchesSelector !==undefined)return elem.mozMatchesSelector(selector);else throw new Error('Browser lacks native selectors');};var bypassSelector=function(dom){return dom.nodeType !==ELEMENT && dom.nodeType !==DOCUMENT||dom.childElementCount===0;};var all=function(selector,scope){var base=scope===undefined ? document :scope.dom();return bypassSelector(base)?[]:Arr.map(base.querySelectorAll(selector),Element.fromDom);};var one=function(selector,scope){var base=scope===undefined ? document :scope.dom();return bypassSelector(base)? Option.none():Option.from(base.querySelector(selector)).map(Element.fromDom);};return{all:all,is:is,one:one};});define('ephox.sugar.api.dom.Compare',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.sand.api.Node','ephox.sand.api.PlatformDetection','ephox.sugar.api.search.Selectors'],function(Arr,Fun,Node,PlatformDetection,Selectors){var eq=function(e1,e2){return e1.dom()===e2.dom();};var isEqualNode=function(e1,e2){return e1.dom().isEqualNode(e2.dom());};var member=function(element,elements){return Arr.exists(elements,Fun.curry(eq,element));};var regularContains=function(e1,e2){var d1=e1.dom(),d2=e2.dom();return d1===d2 ? false :d1.contains(d2);};var ieContains=function(e1,e2){return Node.documentPositionContainedBy(e1.dom(),e2.dom());};var browser=PlatformDetection.detect().browser;var contains=browser.isIE()? ieContains :regularContains;return{eq:eq,isEqualNode:isEqualNode,member:member,contains:contains,is:Selectors.is};});define('ephox.sugar.api.search.Traverse',['ephox.katamari.api.Type','ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Struct','ephox.sugar.alien.Recurse','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element'],function(Type,Arr,Fun,Option,Struct,Recurse,Compare,Element){var owner=function(element){return Element.fromDom(element.dom().ownerDocument);};var documentElement=function(element){var doc=owner(element);return Element.fromDom(doc.dom().documentElement);};var defaultView=function(element){var el=element.dom();var defaultView=el.ownerDocument.defaultView;return Element.fromDom(defaultView);};var parent=function(element){var dom=element.dom();return Option.from(dom.parentNode).map(Element.fromDom);};var findIndex=function(element){return parent(element).bind(function(p){var kin=children(p);return Arr.findIndex(kin,function(elem){return Compare.eq(element,elem);});});};var parents=function(element,isRoot){var stop=Type.isFunction(isRoot)? isRoot :Fun.constant(false);var dom=element.dom();var ret=[];while(dom.parentNode !==null && dom.parentNode !==undefined){var rawParent=dom.parentNode;var parent=Element.fromDom(rawParent);ret.push(parent);if(stop(parent)===true)break;else dom=rawParent;}return ret;};var siblings=function(element){var filterSelf=function(elements){return Arr.filter(elements,function(x){return !Compare.eq(element,x);});};return parent(element).map(children).map(filterSelf).getOr([]);};var offsetParent=function(element){var dom=element.dom();return Option.from(dom.offsetParent).map(Element.fromDom);};var prevSibling=function(element){var dom=element.dom();return Option.from(dom.previousSibling).map(Element.fromDom);};var nextSibling=function(element){var dom=element.dom();return Option.from(dom.nextSibling).map(Element.fromDom);};var prevSiblings=function(element){return Arr.reverse(Recurse.toArray(element,prevSibling));};var nextSiblings=function(element){return Recurse.toArray(element,nextSibling);};var children=function(element){var dom=element.dom();return Arr.map(dom.childNodes,Element.fromDom);};var child=function(element,index){var children=element.dom().childNodes;return Option.from(children[index]).map(Element.fromDom);};var firstChild=function(element){return child(element,0);};var lastChild=function(element){return child(element,element.dom().childNodes.length-1);};var childNodesCount=function(element){return element.dom().childNodes.length;};var hasChildNodes=function(element){return element.dom().hasChildNodes();};var spot=Struct.immutable('element','offset');var leaf=function(element,offset){var cs=children(element);return cs.length>0 && offset<cs.length ? spot(cs[offset],0):spot(element,offset);};return{owner:owner,defaultView:defaultView,documentElement:documentElement,parent:parent,findIndex:findIndex,parents:parents,siblings:siblings,prevSibling:prevSibling,offsetParent:offsetParent,prevSiblings:prevSiblings,nextSibling:nextSibling,nextSiblings:nextSiblings,children:children,child:child,firstChild:firstChild,lastChild:lastChild,childNodesCount:childNodesCount,hasChildNodes:hasChildNodes,leaf:leaf};});define('tinymce.core.dom.Position',['ephox.katamari.api.Arr','ephox.sand.api.PlatformDetection','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.properties.Css','ephox.sugar.api.search.Traverse'],function(Arr,PlatformDetection,Element,Node,Css,Traverse){var browser=PlatformDetection.detect().browser;var firstElement=function(nodes){return Arr.find(nodes,Node.isElement);};var getTableCaptionDeltaY=function(elm){if(browser.isFirefox()&& Node.name(elm)==='table'){return firstElement(Traverse.children(elm)).filter(function(elm){return Node.name(elm)==='caption';}).bind(function(caption){return firstElement(Traverse.nextSiblings(caption)).map(function(body){var bodyTop=body.dom().offsetTop;var captionTop=caption.dom().offsetTop;var captionHeight=caption.dom().offsetHeight;return bodyTop<=captionTop ?-captionHeight :0;});}).getOr(0);}else{return 0;}};var getPos=function(body,elm,rootElm){var x=0,y=0,offsetParent,doc=body.ownerDocument,pos;rootElm=rootElm ? rootElm :body;if(elm){if(rootElm===body && elm.getBoundingClientRect && Css.get(Element.fromDom(body),'position')==='static'){pos=elm.getBoundingClientRect();x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop;return{x:x,y:y};}offsetParent=elm;while(offsetParent && offsetParent !==rootElm && offsetParent.nodeType){x+=offsetParent.offsetLeft||0;y+=offsetParent.offsetTop||0;offsetParent=offsetParent.offsetParent;}offsetParent=elm.parentNode;while(offsetParent && offsetParent !==rootElm && offsetParent.nodeType){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode;}y+=getTableCaptionDeltaY(Element.fromDom(elm));}return{x:x,y:y};};return{getPos:getPos};});define('ephox.katamari.api.LazyValue',['ephox.katamari.api.Arr','ephox.katamari.api.Option','global!setTimeout'],function(Arr,Option,setTimeout){var nu=function(baseFn){var data=Option.none();var callbacks=[];var map=function(f){return nu(function(nCallback){get(function(data){nCallback(f(data));});});};var get=function(nCallback){if(isReady())call(nCallback);else callbacks.push(nCallback);};var set=function(x){data=Option.some(x);run(callbacks);callbacks=[];};var isReady=function(){return data.isSome();};var run=function(cbs){Arr.each(cbs,call);};var call=function(cb){data.each(function(x){setTimeout(function(){cb(x);},0);});};baseFn(set);return{get:get,map:map,isReady:isReady};};var pure=function(a){return nu(function(callback){callback(a);});};return{nu:nu,pure:pure};});define('ephox.katamari.async.Bounce',['global!Array','global!setTimeout'],function(Array,setTimeout){var bounce=function(f){return function(){var args=Array.prototype.slice.call(arguments);var me=this;setTimeout(function(){f.apply(me,args);},0);};};return{bounce:bounce};});define('ephox.katamari.api.Future',['ephox.katamari.api.LazyValue','ephox.katamari.async.Bounce'],function(LazyValue,Bounce){var nu=function(baseFn){var get=function(callback){baseFn(Bounce.bounce(callback));};var map=function(fab){return nu(function(callback){get(function(a){var value=fab(a);callback(value);});});};var bind=function(aFutureB){return nu(function(callback){get(function(a){aFutureB(a).get(callback);});});};var anonBind=function(futureB){return nu(function(callback){get(function(a){futureB.get(callback);});});};var toLazy=function(){return LazyValue.nu(get);};return{map:map,bind:bind,anonBind:anonBind,toLazy:toLazy,get:get};};var pure=function(a){return nu(function(callback){callback(a);});};return{nu:nu,pure:pure};});define('ephox.katamari.async.AsyncValues',['ephox.katamari.api.Arr'],function(Arr){var par=function(asyncValues,nu){return nu(function(callback){var r=[];var count=0;var cb=function(i){return function(value){r[i]=value;count++;if(count>=asyncValues.length){callback(r);}};};if(asyncValues.length===0){callback([]);}else{Arr.each(asyncValues,function(asyncValue,i){asyncValue.get(cb(i));});}});};return{par:par};});define('ephox.katamari.api.Futures',['ephox.katamari.api.Arr','ephox.katamari.api.Future','ephox.katamari.async.AsyncValues'],function(Arr,Future,AsyncValues){var par=function(futures){return AsyncValues.par(futures,Future.nu);};var mapM=function(array,fn){var futures=Arr.map(array,fn);return par(futures);};var compose=function(f,g){return function(a){return g(a).bind(f);};};return{par:par,mapM:mapM,compose:compose};});define('ephox.katamari.api.Result',['ephox.katamari.api.Fun','ephox.katamari.api.Option'],function(Fun,Option){var value=function(o){var is=function(v){return o===v;};var or=function(opt){return value(o);};var orThunk=function(f){return value(o);};var map=function(f){return value(f(o));};var each=function(f){f(o);};var bind=function(f){return f(o);};var fold=function(_,onValue){return onValue(o);};var exists=function(f){return f(o);};var forall=function(f){return f(o);};var toOption=function(){return Option.some(o);};return{is:is,isValue:Fun.constant(true),isError:Fun.constant(false),getOr:Fun.constant(o),getOrThunk:Fun.constant(o),getOrDie:Fun.constant(o),or:or,orThunk:orThunk,fold:fold,map:map,each:each,bind:bind,exists:exists,forall:forall,toOption:toOption};};var error=function(message){var getOrThunk=function(f){return f();};var getOrDie=function(){return Fun.die(message)();};var or=function(opt){return opt;};var orThunk=function(f){return f();};var map=function(f){return error(message);};var bind=function(f){return error(message);};var fold=function(onError,_){return onError(message);};return{is:Fun.constant(false),isValue:Fun.constant(false),isError:Fun.constant(true),getOr:Fun.identity,getOrThunk:getOrThunk,getOrDie:getOrDie,or:or,orThunk:orThunk,fold:fold,map:map,each:Fun.noop,bind:bind,exists:Fun.constant(false),forall:Fun.constant(true),toOption:Option.none};};return{value:value,error:error};});define('tinymce.core.dom.StyleSheetLoader',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Future','ephox.katamari.api.Futures','ephox.katamari.api.Result','global!navigator','tinymce.core.util.Delay','tinymce.core.util.Tools'],function(Arr,Fun,Future,Futures,Result,navigator,Delay,Tools){"use strict";return function(document,settings){var idCount=0,loadedStates={},maxLoadTime;settings=settings||{};maxLoadTime=settings.maxLoadTime||5000;var appendToHead=function(node){document.getElementsByTagName('head')[0].appendChild(node);};var load=function(url,loadedCallback,errorCallback){var link,style,startTime,state;var passed=function(){var callbacks=state.passed,i=callbacks.length;while(i--){callbacks[i]();}state.status=2;state.passed=[];state.failed=[];};var failed=function(){var callbacks=state.failed,i=callbacks.length;while(i--){callbacks[i]();}state.status=3;state.passed=[];state.failed=[];};var isOldWebKit=function(){var webKitChunks=navigator.userAgent.match(/WebKit\/(\d*)/);return !!(webKitChunks && webKitChunks[1]<536);};var wait=function(testCallback,waitCallback){if(!testCallback()){if((new Date().getTime())-startTime<maxLoadTime){Delay.setTimeout(waitCallback);}else{failed();}}};var waitForWebKitLinkLoaded=function(){wait(function(){var styleSheets=document.styleSheets,styleSheet,i=styleSheets.length,owner;while(i--){styleSheet=styleSheets[i];owner=styleSheet.ownerNode ? styleSheet.ownerNode :styleSheet.owningElement;if(owner && owner.id===link.id){passed();return true;}}},waitForWebKitLinkLoaded);};var waitForGeckoLinkLoaded=function(){wait(function(){try{var cssRules=style.sheet.cssRules;passed();return !!cssRules;}catch(ex){}},waitForGeckoLinkLoaded);};url=Tools._addCacheSuffix(url);if(!loadedStates[url]){state={passed:[],failed:[]};loadedStates[url]=state;}else{state=loadedStates[url];}if(loadedCallback){state.passed.push(loadedCallback);}if(errorCallback){state.failed.push(errorCallback);}if(state.status==1){return;}if(state.status==2){passed();return;}if(state.status==3){failed();return;}state.status=1;link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.id='u'+(idCount++);link.async=false;link.defer=false;startTime=new Date().getTime();if("onload" in link && !isOldWebKit()){link.onload=waitForWebKitLinkLoaded;link.onerror=failed;}else{if(navigator.userAgent.indexOf("Firefox")>0){style=document.createElement('style');style.textContent='@import "'+url+'"';waitForGeckoLinkLoaded();appendToHead(style);return;}waitForWebKitLinkLoaded();}appendToHead(link);link.href=url;};var loadF=function(url){return Future.nu(function(resolve){load(url,Fun.compose(resolve,Fun.constant(Result.value(url))),Fun.compose(resolve,Fun.constant(Result.error(url))));});};var unbox=function(result){return result.fold(Fun.identity,Fun.identity);};var loadAll=function(urls,success,failure){Futures.par(Arr.map(urls,loadF)).get(function(result){var parts=Arr.partition(result,function(r){return r.isValue();});if(parts.fail.length>0){failure(parts.fail.map(unbox));}else{success(parts.pass.map(unbox));}});};return{load:load,loadAll:loadAll};};});define('tinymce.core.dom.TreeWalker',[],function(){return function(startNode,rootNode){var node=startNode;var findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow && node[startName]){return node[startName];}if(node !=rootNode){sibling=node[siblingName];if(sibling){return sibling;}for(parent=node.parentNode;parent && parent !=rootNode;parent=parent.parentNode){sibling=parent[siblingName];if(sibling){return sibling;}}}}};var findPreviousNode=function(node,startName,siblingName,shallow){var sibling,parent,child;if(node){sibling=node[siblingName];if(rootNode && sibling===rootNode){return;}if(sibling){if(!shallow){for(child=sibling[startName];child;child=child[startName]){if(!child[startName]){return child;}}}return sibling;}parent=node.parentNode;if(parent && parent !==rootNode){return parent;}}};this.current=function(){return node;};this.next=function(shallow){node=findSibling(node,'firstChild','nextSibling',shallow);return node;};this.prev=function(shallow){node=findSibling(node,'lastChild','previousSibling',shallow);return node;};this.prev2=function(shallow){node=findPreviousNode(node,'lastChild','previousSibling',shallow);return node;};};});define('tinymce.core.dom.ElementType',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.sugar.api.node.Node'],function(Arr,Fun,Node){var blocks=['article','aside','details','div','dt','figcaption','footer','form','fieldset','header','hgroup','html','main','nav','section','summary','body','p','dl','multicol','dd','figure','address','center','blockquote','h1','h2','h3','h4','h5','h6','listing','xmp','pre','plaintext','menu','dir','ul','ol','li','hr','table','tbody','thead','tfoot','th','tr','td','caption'];var voids=['area','base','basefont','br','col','frame','hr','img','input','isindex','link','meta','param','embed','source','wbr','track'];var tableCells=['td','th'];var tableSections=['thead','tbody','tfoot'];var textBlocks=['h1','h2','h3','h4','h5','h6','p','div','address','pre','form','blockquote','center','dir','fieldset','header','footer','article','section','hgroup','aside','nav','figure'];var headings=['h1','h2','h3','h4','h5','h6'];var listItems=['li','dd','dt'];var lists=['ul','ol','dl'];var lazyLookup=function(items){var lookup;return function(node){lookup=lookup ? lookup :Arr.mapToObject(items,Fun.constant(true));return lookup.hasOwnProperty(Node.name(node));};};var isHeading=lazyLookup(headings);var isBlock=lazyLookup(blocks);var isInline=function(node){return Node.isElement(node)&& !isBlock(node);};var isBr=function(node){return Node.isElement(node)&& Node.name(node)==='br';};return{isBlock:isBlock,isInline:isInline,isHeading:isHeading,isTextBlock:lazyLookup(textBlocks),isList:lazyLookup(lists),isListItem:lazyLookup(listItems),isVoid:lazyLookup(voids),isTableSection:lazyLookup(tableSections),isTableCell:lazyLookup(tableCells),isBr:isBr};});define('tinymce.core.dom.NodeType',[],function(){var isNodeType=function(type){return function(node){return !!node && node.nodeType==type;};};var isElement=isNodeType(1);var matchNodeNames=function(names){names=names.toLowerCase().split(' ');return function(node){var i,name;if(node && node.nodeType){name=node.nodeName.toLowerCase();for(i=0;i<names.length;i++){if(name===names[i]){return true;}}}return false;};};var matchStyleValues=function(name,values){values=values.toLowerCase().split(' ');return function(node){var i,cssValue;if(isElement(node)){for(i=0;i<values.length;i++){cssValue=node.ownerDocument.defaultView.getComputedStyle(node,null).getPropertyValue(name);if(cssValue===values[i]){return true;}}}return false;};};var hasPropValue=function(propName,propValue){return function(node){return isElement(node)&& node[propName]===propValue;};};var hasAttribute=function(attrName,attrValue){return function(node){return isElement(node)&& node.hasAttribute(attrName);};};var hasAttributeValue=function(attrName,attrValue){return function(node){return isElement(node)&& node.getAttribute(attrName)===attrValue;};};var isBogus=function(node){return isElement(node)&& node.hasAttribute('data-mce-bogus');};var hasContentEditableState=function(value){return function(node){if(isElement(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};return{isText:isNodeType(3),isElement:isElement,isComment:isNodeType(8),isDocument:isNodeType(9),isBr:matchNodeNames('br'),isContentEditableTrue:hasContentEditableState('true'),isContentEditableFalse:hasContentEditableState('false'),matchNodeNames:matchNodeNames,hasPropValue:hasPropValue,hasAttribute:hasAttribute,hasAttributeValue:hasAttributeValue,matchStyleValues:matchStyleValues,isBogus:isBogus};});define('tinymce.core.dom.TrimNode',['ephox.sugar.api.node.Element','tinymce.core.dom.ElementType','tinymce.core.dom.NodeType','tinymce.core.util.Tools'],function(Element,ElementType,NodeType,Tools){var surroundedBySpans=function(node){var previousIsSpan=node.previousSibling && node.previousSibling.nodeName==='SPAN';var nextIsSpan=node.nextSibling && node.nextSibling.nodeName==='SPAN';return previousIsSpan && nextIsSpan;};var isBookmarkNode=function(node){return node && node.tagName==='SPAN' && node.getAttribute('data-mce-type')==='bookmark';};var trimNode=function(dom,node){var i,children=node.childNodes;if(NodeType.isElement(node)&& isBookmarkNode(node)){return;}for(i=children.length-1;i>=0;i--){trimNode(dom,children[i]);}if(NodeType.isDocument(node)===false){if(NodeType.isText(node)&& node.nodeValue.length>0){var trimmedLength=Tools.trim(node.nodeValue).length;if(dom.isBlock(node.parentNode)||trimmedLength>0){return;}if(trimmedLength===0 && surroundedBySpans(node)){return;}}else if(NodeType.isElement(node)){children=node.childNodes;if(children.length===1 && isBookmarkNode(children[0])){node.parentNode.insertBefore(children[0],node);}if(children.length||ElementType.isVoid(Element.fromDom(node))){return;}}dom.remove(node);}return node;};return{trimNode:trimNode};});define('tinymce.core.html.Entities',['ephox.sugar.api.node.Element','tinymce.core.util.Tools'],function(Element,Tools){var makeMap=Tools.makeMap;var namedEntities,baseEntities,reverseEntities,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"};baseEntities={'\"':'&quot;',"'":'&#39;','<':'&lt;','>':'&gt;','&':'&amp;','\u0060':'&#96;'};reverseEntities={'&lt;':'<','&gt;':'>','&amp;':'&','&quot;':'"','&apos;':"'"};var nativeDecode=function(text){var elm;elm=Element.fromTag("div").dom();elm.innerHTML=text;return elm.textContent||elm.innerText||text;};var buildEntitiesLookup=function(items,radix){var i,chr,entity,lookup={};if(items){items=items.split(',');radix=radix||10;for(i=0;i<items.length;i+=2){chr=String.fromCharCode(parseInt(items[i],radix));if(!baseEntities[chr]){entity='&'+items[i+1]+';';lookup[chr]=entity;lookup[entity]=chr;}}return lookup;}};namedEntities=buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,'+'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,'+'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,'+'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,'+'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,'+'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,'+'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,'+'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,'+'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,'+'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,'+'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,'+'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,'+'t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,'+'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,'+'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,'+'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,'+'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,'+'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,'+'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,'+'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,'+'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,'+'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,'+'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,'+'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,'+'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro',32);var Entities={encodeRaw:function(text,attr){return text.replace(attr ? attrsCharsRegExp :textCharsRegExp,function(chr){return baseEntities[chr]||chr;});},encodeAllRaw:function(text){return(''+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr;});},encodeNumeric:function(text,attr){return text.replace(attr ? attrsCharsRegExp :textCharsRegExp,function(chr){if(chr.length>1){return '&#'+(((chr.charCodeAt(0)-0xD800)*0x400)+(chr.charCodeAt(1)-0xDC00)+0x10000)+';';}return baseEntities[chr]||'&#'+chr.charCodeAt(0)+';';});},encodeNamed:function(text,attr,entities){entities=entities||namedEntities;return text.replace(attr ? attrsCharsRegExp :textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr;});},getEncodeFunc:function(name,entities){entities=buildEntitiesLookup(entities)||namedEntities;var encodeNamedAndNumeric=function(text,attr){return text.replace(attr ? attrsCharsRegExp :textCharsRegExp,function(chr){if(baseEntities[chr]!==undefined){return baseEntities[chr];}if(entities[chr]!==undefined){return entities[chr];}if(chr.length>1){return '&#'+(((chr.charCodeAt(0)-0xD800)*0x400)+(chr.charCodeAt(1)-0xDC00)+0x10000)+';';}return '&#'+chr.charCodeAt(0)+';';});};var encodeCustomNamed=function(text,attr){return Entities.encodeNamed(text,attr,entities);};name=makeMap(name.replace(/\+/g,','));if(name.named && name.numeric){return encodeNamedAndNumeric;}if(name.named){if(entities){return encodeCustomNamed;}return Entities.encodeNamed;}if(name.numeric){return Entities.encodeNumeric;}return Entities.encodeRaw;},decode:function(text){return text.replace(entityRegExp,function(all,numeric){if(numeric){if(numeric.charAt(0).toLowerCase()==='x'){numeric=parseInt(numeric.substr(1),16);}else{numeric=parseInt(numeric,10);}if(numeric>0xFFFF){numeric-=0x10000;return String.fromCharCode(0xD800+(numeric>>10),0xDC00+(numeric & 0x3FF));}return asciiMap[numeric]||String.fromCharCode(numeric);}return reverseEntities[all]||namedEntities[all]||nativeDecode(all);});}};return Entities;});define('tinymce.core.html.Schema',["tinymce.core.util.Tools"],function(Tools){var mapCache={},dummyObj={};var makeMap=Tools.makeMap,each=Tools.each,extend=Tools.extend,explode=Tools.explode,inArray=Tools.inArray;var split=function(items,delim){items=Tools.trim(items);return items ? items.split(delim||' '):[];};var compileSchema=function(type){var schema={},globalAttributes,blockContent;var phrasingContent,flowContent,html4BlockContent,html4PhrasingContent;var add=function(name,attributes,children){var ni,attributesOrder,element;var arrayToMap=function(array,obj){var map={},i,l;for(i=0,l=array.length;i<l;i++){map[array[i]]=obj||{};}return map;};children=children||[];attributes=attributes||"";if(typeof children==="string"){children=split(children);}name=split(name);ni=name.length;while(ni--){attributesOrder=split([globalAttributes,attributes].join(' '));element={attributes:arrayToMap(attributesOrder),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)};schema[name[ni]]=element;}};var addAttrs=function(name,attributes){var ni,schemaItem,i,l;name=split(name);ni=name.length;attributes=split(attributes);while(ni--){schemaItem=schema[name[ni]];for(i=0,l=attributes.length;i<l;i++){schemaItem.attributes[attributes[i]]={};schemaItem.attributesOrder.push(attributes[i]);}}};if(mapCache[type]){return mapCache[type];}globalAttributes="id accesskey class dir lang style tabindex title role";blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul";phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd "+"label map noscript object q s samp script select small span strong sub sup "+"textarea u var #text #comment" ;if(type !="html4"){globalAttributes+=" contenteditable contextmenu draggable dropzone "+"hidden spellcheck translate";blockContent+=" article aside details dialog figure header footer hgroup section nav";phrasingContent+=" audio canvas command datalist mark meter output picture "+"progress time wbr video ruby bdi keygen";}if(type !="html5-strict"){globalAttributes+=" xml:lang";html4PhrasingContent="acronym applet basefont big font strike tt";phrasingContent=[phrasingContent,html4PhrasingContent].join(' ');each(split(html4PhrasingContent),function(name){add(name,"",phrasingContent);});html4BlockContent="center dir isindex noframes";blockContent=[blockContent,html4BlockContent].join(' ');flowContent=[blockContent,phrasingContent].join(' ');each(split(html4BlockContent),function(name){add(name,"",flowContent);});}flowContent=flowContent||[blockContent,phrasingContent].join(" ");add("html","manifest","head body");add("head","","base command link meta noscript script style title");add("title hr noscript br");add("base","href target");add("link","href rel media hreflang type sizes hreflang");add("meta","name http-equiv content charset");add("style","media type scoped");add("script","src async defer type charset");add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus "+"onhashchange onload onmessage onoffline ononline onpagehide onpageshow "+"onpopstate onresize onscroll onstorage onunload",flowContent);add("address dt dd div caption","",flowContent);add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent);add("blockquote","cite",flowContent);add("ol","reversed start type","li");add("ul","","li");add("li","value",flowContent);add("dl","","dt dd");add("a","href target rel media hreflang type",phrasingContent);add("q","cite",phrasingContent);add("ins del","cite datetime",flowContent);add("img","src sizes srcset alt usemap ismap width height");add("iframe","src name width height",flowContent);add("embed","src type width height");add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(' '));add("param","name value");add("map","name",[flowContent,"area"].join(' '));add("area","alt coords shape href target rel media hreflang type");add("table","border","caption colgroup thead tfoot tbody tr"+(type=="html4" ? " col" :""));add("colgroup","span","col");add("col","span");add("tbody thead tfoot","","tr");add("tr","","td th");add("td","colspan rowspan headers",flowContent);add("th","colspan rowspan headers scope abbr",flowContent);add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent);add("fieldset","disabled form name",[flowContent,"legend"].join(' '));add("label","form for",phrasingContent);add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate "+"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width");add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value",type=="html4" ? flowContent :phrasingContent);add("select","disabled form multiple name required size","option optgroup");add("optgroup","disabled label","option");add("option","disabled label selected value");add("textarea","cols dirname disabled form maxlength name readonly required rows wrap");add("menu","type label",[flowContent,"li"].join(' '));add("noscript","",flowContent);if(type !="html4"){add("wbr");add("ruby","",[phrasingContent,"rt rp"].join(' '));add("figcaption","",flowContent);add("mark rt rp summary bdi","",phrasingContent);add("canvas","width height",flowContent);add("video","src crossorigin poster preload autoplay mediagroup loop "+"muted controls width height buffered",[flowContent,"track source"].join(' '));add("audio","src crossorigin preload autoplay mediagroup loop muted controls "+"buffered volume",[flowContent,"track source"].join(' '));add("picture","","img source");add("source","src srcset type media sizes");add("track","kind src srclang label default");add("datalist","",[phrasingContent,"option"].join(' '));add("article section nav aside header footer","",flowContent);add("hgroup","","h1 h2 h3 h4 h5 h6");add("figure","",[flowContent,"figcaption"].join(' '));add("time","datetime",phrasingContent);add("dialog","open",flowContent);add("command","type label icon disabled checked radiogroup command");add("output","for form name",phrasingContent);add("progress","value max",phrasingContent);add("meter","value min max low high optimum",phrasingContent);add("details","open",[flowContent,"summary"].join(' '));add("keygen","autofocus challenge disabled form keytype name");}if(type !="html5-strict"){addAttrs("script","language xml:space");addAttrs("style","xml:space");addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace");addAttrs("embed","align name hspace vspace");addAttrs("param","valuetype type");addAttrs("a","charset name rev shape coords");addAttrs("br","clear");addAttrs("applet","codebase archive code object alt name width height align hspace vspace");addAttrs("img","name longdesc align border hspace vspace");addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align");addAttrs("font basefont","size color face");addAttrs("input","usemap align");addAttrs("select","onchange");addAttrs("textarea");addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align");addAttrs("ul","type compact");addAttrs("li","type");addAttrs("ol dl menu dir","compact");addAttrs("pre","width xml:space");addAttrs("hr","align noshade size width");addAttrs("isindex","prompt");addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor");addAttrs("col","width align char charoff valign");addAttrs("colgroup","width align char charoff valign");addAttrs("thead","align char charoff valign");addAttrs("tr","align char charoff valign bgcolor");addAttrs("th","axis align char charoff valign nowrap bgcolor width height");addAttrs("form","accept");addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height");addAttrs("tfoot","align char charoff valign");addAttrs("tbody","align char charoff valign");addAttrs("area","nohref");addAttrs("body","background bgcolor text link vlink alink");}if(type !="html4"){addAttrs("input button select textarea","autofocus");addAttrs("input textarea","placeholder");addAttrs("a","download");addAttrs("link script img","crossorigin");addAttrs("iframe","sandbox seamless allowfullscreen");}each(split('a form meter progress dfn'),function(name){if(schema[name]){delete schema[name].children[name];}});delete schema.caption.children.table;delete schema.script;mapCache[type]=schema;return schema;};var compileElementMap=function(value,mode){var styles;if(value){styles={};if(typeof value=='string'){value={'*':value};}each(value,function(value,key){styles[key]=styles[key.toUpperCase()]=mode=='map' ? makeMap(value,/[,]/):explode(value,/[,]/);});}return styles;};return function(settings){var self=this,elements={},children={},patternElements=[],validStyles,invalidStyles,schemaItems;var whiteSpaceElementsMap,selfClosingElementsMap,shortEndedElementsMap,boolAttrMap,validClasses;var blockElementsMap,nonEmptyElementsMap,moveCaretBeforeOnEnterElementsMap,textBlockElementsMap,textInlineElementsMap;var customElementsMap={},specialElements={};var createLookupTable=function(option,defaultValue,extendWith){var value=settings[option];if(!value){value=mapCache[option];if(!value){value=makeMap(defaultValue,' ',makeMap(defaultValue.toUpperCase(),' '));value=extend(value,extendWith);mapCache[option]=value;}}else{value=makeMap(value,/[,]/,makeMap(value.toUpperCase(),/[,]/));}return value;};settings=settings||{};schemaItems=compileSchema(settings.schema);if(settings.verify_html===false){settings.valid_elements='*[*]';}validStyles=compileElementMap(settings.valid_styles);invalidStyles=compileElementMap(settings.invalid_styles,'map');validClasses=compileElementMap(settings.valid_classes,'map');whiteSpaceElementsMap=createLookupTable('whitespace_elements','pre script noscript style textarea video audio iframe object code');selfClosingElementsMap=createLookupTable('self_closing_elements','colgroup dd dt li option p td tfoot th thead tr');shortEndedElementsMap=createLookupTable('short_ended_elements','area base basefont br col frame hr img input isindex link '+'meta param embed source wbr track');boolAttrMap=createLookupTable('boolean_attributes','checked compact declare defer disabled ismap multiple nohref noresize '+'noshade nowrap readonly selected autoplay loop controls');nonEmptyElementsMap=createLookupTable('non_empty_elements','td th iframe video audio object '+'script pre code',shortEndedElementsMap);moveCaretBeforeOnEnterElementsMap=createLookupTable('move_caret_before_on_enter_elements','table',nonEmptyElementsMap);textBlockElementsMap=createLookupTable('text_block_elements','h1 h2 h3 h4 h5 h6 p div address pre form '+'blockquote center dir fieldset header footer article section hgroup aside nav figure');blockElementsMap=createLookupTable('block_elements','hr table tbody thead tfoot '+'th tr td li ol ul caption dl dt dd noscript menu isindex option '+'datalist select optgroup figcaption',textBlockElementsMap);textInlineElementsMap=createLookupTable('text_inline_elements','span strong b em i font strike u var cite '+'dfn code mark q sup sub samp');each((settings.special||'script noscript noframes noembed title style textarea xmp').split(' '),function(name){specialElements[name]=new RegExp('<\/'+name+'[^>]*>','gi');});var patternToRegExp=function(str){return new RegExp('^'+str.replace(/([?+*])/g,'.$1')+'$');};var addValidElements=function(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,key,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){validElements=split(validElements,',');if(elements['@']){globalAttributes=elements['@'].attributes;globalAttributesOrder=elements['@'].attributesOrder;}for(ei=0,el=validElements.length;ei<el;ei++){matches=elementRuleRegExp.exec(validElements[ei]);if(matches){prefix=matches[1];elementName=matches[2];outputName=matches[3];attrData=matches[5];attributes={};attributesOrder=[];element={attributes:attributes,attributesOrder:attributesOrder};if(prefix==='#'){element.paddEmpty=true;}if(prefix==='-'){element.removeEmpty=true;}if(matches[4]==='!'){element.removeEmptyAttrs=true;}if(globalAttributes){for(key in globalAttributes){attributes[key]=globalAttributes[key];}attributesOrder.push.apply(attributesOrder,globalAttributesOrder);}if(attrData){attrData=split(attrData,'|');for(ai=0,al=attrData.length;ai<al;ai++){matches=attrRuleRegExp.exec(attrData[ai]);if(matches){attr={};attrType=matches[1];attrName=matches[2].replace(/[\\:]:/g,':');prefix=matches[3];value=matches[4];if(attrType==='!'){element.attributesRequired=element.attributesRequired||[];element.attributesRequired.push(attrName);attr.required=true;}if(attrType==='-'){delete attributes[attrName];attributesOrder.splice(inArray(attributesOrder,attrName),1);continue;}if(prefix){if(prefix==='='){element.attributesDefault=element.attributesDefault||[];element.attributesDefault.push({name:attrName,value:value});attr.defaultValue=value;}if(prefix===':'){element.attributesForced=element.attributesForced||[];element.attributesForced.push({name:attrName,value:value});attr.forcedValue=value;}if(prefix==='<'){attr.validValues=makeMap(value,'?');}}if(hasPatternsRegExp.test(attrName)){element.attributePatterns=element.attributePatterns||[];attr.pattern=patternToRegExp(attrName);element.attributePatterns.push(attr);}else{if(!attributes[attrName]){attributesOrder.push(attrName);}attributes[attrName]=attr;}}}}if(!globalAttributes && elementName=='@'){globalAttributes=attributes;globalAttributesOrder=attributesOrder;}if(outputName){element.outputName=elementName;elements[outputName]=element;}if(hasPatternsRegExp.test(elementName)){element.pattern=patternToRegExp(elementName);patternElements.push(element);}else{elements[elementName]=element;}}}}};var setValidElements=function(validElements){elements={};patternElements=[];addValidElements(validElements);each(schemaItems,function(element,name){children[name]=element.children;});};var addCustomElements=function(customElements){var customElementRegExp=/^(~)?(.+)$/;if(customElements){mapCache.text_block_elements=mapCache.block_elements=null;each(split(customElements,','),function(rule){var matches=customElementRegExp.exec(rule),inline=matches[1]==='~',cloneName=inline ? 'span' :'div',name=matches[2];children[name]=children[cloneName];customElementsMap[name]=cloneName;if(!inline){blockElementsMap[name.toUpperCase()]={};blockElementsMap[name]={};}if(!elements[name]){var customRule=elements[cloneName];customRule=extend({},customRule);delete customRule.removeEmptyAttrs;delete customRule.removeEmpty;elements[name]=customRule;}each(children,function(element,elmName){if(element[cloneName]){children[elmName]=element=extend({},children[elmName]);element[name]=element[cloneName];}});});}};var addValidChildren=function(validChildren){var childRuleRegExp=/^([+\-]?)(\w+)\[([^\]]+)\]$/;mapCache[settings.schema]=null;if(validChildren){each(split(validChildren,','),function(rule){var matches=childRuleRegExp.exec(rule),parent,prefix;if(matches){prefix=matches[1];if(prefix){parent=children[matches[2]];}else{parent=children[matches[2]]={'#comment':{}};}parent=children[matches[2]];each(split(matches[3],'|'),function(child){if(prefix==='-'){delete parent[child];}else{parent[child]={};}});}});}};var getElementRule=function(name){var element=elements[name],i;if(element){return element;}i=patternElements.length;while(i--){element=patternElements[i];if(element.pattern.test(name)){return element;}}};if(!settings.valid_elements){each(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder};children[name]=element.children;});if(settings.schema !="html5"){each(split('strong/b em/i'),function(item){item=split(item,'/');elements[item[1]].outputName=item[0];});}each(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'),function(name){if(elements[name]){elements[name].removeEmpty=true;}});each(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'),function(name){elements[name].paddEmpty=true;});each(split('span'),function(name){elements[name].removeEmptyAttrs=true;});}else{setValidElements(settings.valid_elements);}addCustomElements(settings.custom_elements);addValidChildren(settings.valid_children);addValidElements(settings.extended_valid_elements);addValidChildren('+ol[ul|ol],+ul[ul|ol]');each({dd:'dl',dt:'dl',li:'ul ol',td:'tr',th:'tr',tr:'tbody thead tfoot',tbody:'table',thead:'table',tfoot:'table',legend:'fieldset',area:'map',param:'video audio object'},function(parents,item){if(elements[item]){elements[item].parentsRequired=split(parents);}});if(settings.invalid_elements){each(explode(settings.invalid_elements),function(item){if(elements[item]){delete elements[item];}});}if(!getElementRule('span')){addValidElements('span[!data-mce-type|*]');}self.children=children;self.getValidStyles=function(){return validStyles;};self.getInvalidStyles=function(){return invalidStyles;};self.getValidClasses=function(){return validClasses;};self.getBoolAttrs=function(){return boolAttrMap;};self.getBlockElements=function(){return blockElementsMap;};self.getTextBlockElements=function(){return textBlockElementsMap;};self.getTextInlineElements=function(){return textInlineElementsMap;};self.getShortEndedElements=function(){return shortEndedElementsMap;};self.getSelfClosingElements=function(){return selfClosingElementsMap;};self.getNonEmptyElements=function(){return nonEmptyElementsMap;};self.getMoveCaretBeforeOnEnterElements=function(){return moveCaretBeforeOnEnterElementsMap;};self.getWhiteSpaceElements=function(){return whiteSpaceElementsMap;};self.getSpecialElements=function(){return specialElements;};self.isValidChild=function(name,child){var parent=children[name.toLowerCase()];return !!(parent && parent[child.toLowerCase()]);};self.isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(attr){if(rule.attributes[attr]){return true;}attrPatterns=rule.attributePatterns;if(attrPatterns){i=attrPatterns.length;while(i--){if(attrPatterns[i].pattern.test(name)){return true;}}}}else{return true;}}return false;};self.getElementRule=getElementRule;self.getCustomElements=function(){return customElementsMap;};self.addValidElements=addValidElements;self.setValidElements=setValidElements;self.addCustomElements=addCustomElements;self.addValidChildren=addValidChildren;self.elements=elements;};});define('tinymce.core.html.Styles',[],function(){return function(settings,schema){var rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,i,encodingLookup={},encodingItems,validStyles,invalidStyles,invisibleChar='\uFEFF';settings=settings||{};if(schema){validStyles=schema.getValidStyles();invalidStyles=schema.getInvalidStyles();}encodingItems=('\\" \\\' \\; \\: ; : '+invisibleChar).split(' ');for(i=0;i<encodingItems.length;i++){encodingLookup[encodingItems[i]]=invisibleChar+i;encodingLookup[invisibleChar+i]=encodingItems[i];}var toHex=function(match,r,g,b){var hex=function(val){val=parseInt(val,10).toString(16);return val.length>1 ? val :'0'+val;};return '#'+hex(r)+hex(g)+hex(b);};return{toHex:function(color){return color.replace(rgbRegExp,toHex);},parse:function(css){var styles={},matches,name,value,isEncoded,urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope||this;var compress=function(prefix,suffix,noJoin){var top,right,bottom,left;top=styles[prefix+'-top'+suffix];if(!top){return;}right=styles[prefix+'-right'+suffix];if(!right){return;}bottom=styles[prefix+'-bottom'+suffix];if(!bottom){return;}left=styles[prefix+'-left'+suffix];if(!left){return;}var box=[top,right,bottom,left];i=box.length-1;while(i--){if(box[i]!==box[i+1]){break;}}if(i>-1 && noJoin){return;}styles[prefix+suffix]=i==-1 ? box[0]:box.join(' ');delete styles[prefix+'-top'+suffix];delete styles[prefix+'-right'+suffix];delete styles[prefix+'-bottom'+suffix];delete styles[prefix+'-left'+suffix];};var canCompress=function(key){var value=styles[key],i;if(!value){return;}value=value.split(' ');i=value.length;while(i--){if(value[i]!==value[0]){return false;}}styles[key]=value[0];return true;};var compress2=function(target,a,b,c){if(!canCompress(a)){return;}if(!canCompress(b)){return;}if(!canCompress(c)){return;}styles[target]=styles[a]+' '+styles[b]+' '+styles[c];delete styles[a];delete styles[b];delete styles[c];};var encode=function(str){isEncoded=true;return encodingLookup[str];};var decode=function(str,keepSlashes){if(isEncoded){str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str];});}if(!keepSlashes){str=str.replace(/\\([\'\";:])/g,"$1");}return str;};var decodeSingleHexSequence=function(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16));};var decodeHexSequences=function(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence);};var processUrl=function(match,url,url2,url3,str,str2){str=str||str2;if(str){str=decode(str);return "'"+str.replace(/\'/g,"\\'")+"'";}url=decode(url||url2||url3);if(!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,'');if(/(java|vb)script:/i.test(scriptUrl)){return "";}if(!settings.allow_svg_data_urls && /^data:image\/svg/i.test(scriptUrl)){return "";}}if(urlConverter){url=urlConverter.call(urlConverterScope,url,'style');}return "url('"+url.replace(/\'/g,"\\'")+"')";};if(css){css=css.replace(/[\u0000-\u001F]/g,'');css=css.replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode);});while((matches=styleRegExp.exec(css))){styleRegExp.lastIndex=matches.index+matches[0].length;name=matches[1].replace(trimRightRegExp,'').toLowerCase();value=matches[2].replace(trimRightRegExp,'');if(name && value){name=decodeHexSequences(name);value=decodeHexSequences(value);if(name.indexOf(invisibleChar)!==-1||name.indexOf('"')!==-1){continue;}if(!settings.allow_script_urls &&(name=="behavior"||/expression\s*\(|\/\*|\*\//.test(value))){continue;}if(name==='font-weight' && value==='700'){value='bold';}else if(name==='color'||name==='background-color'){value=value.toLowerCase();}value=value.replace(rgbRegExp,toHex);value=value.replace(urlOrStrRegExp,processUrl);styles[name]=isEncoded ? decode(value,true):value;}}compress("border","",true);compress("border","-width");compress("border","-color");compress("border","-style");compress("padding","");compress("margin","");compress2('border','border-width','border-style','border-color');if(styles.border==='medium none'){delete styles.border;}if(styles['border-image']==='none'){delete styles['border-image'];}}return styles;},serialize:function(styles,elementName){var css='',name,value;var serializeStyles=function(name){var styleList,i,l,value;styleList=validStyles[name];if(styleList){for(i=0,l=styleList.length;i<l;i++){name=styleList[i];value=styles[name];if(value){css+=(css.length>0 ? ' ' :'')+name+': '+value+';';}}}};var isValid=function(name,elementName){var styleMap;styleMap=invalidStyles['*'];if(styleMap && styleMap[name]){return false;}styleMap=invalidStyles[elementName];if(styleMap && styleMap[name]){return false;}return true;};if(elementName && validStyles){serializeStyles('*');serializeStyles(elementName);}else{for(name in styles){value=styles[name];if(value &&(!invalidStyles||isValid(name,elementName))){css+=(css.length>0 ? ' ' :'')+name+': '+value+';';}}}return css;}};};});define('tinymce.core.dom.DOMUtils',['global!document','global!window','tinymce.core.Env','tinymce.core.dom.DomQuery','tinymce.core.dom.EventUtils','tinymce.core.dom.Position','tinymce.core.dom.Sizzle','tinymce.core.dom.StyleSheetLoader','tinymce.core.dom.TreeWalker','tinymce.core.dom.TrimNode','tinymce.core.html.Entities','tinymce.core.html.Schema','tinymce.core.html.Styles','tinymce.core.util.Tools'],function(document,window,Env,DomQuery,EventUtils,Position,Sizzle,StyleSheetLoader,TreeWalker,TrimNode,Entities,Schema,Styles,Tools){var each=Tools.each,is=Tools.is,grep=Tools.grep;var isIE=Env.ie;var simpleSelectorRe=/^([a-z0-9])+$/i;var whiteSpaceRegExp=/^[ \t\r\n]*$/;var setupAttrHooks=function(domUtils,settings){var attrHooks={},keepValues=settings.keep_values,keepUrlHook;keepUrlHook={set:function($elm,value,name){if(settings.url_converter){value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0]);}$elm.attr('data-mce-'+name,value).attr(name,value);},get:function($elm,name){return $elm.attr('data-mce-'+name)||$elm.attr(name);}};attrHooks={style:{set:function($elm,value){if(value !==null && typeof value==='object'){$elm.css(value);return;}if(keepValues){$elm.attr('data-mce-style',value);}$elm.attr('style',value);},get:function($elm){var value=$elm.attr('data-mce-style')||$elm.attr('style');value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName);return value;}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook;}return attrHooks;};var updateInternalStyleAttr=function(domUtils,$elm){var value=$elm.attr('style');value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName);if(!value){value=null;}$elm.attr('data-mce-style',value);};var nodeIndex=function(node,normalized){var idx=0,lastNodeType,nodeType;if(node){for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling){nodeType=node.nodeType;if(normalized && nodeType==3){if(nodeType==lastNodeType||!node.nodeValue.length){continue;}}idx++;lastNodeType=nodeType;}}return idx;};var DOMUtils=function(doc,settings){var self=this,blockElementsMap;self.doc=doc;self.win=window;self.files={};self.counter=0;self.stdMode=!isIE||doc.documentMode>=8;self.boxModel=!isIE||doc.compatMode=="CSS1Compat"||self.stdMode;self.styleSheetLoader=new StyleSheetLoader(doc);self.boundEvents=[];self.settings=settings=settings||{};self.schema=settings.schema ? settings.schema :new Schema({});self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);self.fixDoc(doc);self.events=settings.ownEvents ? new EventUtils(settings.proxy):EventUtils.Event;self.attrHooks=setupAttrHooks(self,settings);blockElementsMap=self.schema.getBlockElements();self.$=DomQuery.overrideDefaults(function(){return{context:doc,element:self.getRoot()};});self.isBlock=function(node){if(!node){return false;}var type=node.nodeType;if(type){return !!(type===1 && blockElementsMap[node.nodeName]);}return !!blockElementsMap[node];};};DOMUtils.prototype={$$:function(elm){if(typeof elm=='string'){elm=this.get(elm);}return this.$(elm);},root:null,fixDoc:function(doc){var settings=this.settings,name;if(isIE && settings.schema){('abbr article aside audio canvas '+'details figcaption figure footer '+'header hgroup mark menu meter nav '+'output progress section summary '+'time video').replace(/\w+/g,function(name){doc.createElement(name);});for(name in settings.schema.getCustomElements()){doc.createElement(name);}}},clone:function(node,deep){var self=this,clone,doc;if(!isIE||node.nodeType !==1||deep){return node.cloneNode(deep);}doc=self.doc;if(!deep){clone=doc.createElement(node.nodeName);each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName));});return clone;}return clone.firstChild;},getRoot:function(){var self=this;return self.settings.root_element||self.doc.body;},getViewPort:function(win){var doc,rootElm;win=!win ? this.win :win;doc=win.document;rootElm=this.boxModel ? doc.documentElement :doc.body;return{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight};},getRect:function(elm){var self=this,pos,size;elm=self.get(elm);pos=self.getPos(elm);size=self.getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h};},getSize:function(elm){var self=this,w,h;elm=self.get(elm);w=self.getStyle(elm,'width');h=self.getStyle(elm,'height');if(w.indexOf('px')===-1){w=0;}if(h.indexOf('px')===-1){h=0;}return{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight};},getParent:function(node,selector,root){return this.getParents(node,selector,root,false);},getParents:function(node,selector,root,collect){var self=this,selectorVal,result=[];node=self.get(node);collect=collect===undefined;root=root||(self.getRoot().nodeName !='BODY' ? self.getRoot().parentNode :null);if(is(selector,'string')){selectorVal=selector;if(selector==='*'){selector=function(node){return node.nodeType==1;};}else{selector=function(node){return self.is(node,selectorVal);};}}while(node){if(node==root||!node.nodeType||node.nodeType===9){break;}if(!selector||selector(node)){if(collect){result.push(node);}else{return node;}}node=node.parentNode;}return collect ? result :null;},get:function(elm){var name;if(elm && this.doc && typeof elm=='string'){name=elm;elm=this.doc.getElementById(elm);if(elm && elm.id !==name){return this.doc.getElementsByName(name)[1];}}return elm;},getNext:function(node,selector){return this._findSib(node,selector,'nextSibling');},getPrev:function(node,selector){return this._findSib(node,selector,'previousSibling');},select:function(selector,scope){var self=this;return Sizzle(selector,self.get(scope)||self.settings.root_element||self.doc,[]);},is:function(elm,selector){var i;if(!elm){return false;}if(elm.length===undefined){if(selector==='*'){return elm.nodeType==1;}if(simpleSelectorRe.test(selector)){selector=selector.toLowerCase().split(/,/);elm=elm.nodeName.toLowerCase();for(i=selector.length-1;i>=0;i--){if(selector[i]==elm){return true;}}return false;}}if(elm.nodeType && elm.nodeType !=1){return false;}var elms=elm.nodeType ?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0;},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;newElm=is(name,'string')? self.doc.createElement(name):name;self.setAttribs(newElm,attrs);if(html){if(html.nodeType){newElm.appendChild(html);}else{self.setHTML(newElm,html);}}return !create ? parentElm.appendChild(newElm):newElm;});},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1);},createHTML:function(name,attrs,html){var outHtml='',key;outHtml+='<'+name;for(key in attrs){if(attrs.hasOwnProperty(key)&& attrs[key]!==null && typeof attrs[key]!='undefined'){outHtml+=' '+key+'="'+this.encode(attrs[key])+'"';}}if(typeof html !="undefined"){return outHtml+'>'+html+'</'+name+'>';}return outHtml+' />';},createFragment:function(html){var frag,node,doc=this.doc,container;container=doc.createElement("div");frag=doc.createDocumentFragment();if(html){container.innerHTML=html;}while((node=container.firstChild)){frag.appendChild(node);}return frag;},remove:function(node,keepChildren){node=this.$$(node);if(keepChildren){node.each(function(){var child;while((child=this.firstChild)){if(child.nodeType==3 && child.data.length===0){this.removeChild(child);}else{this.parentNode.insertBefore(child,this);}}}).remove();}else{node.remove();}return node.length>1 ? node.toArray():node[0];},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value);if(this.settings.update_styles){updateInternalStyleAttr(this,elm);}},getStyle:function(elm,name,computed){elm=this.$$(elm);if(computed){return elm.css(name);}name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});if(name=='float'){name=Env.ie && Env.ie<12 ? 'styleFloat' :'cssFloat';}return elm[0]&& elm[0].style ? elm[0].style[name]:undefined;},setStyles:function(elm,styles){elm=this.$$(elm).css(styles);if(this.settings.update_styles){updateInternalStyleAttr(this,elm);}},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i));}});},setAttrib:function(elm,name,value){var self=this,originalValue,hook,settings=self.settings;if(value===''){value=null;}elm=self.$$(elm);originalValue=elm.attr(name);if(!elm.length){return;}hook=self.attrHooks[name];if(hook && hook.set){hook.set(elm,value,name);}else{elm.attr(name,value);}if(originalValue !=value && settings.onSetAttrib){settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value});}},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value);});});},getAttrib:function(elm,name,defaultVal){var self=this,hook,value;elm=self.$$(elm);if(elm.length){hook=self.attrHooks[name];if(hook && hook.get){value=hook.get(elm,name);}else{value=elm.attr(name);}}if(typeof value=='undefined'){value=defaultVal||'';}return value;},getPos:function(elm,rootElm){return Position.getPos(this.doc.body,this.get(elm),rootElm);},parseStyle:function(cssText){return this.styles.parse(cssText);},serializeStyle:function(styles,name){return this.styles.serialize(styles,name);},addStyle:function(cssText){var self=this,doc=self.doc,head,styleElm;if(self !==DOMUtils.DOM && doc===document){var addedStyles=DOMUtils.DOM.addedStyles;addedStyles=addedStyles||[];if(addedStyles[cssText]){return;}addedStyles[cssText]=true;DOMUtils.DOM.addedStyles=addedStyles;}styleElm=doc.getElementById('mceDefaultStyles');if(!styleElm){styleElm=doc.createElement('style');styleElm.id='mceDefaultStyles';styleElm.type='text/css';head=doc.getElementsByTagName('head')[0];if(head.firstChild){head.insertBefore(styleElm,head.firstChild);}else{head.appendChild(styleElm);}}if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText;}else{styleElm.appendChild(doc.createTextNode(cssText));}},loadCSS:function(url){var self=this,doc=self.doc,head;if(self !==DOMUtils.DOM && doc===document){DOMUtils.DOM.loadCSS(url);return;}if(!url){url='';}head=doc.getElementsByTagName('head')[0];each(url.split(','),function(url){var link;url=Tools._addCacheSuffix(url);if(self.files[url]){return;}self.files[url]=true;link=self.create('link',{rel:'stylesheet',href:url});if(isIE && doc.documentMode && doc.recalc){link.onload=function(){if(doc.recalc){doc.recalc();}link.onload=null;};}head.appendChild(link);});},addClass:function(elm,cls){this.$$(elm).addClass(cls);},removeClass:function(elm,cls){this.toggleClass(elm,cls,false);},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls);},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){if(this.className===''){DomQuery(this).attr('class',null);}});},show:function(elm){this.$$(elm).show();},hide:function(elm){this.$$(elm).hide();},isHidden:function(elm){return this.$$(elm).css('display')=='none';},uniqueId:function(prefix){return(!prefix ? 'mce_' :prefix)+(this.counter++);},setHTML:function(elm,html){elm=this.$$(elm);if(isIE){elm.each(function(i,target){if(target.canHaveHTML===false){return;}while(target.firstChild){target.removeChild(target.firstChild);}try{target.innerHTML='<br>'+html;target.removeChild(target.firstChild);}catch(ex){DomQuery('<div></div>').html('<br>'+html).contents().slice(1).appendTo(target);}return html;});}else{elm.html(html);}},getOuterHTML:function(elm){elm=this.get(elm);return elm.nodeType==1 && "outerHTML" in elm ? elm.outerHTML :DomQuery('<div></div>').append(DomQuery(elm).clone()).html();},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{if("outerHTML" in this){this.outerHTML=html;return;}}catch(ex){}self.remove(DomQuery(this).html(html),true);});},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){referenceNode=this.get(referenceNode);return this.run(node,function(node){var parent,nextSibling;parent=referenceNode.parentNode;nextSibling=referenceNode.nextSibling;if(nextSibling){parent.insertBefore(node,nextSibling);}else{parent.appendChild(node);}return node;});},replace:function(newElm,oldElm,keepChildren){var self=this;return self.run(oldElm,function(oldElm){if(is(oldElm,'array')){newElm=newElm.cloneNode(true);}if(keepChildren){each(grep(oldElm.childNodes),function(node){newElm.appendChild(node);});}return oldElm.parentNode.replaceChild(newElm,oldElm);});},rename:function(elm,name){var self=this,newElm;if(elm.nodeName !=name.toUpperCase()){newElm=self.create(name);each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName));});self.replace(newElm,elm,1);}return newElm||elm;},findCommonAncestor:function(a,b){var ps=a,pe;while(ps){pe=b;while(pe && ps !=pe){pe=pe.parentNode;}if(ps==pe){break;}ps=ps.parentNode;}if(!ps && a.ownerDocument){return a.ownerDocument.documentElement;}return ps;},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal));},run:function(elm,func,scope){var self=this,result;if(typeof elm==='string'){elm=self.get(elm);}if(!elm){return false;}scope=scope||this;if(!elm.nodeType &&(elm.length||elm.length===0)){result=[];each(elm,function(elm,i){if(elm){if(typeof elm=='string'){elm=self.get(elm);}result.push(func.call(scope,elm,i));}});return result;}return func.call(scope,elm);},getAttribs:function(elm){var attrs;elm=this.get(elm);if(!elm){return[];}if(isIE){attrs=[];if(elm.nodeName=='OBJECT'){return elm.attributes;}if(elm.nodeName==='OPTION' && this.getAttrib(elm,'selected')){attrs.push({specified:1,nodeName:'selected'});}var attrRegExp=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;elm.cloneNode(false).outerHTML.replace(attrRegExp,'').replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a});});return attrs;}return elm.attributes;},isEmpty:function(node,elements){var self=this,i,attributes,type,whitespace,walker,name,brCount=0;node=node.firstChild;if(node){walker=new TreeWalker(node,node.parentNode);elements=elements||(self.schema ? self.schema.getNonEmptyElements():null);whitespace=self.schema ? self.schema.getWhiteSpaceElements():{};do{type=node.nodeType;if(type===1){var bogusVal=node.getAttribute('data-mce-bogus');if(bogusVal){node=walker.next(bogusVal==='all');continue;}name=node.nodeName.toLowerCase();if(elements && elements[name]){if(name==='br'){brCount++;node=walker.next();continue;}return false;}attributes=self.getAttribs(node);i=attributes.length;while(i--){name=attributes[i].nodeName;if(name==="name"||name==='data-mce-bookmark'){return false;}}}if(type==8){return false;}if(type===3 && !whiteSpaceRegExp.test(node.nodeValue)){return false;}if(type===3 && node.parentNode && whitespace[node.parentNode.nodeName]&& whiteSpaceRegExp.test(node.nodeValue)){return false;}node=walker.next();}while(node);}return brCount<=1;},createRng:function(){return this.doc.createRange();},nodeIndex:nodeIndex,split:function(parentElm,splitElm,replacementElm){var self=this,r=self.createRng(),bef,aft,pa;if(parentElm && splitElm){r.setStart(parentElm.parentNode,self.nodeIndex(parentElm));r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm));bef=r.extractContents();r=self.createRng();r.setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1);r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1);aft=r.extractContents();pa=parentElm.parentNode;pa.insertBefore(TrimNode.trimNode(self,bef),parentElm);if(replacementElm){pa.insertBefore(replacementElm,parentElm);}else{pa.insertBefore(splitElm,parentElm);}pa.insertBefore(TrimNode.trimNode(self,aft),parentElm);self.remove(parentElm);return replacementElm||splitElm;}},bind:function(target,name,func,scope){var self=this;if(Tools.isArray(target)){var i=target.length;while(i--){target[i]=self.bind(target[i],name,func,scope);}return target;}if(self.settings.collect &&(target===self.doc||target===self.win)){self.boundEvents.push([target,name,func,scope]);}return self.events.bind(target,name,func,scope||self);},unbind:function(target,name,func){var self=this,i;if(Tools.isArray(target)){i=target.length;while(i--){target[i]=self.unbind(target[i],name,func);}return target;}if(self.boundEvents &&(target===self.doc||target===self.win)){i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];if(target==item[0]&&(!name||name==item[1])&&(!func||func==item[2])){this.events.unbind(item[0],item[1],item[2]);}}}return this.events.unbind(target,name,func);},fire:function(target,name,evt){return this.events.fire(target,name,evt);},getContentEditable:function(node){var contentEditable;if(!node||node.nodeType !=1){return null;}contentEditable=node.getAttribute("data-mce-contenteditable");if(contentEditable && contentEditable !=="inherit"){return contentEditable;}return node.contentEditable !=="inherit" ? node.contentEditable :null;},getContentEditableParent:function(node){var root=this.getRoot(),state=null;for(;node && node !==root;node=node.parentNode){state=this.getContentEditable(node);if(state !==null){break;}}return state;},destroy:function(){var self=this;if(self.boundEvents){var i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];this.events.unbind(item[0],item[1],item[2]);}self.boundEvents=null;}if(Sizzle.setDocument){Sizzle.setDocument();}self.win=self.doc=self.root=self.events=self.frag=null;},isChildOf:function(node,parent){while(node){if(parent===node){return true;}node=node.parentNode;}return false;},dumpRng:function(r){return('startContainer: '+r.startContainer.nodeName+', startOffset: '+r.startOffset+', endContainer: '+r.endContainer.nodeName+', endOffset: '+r.endOffset);},_findSib:function(node,selector,name){var self=this,func=selector;if(node){if(typeof func=='string'){func=function(node){return self.is(node,selector);};}for(node=node[name];node;node=node[name]){if(func(node)){return node;}}}return null;}};DOMUtils.DOM=new DOMUtils(document);DOMUtils.nodeIndex=nodeIndex;return DOMUtils;});define('tinymce.core.dom.ScriptLoader',['global!document','tinymce.core.dom.DOMUtils','tinymce.core.util.Tools'],function(document,DOMUtils,Tools){var DOM=DOMUtils.DOM;var each=Tools.each,grep=Tools.grep;var isFunction=function(f){return typeof f==='function';};var ScriptLoader=function(){var QUEUED=0,LOADING=1,LOADED=2,FAILED=3,states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0,undef;var loadScript=function(url,success,failure){var dom=DOM,elm,id;var done=function(){dom.remove(id);if(elm){elm.onreadystatechange=elm.onload=elm=null;}success();};var error=function(){if(isFunction(failure)){failure();}else{if(typeof console !=="undefined" && console.log){console.log("Failed to load script: "+url);}}};id=dom.uniqueId();elm=document.createElement('script');elm.id=id;elm.type='text/javascript';elm.src=Tools._addCacheSuffix(url);if("onreadystatechange" in elm){elm.onreadystatechange=function(){if(/loaded|complete/.test(elm.readyState)){done();}};}else{elm.onload=done;}elm.onerror=error;(document.getElementsByTagName('head')[0]||document.body).appendChild(elm);};this.isDone=function(url){return states[url]==LOADED;};this.markDone=function(url){states[url]=LOADED;};this.add=this.load=function(url,success,scope,failure){var state=states[url];if(state==undef){queue.push(url);states[url]=QUEUED;}if(success){if(!scriptLoadedCallbacks[url]){scriptLoadedCallbacks[url]=[];}scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this});}};this.remove=function(url){delete states[url];delete scriptLoadedCallbacks[url];};this.loadQueue=function(success,scope,failure){this.loadScripts(queue,success,scope,failure);};this.loadScripts=function(scripts,success,scope,failure){var loadScripts,failures=[];var execCallbacks=function(name,url){each(scriptLoadedCallbacks[url],function(callback){if(isFunction(callback[name])){callback[name].call(callback.scope);}});scriptLoadedCallbacks[url]=undef;};queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this});loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0;each(loadingScripts,function(url){if(states[url]===LOADED){execCallbacks('success',url);return;}if(states[url]===FAILED){execCallbacks('failure',url);return;}if(states[url]!==LOADING){states[url]=LOADING;loading++;loadScript(url,function(){states[url]=LOADED;loading--;execCallbacks('success',url);loadScripts();},function(){states[url]=FAILED;loading--;failures.push(url);execCallbacks('failure',url);loadScripts();});}});if(!loading){var notifyCallbacks=queueLoadedCallbacks.slice(0);queueLoadedCallbacks.length=0;each(notifyCallbacks,function(callback){if(failures.length===0){if(isFunction(callback.success)){callback.success.call(callback.scope);}}else{if(isFunction(callback.failure)){callback.failure.call(callback.scope,failures);}}});}};loadScripts();};};ScriptLoader.ScriptLoader=new ScriptLoader();return ScriptLoader;});define('tinymce.core.AddOnManager',['ephox.katamari.api.Arr','tinymce.core.dom.ScriptLoader','tinymce.core.util.Tools'],function(Arr,ScriptLoader,Tools){var each=Tools.each;var AddOnManager=function(){var self=this;self.items=[];self.urls={};self.lookup={};self._listeners=[];};AddOnManager.prototype={get:function(name){if(this.lookup[name]){return this.lookup[name].instance;}return undefined;},dependencies:function(name){var result;if(this.lookup[name]){result=this.lookup[name].dependencies;}return result||[];},requireLangPack:function(name,languages){var language=AddOnManager.language;if(language && AddOnManager.languageLoad !==false){if(languages){languages=','+languages+',';if(languages.indexOf(','+language.substr(0,2)+',')!=-1){language=language.substr(0,2);}else if(languages.indexOf(','+language+',')==-1){return;}}ScriptLoader.ScriptLoader.add(this.urls[name]+'/langs/'+language+'.js');}},add:function(id,addOn,dependencies){this.items.push(addOn);this.lookup[id]={instance:addOn,dependencies:dependencies};var result=Arr.partition(this._listeners,function(listener){return listener.name===id;});this._listeners=result.fail;each(result.pass,function(listener){listener.callback();});return addOn;},remove:function(name){delete this.urls[name];delete this.lookup[name];},createUrl:function(baseUrl,dep){if(typeof dep==="object"){return dep;}return{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix};},addComponents:function(pluginName,scripts){var pluginUrl=this.urls[pluginName];each(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script);});},load:function(name,addOnUrl,success,scope,failure){var self=this,url=addOnUrl;var loadDependencies=function(){var dependencies=self.dependencies(name);each(dependencies,function(dep){var newUrl=self.createUrl(addOnUrl,dep);self.load(newUrl.resource,newUrl,undefined,undefined);});if(success){if(scope){success.call(scope);}else{success.call(ScriptLoader);}}};if(self.urls[name]){return;}if(typeof addOnUrl==="object"){url=addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;}if(url.indexOf('/')!==0 && url.indexOf('://')==-1){url=AddOnManager.baseURL+'/'+url;}self.urls[name]=url.substring(0,url.lastIndexOf('/'));if(self.lookup[name]){loadDependencies();}else{ScriptLoader.ScriptLoader.add(url,loadDependencies,scope,failure);}},waitFor:function(name,callback){if(this.lookup.hasOwnProperty(name)){callback();}else{this._listeners.push({name:name,callback:callback});}}};AddOnManager.PluginManager=new AddOnManager();AddOnManager.ThemeManager=new AddOnManager();return AddOnManager;});define('tinymce.core.text.Zwsp',[],function(){var ZWSP='\uFEFF';var isZwsp=function(chr){return chr===ZWSP;};var trim=function(text){return text.replace(new RegExp(ZWSP,'g'),'');};return{isZwsp:isZwsp,ZWSP:ZWSP,trim:trim};});define('tinymce.core.caret.CaretContainer',['global!document','tinymce.core.dom.NodeType','tinymce.core.text.Zwsp'],function(document,NodeType,Zwsp){var isElement=NodeType.isElement,isText=NodeType.isText;var isCaretContainerBlock=function(node){if(isText(node)){node=node.parentNode;}return isElement(node)&& node.hasAttribute('data-mce-caret');};var isCaretContainerInline=function(node){return isText(node)&& Zwsp.isZwsp(node.data);};var isCaretContainer=function(node){return isCaretContainerBlock(node)||isCaretContainerInline(node);};var hasContent=function(node){return node.firstChild !==node.lastChild||!NodeType.isBr(node.firstChild);};var insertInline=function(node,before){var doc,sibling,textNode,parentNode;doc=node.ownerDocument;textNode=doc.createTextNode(Zwsp.ZWSP);parentNode=node.parentNode;if(!before){sibling=node.nextSibling;if(isText(sibling)){if(isCaretContainer(sibling)){return sibling;}if(startsWithCaretContainer(sibling)){sibling.splitText(1);return sibling;}}if(node.nextSibling){parentNode.insertBefore(textNode,node.nextSibling);}else{parentNode.appendChild(textNode);}}else{sibling=node.previousSibling;if(isText(sibling)){if(isCaretContainer(sibling)){return sibling;}if(endsWithCaretContainer(sibling)){return sibling.splitText(sibling.data.length-1);}}parentNode.insertBefore(textNode,node);}return textNode;};var prependInline=function(node){if(NodeType.isText(node)){var data=node.data;if(data.length>0 && data.charAt(0)!==Zwsp.ZWSP){node.insertData(0,Zwsp.ZWSP);}return node;}else{return null;}};var appendInline=function(node){if(NodeType.isText(node)){var data=node.data;if(data.length>0 && data.charAt(data.length-1)!==Zwsp.ZWSP){node.insertData(data.length,Zwsp.ZWSP);}return node;}else{return null;}};var isBeforeInline=function(pos){return pos && NodeType.isText(pos.container())&& pos.container().data.charAt(pos.offset())===Zwsp.ZWSP;};var isAfterInline=function(pos){return pos && NodeType.isText(pos.container())&& pos.container().data.charAt(pos.offset()-1)===Zwsp.ZWSP;};var createBogusBr=function(){var br=document.createElement('br');br.setAttribute('data-mce-bogus','1');return br;};var insertBlock=function(blockName,node,before){var doc,blockNode,parentNode;doc=node.ownerDocument;blockNode=doc.createElement(blockName);blockNode.setAttribute('data-mce-caret',before ? 'before' :'after');blockNode.setAttribute('data-mce-bogus','all');blockNode.appendChild(createBogusBr());parentNode=node.parentNode;if(!before){if(node.nextSibling){parentNode.insertBefore(blockNode,node.nextSibling);}else{parentNode.appendChild(blockNode);}}else{parentNode.insertBefore(blockNode,node);}return blockNode;};var startsWithCaretContainer=function(node){return isText(node)&& node.data[0]==Zwsp.ZWSP;};var endsWithCaretContainer=function(node){return isText(node)&& node.data[node.data.length-1]==Zwsp.ZWSP;};var trimBogusBr=function(elm){var brs=elm.getElementsByTagName('br');var lastBr=brs[brs.length-1];if(NodeType.isBogus(lastBr)){lastBr.parentNode.removeChild(lastBr);}};var showCaretContainerBlock=function(caretContainer){if(caretContainer && caretContainer.hasAttribute('data-mce-caret')){trimBogusBr(caretContainer);caretContainer.removeAttribute('data-mce-caret');caretContainer.removeAttribute('data-mce-bogus');caretContainer.removeAttribute('style');caretContainer.removeAttribute('_moz_abspos');return caretContainer;}return null;};return{isCaretContainer:isCaretContainer,isCaretContainerBlock:isCaretContainerBlock,isCaretContainerInline:isCaretContainerInline,showCaretContainerBlock:showCaretContainerBlock,insertInline:insertInline,prependInline:prependInline,appendInline:appendInline,isBeforeInline:isBeforeInline,isAfterInline:isAfterInline,insertBlock:insertBlock,hasContent:hasContent,startsWithCaretContainer:startsWithCaretContainer,endsWithCaretContainer:endsWithCaretContainer};});define('tinymce.core.caret.CaretCandidate',["tinymce.core.dom.NodeType","tinymce.core.util.Arr","tinymce.core.caret.CaretContainer"],function(NodeType,Arr,CaretContainer){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBr=NodeType.isBr,isText=NodeType.isText,isInvalidTextElement=NodeType.matchNodeNames('script style textarea'),isAtomicInline=NodeType.matchNodeNames('img input textarea hr iframe video audio object'),isTable=NodeType.matchNodeNames('table'),isCaretContainer=CaretContainer.isCaretContainer;var isCaretCandidate=function(node){if(isCaretContainer(node)){return false;}if(isText(node)){if(isInvalidTextElement(node.parentNode)){return false;}return true;}return isAtomicInline(node)||isBr(node)||isTable(node)||isContentEditableFalse(node);};var isInEditable=function(node,rootNode){for(node=node.parentNode;node && node !=rootNode;node=node.parentNode){if(isContentEditableFalse(node)){return false;}if(isContentEditableTrue(node)){return true;}}return true;};var isAtomicContentEditableFalse=function(node){if(!isContentEditableFalse(node)){return false;}return Arr.reduce(node.getElementsByTagName('*'),function(result,elm){return result||isContentEditableTrue(elm);},false)!==true;};var isAtomic=function(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node);};var isEditableCaretCandidate=function(node,rootNode){return isCaretCandidate(node)&& isInEditable(node,rootNode);};return{isCaretCandidate:isCaretCandidate,isInEditable:isInEditable,isAtomic:isAtomic,isEditableCaretCandidate:isEditableCaretCandidate};});define('tinymce.core.geom.ClientRect',[],function(){var round=Math.round;var clone=function(rect){if(!rect){return{left:0,top:0,bottom:0,right:0,width:0,height:0};}return{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)};};var collapse=function(clientRect,toStart){clientRect=clone(clientRect);if(toStart){clientRect.right=clientRect.left;}else{clientRect.left=clientRect.left+clientRect.width;clientRect.right=clientRect.left;}clientRect.width=0;return clientRect;};var isEqual=function(rect1,rect2){return(rect1.left===rect2.left && rect1.top===rect2.top && rect1.bottom===rect2.bottom && rect1.right===rect2.right);};var isValidOverflow=function(overflowY,clientRect1,clientRect2){return overflowY>=0 && overflowY<=Math.min(clientRect1.height,clientRect2.height)/ 2;};var isAbove=function(clientRect1,clientRect2){if((clientRect1.bottom-clientRect1.height / 2)<clientRect2.top){return true;}if(clientRect1.top>clientRect2.bottom){return false;}return isValidOverflow(clientRect2.top-clientRect1.bottom,clientRect1,clientRect2);};var isBelow=function(clientRect1,clientRect2){if(clientRect1.top>clientRect2.bottom){return true;}if(clientRect1.bottom<clientRect2.top){return false;}return isValidOverflow(clientRect2.bottom-clientRect1.top,clientRect1,clientRect2);};var isLeft=function(clientRect1,clientRect2){return clientRect1.left<clientRect2.left;};var isRight=function(clientRect1,clientRect2){return clientRect1.right>clientRect2.right;};var compare=function(clientRect1,clientRect2){if(isAbove(clientRect1,clientRect2)){return-1;}if(isBelow(clientRect1,clientRect2)){return 1;}if(isLeft(clientRect1,clientRect2)){return-1;}if(isRight(clientRect1,clientRect2)){return 1;}return 0;};var containsXY=function(clientRect,clientX,clientY){return(clientX>=clientRect.left && clientX<=clientRect.right && clientY>=clientRect.top && clientY<=clientRect.bottom);};return{clone:clone,collapse:collapse,isEqual:isEqual,isAbove:isAbove,isBelow:isBelow,isLeft:isLeft,isRight:isRight,compare:compare,containsXY:containsXY};});define('tinymce.core.selection.RangeNodes',[],function(){var getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;if(startContainer.hasChildNodes()&& range.endOffset==startOffset+1){return startContainer.childNodes[startOffset];}return null;};var getNode=function(container,offset){if(container.nodeType===1 && container.hasChildNodes()){if(offset>=container.childNodes.length){offset=container.childNodes.length-1;}container=container.childNodes[offset];}return container;};return{getSelectedNode:getSelectedNode,getNode:getNode};});define('tinymce.core.text.ExtendingChar',[],function(){var extendingChars=new RegExp("[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A"+"\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0"+"\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E3-\u0902\u093A\u093C"+"\u0941-\u0948\u094D\u0951-\u0957\u0962-\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2-\u09E3"+"\u0A01-\u0A02\u0A3C\u0A41-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A82\u0ABC"+"\u0AC1-\u0AC5\u0AC7-\u0AC8\u0ACD\u0AE2-\u0AE3\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B57"+"\u0B62-\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56"+"\u0C62-\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01\u0D3E\u0D41-\u0D44"+"\u0D4D\u0D57\u0D62-\u0D63\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9"+"\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97"+"\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039-\u103A\u103D-\u103E\u1058-\u1059\u105E-\u1060\u1071-\u1074"+"\u1082\u1085-\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17B5"+"\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u1922\u1927-\u1928\u1932\u1939-\u193B\u1A17-\u1A18"+"\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABD\u1ABE\u1B00-\u1B03\u1B34"+"\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80-\u1B81\u1BA2-\u1BA5\u1BA8-\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8-\u1BE9"+"\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8-\u1CF9"+"\u1DC0-\u1DF5\u1DFC-\u1DFF\u200C-\u200D\u20D0-\u20DC\u20DD-\u20E0\u20E1\u20E2-\u20E4\u20E5-\u20F0\u2CEF-\u2CF1"+"\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u302E-\u302F\u3099-\u309A\uA66F\uA670-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1"+"\uA802\uA806\uA80B\uA825-\uA826\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC"+"\uA9E5\uAA29-\uAA2E\uAA31-\uAA32\uAA35-\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1"+"\uAAEC-\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E-\uFF9F]");var isExtendingChar=function(ch){return typeof ch=="string" && ch.charCodeAt(0)>=768 && extendingChars.test(ch);};return{isExtendingChar:isExtendingChar};});define('tinymce.core.util.Fun',[],function(){var slice=[].slice;var constant=function(value){return function(){return value;};};var negate=function(predicate){return function(x){return !predicate(x);};};var compose=function(f,g){return function(x){return f(g(x));};};var or=function(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++){if(args[i](x)){return true;}}return false;};};var and=function(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++){if(!args[i](x)){return false;}}return true;};};var curry=function(fn){var args=slice.call(arguments);if(args.length-1>=fn.length){return fn.apply(this,args.slice(1));}return function(){var tempArgs=args.concat([].slice.call(arguments));return curry.apply(this,tempArgs);};};var noop=function(){};return{constant:constant,negate:negate,and:and,or:or,curry:curry,compose:compose,noop:noop};});define('tinymce.core.caret.CaretPosition',['tinymce.core.caret.CaretCandidate','tinymce.core.dom.DOMUtils','tinymce.core.dom.NodeType','tinymce.core.geom.ClientRect','tinymce.core.selection.RangeNodes','tinymce.core.text.ExtendingChar','tinymce.core.util.Fun'],function(CaretCandidate,DOMUtils,NodeType,ClientRect,RangeNodes,ExtendingChar,Fun){var isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,isBlock=NodeType.matchStyleValues('display','block table'),isFloated=NodeType.matchStyleValues('float','left right'),isValidElementCaretCandidate=Fun.and(isElement,isCaretCandidate,Fun.negate(isFloated)),isNotPre=Fun.negate(NodeType.matchStyleValues('white-space','pre pre-line pre-wrap')),isText=NodeType.isText,isBr=NodeType.isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=RangeNodes.getNode;var createRange=function(doc){return "createRange" in doc ? doc.createRange():DOMUtils.DOM.createRng();};var isWhiteSpace=function(chr){return chr && /[\r\n\t ]/.test(chr);};var isHiddenWhiteSpaceRange=function(range){var container=range.startContainer,offset=range.startOffset,text;if(isWhiteSpace(range.toString())&& isNotPre(container.parentNode)){text=container.data;if(isWhiteSpace(text[offset-1])||isWhiteSpace(text[offset+1])){return true;}}return false;};var getCaretPositionClientRects=function(caretPosition){var clientRects=[],beforeNode,node;var getBrClientRect=function(brNode){var doc=brNode.ownerDocument,rng=createRange(doc),nbsp=doc.createTextNode('\u00a0'),parentNode=brNode.parentNode,clientRect;parentNode.insertBefore(nbsp,brNode);rng.setStart(nbsp,0);rng.setEnd(nbsp,1);clientRect=ClientRect.clone(rng.getBoundingClientRect());parentNode.removeChild(nbsp);return clientRect;};var getBoundingClientRect=function(item){var clientRect,clientRects;clientRects=item.getClientRects();if(clientRects.length>0){clientRect=ClientRect.clone(clientRects[0]);}else{clientRect=ClientRect.clone(item.getBoundingClientRect());}if(isBr(item)&& clientRect.left===0){return getBrClientRect(item);}return clientRect;};var collapseAndInflateWidth=function(clientRect,toStart){clientRect=ClientRect.collapse(clientRect,toStart);clientRect.width=1;clientRect.right=clientRect.left+1;return clientRect;};var addUniqueAndValidRect=function(clientRect){if(clientRect.height===0){return;}if(clientRects.length>0){if(ClientRect.isEqual(clientRect,clientRects[clientRects.length-1])){return;}}clientRects.push(clientRect);};var addCharacterOffset=function(container,offset){var range=createRange(container.ownerDocument);if(offset<container.data.length){if(ExtendingChar.isExtendingChar(container.data[offset])){return clientRects;}if(ExtendingChar.isExtendingChar(container.data[offset-1])){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),false));return clientRects;}}}if(offset>0){range.setStart(container,offset-1);range.setEnd(container,offset);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),false));}}if(offset<container.data.length){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),true));}}};if(isText(caretPosition.container())){addCharacterOffset(caretPosition.container(),caretPosition.offset());return clientRects;}if(isElement(caretPosition.container())){if(caretPosition.isAtEnd()){node=resolveIndex(caretPosition.container(),caretPosition.offset());if(isText(node)){addCharacterOffset(node,node.data.length);}if(isValidElementCaretCandidate(node)&& !isBr(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),false));}}else{node=resolveIndex(caretPosition.container(),caretPosition.offset());if(isText(node)){addCharacterOffset(node,0);}if(isValidElementCaretCandidate(node)&& caretPosition.isAtEnd()){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),false));return clientRects;}beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1);if(isValidElementCaretCandidate(beforeNode)&& !isBr(beforeNode)){if(isBlock(beforeNode)||isBlock(node)||!isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),false));}}if(isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),true));}}}return clientRects;};var CaretPosition=function(container,offset,clientRects){var isAtStart=function(){if(isText(container)){return offset===0;}return offset===0;};var isAtEnd=function(){if(isText(container)){return offset>=container.data.length;}return offset>=container.childNodes.length;};var toRange=function(){var range;range=createRange(container.ownerDocument);range.setStart(container,offset);range.setEnd(container,offset);return range;};var getClientRects=function(){if(!clientRects){clientRects=getCaretPositionClientRects(new CaretPosition(container,offset));}return clientRects;};var isVisible=function(){return getClientRects().length>0;};var isEqual=function(caretPosition){return caretPosition && container===caretPosition.container()&& offset===caretPosition.offset();};var getNode=function(before){return resolveIndex(container,before ? offset-1 :offset);};return{container:Fun.constant(container),offset:Fun.constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode};};CaretPosition.fromRangeStart=function(range){return new CaretPosition(range.startContainer,range.startOffset);};CaretPosition.fromRangeEnd=function(range){return new CaretPosition(range.endContainer,range.endOffset);};CaretPosition.after=function(node){return new CaretPosition(node.parentNode,nodeIndex(node)+1);};CaretPosition.before=function(node){return new CaretPosition(node.parentNode,nodeIndex(node));};CaretPosition.isAtStart=function(pos){return pos ? pos.isAtStart():false;};CaretPosition.isAtEnd=function(pos){return pos ? pos.isAtEnd():false;};CaretPosition.isTextPosition=function(pos){return pos ? NodeType.isText(pos.container()):false;};return CaretPosition;});define('tinymce.core.caret.CaretUtils',["tinymce.core.util.Fun","tinymce.core.dom.TreeWalker","tinymce.core.dom.NodeType","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretContainer","tinymce.core.caret.CaretCandidate"],function(Fun,TreeWalker,NodeType,CaretPosition,CaretContainer,CaretCandidate){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBlockLike=NodeType.matchStyleValues('display','block table table-cell table-caption list-item'),isCaretContainer=CaretContainer.isCaretContainer,isCaretContainerBlock=CaretContainer.isCaretContainerBlock,curry=Fun.curry,isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate;var isForwards=function(direction){return direction>0;};var isBackwards=function(direction){return direction<0;};var skipCaretContainers=function(walk,shallow){var node;while((node=walk(shallow))){if(!isCaretContainerBlock(node)){return node;}}return null;};var findNode=function(node,direction,predicateFn,rootNode,shallow){var walker=new TreeWalker(node,rootNode);if(isBackwards(direction)){if(isContentEditableFalse(node)||isCaretContainerBlock(node)){node=skipCaretContainers(walker.prev,true);if(predicateFn(node)){return node;}}while((node=skipCaretContainers(walker.prev,shallow))){if(predicateFn(node)){return node;}}}if(isForwards(direction)){if(isContentEditableFalse(node)||isCaretContainerBlock(node)){node=skipCaretContainers(walker.next,true);if(predicateFn(node)){return node;}}while((node=skipCaretContainers(walker.next,shallow))){if(predicateFn(node)){return node;}}}return null;};var getEditingHost=function(node,rootNode){for(node=node.parentNode;node && node !=rootNode;node=node.parentNode){if(isContentEditableTrue(node)){return node;}}return rootNode;};var getParentBlock=function(node,rootNode){while(node && node !=rootNode){if(isBlockLike(node)){return node;}node=node.parentNode;}return null;};var isInSameBlock=function(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)==getParentBlock(caretPosition2.container(),rootNode);};var isInSameEditingHost=function(caretPosition1,caretPosition2,rootNode){return getEditingHost(caretPosition1.container(),rootNode)==getEditingHost(caretPosition2.container(),rootNode);};var getChildNodeAtRelativeOffset=function(relativeOffset,caretPosition){var container,offset;if(!caretPosition){return null;}container=caretPosition.container();offset=caretPosition.offset();if(!isElement(container)){return null;}return container.childNodes[offset+relativeOffset];};var beforeAfter=function(before,node){var range=node.ownerDocument.createRange();if(before){range.setStartBefore(node);range.setEndBefore(node);}else{range.setStartAfter(node);range.setEndAfter(node);}return range;};var isNodesInSameBlock=function(rootNode,node1,node2){return getParentBlock(node1,rootNode)==getParentBlock(node2,rootNode);};var lean=function(left,rootNode,node){var sibling,siblingName;if(left){siblingName='previousSibling';}else{siblingName='nextSibling';}while(node && node !=rootNode){sibling=node[siblingName];if(isCaretContainer(sibling)){sibling=sibling[siblingName];}if(isContentEditableFalse(sibling)){if(isNodesInSameBlock(rootNode,sibling,node)){return sibling;}break;}if(isCaretCandidate(sibling)){break;}node=node.parentNode;}return null;};var before=curry(beforeAfter,true);var after=curry(beforeAfter,false);var normalizeRange=function(direction,rootNode,range){var node,container,offset,location;var leanLeft=curry(lean,true,rootNode);var leanRight=curry(lean,false,rootNode);container=range.startContainer;offset=range.startOffset;if(CaretContainer.isCaretContainerBlock(container)){if(!isElement(container)){container=container.parentNode;}location=container.getAttribute('data-mce-caret');if(location=='before'){node=container.nextSibling;if(isContentEditableFalse(node)){return before(node);}}if(location=='after'){node=container.previousSibling;if(isContentEditableFalse(node)){return after(node);}}}if(!range.collapsed){return range;}if(NodeType.isText(container)){if(isCaretContainer(container)){if(direction===1){node=leanRight(container);if(node){return before(node);}node=leanLeft(container);if(node){return after(node);}}if(direction===-1){node=leanLeft(container);if(node){return after(node);}node=leanRight(container);if(node){return before(node);}}return range;}if(CaretContainer.endsWithCaretContainer(container)&& offset>=container.data.length-1){if(direction===1){node=leanRight(container);if(node){return before(node);}}return range;}if(CaretContainer.startsWithCaretContainer(container)&& offset<=1){if(direction===-1){node=leanLeft(container);if(node){return after(node);}}return range;}if(offset===container.data.length){node=leanRight(container);if(node){return before(node);}return range;}if(offset===0){node=leanLeft(container);if(node){return after(node);}return range;}}return range;};var isNextToContentEditableFalse=function(relativeOffset,caretPosition){return isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset,caretPosition));};return{isForwards:isForwards,isBackwards:isBackwards,findNode:findNode,getEditingHost:getEditingHost,getParentBlock:getParentBlock,isInSameBlock:isInSameBlock,isInSameEditingHost:isInSameEditingHost,isBeforeContentEditableFalse:curry(isNextToContentEditableFalse,0),isAfterContentEditableFalse:curry(isNextToContentEditableFalse,-1),normalizeRange:normalizeRange};});define('tinymce.core.caret.CaretWalker',["tinymce.core.dom.NodeType","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretPosition","tinymce.core.caret.CaretUtils","tinymce.core.util.Arr","tinymce.core.util.Fun"],function(NodeType,CaretCandidate,CaretPosition,CaretUtils,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,isText=NodeType.isText,isElement=NodeType.isElement,isBr=NodeType.isBr,isForwards=CaretUtils.isForwards,isBackwards=CaretUtils.isBackwards,isCaretCandidate=CaretCandidate.isCaretCandidate,isAtomic=CaretCandidate.isAtomic,isEditableCaretCandidate=CaretCandidate.isEditableCaretCandidate;var getParents=function(node,rootNode){var parents=[];while(node && node !=rootNode){parents.push(node);node=node.parentNode;}return parents;};var nodeAtIndex=function(container,offset){if(container.hasChildNodes()&& offset<container.childNodes.length){return container.childNodes[offset];}return null;};var getCaretCandidatePosition=function(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&& !isText(node.previousSibling)){return CaretPosition.before(node);}if(isText(node)){return CaretPosition(node,0);}}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&& !isText(node.nextSibling)){return CaretPosition.after(node);}if(isText(node)){return CaretPosition(node,node.data.length);}}if(isBackwards(direction)){if(isBr(node)){return CaretPosition.before(node);}return CaretPosition.after(node);}return CaretPosition.before(node);};var isBrBeforeBlock=function(node,rootNode){var next;if(!NodeType.isBr(node)){return false;}next=findCaretPosition(1,CaretPosition.after(node),rootNode);if(!next){return false;}return !CaretUtils.isInSameBlock(CaretPosition.before(node),CaretPosition.before(next),rootNode);};var findCaretPosition=function(direction,startCaretPosition,rootNode){var container,offset,node,nextNode,innerNode,rootContentEditableFalseElm,caretPosition;if(!isElement(rootNode)||!startCaretPosition){return null;}if(startCaretPosition.isEqual(CaretPosition.after(rootNode))&& rootNode.lastChild){caretPosition=CaretPosition.after(rootNode.lastChild);if(isBackwards(direction)&& isCaretCandidate(rootNode.lastChild)&& isElement(rootNode.lastChild)){return isBr(rootNode.lastChild)? CaretPosition.before(rootNode.lastChild):caretPosition;}}else{caretPosition=startCaretPosition;}container=caretPosition.container();offset=caretPosition.offset();if(isText(container)){if(isBackwards(direction)&& offset>0){return CaretPosition(container,--offset);}if(isForwards(direction)&& offset<container.length){return CaretPosition(container,++offset);}node=container;}else{if(isBackwards(direction)&& offset>0){nextNode=nodeAtIndex(container,offset-1);if(isCaretCandidate(nextNode)){if(!isAtomic(nextNode)){innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText(innerNode)){return CaretPosition(innerNode,innerNode.data.length);}return CaretPosition.after(innerNode);}}if(isText(nextNode)){return CaretPosition(nextNode,nextNode.data.length);}return CaretPosition.before(nextNode);}}if(isForwards(direction)&& offset<container.childNodes.length){nextNode=nodeAtIndex(container,offset);if(isCaretCandidate(nextNode)){if(isBrBeforeBlock(nextNode,rootNode)){return findCaretPosition(direction,CaretPosition.after(nextNode),rootNode);}if(!isAtomic(nextNode)){innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText(innerNode)){return CaretPosition(innerNode,0);}return CaretPosition.before(innerNode);}}if(isText(nextNode)){return CaretPosition(nextNode,0);}return CaretPosition.after(nextNode);}}node=caretPosition.getNode();}if((isForwards(direction)&& caretPosition.isAtEnd())||(isBackwards(direction)&& caretPosition.isAtStart())){node=CaretUtils.findNode(node,direction,Fun.constant(true),rootNode,true);if(isEditableCaretCandidate(node)){return getCaretCandidatePosition(direction,node);}}nextNode=CaretUtils.findNode(node,direction,isEditableCaretCandidate,rootNode);rootContentEditableFalseElm=Arr.last(Arr.filter(getParents(container,rootNode),isContentEditableFalse));if(rootContentEditableFalseElm &&(!nextNode||!rootContentEditableFalseElm.contains(nextNode))){if(isForwards(direction)){caretPosition=CaretPosition.after(rootContentEditableFalseElm);}else{caretPosition=CaretPosition.before(rootContentEditableFalseElm);}return caretPosition;}if(nextNode){return getCaretCandidatePosition(direction,nextNode);}return null;};return function(rootNode){return{next:function(caretPosition){return findCaretPosition(1,caretPosition,rootNode);},prev:function(caretPosition){return findCaretPosition(-1,caretPosition,rootNode);}};};});define('tinymce.core.InsertList',['tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretWalker','tinymce.core.dom.NodeType','tinymce.core.util.Tools'],function(CaretPosition,CaretWalker,NodeType,Tools){var hasOnlyOneChild=function(node){return node.firstChild && node.firstChild===node.lastChild;};var isPaddingNode=function(node){return node.name==='br'||node.value==='\u00a0';};var isPaddedEmptyBlock=function(schema,node){var blockElements=schema.getBlockElements();return blockElements[node.name]&& hasOnlyOneChild(node)&& isPaddingNode(node.firstChild);};var isEmptyFragmentElement=function(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node &&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node));};var isListFragment=function(schema,fragment){var firstChild=fragment.firstChild;var lastChild=fragment.lastChild;if(firstChild && firstChild.name==='meta'){firstChild=firstChild.next;}if(lastChild && lastChild.attr('id')==='mce_marker'){lastChild=lastChild.prev;}if(isEmptyFragmentElement(schema,lastChild)){lastChild=lastChild.prev;}if(!firstChild||firstChild !==lastChild){return false;}return firstChild.name==='ul'||firstChild.name==='ol';};var cleanupDomFragment=function(domFragment){var firstChild=domFragment.firstChild;var lastChild=domFragment.lastChild;if(firstChild && firstChild.nodeName==='META'){firstChild.parentNode.removeChild(firstChild);}if(lastChild && lastChild.id==='mce_marker'){lastChild.parentNode.removeChild(lastChild);}return domFragment;};var toDomFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment);var domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment);};var listItems=function(elm){return Tools.grep(elm.childNodes,function(child){return child.nodeName==='LI';});};var isPadding=function(node){return node.data==='\u00a0'||NodeType.isBr(node);};var isListItemPadded=function(node){return node && node.firstChild && node.firstChild===node.lastChild && isPadding(node.firstChild);};var isEmptyOrPadded=function(elm){return !elm.firstChild||isListItemPadded(elm);};var trimListItems=function(elms){return elms.length>0 && isEmptyOrPadded(elms[elms.length-1])? elms.slice(0,-1):elms;};var getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock && parentBlock.nodeName==='LI' ? parentBlock :null;};var isParentBlockLi=function(dom,node){return !!getParentLi(dom,node);};var getSplit=function(parentNode,rng){var beforeRng=rng.cloneRange();var afterRng=rng.cloneRange();beforeRng.setStartBefore(parentNode);afterRng.setEndAfter(parentNode);return[beforeRng.cloneContents(),afterRng.cloneContents()];};var findFirstIn=function(node,rootNode){var caretPos=CaretPosition.before(node);var caretWalker=new CaretWalker(rootNode);var newCaretPos=caretWalker.next(caretPos);return newCaretPos ? newCaretPos.toRange():null;};var findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node);var caretWalker=new CaretWalker(rootNode);var newCaretPos=caretWalker.prev(caretPos);return newCaretPos ? newCaretPos.toRange():null;};var insertMiddle=function(target,elms,rootNode,rng){var parts=getSplit(target,rng);var parentElm=target.parentNode;parentElm.insertBefore(parts[0],target);Tools.each(elms,function(li){parentElm.insertBefore(li,target);});parentElm.insertBefore(parts[1],target);parentElm.removeChild(target);return findLastOf(elms[elms.length-1],rootNode);};var insertBefore=function(target,elms,rootNode){var parentElm=target.parentNode;Tools.each(elms,function(elm){parentElm.insertBefore(elm,target);});return findFirstIn(target,rootNode);};var insertAfter=function(target,elms,rootNode,dom){dom.insertAfter(elms.reverse(),target);return findLastOf(elms[0],rootNode);};var insertAtCaret=function(serializer,dom,rng,fragment){var domFragment=toDomFragment(dom,serializer,fragment);var liTarget=getParentLi(dom,rng.startContainer);var liElms=trimListItems(listItems(domFragment.firstChild));var BEGINNING=1,END=2;var rootNode=dom.getRoot();var isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=new CaretWalker(dom.getRoot());var newPos=location===BEGINNING ? caretWalker.prev(caretPos):caretWalker.next(caretPos);return newPos ? getParentLi(dom,newPos.getNode())!==liTarget :true;};if(isAt(BEGINNING)){return insertBefore(liTarget,liElms,rootNode);}else if(isAt(END)){return insertAfter(liTarget,liElms,rootNode,dom);}return insertMiddle(liTarget,liElms,rootNode,rng);};return{isListFragment:isListFragment,insertAtCaret:insertAtCaret,isParentBlockLi:isParentBlockLi,trimListItems:trimListItems,listItems:listItems};});define('tinymce.core.caret.CaretBookmark',['tinymce.core.dom.NodeType','tinymce.core.dom.DOMUtils','tinymce.core.util.Fun','tinymce.core.util.Arr','tinymce.core.caret.CaretPosition'],function(NodeType,DomUtils,Fun,Arr,CaretPosition){var isText=NodeType.isText,isBogus=NodeType.isBogus,nodeIndex=DomUtils.nodeIndex;var normalizedParent=function(node){var parentNode=node.parentNode;if(isBogus(parentNode)){return normalizedParent(parentNode);}return parentNode;};var getChildNodes=function(node){if(!node){return[];}return Arr.reduce(node.childNodes,function(result,node){if(isBogus(node)&& node.nodeName !='BR'){result=result.concat(getChildNodes(node));}else{result.push(node);}return result;},[]);};var normalizedTextOffset=function(textNode,offset){while((textNode=textNode.previousSibling)){if(!isText(textNode)){break;}offset+=textNode.data.length;}return offset;};var equal=function(targetValue){return function(value){return targetValue===value;};};var normalizedNodeIndex=function(node){var nodes,index,numTextFragments;nodes=getChildNodes(normalizedParent(node));index=Arr.findIndex(nodes,equal(node),node);nodes=nodes.slice(0,index+1);numTextFragments=Arr.reduce(nodes,function(result,node,i){if(isText(node)&& isText(nodes[i-1])){result++;}return result;},0);nodes=Arr.filter(nodes,NodeType.matchNodeNames(node.nodeName));index=Arr.findIndex(nodes,equal(node),node);return index-numTextFragments;};var createPathItem=function(node){var name;if(isText(node)){name='text()';}else{name=node.nodeName.toLowerCase();}return name+'['+normalizedNodeIndex(node)+']';};var parentsUntil=function(rootNode,node,predicate){var parents=[];for(node=node.parentNode;node !=rootNode;node=node.parentNode){if(predicate && predicate(node)){break;}parents.push(node);}return parents;};var create=function(rootNode,caretPosition){var container,offset,path=[],outputOffset,childNodes,parents;container=caretPosition.container();offset=caretPosition.offset();if(isText(container)){outputOffset=normalizedTextOffset(container,offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length){outputOffset='after';offset=childNodes.length-1;}else{outputOffset='before';}container=childNodes[offset];}path.push(createPathItem(container));parents=parentsUntil(rootNode,container);parents=Arr.filter(parents,Fun.negate(NodeType.isBogus));path=path.concat(Arr.map(parents,function(node){return createPathItem(node);}));return path.reverse().join('/')+','+outputOffset;};var resolvePathItem=function(node,name,index){var nodes=getChildNodes(node);nodes=Arr.filter(nodes,function(node,index){return !isText(node)||!isText(nodes[index-1]);});nodes=Arr.filter(nodes,NodeType.matchNodeNames(name));return nodes[index];};var findTextPosition=function(container,offset){var node=container,targetOffset=0,dataLen;while(isText(node)){dataLen=node.data.length;if(offset>=targetOffset && offset<=targetOffset+dataLen){container=node;offset=offset-targetOffset;break;}if(!isText(node.nextSibling)){container=node;offset=dataLen;break;}targetOffset+=dataLen;node=node.nextSibling;}if(offset>container.data.length){offset=container.data.length;}return new CaretPosition(container,offset);};var resolve=function(rootNode,path){var parts,container,offset;if(!path){return null;}parts=path.split(',');path=parts[0].split('/');offset=parts.length>1 ? parts[1]:'before';container=Arr.reduce(path,function(result,value){value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);if(!value){return null;}if(value[1]==='text()'){value[1]='#text';}return resolvePathItem(result,value[1],parseInt(value[2],10));},rootNode);if(!container){return null;}if(!isText(container)){if(offset==='after'){offset=nodeIndex(container)+1;}else{offset=nodeIndex(container);}return new CaretPosition(container.parentNode,offset);}return findTextPosition(container,parseInt(offset,10));};return{create:create,resolve:resolve};});define('tinymce.core.dom.GetBookmark',['ephox.katamari.api.Fun','tinymce.core.caret.CaretBookmark','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.selection.RangeNodes','tinymce.core.text.Zwsp','tinymce.core.util.Tools'],function(Fun,CaretBookmark,CaretContainer,CaretPosition,NodeType,RangeNodes,Zwsp,Tools){var isContentEditableFalse=NodeType.isContentEditableFalse;var getNormalizedTextOffset=function(trim,container,offset){var node,trimmedOffset;trimmedOffset=trim(container.data.slice(0,offset)).length;for(node=container.previousSibling;node && NodeType.isText(node);node=node.previousSibling){trimmedOffset+=trim(node.data).length;}return trimmedOffset;};var getPoint=function(dom,trim,normalized,rng,start){var container=rng[start ? 'startContainer' :'endContainer'];var offset=rng[start ? 'startOffset' :'endOffset'],point=[],childNodes,after=0;var root=dom.getRoot();if(NodeType.isText(container)){point.push(normalized ? getNormalizedTextOffset(trim,container,offset):offset);}else{childNodes=container.childNodes;if(offset>=childNodes.length && childNodes.length){after=1;offset=Math.max(0,childNodes.length-1);}point.push(dom.nodeIndex(childNodes[offset],normalized)+after);}for(;container && container !==root;container=container.parentNode){point.push(dom.nodeIndex(container,normalized));}return point;};var getLocation=function(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};bookmark.start=getPoint(dom,trim,normalized,rng,true);if(!selection.isCollapsed()){bookmark.end=getPoint(dom,trim,normalized,rng,false);}return bookmark;};var trimEmptyTextNode=function(node){if(NodeType.isText(node)&& node.data.length===0){node.parentNode.removeChild(node);}};var findIndex=function(dom,name,element){var count=0;Tools.each(dom.select(name),function(node){if(node.getAttribute('data-mce-bogus')==='all'){return;}if(node===element){return false;}count++;});return count;};var moveEndPoint=function(rng,start){var container,offset,childNodes,prefix=start ? 'start' :'end';container=rng[prefix+'Container'];offset=rng[prefix+'Offset'];if(NodeType.isElement(container)&& container.nodeName==='TR'){childNodes=container.childNodes;container=childNodes[Math.min(start ? offset :offset-1,childNodes.length-1)];if(container){offset=start ? 0 :container.childNodes.length;rng['set'+(start ? 'Start' :'End')](container,offset);}}};var normalizeTableCellSelection=function(rng){moveEndPoint(rng,true);moveEndPoint(rng,false);return rng;};var findSibling=function(node,offset){var sibling;if(NodeType.isElement(node)){node=RangeNodes.getNode(node,offset);if(isContentEditableFalse(node)){return node;}}if(CaretContainer.isCaretContainer(node)){if(NodeType.isText(node)&& CaretContainer.isCaretContainerBlock(node)){node=node.parentNode;}sibling=node.previousSibling;if(isContentEditableFalse(sibling)){return sibling;}sibling=node.nextSibling;if(isContentEditableFalse(sibling)){return sibling;}}};var findAdjacentContentEditableFalseElm=function(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset);};var getOffsetBookmark=function(trim,normalized,selection){var element=selection.getNode();var name=element ? element.nodeName :null;var rng=selection.getRng();if(isContentEditableFalse(element)||name==='IMG'){return{name:name,index:findIndex(selection.dom,name,element)};}element=findAdjacentContentEditableFalseElm(rng);if(element){name=element.tagName;return{name:name,index:findIndex(selection.dom,name,element)};}return getLocation(trim,selection,normalized,rng);};var getCaretBookmark=function(selection){var rng=selection.getRng();return{start:CaretBookmark.create(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:CaretBookmark.create(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng))};};var getRangeBookmark=function(selection){return{rng:selection.getRng()};};var getPersistentBookmark=function(selection){var dom=selection.dom;var rng=selection.getRng();var id=dom.uniqueId();var collapsed=selection.isCollapsed();var styles='overflow:hidden;line-height:0px';var element=selection.getNode();var name=element.nodeName;var chr='&#xFEFF;';if(name==='IMG'){return{name:name,index:findIndex(dom,name,element)};}var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(false);var endBookmarkNode=dom.create('span',{'data-mce-type':'bookmark',id:id+'_end',style:styles},chr);rng2.insertNode(endBookmarkNode);trimEmptyTextNode(endBookmarkNode.nextSibling);}rng=normalizeTableCellSelection(rng);rng.collapse(true);var startBookmarkNode=dom.create('span',{'data-mce-type':'bookmark',id:id+'_start',style:styles},chr);rng.insertNode(startBookmarkNode);trimEmptyTextNode(startBookmarkNode.previousSibling);selection.moveToBookmark({id:id,keep:1});return{id:id};};var getBookmark=function(selection,type,normalized){if(type===2){return getOffsetBookmark(Zwsp.trim,normalized,selection);}else if(type===3){return getCaretBookmark(selection);}else if(type){return getRangeBookmark(selection);}else{return getPersistentBookmark(selection);}};return{getBookmark:getBookmark,getUndoBookmark:Fun.curry(getOffsetBookmark,Fun.identity,true)};});define('ephox.katamari.api.Options',['ephox.katamari.api.Option'],function(Option){var cat=function(arr){var r=[];var push=function(x){r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome()){return r;}}return Option.none();};var liftN=function(arr,f){var r=[];for(var i=0;i<arr.length;i++){var x=arr[i];if(x.isSome()){r.push(x.getOrDie());}else{return Option.none();}}return Option.some(f.apply(null,r));};return{cat:cat,findMap:findMap,liftN:liftN};});define('tinymce.core.dom.ResolveBookmark',['ephox.katamari.api.Option','ephox.katamari.api.Options','tinymce.core.Env','tinymce.core.caret.CaretBookmark','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.util.Tools'],function(Option,Options,Env,CaretBookmark,CaretPosition,NodeType,Tools){var addBogus=function(dom,node){if(dom.isBlock(node)&& !node.innerHTML && !Env.ie){node.innerHTML='<br data-mce-bogus="1" />';}return node;};var resolveCaretPositionBookmark=function(dom,bookmark){var rng,pos;rng=dom.createRng();pos=CaretBookmark.resolve(dom.getRoot(),bookmark.start);rng.setStart(pos.container(),pos.offset());pos=CaretBookmark.resolve(dom.getRoot(),bookmark.end);rng.setEnd(pos.container(),pos.offset());return rng;};var setEndPoint=function(dom,start,bookmark,rng){var point=bookmark[start ? 'start' :'end'],i,node,offset,children,root=dom.getRoot();if(point){offset=point[0];for(node=root,i=point.length-1;i>=1;i--){children=node.childNodes;if(point[i]>children.length-1){return;}node=children[point[i]];}if(node.nodeType===3){offset=Math.min(point[0],node.nodeValue.length);}if(node.nodeType===1){offset=Math.min(point[0],node.childNodes.length);}if(start){rng.setStart(node,offset);}else{rng.setEnd(node,offset);}}return true;};var restoreEndPoint=function(dom,suffix,bookmark){var marker=dom.get(bookmark.id+'_'+suffix),node,idx,next,prev,keep=bookmark.keep;var container,offset;if(marker){node=marker.parentNode;if(suffix==='start'){if(!keep){idx=dom.nodeIndex(marker);}else{node=marker.firstChild;idx=1;}container=node;offset=idx;}else{if(!keep){idx=dom.nodeIndex(marker);}else{node=marker.firstChild;idx=1;}container=node;offset=idx;}if(!keep){prev=marker.previousSibling;next=marker.nextSibling;Tools.each(Tools.grep(marker.childNodes),function(node){if(NodeType.isText(node)){node.nodeValue=node.nodeValue.replace(/\uFEFF/g,'');}});while((marker=dom.get(bookmark.id+'_'+suffix))){dom.remove(marker,1);}if(prev && next && prev.nodeType===next.nodeType && NodeType.isText(prev)&& !Env.opera){idx=prev.nodeValue.length;prev.appendData(next.nodeValue);dom.remove(next);if(suffix==='start'){container=prev;offset=idx;}else{container=prev;offset=idx;}}}return Option.some(CaretPosition(container,offset));}else{return Option.none();}};var alt=function(o1,o2){return o1.isSome()? o1 :o2;};var resolvePaths=function(dom,bookmark){var rng=dom.createRng();if(setEndPoint(dom,true,bookmark,rng)&& setEndPoint(dom,false,bookmark,rng)){return Option.some(rng);}else{return Option.none();}};var resolveId=function(dom,bookmark){var startPos=restoreEndPoint(dom,'start',bookmark);var endPos=restoreEndPoint(dom,'end',bookmark);return Options.liftN([startPos,alt(endPos,startPos)],function(spos,epos){var rng=dom.createRng();rng.setStart(addBogus(dom,spos.container()),spos.offset());rng.setEnd(addBogus(dom,epos.container()),epos.offset());return rng;});};var resolveIndex=function(dom,bookmark){return Option.from(dom.select(bookmark.name)[bookmark.index]).map(function(elm){var rng=dom.createRng();rng.selectNode(elm);return rng;});};var resolve=function(selection,bookmark){var dom=selection.dom;if(bookmark){if(Tools.isArray(bookmark.start)){return resolvePaths(dom,bookmark);}else if(typeof bookmark.start==='string'){return Option.some(resolveCaretPositionBookmark(dom,bookmark));}else if(bookmark.id){return resolveId(dom,bookmark);}else if(bookmark.name){return resolveIndex(dom,bookmark);}else if(bookmark.rng){return Option.some(bookmark.rng);}}return Option.none();};return{resolve:resolve};});define('tinymce.core.dom.Bookmarks',['tinymce.core.dom.GetBookmark','tinymce.core.dom.ResolveBookmark'],function(GetBookmark,ResolveBookmark){var getBookmark=function(selection,type,normalized){return GetBookmark.getBookmark(selection,type,normalized);};var moveToBookmark=function(selection,bookmark){ResolveBookmark.resolve(selection,bookmark).each(function(rng){selection.setRng(rng);});};var isBookmarkNode=function(node){return node && node.tagName==='SPAN' && node.getAttribute('data-mce-type')==='bookmark';};return{getBookmark:getBookmark,moveToBookmark:moveToBookmark,isBookmarkNode:isBookmarkNode};});define('tinymce.core.dom.ElementUtils',["tinymce.core.dom.Bookmarks","tinymce.core.util.Tools"],function(Bookmarks,Tools){var each=Tools.each;var ElementUtils=function(dom){this.compare=function(node1,node2){if(node1.nodeName !=node2.nodeName){return false;}var getAttribs=function(node){var attribs={};each(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();if(name.indexOf('_')!==0 && name !=='style' && name.indexOf('data-')!==0){attribs[name]=dom.getAttrib(node,name);}});return attribs;};var compareObjects=function(obj1,obj2){var value,name;for(name in obj1){if(obj1.hasOwnProperty(name)){value=obj2[name];if(typeof value=="undefined"){return false;}if(obj1[name]!=value){return false;}delete obj2[name];}}for(name in obj2){if(obj2.hasOwnProperty(name)){return false;}}return true;};if(!compareObjects(getAttribs(node1),getAttribs(node2))){return false;}if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,'style')),dom.parseStyle(dom.getAttrib(node2,'style')))){return false;}return !Bookmarks.isBookmarkNode(node1)&& !Bookmarks.isBookmarkNode(node2);};};return ElementUtils;});define('ephox.sugar.api.dom.Insert',['ephox.sugar.api.search.Traverse'],function(Traverse){var before=function(marker,element){var parent=Traverse.parent(marker);parent.each(function(v){v.dom().insertBefore(element.dom(),marker.dom());});};var after=function(marker,element){var sibling=Traverse.nextSibling(marker);sibling.fold(function(){var parent=Traverse.parent(marker);parent.each(function(v){append(v,element);});},function(v){before(v,element);});};var prepend=function(parent,element){var firstChild=Traverse.firstChild(parent);firstChild.fold(function(){append(parent,element);},function(v){parent.dom().insertBefore(element.dom(),v.dom());});};var append=function(parent,element){parent.dom().appendChild(element.dom());};var appendAt=function(parent,element,index){Traverse.child(parent,index).fold(function(){append(parent,element);},function(v){before(v,element);});};var wrap=function(element,wrapper){before(element,wrapper);append(wrapper,element);};return{before:before,after:after,prepend:prepend,append:append,appendAt:appendAt,wrap:wrap};});define('ephox.sugar.api.dom.InsertAll',['ephox.katamari.api.Arr','ephox.sugar.api.dom.Insert'],function(Arr,Insert){var before=function(marker,elements){Arr.each(elements,function(x){Insert.before(marker,x);});};var after=function(marker,elements){Arr.each(elements,function(x,i){var e=i===0 ? marker :elements[i-1];Insert.after(e,x);});};var prepend=function(parent,elements){Arr.each(elements.slice().reverse(),function(x){Insert.prepend(parent,x);});};var append=function(parent,elements){Arr.each(elements,function(x){Insert.append(parent,x);});};return{before:before,after:after,prepend:prepend,append:append};});define('ephox.sugar.api.dom.Remove',['ephox.katamari.api.Arr','ephox.sugar.api.dom.InsertAll','ephox.sugar.api.search.Traverse'],function(Arr,InsertAll,Traverse){var empty=function(element){element.dom().textContent='';Arr.each(Traverse.children(element),function(rogue){remove(rogue);});};var remove=function(element){var dom=element.dom();if(dom.parentNode !==null)dom.parentNode.removeChild(dom);};var unwrap=function(wrapper){var children=Traverse.children(wrapper);if(children.length>0)InsertAll.before(wrapper,children);remove(wrapper);};return{empty:empty,remove:remove,unwrap:unwrap};});define('ephox.sugar.impl.NodeValue',['ephox.sand.api.PlatformDetection','ephox.katamari.api.Option','global!Error'],function(PlatformDetection,Option,Error){return function(is,name){var get=function(element){if(!is(element))throw new Error('Can only get '+name+' value of a '+name+' node');return getOption(element).getOr('');};var getOptionIE10=function(element){try{return getOptionSafe(element);}catch(e){return Option.none();}};var getOptionSafe=function(element){return is(element)? Option.from(element.dom().nodeValue):Option.none();};var browser=PlatformDetection.detect().browser;var getOption=browser.isIE()&& browser.version.major===10 ? getOptionIE10 :getOptionSafe;var set=function(element,value){if(!is(element))throw new Error('Can only set raw '+name+' value of a '+name+' node');element.dom().nodeValue=value;};return{get:get,getOption:getOption,set:set};};});define('ephox.sugar.api.node.Text',['ephox.sugar.api.node.Node','ephox.sugar.impl.NodeValue'],function(Node,NodeValue){var api=NodeValue(Node.isText,'text');var get=function(element){return api.get(element);};var getOption=function(element){return api.getOption(element);};var set=function(element,value){api.set(element,value);};return{get:get,getOption:getOption,set:set};});define('ephox.sugar.api.search.PredicateFilter',['ephox.katamari.api.Arr','ephox.sugar.api.node.Body','ephox.sugar.api.search.Traverse'],function(Arr,Body,Traverse){var all=function(predicate){return descendants(Body.body(),predicate);};var ancestors=function(scope,predicate,isRoot){return Arr.filter(Traverse.parents(scope,isRoot),predicate);};var siblings=function(scope,predicate){return Arr.filter(Traverse.siblings(scope),predicate);};var children=function(scope,predicate){return Arr.filter(Traverse.children(scope),predicate);};var descendants=function(scope,predicate){var result=[];Arr.each(Traverse.children(scope),function(x){if(predicate(x)){result=result.concat([x]);}result=result.concat(descendants(x,predicate));});return result;};return{all:all,ancestors:ancestors,siblings:siblings,children:children,descendants:descendants};});define('ephox.sugar.api.search.SelectorFilter',['ephox.sugar.api.search.PredicateFilter','ephox.sugar.api.search.Selectors'],function(PredicateFilter,Selectors){var all=function(selector){return Selectors.all(selector);};var ancestors=function(scope,selector,isRoot){return PredicateFilter.ancestors(scope,function(e){return Selectors.is(e,selector);},isRoot);};var siblings=function(scope,selector){return PredicateFilter.siblings(scope,function(e){return Selectors.is(e,selector);});};var children=function(scope,selector){return PredicateFilter.children(scope,function(e){return Selectors.is(e,selector);});};var descendants=function(scope,selector){return Selectors.all(selector,scope);};return{all:all,ancestors:ancestors,siblings:siblings,children:children,descendants:descendants};});define('tinymce.core.dom.PaddingBr',['ephox.katamari.api.Arr','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.node.Text','ephox.sugar.api.search.SelectorFilter','ephox.sugar.api.search.Traverse','tinymce.core.dom.ElementType'],function(Arr,Insert,Remove,Element,Node,Text,SelectorFilter,Traverse,ElementType){var getLastChildren=function(elm){var children=[],rawNode=elm.dom();while(rawNode){children.push(Element.fromDom(rawNode));rawNode=rawNode.lastChild;}return children;};var removeTrailingBr=function(elm){var allBrs=SelectorFilter.descendants(elm,'br');var brs=Arr.filter(getLastChildren(elm).slice(-1),ElementType.isBr);if(allBrs.length===brs.length){Arr.each(brs,Remove.remove);}};var fillWithPaddingBr=function(elm){Remove.empty(elm);Insert.append(elm,Element.fromHtml('<br data-mce-bogus="1">'));};var isPaddingContents=function(elm){return Node.isText(elm)? Text.get(elm)==='\u00a0' :ElementType.isBr(elm);};var isPaddedElement=function(elm){return Arr.filter(Traverse.children(elm),isPaddingContents).length===1;};var trimBlockTrailingBr=function(elm){Traverse.lastChild(elm).each(function(lastChild){Traverse.prevSibling(lastChild).each(function(lastChildPrevSibling){if(ElementType.isBlock(elm)&& ElementType.isBr(lastChild)&& ElementType.isBlock(lastChildPrevSibling)){Remove.remove(lastChild);}});});};return{removeTrailingBr:removeTrailingBr,fillWithPaddingBr:fillWithPaddingBr,isPaddedElement:isPaddedElement,trimBlockTrailingBr:trimBlockTrailingBr};});define('tinymce.core.html.Writer',["tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Entities,Tools){var makeMap=Tools.makeMap;return function(settings){var html=[],indent,indentBefore,indentAfter,encode,htmlOutput;settings=settings||{};indent=settings.indent;indentBefore=makeMap(settings.indent_before||'');indentAfter=makeMap(settings.indent_after||'');encode=Entities.getEncodeFunc(settings.entity_encoding||'raw',settings.entities);htmlOutput=settings.element_format=="html";return{start:function(name,attrs,empty){var i,l,attr,value;if(indent && indentBefore[name]&& html.length>0){value=html[html.length-1];if(value.length>0 && value !=='\n'){html.push('\n');}}html.push('<',name);if(attrs){for(i=0,l=attrs.length;i<l;i++){attr=attrs[i];html.push(' ',attr.name,'="',encode(attr.value,true),'"');}}if(!empty||htmlOutput){html[html.length]='>';}else{html[html.length]=' />';}if(empty && indent && indentAfter[name]&& html.length>0){value=html[html.length-1];if(value.length>0 && value !=='\n'){html.push('\n');}}},end:function(name){var value;html.push('</',name,'>');if(indent && indentAfter[name]&& html.length>0){value=html[html.length-1];if(value.length>0 && value !=='\n'){html.push('\n');}}},text:function(text,raw){if(text.length>0){html[html.length]=raw ? text :encode(text);}},cdata:function(text){html.push('<![CDATA[',text,']]>');},comment:function(text){html.push('<!--',text,'-->');},pi:function(name,text){if(text){html.push('<?',name,' ',encode(text),'?>');}else{html.push('<?',name,'?>');}if(indent){html.push('\n');}},doctype:function(text){html.push('<!DOCTYPE',text,'>',indent ? '\n' :'');},reset:function(){html.length=0;},getContent:function(){return html.join('').replace(/\n$/,'');}};};});define('tinymce.core.html.Serializer',["tinymce.core.html.Writer","tinymce.core.html.Schema"],function(Writer,Schema){return function(settings,schema){var self=this,writer=new Writer(settings);settings=settings||{};settings.validate="validate" in settings ? settings.validate :true;self.schema=schema=schema||new Schema();self.writer=writer;self.serialize=function(node){var handlers,validate;validate=settings.validate;handlers={3:function(node){writer.text(node.value,node.raw);},8:function(node){writer.comment(node.value);},7:function(node){writer.pi(node.name,node.value);},10:function(node){writer.doctype(node.value);},4:function(node){writer.cdata(node.value);},11:function(node){if((node=node.firstChild)){do{walk(node);}while((node=node.next));}}};writer.reset();var walk=function(node){var handler=handlers[node.type],name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule;if(!handler){name=node.name;isEmpty=node.shortEnded;attrs=node.attributes;if(validate && attrs && attrs.length>1){sortedAttrs=[];sortedAttrs.map={};elementRule=schema.getElementRule(node.name);if(elementRule){for(i=0,l=elementRule.attributesOrder.length;i<l;i++){attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}for(i=0,l=attrs.length;i<l;i++){attrName=attrs[i].name;if(!(attrName in sortedAttrs.map)){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}attrs=sortedAttrs;}}writer.start(node.name,attrs,isEmpty);if(!isEmpty){if((node=node.firstChild)){do{walk(node);}while((node=node.next));}writer.end(name);}}else{handler(node);}};if(node.type==1 && !settings.inner){walk(node);}else{handlers[11](node);}return writer.getContent();};};});define('tinymce.core.caret.CaretFinder',['ephox.katamari.api.Fun','ephox.katamari.api.Option','tinymce.core.caret.CaretCandidate','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.caret.CaretWalker','tinymce.core.dom.NodeType'],function(Fun,Option,CaretCandidate,CaretPosition,CaretUtils,CaretWalker,NodeType){var walkToPositionIn=function(forward,rootNode,startNode){var position=forward ? CaretPosition.before(startNode):CaretPosition.after(startNode);return fromPosition(forward,rootNode,position);};var afterElement=function(node){return NodeType.isBr(node)? CaretPosition.before(node):CaretPosition.after(node);};var isBeforeOrStart=function(position){if(CaretPosition.isTextPosition(position)){return position.offset()===0;}else{return CaretCandidate.isCaretCandidate(position.getNode());}};var isAfterOrEnd=function(position){if(CaretPosition.isTextPosition(position)){return position.offset()===position.container().data.length;}else{return CaretCandidate.isCaretCandidate(position.getNode(true));}};var isBeforeAfterSameElement=function(from,to){return !CaretPosition.isTextPosition(from)&& !CaretPosition.isTextPosition(to)&& from.getNode()===to.getNode(true);};var isAtBr=function(position){return !CaretPosition.isTextPosition(position)&& NodeType.isBr(position.getNode());};var shouldSkipPosition=function(forward,from,to){if(forward){return !isBeforeAfterSameElement(from,to)&& !isAtBr(from)&& isAfterOrEnd(from)&& isBeforeOrStart(to);}else{return !isBeforeAfterSameElement(to,from)&& isBeforeOrStart(from)&& isAfterOrEnd(to);}};var fromPosition=function(forward,rootNode,position){var walker=new CaretWalker(rootNode);return Option.from(forward ? walker.next(position):walker.prev(position));};var navigate=function(forward,rootNode,from){return fromPosition(forward,rootNode,from).bind(function(to){if(CaretUtils.isInSameBlock(from,to,rootNode)&& shouldSkipPosition(forward,from,to)){return fromPosition(forward,rootNode,to);}else{return Option.some(to);}});};var positionIn=function(forward,element){var startNode=forward ? element.firstChild :element.lastChild;if(NodeType.isText(startNode)){return Option.some(new CaretPosition(startNode,forward ? 0 :startNode.data.length));}else if(startNode){if(CaretCandidate.isCaretCandidate(startNode)){return Option.some(forward ? CaretPosition.before(startNode):afterElement(startNode));}else{return walkToPositionIn(forward,element,startNode);}}else{return Option.none();}};return{fromPosition:fromPosition,nextPosition:Fun.curry(fromPosition,true),prevPosition:Fun.curry(fromPosition,false),navigate:navigate,positionIn:positionIn,firstPositionIn:Fun.curry(positionIn,true),lastPositionIn:Fun.curry(positionIn,false)};});define('tinymce.core.selection.RangeNormalizer',['global!document','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils'],function(document,CaretFinder,CaretPosition,CaretUtils){var createRange=function(sc,so,ec,eo){var rng=document.createRange();rng.setStart(sc,so);rng.setEnd(ec,eo);return rng;};var normalizeBlockSelectionRange=function(rng){var startPos=CaretPosition.fromRangeStart(rng);var endPos=CaretPosition.fromRangeEnd(rng);var rootNode=rng.commonAncestorContainer;return CaretFinder.fromPosition(false,rootNode,endPos).map(function(newEndPos){if(!CaretUtils.isInSameBlock(startPos,endPos,rootNode)&& CaretUtils.isInSameBlock(startPos,newEndPos,rootNode)){return createRange(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset());}else{return rng;}}).getOr(rng);};var normalizeBlockSelection=function(rng){return rng.collapsed ? rng :normalizeBlockSelectionRange(rng);};var normalize=function(rng){return normalizeBlockSelection(rng);};return{normalize:normalize};});define('tinymce.core.InsertContent',['ephox.katamari.api.Option','ephox.sugar.api.node.Element','tinymce.core.Env','tinymce.core.InsertList','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretWalker','tinymce.core.dom.ElementUtils','tinymce.core.dom.NodeType','tinymce.core.dom.PaddingBr','tinymce.core.html.Serializer','tinymce.core.selection.RangeNormalizer','tinymce.core.util.Tools'],function(Option,Element,Env,InsertList,CaretPosition,CaretWalker,ElementUtils,NodeType,PaddingBr,Serializer,RangeNormalizer,Tools){var isTableCell=NodeType.matchNodeNames('td th');var validInsertion=function(editor,value,parentNode){if(parentNode.getAttribute('data-mce-bogus')==='all'){parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);}else{var node=parentNode.firstChild;var node2=parentNode.lastChild;if(!node||(node===node2 && node.nodeName==='BR')){editor.dom.setHTML(parentNode,value);}else{editor.selection.setContent(value);}}};var trimBrsFromTableCell=function(dom,elm){Option.from(dom.getParent(elm,'td,th')).map(Element.fromDom).each(PaddingBr.trimBlockTrailingBr);};var insertHtmlAtCaret=function(editor,value,details){var parser,serializer,parentNode,rootNode,fragment,args;var marker,rng,node,node2,bookmarkHtml,merge;var textInlineElements=editor.schema.getTextInlineElements();var selection=editor.selection,dom=editor.dom;var trimOrPaddLeftRight=function(html){var rng,container,offset;rng=selection.getRng(true);container=rng.startContainer;offset=rng.startOffset;var hasSiblingText=function(siblingName){return container[siblingName]&& container[siblingName].nodeType==3;};if(container.nodeType==3){if(offset>0){html=html.replace(/^&nbsp;/,' ');}else if(!hasSiblingText('previousSibling')){html=html.replace(/^ /,'&nbsp;');}if(offset<container.length){html=html.replace(/&nbsp;(<br>|)$/,' ');}else if(!hasSiblingText('nextSibling')){html=html.replace(/(&nbsp;| )(<br>|)$/,'&nbsp;');}}return html;};var trimNbspAfterDeleteAndPaddValue=function(){var rng,container,offset;rng=selection.getRng(true);container=rng.startContainer;offset=rng.startOffset;if(container.nodeType==3 && rng.collapsed){if(container.data[offset]==='\u00a0'){container.deleteData(offset,1);if(!/[\u00a0| ]$/.test(value)){value+=' ';}}else if(container.data[offset-1]==='\u00a0'){container.deleteData(offset-1,1);if(!/[\u00a0| ]$/.test(value)){value=' '+value;}}}};var reduceInlineTextElements=function(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);Tools.each(dom.select('*[data-mce-fragment]'),function(node){for(var testNode=node.parentNode;testNode && testNode !=root;testNode=testNode.parentNode){if(textInlineElements[node.nodeName.toLowerCase()]&& elementUtils.compare(testNode,node)){dom.remove(node,true);}}});}};var markFragmentElements=function(fragment){var node=fragment;while((node=node.walk())){if(node.type===1){node.attr('data-mce-fragment','1');}}};var umarkFragmentElements=function(elm){Tools.each(elm.getElementsByTagName('*'),function(elm){elm.removeAttribute('data-mce-fragment');});};var isPartOfFragment=function(node){return !!node.getAttribute('data-mce-fragment');};var canHaveChildren=function(node){return node && !editor.schema.getShortEndedElements()[node.nodeName];};var moveSelectionToMarker=function(marker){var parentEditableFalseElm,parentBlock,nextRng;var getContentEditableFalseParent=function(node){var root=editor.getBody();for(;node && node !==root;node=node.parentNode){if(editor.dom.getContentEditable(node)==='false'){return node;}}return null;};if(!marker){return;}selection.scrollIntoView(marker);parentEditableFalseElm=getContentEditableFalseParent(marker);if(parentEditableFalseElm){dom.remove(marker);selection.select(parentEditableFalseElm);return;}rng=dom.createRng();node=marker.previousSibling;if(node && node.nodeType==3){rng.setStart(node,node.nodeValue.length);if(!Env.ie){node2=marker.nextSibling;if(node2 && node2.nodeType==3){node.appendData(node2.data);node2.parentNode.removeChild(node2);}}}else{rng.setStartBefore(marker);rng.setEndBefore(marker);}var findNextCaretRng=function(rng){var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=new CaretWalker(editor.getBody());caretPos=caretWalker.next(caretPos);if(caretPos){return caretPos.toRange();}};parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker);if(parentBlock && dom.isEmpty(parentBlock)){editor.$(parentBlock).empty();rng.setStart(parentBlock,0);rng.setEnd(parentBlock,0);if(!isTableCell(parentBlock)&& !isPartOfFragment(parentBlock)&&(nextRng=findNextCaretRng(rng))){rng=nextRng;dom.remove(parentBlock);}else{dom.add(parentBlock,dom.create('br',{'data-mce-bogus':'1'}));}}selection.setRng(rng);};if(/^ | $/.test(value)){value=trimOrPaddLeftRight(value);}parser=editor.parser;merge=details.merge;serializer=new Serializer({validate:editor.settings.validate},editor.schema);bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>';args={content:value,format:'html',selection:true,paste:details.paste};args=editor.fire('BeforeSetContent',args);if(args.isDefaultPrevented()){editor.fire('SetContent',{content:args.content,format:'html',selection:true,paste:details.paste});return;}value=args.content;if(value.indexOf('{$caret}')==-1){value+='{$caret}';}value=value.replace(/\{\$caret\}/,bookmarkHtml);rng=selection.getRng();var caretElement=rng.startContainer||(rng.parentElement ? rng.parentElement():null);var body=editor.getBody();if(caretElement===body && selection.isCollapsed()){if(dom.isBlock(body.firstChild)&& canHaveChildren(body.firstChild)&& dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng);}}if(!selection.isCollapsed()){editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng()));editor.getDoc().execCommand('Delete',false,null);trimNbspAfterDeleteAndPaddValue();}parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:details.data,insert:true};fragment=parser.parse(value,parserArgs);if(details.paste===true && InsertList.isListFragment(editor.schema,fragment)&& InsertList.isParentBlockLi(dom,parentNode)){rng=InsertList.insertAtCaret(serializer,dom,editor.selection.getRng(true),fragment);editor.selection.setRng(rng);editor.fire('SetContent',args);return;}markFragmentElements(fragment);node=fragment.lastChild;if(node.attr('id')=='mce_marker'){marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type==3||!dom.isBlock(node.name)){if(editor.schema.isValidChild(node.parent.name,'span')){node.parent.insert(marker,node,node.name==='br');}break;}}}editor._selectionOverrides.showBlockCaretContainer(parentNode);if(!parserArgs.invalid){value=serializer.serialize(fragment);validInsertion(editor,value,parentNode);}else{selection.setContent(bookmarkHtml);parentNode=selection.getNode();rootNode=editor.getBody();if(parentNode.nodeType==9){parentNode=node=rootNode;}else{node=parentNode;}while(node !==rootNode){parentNode=node;node=node.parentNode;}value=parentNode==rootNode ? rootNode.innerHTML :dom.getOuterHTML(parentNode);value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment);})));if(parentNode==rootNode){dom.setHTML(rootNode,value);}else{dom.setOuterHTML(parentNode,value);}}reduceInlineTextElements();moveSelectionToMarker(dom.get('mce_marker'));umarkFragmentElements(editor.getBody());trimBrsFromTableCell(editor.dom,editor.selection.getStart());editor.fire('SetContent',args);editor.addVisual();};var processValue=function(value){var details;if(typeof value !=='string'){details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details:details};}return{content:value,details:{}};};var insertAtCaret=function(editor,value){var result=processValue(value);insertHtmlAtCaret(editor,result.content,result.details);};return{insertAtCaret:insertAtCaret};});define('ephox.sugar.impl.ClosestOrAncestor',['ephox.katamari.api.Type','ephox.katamari.api.Option'],function(Type,Option){return function(is,ancestor,scope,a,isRoot){return is(scope,a)? Option.some(scope):Type.isFunction(isRoot)&& isRoot(scope)? Option.none():ancestor(scope,a,isRoot);};});define('ephox.sugar.api.search.PredicateFind',['ephox.katamari.api.Type','ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.node.Body','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.impl.ClosestOrAncestor'],function(Type,Arr,Fun,Option,Body,Compare,Element,ClosestOrAncestor){var first=function(predicate){return descendant(Body.body(),predicate);};var ancestor=function(scope,predicate,isRoot){var element=scope.dom();var stop=Type.isFunction(isRoot)? isRoot :Fun.constant(false);while(element.parentNode){element=element.parentNode;var el=Element.fromDom(element);if(predicate(el))return Option.some(el);else if(stop(el))break;}return Option.none();};var closest=function(scope,predicate,isRoot){var is=function(scope){return predicate(scope);};return ClosestOrAncestor(is,ancestor,scope,predicate,isRoot);};var sibling=function(scope,predicate){var element=scope.dom();if(!element.parentNode)return Option.none();return child(Element.fromDom(element.parentNode),function(x){return !Compare.eq(scope,x)&& predicate(x);});};var child=function(scope,predicate){var result=Arr.find(scope.dom().childNodes,Fun.compose(predicate,Element.fromDom));return result.map(Element.fromDom);};var descendant=function(scope,predicate){var descend=function(element){for(var i=0;i<element.childNodes.length;i++){if(predicate(Element.fromDom(element.childNodes[i])))return Option.some(Element.fromDom(element.childNodes[i]));var res=descend(element.childNodes[i]);if(res.isSome())return res;}return Option.none();};return descend(scope.dom());};return{first:first,ancestor:ancestor,closest:closest,sibling:sibling,child:child,descendant:descendant};});define('tinymce.core.EditorSettings',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Obj','ephox.katamari.api.Option','ephox.katamari.api.Strings','ephox.katamari.api.Struct','ephox.katamari.api.Type','ephox.sand.api.PlatformDetection','tinymce.core.util.Tools'],function(Arr,Fun,Obj,Option,Strings,Struct,Type,PlatformDetection,Tools){var sectionResult=Struct.immutable('sections','settings');var detection=PlatformDetection.detect();var isTouch=detection.deviceType.isTouch();var mobilePlugins=['lists','autolink','autosave'];var defaultMobileSettings={theme:'mobile'};var normalizePlugins=function(plugins){var pluginNames=Type.isArray(plugins)? plugins.join(' '):plugins;var trimmedPlugins=Arr.map(Type.isString(pluginNames)? pluginNames.split(' '):[],Strings.trim);return Arr.filter(trimmedPlugins,function(item){return item.length>0;});};var filterMobilePlugins=function(plugins){return Arr.filter(plugins,Fun.curry(Arr.contains,mobilePlugins));};var extractSections=function(keys,settings){var result=Obj.bifilter(settings,function(value,key){return Arr.contains(keys,key);});return sectionResult(result.t,result.f);};var getSection=function(sectionResult,name,defaults){var sections=sectionResult.sections();var sectionSettings=sections.hasOwnProperty(name)? sections[name]:{};return Tools.extend({},defaults,sectionSettings);};var hasSection=function(sectionResult,name){return sectionResult.sections().hasOwnProperty(name);};var getDefaultSettings=function(id,documentBaseUrl,editor){return{id:id,theme:'modern',delta_width:0,delta_height:0,popup_css:'',plugins:'',document_base_url:documentBaseUrl,add_form_submit_trigger:true,submit_patch:true,add_unload_trigger:true,convert_urls:true,relative_urls:true,remove_script_host:true,object_resizing:true,doctype:'<!DOCTYPE html>',visual:true,font_size_style_values:'xx-small,x-small,small,medium,large,x-large,xx-large',font_size_legacy_values:'xx-small,small,medium,large,x-large,xx-large,300%',forced_root_block:'p',hidden_input:true,padd_empty_editor:true,render_ui:true,indentation:'30px',inline_styles:true,convert_fonts_to_spans:true,indent:'simple',indent_before:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',indent_after:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',entity_encoding:'named',url_converter:editor.convertURL,url_converter_scope:editor,ie7_compat:true};};var getExternalPlugins=function(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins ? settings.external_plugins :{};if(overrideSettings && overrideSettings.external_plugins){return Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins);}else{return userDefinedExternalPlugins;}};var combinePlugins=function(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));};var processPlugins=function(isTouchDevice,sectionResult,defaultOverrideSettings,settings){var forcedPlugins=normalizePlugins(defaultOverrideSettings.forced_plugins);var plugins=normalizePlugins(settings.plugins);var platformPlugins=isTouchDevice && hasSection(sectionResult,'mobile')? filterMobilePlugins(plugins):plugins;var combinedPlugins=combinePlugins(forcedPlugins,platformPlugins);return Tools.extend(settings,{plugins:combinedPlugins.join(' ')});};var isOnMobile=function(isTouchDevice,sectionResult){var isInline=sectionResult.settings().inline;return isTouchDevice && hasSection(sectionResult,'mobile')&& !isInline;};var combineSettings=function(isTouchDevice,defaultSettings,defaultOverrideSettings,settings){var sectionResult=extractSections(['mobile'],settings);var extendedSettings=Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),isOnMobile(isTouchDevice,sectionResult)? getSection(sectionResult,'mobile',defaultMobileSettings):{},{validate:true,content_editable:sectionResult.settings().inline,external_plugins:getExternalPlugins(defaultOverrideSettings,sectionResult.settings())});return processPlugins(isTouchDevice,sectionResult,defaultOverrideSettings,extendedSettings);};var getEditorSettings=function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=getDefaultSettings(id,documentBaseUrl,editor);return combineSettings(isTouch,defaultSettings,defaultOverrideSettings,settings);};var get=function(editor,name){return Option.from(editor.settings[name]);};var getFiltered=function(predicate,editor,name){return Option.from(editor.settings[name]).filter(predicate);};return{getEditorSettings:getEditorSettings,get:get,getString:Fun.curry(getFiltered,Type.isString),combineSettings:combineSettings};});define('tinymce.core.text.Bidi',[],function(){var strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;var hasStrongRtl=function(text){return strongRtl.test(text);};return{hasStrongRtl:hasStrongRtl};});define('tinymce.core.keyboard.InlineUtils',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.node.Element','ephox.sugar.api.search.Selectors','tinymce.core.EditorSettings','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.dom.DOMUtils','tinymce.core.dom.NodeType','tinymce.core.text.Bidi'],function(Arr,Fun,Option,Element,Selectors,EditorSettings,CaretContainer,CaretPosition,CaretUtils,DOMUtils,NodeType,Bidi){var isInlineTarget=function(editor,elm){var selector=EditorSettings.getString(editor,'inline_boundaries_selector').getOr('a[href],code');return Selectors.is(Element.fromDom(elm),selector);};var isRtl=function(element){return DOMUtils.DOM.getStyle(element,'direction',true)==='rtl'||Bidi.hasStrongRtl(element.textContent);};var findInlineParents=function(isInlineTarget,rootNode,pos){return Arr.filter(DOMUtils.DOM.getParents(pos.container(),'*',rootNode),isInlineTarget);};var findRootInline=function(isInlineTarget,rootNode,pos){var parents=findInlineParents(isInlineTarget,rootNode,pos);return Option.from(parents[parents.length-1]);};var hasSameParentBlock=function(rootNode,node1,node2){var block1=CaretUtils.getParentBlock(node1,rootNode);var block2=CaretUtils.getParentBlock(node2,rootNode);return block1 && block1===block2;};var isAtZwsp=function(pos){return CaretContainer.isBeforeInline(pos)||CaretContainer.isAfterInline(pos);};var normalizePosition=function(forward,pos){var container=pos.container(),offset=pos.offset();if(forward){if(CaretContainer.isCaretContainerInline(container)){if(NodeType.isText(container.nextSibling)){return new CaretPosition(container.nextSibling,0);}else{return CaretPosition.after(container);}}else{return CaretContainer.isBeforeInline(pos)? new CaretPosition(container,offset+1):pos;}}else{if(CaretContainer.isCaretContainerInline(container)){if(NodeType.isText(container.previousSibling)){return new CaretPosition(container.previousSibling,container.previousSibling.data.length);}else{return CaretPosition.before(container);}}else{return CaretContainer.isAfterInline(pos)? new CaretPosition(container,offset-1):pos;}}};var normalizeForwards=Fun.curry(normalizePosition,true);var normalizeBackwards=Fun.curry(normalizePosition,false);return{isInlineTarget:isInlineTarget,findRootInline:findRootInline,isRtl:isRtl,isAtZwsp:isAtZwsp,normalizePosition:normalizePosition,normalizeForwards:normalizeForwards,normalizeBackwards:normalizeBackwards,hasSameParentBlock:hasSameParentBlock};});define('tinymce.core.delete.DeleteUtils',['ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.search.PredicateFind','tinymce.core.caret.CaretFinder','tinymce.core.dom.ElementType','tinymce.core.keyboard.InlineUtils'],function(Option,Options,Compare,Element,PredicateFind,CaretFinder,ElementType,InlineUtils){var isBeforeRoot=function(rootNode){return function(elm){return Compare.eq(rootNode,Element.fromDom(elm.dom().parentNode));};};var getParentBlock=function(rootNode,elm){return Compare.contains(rootNode,elm)? PredicateFind.closest(elm,function(element){return ElementType.isTextBlock(element)||ElementType.isListItem(element);},isBeforeRoot(rootNode)):Option.none();};var placeCaretInEmptyBody=function(editor){var body=editor.getBody();var node=body.firstChild && editor.dom.isBlock(body.firstChild)? body.firstChild :body;editor.selection.setCursorLocation(node,0);};var paddEmptyBody=function(editor){if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');placeCaretInEmptyBody(editor);}};var willDeleteLastPositionInElement=function(forward,fromPos,elm){return Options.liftN([CaretFinder.firstPositionIn(elm),CaretFinder.lastPositionIn(elm)],function(firstPos,lastPos){var normalizedFirstPos=InlineUtils.normalizePosition(true,firstPos);var normalizedLastPos=InlineUtils.normalizePosition(false,lastPos);var normalizedFromPos=InlineUtils.normalizePosition(false,fromPos);if(forward){return CaretFinder.nextPosition(elm,normalizedFromPos).map(function(nextPos){return nextPos.isEqual(normalizedLastPos)&& fromPos.isEqual(normalizedFirstPos);}).getOr(false);}else{return CaretFinder.prevPosition(elm,normalizedFromPos).map(function(prevPos){return prevPos.isEqual(normalizedFirstPos)&& fromPos.isEqual(normalizedLastPos);}).getOr(false);}}).getOr(true);};return{getParentBlock:getParentBlock,paddEmptyBody:paddEmptyBody,willDeleteLastPositionInElement:willDeleteLastPositionInElement};});define('ephox.sugar.api.search.SelectorFind',['ephox.sugar.api.search.PredicateFind','ephox.sugar.api.search.Selectors','ephox.sugar.impl.ClosestOrAncestor'],function(PredicateFind,Selectors,ClosestOrAncestor){var first=function(selector){return Selectors.one(selector);};var ancestor=function(scope,selector,isRoot){return PredicateFind.ancestor(scope,function(e){return Selectors.is(e,selector);},isRoot);};var sibling=function(scope,selector){return PredicateFind.sibling(scope,function(e){return Selectors.is(e,selector);});};var child=function(scope,selector){return PredicateFind.child(scope,function(e){return Selectors.is(e,selector);});};var descendant=function(scope,selector){return Selectors.one(selector,scope);};var closest=function(scope,selector,isRoot){return ClosestOrAncestor(Selectors.is,ancestor,scope,selector,isRoot);};return{first:first,ancestor:ancestor,sibling:sibling,child:child,descendant:descendant,closest:closest};});define('ephox.sugar.api.search.SelectorExists',['ephox.sugar.api.search.SelectorFind'],function(SelectorFind){var any=function(selector){return SelectorFind.first(selector).isSome();};var ancestor=function(scope,selector,isRoot){return SelectorFind.ancestor(scope,selector,isRoot).isSome();};var sibling=function(scope,selector){return SelectorFind.sibling(scope,selector).isSome();};var child=function(scope,selector){return SelectorFind.child(scope,selector).isSome();};var descendant=function(scope,selector){return SelectorFind.descendant(scope,selector).isSome();};var closest=function(scope,selector,isRoot){return SelectorFind.closest(scope,selector,isRoot).isSome();};return{any:any,ancestor:ancestor,sibling:sibling,child:child,descendant:descendant,closest:closest};});define('tinymce.core.dom.Empty',['ephox.katamari.api.Fun','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.search.SelectorExists','tinymce.core.caret.CaretCandidate','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker'],function(Fun,Compare,Element,SelectorExists,CaretCandidate,NodeType,TreeWalker){var hasWhitespacePreserveParent=function(rootNode,node){var rootElement=Element.fromDom(rootNode);var startNode=Element.fromDom(node);return SelectorExists.ancestor(startNode,'pre,code',Fun.curry(Compare.eq,rootElement));};var isWhitespace=function(rootNode,node){return NodeType.isText(node)&& /^[ \t\r\n]*$/.test(node.data)&& hasWhitespacePreserveParent(rootNode,node)===false;};var isNamedAnchor=function(node){return NodeType.isElement(node)&& node.nodeName==='A' && node.hasAttribute('name');};var isContent=function(rootNode,node){return(CaretCandidate.isCaretCandidate(node)&& isWhitespace(rootNode,node)===false)||isNamedAnchor(node)||isBookmark(node);};var isBookmark=NodeType.hasAttribute('data-mce-bookmark');var isBogus=NodeType.hasAttribute('data-mce-bogus');var isBogusAll=NodeType.hasAttributeValue('data-mce-bogus','all');var isEmptyNode=function(targetNode){var walker,node,brCount=0;if(isContent(targetNode,targetNode)){return false;}else{node=targetNode.firstChild;if(!node){return true;}walker=new TreeWalker(node,targetNode);do{if(isBogusAll(node)){node=walker.next(true);continue;}if(isBogus(node)){node=walker.next();continue;}if(NodeType.isBr(node)){brCount++;node=walker.next();continue;}if(isContent(targetNode,node)){return false;}node=walker.next();}while(node);return brCount<=1;}};var isEmpty=function(elm){return isEmptyNode(elm.dom());};return{isEmpty:isEmpty};});define('tinymce.core.delete.BlockBoundary',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.katamari.api.Struct','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.search.PredicateFind','ephox.sugar.api.search.Traverse','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.delete.DeleteUtils','tinymce.core.dom.Empty','tinymce.core.dom.NodeType'],function(Arr,Fun,Option,Options,Struct,Compare,Element,Node,PredicateFind,Traverse,CaretFinder,CaretPosition,DeleteUtils,Empty,NodeType){var BlockPosition=Struct.immutable('block','position');var BlockBoundary=Struct.immutable('from','to');var getBlockPosition=function(rootNode,pos){var rootElm=Element.fromDom(rootNode);var containerElm=Element.fromDom(pos.container());return DeleteUtils.getParentBlock(rootElm,containerElm).map(function(block){return BlockPosition(block,pos);});};var isDifferentBlocks=function(blockBoundary){return Compare.eq(blockBoundary.from().block(),blockBoundary.to().block())===false;};var hasSameParent=function(blockBoundary){return Traverse.parent(blockBoundary.from().block()).bind(function(parent1){return Traverse.parent(blockBoundary.to().block()).filter(function(parent2){return Compare.eq(parent1,parent2);});}).isSome();};var isEditable=function(blockBoundary){return NodeType.isContentEditableFalse(blockBoundary.from().block())===false && NodeType.isContentEditableFalse(blockBoundary.to().block())===false;};var skipLastBr=function(rootNode,forward,blockPosition){if(NodeType.isBr(blockPosition.position().getNode())&& Empty.isEmpty(blockPosition.block())===false){return CaretFinder.positionIn(false,blockPosition.block().dom()).bind(function(lastPositionInBlock){if(lastPositionInBlock.isEqual(blockPosition.position())){return CaretFinder.fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to);});}else{return Option.some(blockPosition);}}).getOr(blockPosition);}else{return blockPosition;}};var readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng));var toBlockPos=fromBlockPos.bind(function(blockPos){return CaretFinder.fromPosition(forward,rootNode,blockPos.position()).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return skipLastBr(rootNode,forward,blockPos);});});});return Options.liftN([fromBlockPos,toBlockPos],BlockBoundary).filter(function(blockBoundary){return isDifferentBlocks(blockBoundary)&& hasSameParent(blockBoundary)&& isEditable(blockBoundary);});};var read=function(rootNode,forward,rng){return rng.collapsed ? readFromRange(rootNode,forward,rng):Option.none();};return{read:read};});define('tinymce.core.dom.Parents',['ephox.katamari.api.Fun','ephox.sugar.api.dom.Compare','ephox.sugar.api.search.Traverse'],function(Fun,Compare,Traverse){var dropLast=function(xs){return xs.slice(0,-1);};var parentsUntil=function(startNode,rootElm,predicate){if(Compare.contains(rootElm,startNode)){return dropLast(Traverse.parents(startNode,function(elm){return predicate(elm)||Compare.eq(elm,rootElm);}));}else{return[];}};var parents=function(startNode,rootElm){return parentsUntil(startNode,rootElm,Fun.constant(false));};var parentsAndSelf=function(startNode,rootElm){return[startNode].concat(parents(startNode,rootElm));};return{parentsUntil:parentsUntil,parents:parents,parentsAndSelf:parentsAndSelf};});define('tinymce.core.delete.MergeBlocks',['ephox.katamari.api.Arr','ephox.katamari.api.Option','ephox.sugar.api.dom.Compare','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.search.Traverse','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.dom.ElementType','tinymce.core.dom.Empty','tinymce.core.dom.NodeType','tinymce.core.dom.PaddingBr','tinymce.core.dom.Parents'],function(Arr,Option,Compare,Insert,Remove,Element,Traverse,CaretFinder,CaretPosition,ElementType,Empty,NodeType,PaddingBr,Parents){var getChildrenUntilBlockBoundary=function(block){var children=Traverse.children(block);return Arr.findIndex(children,ElementType.isBlock).fold(function(){return children;},function(index){return children.slice(0,index);});};var extractChildren=function(block){var children=getChildrenUntilBlockBoundary(block);Arr.each(children,function(node){Remove.remove(node);});return children;};var trimBr=function(first,block){CaretFinder.positionIn(first,block.dom()).each(function(position){var node=position.getNode();if(NodeType.isBr(node)){Remove.remove(Element.fromDom(node));}});};var removeEmptyRoot=function(rootNode,block){var parents=Parents.parentsAndSelf(block,rootNode);return Arr.find(parents.reverse(),Empty.isEmpty).each(Remove.remove);};var findParentInsertPoint=function(toBlock,block){var parents=Traverse.parents(block,function(elm){return Compare.eq(elm,toBlock);});return Option.from(parents[parents.length-2]);};var getInsertionPoint=function(fromBlock,toBlock){if(Compare.contains(toBlock,fromBlock)){return Traverse.parent(fromBlock).bind(function(parent){return Compare.eq(parent,toBlock)? Option.some(fromBlock):findParentInsertPoint(toBlock,fromBlock);});}else{return Option.none();}};var mergeBlockInto=function(rootNode,fromBlock,toBlock){if(Empty.isEmpty(toBlock)){Remove.remove(toBlock);if(Empty.isEmpty(fromBlock)){PaddingBr.fillWithPaddingBr(fromBlock);}return CaretFinder.firstPositionIn(fromBlock.dom());}else{trimBr(true,fromBlock);trimBr(false,toBlock);var children=extractChildren(fromBlock);return getInsertionPoint(fromBlock,toBlock).fold(function(){removeEmptyRoot(rootNode,fromBlock);var position=CaretFinder.lastPositionIn(toBlock.dom());Arr.each(children,function(node){Insert.append(toBlock,node);});return position;},function(target){var position=CaretFinder.prevPosition(toBlock.dom(),CaretPosition.before(target.dom()));Arr.each(children,function(node){Insert.before(target,node);});removeEmptyRoot(rootNode,fromBlock);return position;});}};var mergeBlocks=function(rootNode,forward,block1,block2){return forward ? mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2);};return{mergeBlocks:mergeBlocks};});define('tinymce.core.delete.BlockBoundaryDelete',['ephox.sugar.api.node.Element','tinymce.core.delete.BlockBoundary','tinymce.core.delete.MergeBlocks'],function(Element,BlockBoundary,MergeBlocks){var backspaceDelete=function(editor,forward){var position,rootNode=Element.fromDom(editor.getBody());position=BlockBoundary.read(rootNode.dom(),forward,editor.selection.getRng()).bind(function(blockBoundary){return MergeBlocks.mergeBlocks(rootNode,forward,blockBoundary.from().block(),blockBoundary.to().block());});position.each(function(pos){editor.selection.setRng(pos.toRange());});return position.isSome();};return{backspaceDelete:backspaceDelete};});define('tinymce.core.delete.BlockRangeDelete',['ephox.katamari.api.Fun','ephox.katamari.api.Options','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.search.PredicateFind','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.delete.DeleteUtils','tinymce.core.delete.MergeBlocks','tinymce.core.dom.ElementType'],function(Fun,Options,Compare,Element,PredicateFind,CaretFinder,CaretPosition,DeleteUtils,MergeBlocks,ElementType){var deleteRangeMergeBlocks=function(rootNode,selection){var rng=selection.getRng();return Options.liftN([DeleteUtils.getParentBlock(rootNode,Element.fromDom(rng.startContainer)),DeleteUtils.getParentBlock(rootNode,Element.fromDom(rng.endContainer))],function(block1,block2){if(Compare.eq(block1,block2)===false){rng.deleteContents();MergeBlocks.mergeBlocks(rootNode,true,block1,block2).each(function(pos){selection.setRng(pos.toRange());});return true;}else{return false;}}).getOr(false);};var isRawNodeInTable=function(root,rawNode){var node=Element.fromDom(rawNode);var isRoot=Fun.curry(Compare.eq,root);return PredicateFind.ancestor(node,ElementType.isTableCell,isRoot).isSome();};var isSelectionInTable=function(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer);};var isEverythingSelected=function(root,rng){var noPrevious=CaretFinder.prevPosition(root.dom(),CaretPosition.fromRangeStart(rng)).isNone();var noNext=CaretFinder.nextPosition(root.dom(),CaretPosition.fromRangeEnd(rng)).isNone();return !isSelectionInTable(root,rng)&& noPrevious && noNext;};var emptyEditor=function(editor){editor.setContent('');editor.selection.setCursorLocation();return true;};var deleteRange=function(editor){var rootNode=Element.fromDom(editor.getBody());var rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)? emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection);};var backspaceDelete=function(editor,forward){return editor.selection.isCollapsed()? false :deleteRange(editor,editor.selection.getRng());};return{backspaceDelete:backspaceDelete};});define('ephox.katamari.api.Adt',['ephox.katamari.api.Arr','ephox.katamari.api.Obj','ephox.katamari.api.Type','global!Array','global!Error','global!console'],function(Arr,Obj,Type,Array,Error,console){var generate=function(cases){if(!Type.isArray(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};Arr.each(cases,function(acase,count){var keys=Obj.keys(acase);if(keys.length !==1){throw new Error('one and only one name per case');}var key=keys[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!Type.isArray(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){var argLength=arguments.length;if(argLength !==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var args=new Array(argLength);for(var i=0;i<args.length;i++)args[i]=arguments[i];var match=function(branches){var branchKeys=Obj.keys(branches);if(constructors.length !==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\nActual: '+branchKeys.join(','));}var allReqd=Arr.forall(constructors,function(reqKey){return Arr.contains(branchKeys,reqKey);});if(!allReqd)throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\nRequired: '+constructors.join(', '));return branches[key].apply(null,args);};return{fold:function(){if(arguments.length !==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+arguments.length);}var target=arguments[count];return target.apply(null,args);},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args});}};};});return adt;};return{generate:generate};});define('tinymce.core.delete.CefDeleteAction',['ephox.katamari.api.Adt','ephox.katamari.api.Option','ephox.sugar.api.node.Element','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.delete.DeleteUtils','tinymce.core.dom.Empty','tinymce.core.dom.NodeType'],function(Adt,Option,Element,CaretFinder,CaretPosition,CaretUtils,DeleteUtils,Empty,NodeType){var DeleteAction=Adt.generate([{remove:['element']},{moveToElement:['element']},{moveToPosition:['position']}]);var isAtContentEditableBlockCaret=function(forward,from){var elm=from.getNode(forward===false);var caretLocation=forward ? 'after' :'before';return NodeType.isElement(elm)&& elm.getAttribute('data-mce-caret')===caretLocation;};var deleteEmptyBlockOrMoveToCef=function(rootNode,forward,from,to){var toCefElm=to.getNode(forward===false);return DeleteUtils.getParentBlock(Element.fromDom(rootNode),Element.fromDom(from.getNode())).map(function(blockElm){return Empty.isEmpty(blockElm)? DeleteAction.remove(blockElm.dom()):DeleteAction.moveToElement(toCefElm);}).orThunk(function(){return Option.some(DeleteAction.moveToElement(toCefElm));});};var findCefPosition=function(rootNode,forward,from){return CaretFinder.fromPosition(forward,rootNode,from).bind(function(to){if(forward && NodeType.isContentEditableFalse(to.getNode())){return deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to);}else if(forward===false && NodeType.isContentEditableFalse(to.getNode(true))){return deleteEmptyBlockOrMoveToCef(rootNode,forward,from,to);}else if(forward && CaretUtils.isAfterContentEditableFalse(from)){return Option.some(DeleteAction.moveToPosition(to));}else if(forward===false && CaretUtils.isBeforeContentEditableFalse(from)){return Option.some(DeleteAction.moveToPosition(to));}else{return Option.none();}});};var getContentEditableBlockAction=function(forward,elm){if(forward && NodeType.isContentEditableFalse(elm.nextSibling)){return Option.some(DeleteAction.moveToElement(elm.nextSibling));}else if(forward===false && NodeType.isContentEditableFalse(elm.previousSibling)){return Option.some(DeleteAction.moveToElement(elm.previousSibling));}else{return Option.none();}};var skipMoveToActionFromInlineCefToContent=function(root,from,deleteAction){return deleteAction.fold(function(elm){return Option.some(DeleteAction.remove(elm));},function(elm){return Option.some(DeleteAction.moveToElement(elm));},function(to){if(CaretUtils.isInSameBlock(from,to,root)){return Option.none();}else{return Option.some(DeleteAction.moveToPosition(to));}});};var getContentEditableAction=function(rootNode,forward,from){if(isAtContentEditableBlockCaret(forward,from)){return getContentEditableBlockAction(forward,from.getNode(forward===false)).fold(function(){return findCefPosition(rootNode,forward,from);},Option.some);}else{return findCefPosition(rootNode,forward,from).bind(function(deleteAction){return skipMoveToActionFromInlineCefToContent(rootNode,from,deleteAction);});}};var read=function(rootNode,forward,rng){var normalizedRange=CaretUtils.normalizeRange(forward ? 1 :-1,rootNode,rng);var from=CaretPosition.fromRangeStart(normalizedRange);if(forward===false && CaretUtils.isAfterContentEditableFalse(from)){return Option.some(DeleteAction.remove(from.getNode(true)));}else if(forward && CaretUtils.isBeforeContentEditableFalse(from)){return Option.some(DeleteAction.remove(from.getNode()));}else{return getContentEditableAction(rootNode,forward,from);}};return{read:read};});define('tinymce.core.delete.DeleteElement',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.search.PredicateFind','ephox.sugar.api.search.Traverse','tinymce.core.caret.CaretCandidate','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.dom.Empty','tinymce.core.dom.NodeType'],function(Fun,Option,Options,Insert,Remove,Element,Node,PredicateFind,Traverse,CaretCandidate,CaretFinder,CaretPosition,Empty,NodeType){var needsReposition=function(pos,elm){var container=pos.container();var offset=pos.offset();return CaretPosition.isTextPosition(pos)===false && container===elm.parentNode && offset>CaretPosition.before(elm).offset();};var reposition=function(elm,pos){return needsReposition(pos,elm)? new CaretPosition(pos.container(),pos.offset()-1):pos;};var beforeOrStartOf=function(node){return NodeType.isText(node)? new CaretPosition(node,0):CaretPosition.before(node);};var afterOrEndOf=function(node){return NodeType.isText(node)? new CaretPosition(node,node.data.length):CaretPosition.after(node);};var getPreviousSiblingCaretPosition=function(elm){if(CaretCandidate.isCaretCandidate(elm.previousSibling)){return Option.some(afterOrEndOf(elm.previousSibling));}else{return elm.previousSibling ? CaretFinder.lastPositionIn(elm.previousSibling):Option.none();}};var getNextSiblingCaretPosition=function(elm){if(CaretCandidate.isCaretCandidate(elm.nextSibling)){return Option.some(beforeOrStartOf(elm.nextSibling));}else{return elm.nextSibling ? CaretFinder.firstPositionIn(elm.nextSibling):Option.none();}};var findCaretPositionBackwardsFromElm=function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling ? elm.previousSibling :elm.parentNode);return CaretFinder.prevPosition(rootElement,startPosition).fold(function(){return CaretFinder.nextPosition(rootElement,CaretPosition.after(elm));},Option.some);};var findCaretPositionForwardsFromElm=function(rootElement,elm){return CaretFinder.nextPosition(rootElement,CaretPosition.after(elm)).fold(function(){return CaretFinder.prevPosition(rootElement,CaretPosition.before(elm));},Option.some);};var findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionBackwardsFromElm(rootElement,elm);});};var findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm);}).orThunk(function(){return findCaretPositionForwardsFromElm(rootElement,elm);});};var findCaretPosition=function(forward,rootElement,elm){return forward ? findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm);};var findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return findCaretPosition(forward,rootElement,elm).map(Fun.curry(reposition,elm));};var setSelection=function(editor,forward,pos){pos.fold(function(){editor.focus();},function(pos){editor.selection.setRng(pos.toRange(),forward);});};var eqRawNode=function(rawNode){return function(elm){return elm.dom()===rawNode;};};var isBlock=function(editor,elm){return elm && editor.schema.getBlockElements().hasOwnProperty(Node.name(elm));};var paddEmptyBlock=function(elm){if(Empty.isEmpty(elm)){var br=Element.fromHtml('<br data-mce-bogus="1">');Remove.empty(elm);Insert.append(elm,br);return Option.some(CaretPosition.before(br.dom()));}else{return Option.none();}};var deleteNormalized=function(elm,afterDeletePosOpt){return Options.liftN([Traverse.prevSibling(elm),Traverse.nextSibling(elm),afterDeletePosOpt],function(prev,next,afterDeletePos){var offset,prevNode=prev.dom(),nextNode=next.dom();if(NodeType.isText(prevNode)&& NodeType.isText(nextNode)){offset=prevNode.data.length;prevNode.appendData(nextNode.data);Remove.remove(next);Remove.remove(elm);if(afterDeletePos.container()===nextNode){return new CaretPosition(prevNode,offset);}else{return afterDeletePos;}}else{Remove.remove(elm);return afterDeletePos;}}).orThunk(function(){Remove.remove(elm);return afterDeletePosOpt;});};var deleteElement=function(editor,forward,elm){var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom());var parentBlock=PredicateFind.ancestor(elm,Fun.curry(isBlock,editor),eqRawNode(editor.getBody()));var normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos);if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');editor.selection.setCursorLocation();}else{parentBlock.bind(paddEmptyBlock).fold(function(){setSelection(editor,forward,normalizedAfterDeletePos);},function(paddPos){setSelection(editor,forward,Option.some(paddPos));});}};return{deleteElement:deleteElement};});define('tinymce.core.delete.CefDelete',['ephox.katamari.api.Arr','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.search.SelectorFilter','tinymce.core.caret.CaretPosition','tinymce.core.delete.CefDeleteAction','tinymce.core.delete.DeleteElement','tinymce.core.delete.DeleteUtils','tinymce.core.dom.NodeType'],function(Arr,Remove,Element,SelectorFilter,CaretPosition,CefDeleteAction,DeleteElement,DeleteUtils,NodeType){var deleteElement=function(editor,forward){return function(element){editor._selectionOverrides.hideFakeCaret();DeleteElement.deleteElement(editor,forward,Element.fromDom(element));return true;};};var moveToElement=function(editor,forward){return function(element){var pos=forward ? CaretPosition.before(element):CaretPosition.after(element);editor.selection.setRng(pos.toRange());return true;};};var moveToPosition=function(editor){return function(pos){editor.selection.setRng(pos.toRange());return true;};};var backspaceDeleteCaret=function(editor,forward){var result=CefDeleteAction.read(editor.getBody(),forward,editor.selection.getRng()).map(function(deleteAction){return deleteAction.fold(deleteElement(editor,forward),moveToElement(editor,forward),moveToPosition(editor));});return result.getOr(false);};var deleteOffscreenSelection=function(rootElement){Arr.each(SelectorFilter.descendants(rootElement,'.mce-offscreen-selection'),Remove.remove);};var backspaceDeleteRange=function(editor,forward){var selectedElement=editor.selection.getNode();if(NodeType.isContentEditableFalse(selectedElement)){deleteOffscreenSelection(Element.fromDom(editor.getBody()));DeleteElement.deleteElement(editor,forward,Element.fromDom(editor.selection.getNode()));DeleteUtils.paddEmptyBody(editor);return true;}else{return false;}};var getContentEditableRoot=function(root,node){while(node && node !==root){if(NodeType.isContentEditableTrue(node)||NodeType.isContentEditableFalse(node)){return node;}node=node.parentNode;}return null;};var paddEmptyElement=function(editor){var br,ceRoot=getContentEditableRoot(editor.getBody(),editor.selection.getNode());if(NodeType.isContentEditableTrue(ceRoot)&& editor.dom.isBlock(ceRoot)&& editor.dom.isEmpty(ceRoot)){br=editor.dom.create('br',{"data-mce-bogus":"1"});editor.dom.setHTML(ceRoot,'');ceRoot.appendChild(br);editor.selection.setRng(CaretPosition.before(br).toRange());}return true;};var backspaceDelete=function(editor,forward){if(editor.selection.isCollapsed()){return backspaceDeleteCaret(editor,forward);}else{return backspaceDeleteRange(editor,forward);}};return{backspaceDelete:backspaceDelete,paddEmptyElement:paddEmptyElement};});define('tinymce.core.caret.CaretContainerInline',['ephox.katamari.api.Fun','tinymce.core.dom.NodeType','tinymce.core.text.Zwsp'],function(Fun,NodeType,Zwsp){var isText=NodeType.isText;var startsWithCaretContainer=function(node){return isText(node)&& node.data[0]===Zwsp.ZWSP;};var endsWithCaretContainer=function(node){return isText(node)&& node.data[node.data.length-1]===Zwsp.ZWSP;};var createZwsp=function(node){return node.ownerDocument.createTextNode(Zwsp.ZWSP);};var insertBefore=function(node){if(isText(node.previousSibling)){if(endsWithCaretContainer(node.previousSibling)){return node.previousSibling;}else{node.previousSibling.appendData(Zwsp.ZWSP);return node.previousSibling;}}else if(isText(node)){if(startsWithCaretContainer(node)){return node;}else{node.insertData(0,Zwsp.ZWSP);return node;}}else{var newNode=createZwsp(node);node.parentNode.insertBefore(newNode,node);return newNode;}};var insertAfter=function(node){if(isText(node.nextSibling)){if(startsWithCaretContainer(node.nextSibling)){return node.nextSibling;}else{node.nextSibling.insertData(0,Zwsp.ZWSP);return node.nextSibling;}}else if(isText(node)){if(endsWithCaretContainer(node)){return node;}else{node.appendData(Zwsp.ZWSP);return node;}}else{var newNode=createZwsp(node);if(node.nextSibling){node.parentNode.insertBefore(newNode,node.nextSibling);}else{node.parentNode.appendChild(newNode);}return newNode;}};var insertInline=function(before,node){return before ? insertBefore(node):insertAfter(node);};return{insertInline:insertInline,insertInlineBefore:Fun.curry(insertInline,true),insertInlineAfter:Fun.curry(insertInline,false)};});define('tinymce.core.caret.CaretContainerRemove',['ephox.katamari.api.Arr','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.text.Zwsp'],function(Arr,CaretContainer,CaretPosition,NodeType,Zwsp){var isElement=NodeType.isElement;var isText=NodeType.isText;var removeNode=function(node){var parentNode=node.parentNode;if(parentNode){parentNode.removeChild(node);}};var getNodeValue=function(node){try{return node.nodeValue;}catch(ex){return "";}};var setNodeValue=function(node,text){if(text.length===0){removeNode(node);}else{node.nodeValue=text;}};var trimCount=function(text){var trimmedText=Zwsp.trim(text);return{count:text.length-trimmedText.length,text:trimmedText};};var removeUnchanged=function(caretContainer,pos){remove(caretContainer);return pos;};var removeTextAndReposition=function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset()));var after=trimCount(caretContainer.data.substr(pos.offset()));var text=before.text+after.text;if(text.length>0){setNodeValue(caretContainer,text);return new CaretPosition(caretContainer,pos.offset()-before.count);}else{return pos;}};var removeElementAndReposition=function(caretContainer,pos){var parentNode=pos.container();var newPosition=Arr.indexOf(parentNode.childNodes,caretContainer).map(function(index){return index<pos.offset()? new CaretPosition(parentNode,pos.offset()-1):pos;}).getOr(pos);remove(caretContainer);return newPosition;};var removeTextCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer ? removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeElementCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer.parentNode ? removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);};var removeAndReposition=function(container,pos){return CaretPosition.isTextPosition(pos)? removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos);};var remove=function(caretContainerNode){if(isElement(caretContainerNode)&& CaretContainer.isCaretContainer(caretContainerNode)){if(CaretContainer.hasContent(caretContainerNode)){caretContainerNode.removeAttribute('data-mce-caret');}else{removeNode(caretContainerNode);}}if(isText(caretContainerNode)){var text=Zwsp.trim(getNodeValue(caretContainerNode));setNodeValue(caretContainerNode,text);}};return{removeAndReposition:removeAndReposition,remove:remove};});define('tinymce.core.keyboard.BoundaryCaret',['ephox.katamari.api.Option','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretContainerInline','tinymce.core.caret.CaretContainerRemove','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.keyboard.InlineUtils'],function(Option,CaretContainer,CaretContainerInline,CaretContainerRemove,CaretFinder,CaretPosition,NodeType,InlineUtils){var insertInlinePos=function(pos,before){if(NodeType.isText(pos.container())){return CaretContainerInline.insertInline(before,pos.container());}else{return CaretContainerInline.insertInline(before,pos.getNode());}};var isPosCaretContainer=function(pos,caret){var caretNode=caret.get();return caretNode && pos.container()===caretNode && CaretContainer.isCaretContainerInline(caretNode);};var renderCaret=function(caret,location){return location.fold(function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineBefore(element);caret.set(text);return Option.some(new CaretPosition(text,text.length-1));},function(element){return CaretFinder.firstPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,true);caret.set(text);return new CaretPosition(text,1);}else{return new CaretPosition(caret.get(),1);}});},function(element){return CaretFinder.lastPositionIn(element).map(function(pos){if(!isPosCaretContainer(pos,caret)){CaretContainerRemove.remove(caret.get());var text=insertInlinePos(pos,false);caret.set(text);return new CaretPosition(text,text.length-1);}else{return new CaretPosition(caret.get(),caret.get().length-1);}});},function(element){CaretContainerRemove.remove(caret.get());var text=CaretContainerInline.insertInlineAfter(element);caret.set(text);return Option.some(new CaretPosition(text,1));});};return{renderCaret:renderCaret};});define('tinymce.core.fmt.FormatUtils',['tinymce.core.dom.TreeWalker'],function(TreeWalker){var isInlineBlock=function(node){return node && /^(IMG)$/.test(node.nodeName);};var moveStart=function(dom,selection,rng){var container=rng.startContainer,offset=rng.startOffset,walker,node,nodes;if(rng.startContainer===rng.endContainer){if(isInlineBlock(rng.startContainer.childNodes[rng.startOffset])){return;}}if(container.nodeType===3 && offset>=container.nodeValue.length){offset=dom.nodeIndex(container);container=container.parentNode;}if(container.nodeType===1){nodes=container.childNodes;if(offset<nodes.length){container=nodes[offset];walker=new TreeWalker(container,dom.getParent(container,dom.isBlock));}else{container=nodes[nodes.length-1];walker=new TreeWalker(container,dom.getParent(container,dom.isBlock));walker.next(true);}for(node=walker.current();node;node=walker.next()){if(node.nodeType===3 && !isWhiteSpaceNode(node)){rng.setStart(node,0);selection.setRng(rng);return;}}}};var getNonWhiteSpaceSibling=function(node,next,inc){if(node){next=next ? 'nextSibling' :'previousSibling';for(node=inc ? node :node[next];node;node=node[next]){if(node.nodeType===1||!isWhiteSpaceNode(node)){return node;}}}};var isTextBlock=function(editor,name){if(name.nodeType){name=name.nodeName;}return !!editor.schema.getTextBlockElements()[name.toLowerCase()];};var isValid=function(ed,parent,child){return ed.schema.isValidChild(parent,child);};var isWhiteSpaceNode=function(node){return node && node.nodeType===3 && /^([\t \r\n]+|)$/.test(node.nodeValue);};var replaceVars=function(value,vars){if(typeof value !=="string"){value=value(vars);}else if(vars){value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str;});}return value;};var isEq=function(str1,str2){str1=str1||'';str2=str2||'';str1=''+(str1.nodeName||str1);str2=''+(str2.nodeName||str2);return str1.toLowerCase()===str2.toLowerCase();};var normalizeStyleValue=function(dom,value,name){if(name==='color'||name==='backgroundColor'){value=dom.toHex(value);}if(name==='fontWeight' && value===700){value='bold';}if(name==='fontFamily'){value=value.replace(/[\'\"]/g,'').replace(/,\s+/g,',');}return ''+value;};var getStyle=function(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name);};var getTextDecoration=function(dom,node){var decoration;dom.getParent(node,function(n){decoration=dom.getStyle(n,'text-decoration');return decoration && decoration !=='none';});return decoration;};var getParents=function(dom,node,selector){return dom.getParents(node,selector,dom.getRoot());};return{isInlineBlock:isInlineBlock,moveStart:moveStart,getNonWhiteSpaceSibling:getNonWhiteSpaceSibling,isTextBlock:isTextBlock,isValid:isValid,isWhiteSpaceNode:isWhiteSpaceNode,replaceVars:replaceVars,isEq:isEq,normalizeStyleValue:normalizeStyleValue,getStyle:getStyle,getTextDecoration:getTextDecoration,getParents:getParents};});define('tinymce.core.fmt.ExpandRange',['tinymce.core.dom.Bookmarks','tinymce.core.dom.TreeWalker','tinymce.core.fmt.FormatUtils','tinymce.core.selection.RangeNodes'],function(Bookmarks,TreeWalker,FormatUtils,RangeNodes){var isBookmarkNode=Bookmarks.isBookmarkNode;var getParents=FormatUtils.getParents,isWhiteSpaceNode=FormatUtils.isWhiteSpaceNode,isTextBlock=FormatUtils.isTextBlock;var findLeaf=function(node,offset){if(typeof offset==='undefined'){offset=node.nodeType===3 ? node.length :node.childNodes.length;}while(node && node.hasChildNodes()){node=node.childNodes[offset];if(node){offset=node.nodeType===3 ? node.length :node.childNodes.length;}}return{node:node,offset:offset};};var excludeTrailingWhitespace=function(endContainer,endOffset){var leaf=findLeaf(endContainer,endOffset);if(leaf.node){while(leaf.node && leaf.offset===0 && leaf.node.previousSibling){leaf=findLeaf(leaf.node.previousSibling);}if(leaf.node && leaf.offset>0 && leaf.node.nodeType===3 && leaf.node.nodeValue.charAt(leaf.offset-1)===' '){if(leaf.offset>1){endContainer=leaf.node;endContainer.splitText(leaf.offset-1);}}}return endContainer;};var isBogusBr=function(node){return node.nodeName==="BR" && node.getAttribute('data-mce-bogus')&& !node.nextSibling;};var findParentContentEditable=function(dom,node){var parent=node;while(parent){if(parent.nodeType===1 && dom.getContentEditable(parent)){return dom.getContentEditable(parent)==="false" ? parent :node;}parent=parent.parentNode;}return node;};var findSpace=function(start,remove,node,offset){var pos,pos2,str=node.nodeValue;if(typeof offset==="undefined"){offset=start ? str.length :0;}if(start){pos=str.lastIndexOf(' ',offset);pos2=str.lastIndexOf('\u00a0',offset);pos=pos>pos2 ? pos :pos2;if(pos !==-1 && !remove){pos++;}}else{pos=str.indexOf(' ',offset);pos2=str.indexOf('\u00a0',offset);pos=pos !==-1 &&(pos2===-1||pos<pos2)? pos :pos2;}return pos;};var findWordEndPoint=function(dom,body,container,offset,start,remove){var walker,node,pos,lastTextNode;if(container.nodeType===3){pos=findSpace(start,remove,container,offset);if(pos !==-1){return{container:container,offset:pos};}lastTextNode=container;}walker=new TreeWalker(container,dom.getParent(container,dom.isBlock)||body);while((node=walker[start ? 'prev' :'next']())){if(node.nodeType===3){lastTextNode=node;pos=findSpace(start,remove,node);if(pos !==-1){return{container:node,offset:pos};}}else if(dom.isBlock(node)){break;}}if(lastTextNode){if(start){offset=0;}else{offset=lastTextNode.length;}return{container:lastTextNode,offset:offset};}};var findSelectorEndPoint=function(dom,format,rng,container,siblingName){var parents,i,y,curFormat;if(container.nodeType===3 && container.nodeValue.length===0 && container[siblingName]){container=container[siblingName];}parents=getParents(dom,container);for(i=0;i<parents.length;i++){for(y=0;y<format.length;y++){curFormat=format[y];if("collapsed" in curFormat && curFormat.collapsed !==rng.collapsed){continue;}if(dom.is(parents[i],curFormat.selector)){return parents[i];}}}return container;};var findBlockEndPoint=function(editor,format,container,siblingName){var node,dom=editor.dom,root=dom.getRoot();if(!format[0].wrapper){node=dom.getParent(container,format[0].block,root);}if(!node){var scopeRoot=dom.getParent(container,'LI,TD,TH');node=dom.getParent(container.nodeType===3 ? container.parentNode :container,function(node){return node !==root && isTextBlock(editor,node);},scopeRoot);}if(node && format[0].wrapper){node=getParents(dom,node,'ul,ol').reverse()[0]||node;}if(!node){node=container;while(node[siblingName]&& !dom.isBlock(node[siblingName])){node=node[siblingName];if(FormatUtils.isEq(node,'br')){break;}}}return node||container;};var findParentContainer=function(dom,format,startContainer,startOffset,endContainer,endOffset,start){var container,parent,sibling,siblingName,root;container=parent=start ? startContainer :endContainer;siblingName=start ? 'previousSibling' :'nextSibling';root=dom.getRoot();if(container.nodeType===3 && !isWhiteSpaceNode(container)){if(start ? startOffset>0 :endOffset<container.nodeValue.length){return container;}}while(true){if(!format[0].block_expand && dom.isBlock(parent)){return parent;}for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){if(!isBookmarkNode(sibling)&& !isWhiteSpaceNode(sibling)&& !isBogusBr(sibling)){return parent;}}if(parent===root||parent.parentNode===root){container=parent;break;}parent=parent.parentNode;}return container;};var expandRng=function(editor,rng,format,remove){var endPoint,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom;if(startContainer.nodeType===1 && startContainer.hasChildNodes()){startContainer=RangeNodes.getNode(startContainer,startOffset);if(startContainer.nodeType===3){startOffset=0;}}if(endContainer.nodeType===1 && endContainer.hasChildNodes()){endContainer=RangeNodes.getNode(endContainer,rng.collapsed ? endOffset :endOffset-1);if(endContainer.nodeType===3){endOffset=endContainer.nodeValue.length;}}startContainer=findParentContentEditable(dom,startContainer);endContainer=findParentContentEditable(dom,endContainer);if(isBookmarkNode(startContainer.parentNode)||isBookmarkNode(startContainer)){startContainer=isBookmarkNode(startContainer)? startContainer :startContainer.parentNode;startContainer=startContainer.nextSibling||startContainer;if(startContainer.nodeType===3){startOffset=0;}}if(isBookmarkNode(endContainer.parentNode)||isBookmarkNode(endContainer)){endContainer=isBookmarkNode(endContainer)? endContainer :endContainer.parentNode;endContainer=endContainer.previousSibling||endContainer;if(endContainer.nodeType===3){endOffset=endContainer.length;}}if(format[0].inline){if(rng.collapsed){endPoint=findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,true,remove);if(endPoint){startContainer=endPoint.container;startOffset=endPoint.offset;}endPoint=findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,false,remove);if(endPoint){endContainer=endPoint.container;endOffset=endPoint.offset;}}endContainer=remove ? endContainer :excludeTrailingWhitespace(endContainer,endOffset);}if(format[0].inline||format[0].block_expand){if(!format[0].inline||(startContainer.nodeType !==3||startOffset===0)){startContainer=findParentContainer(dom,format,startContainer,startOffset,endContainer,endOffset,true);}if(!format[0].inline||(endContainer.nodeType !==3||endOffset===endContainer.nodeValue.length)){endContainer=findParentContainer(dom,format,startContainer,startOffset,endContainer,endOffset,false);}}if(format[0].selector && format[0].expand !==false && !format[0].inline){startContainer=findSelectorEndPoint(dom,format,rng,startContainer,'previousSibling');endContainer=findSelectorEndPoint(dom,format,rng,endContainer,'nextSibling');}if(format[0].block||format[0].selector){startContainer=findBlockEndPoint(editor,format,startContainer,'previousSibling');endContainer=findBlockEndPoint(editor,format,endContainer,'nextSibling');if(format[0].block){if(!dom.isBlock(startContainer)){startContainer=findParentContainer(dom,format,startContainer,startOffset,endContainer,endOffset,true);}if(!dom.isBlock(endContainer)){endContainer=findParentContainer(dom,format,startContainer,startOffset,endContainer,endOffset,false);}}}if(startContainer.nodeType===1){startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(endContainer.nodeType===1){endOffset=dom.nodeIndex(endContainer)+1;endContainer=endContainer.parentNode;}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};return{expandRng:expandRng};});define('tinymce.core.fmt.MatchFormat',['tinymce.core.fmt.FormatUtils'],function(FormatUtils){var isEq=FormatUtils.isEq;var matchesUnInheritedFormatSelector=function(ed,node,name){var formatList=ed.formatter.get(name);if(formatList){for(var i=0;i<formatList.length;i++){if(formatList[i].inherit===false && ed.dom.is(node,formatList[i].selector)){return true;}}}return false;};var matchParents=function(editor,node,name,vars){var root=editor.dom.getRoot();if(node===root){return false;}node=editor.dom.getParent(node,function(node){if(matchesUnInheritedFormatSelector(editor,node,name)){return true;}return node.parentNode===root||!!matchNode(editor,node,name,vars,true);});return matchNode(editor,node,name,vars);};var matchName=function(dom,node,format){if(isEq(node,format.inline)){return true;}if(isEq(node,format.block)){return true;}if(format.selector){return node.nodeType===1 && dom.is(node,format.selector);}};var matchItems=function(dom,node,format,itemName,similar,vars){var key,value,items=format[itemName],i;if(format.onmatch){return format.onmatch(node,format,itemName);}if(items){if(typeof items.length==='undefined'){for(key in items){if(items.hasOwnProperty(key)){if(itemName==='attributes'){value=dom.getAttrib(node,key);}else{value=FormatUtils.getStyle(dom,node,key);}if(similar && !value && !format.exact){return;}if((!similar||format.exact)&& !isEq(value,FormatUtils.normalizeStyleValue(dom,FormatUtils.replaceVars(items[key],vars),key))){return;}}}}else{for(i=0;i<items.length;i++){if(itemName==='attributes' ? dom.getAttrib(node,items[i]):FormatUtils.getStyle(dom,node,items[i])){return format;}}}}return format;};var matchNode=function(ed,node,name,vars,similar){var formatList=ed.formatter.get(name),format,i,x,classes,dom=ed.dom;if(formatList && node){for(i=0;i<formatList.length;i++){format=formatList[i];if(matchName(ed.dom,node,format)&& matchItems(dom,node,format,'attributes',similar,vars)&& matchItems(dom,node,format,'styles',similar,vars)){if((classes=format.classes)){for(x=0;x<classes.length;x++){if(!ed.dom.hasClass(node,classes[x])){return;}}}return format;}}}};var match=function(editor,name,vars,node){var startNode;if(node){return matchParents(editor,node,name,vars);}node=editor.selection.getNode();if(matchParents(editor,node,name,vars)){return true;}startNode=editor.selection.getStart();if(startNode !==node){if(matchParents(editor,startNode,name,vars)){return true;}}return false;};var matchAll=function(editor,names,vars){var startElement,matchedFormatNames=[],checkedMap={};startElement=editor.selection.getStart();editor.dom.getParent(startElement,function(node){var i,name;for(i=0;i<names.length;i++){name=names[i];if(!checkedMap[name]&& matchNode(editor,node,name,vars)){checkedMap[name]=true;matchedFormatNames.push(name);}}},editor.dom.getRoot());return matchedFormatNames;};var canApply=function(editor,name){var formatList=editor.formatter.get(name),startNode,parents,i,x,selector,dom=editor.dom;if(formatList){startNode=editor.selection.getStart();parents=FormatUtils.getParents(dom,startNode);for(x=formatList.length-1;x>=0;x--){selector=formatList[x].selector;if(!selector||formatList[x].defaultBlock){return true;}for(i=parents.length-1;i>=0;i--){if(dom.is(parents[i],selector)){return true;}}}}return false;};return{matchNode:matchNode,matchName:matchName,match:match,matchAll:matchAll,canApply:canApply,matchesUnInheritedFormatSelector:matchesUnInheritedFormatSelector};});define('tinymce.core.selection.SplitRange',['tinymce.core.dom.NodeType'],function(NodeType){var splitText=function(node,offset){return node.splitText(offset);};var split=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(startContainer===endContainer && NodeType.isText(startContainer)){if(startOffset>0 && startOffset<startContainer.nodeValue.length){endContainer=splitText(startContainer,startOffset);startContainer=endContainer.previousSibling;if(endOffset>startOffset){endOffset=endOffset-startOffset;startContainer=endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;startOffset=0;}else{endOffset=0;}}}else{if(NodeType.isText(startContainer)&& startOffset>0 && startOffset<startContainer.nodeValue.length){startContainer=splitText(startContainer,startOffset);startOffset=0;}if(NodeType.isText(endContainer)&& endOffset>0 && endOffset<endContainer.nodeValue.length){endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;}}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset};};return{split:split};});define('tinymce.core.fmt.CaretFormat',['ephox.katamari.api.Arr','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.properties.Attr','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.dom.PaddingBr','tinymce.core.dom.TreeWalker','tinymce.core.fmt.ExpandRange','tinymce.core.fmt.FormatUtils','tinymce.core.fmt.MatchFormat','tinymce.core.selection.SplitRange','tinymce.core.text.Zwsp','tinymce.core.util.Fun'],function(Arr,Insert,Remove,Element,Node,Attr,CaretPosition,NodeType,PaddingBr,TreeWalker,ExpandRange,FormatUtils,MatchFormat,SplitRange,Zwsp,Fun){var ZWSP=Zwsp.ZWSP,CARET_ID='_mce_caret';var importNode=function(ownerDocument,node){return ownerDocument.importNode(node,true);};var isCaretNode=function(node){return node.nodeType===1 && node.id===CARET_ID;};var getEmptyCaretContainers=function(node){var nodes=[];while(node){if((node.nodeType===3 && node.nodeValue !==ZWSP)||node.childNodes.length>1){return[];}if(node.nodeType===1){nodes.push(node);}node=node.firstChild;}return nodes;};var isCaretContainerEmpty=function(node){return getEmptyCaretContainers(node).length>0;};var findFirstTextNode=function(node){var walker;if(node){walker=new TreeWalker(node,node);for(node=walker.current();node;node=walker.next()){if(node.nodeType===3){return node;}}}return null;};var createCaretContainer=function(fill){var caretContainer=Element.fromTag('span');Attr.setAll(caretContainer,{id:CARET_ID,'data-mce-bogus':'1','data-mce-type':'format-caret'});if(fill){Insert.append(caretContainer,Element.fromText(ZWSP));}return caretContainer;};var getParentCaretContainer=function(body,node){while(node && node !==body){if(node.id===CARET_ID){return node;}node=node.parentNode;}return null;};var trimZwspFromCaretContainer=function(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);if(textNode && textNode.nodeValue.charAt(0)===ZWSP){textNode.deleteData(0,1);}return textNode;};var removeCaretContainerNode=function(dom,selection,node,moveCaret){var rng,block,textNode;rng=selection.getRng(true);block=dom.getParent(node,dom.isBlock);if(isCaretContainerEmpty(node)){if(moveCaret !==false){rng.setStartBefore(node);rng.setEndBefore(node);}dom.remove(node);}else{textNode=trimZwspFromCaretContainer(node);if(rng.startContainer===textNode && rng.startOffset>0){rng.setStart(textNode,rng.startOffset-1);}if(rng.endContainer===textNode && rng.endOffset>0){rng.setEnd(textNode,rng.endOffset-1);}dom.remove(node,true);}if(block && dom.isEmpty(block)){PaddingBr.fillWithPaddingBr(Element.fromDom(block));}selection.setRng(rng);};var removeCaretContainer=function(body,dom,selection,node,moveCaret){if(!node){node=getParentCaretContainer(body,selection.getStart());if(!node){while((node=dom.get(CARET_ID))){removeCaretContainerNode(dom,selection,node,false);}}}else{removeCaretContainerNode(dom,selection,node,moveCaret);}};var insertCaretContainerNode=function(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,Fun.curry(FormatUtils.isTextBlock,editor));if(block && dom.isEmpty(block)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{PaddingBr.removeTrailingBr(Element.fromDom(formatNode));if(dom.isEmpty(formatNode)){formatNode.parentNode.replaceChild(caretContainer,formatNode);}else{dom.insertAfter(caretContainer,formatNode);}}};var appendNode=function(parentNode,node){parentNode.appendChild(node);return node;};var insertFormatNodesIntoCaretContainer=function(formatNodes,caretContainer){var innerMostFormatNode=Arr.foldr(formatNodes,function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(false));},caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode(ZWSP));};var applyCaretFormat=function(editor,name,vars){var rng,caretContainer,textNode,offset,bookmark,container,text;var selection=editor.selection;rng=selection.getRng(true);offset=rng.startOffset;container=rng.startContainer;text=container.nodeValue;caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart());if(caretContainer){textNode=findFirstTextNode(caretContainer);}var wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text && offset>0 && offset<text.length && wordcharRegex.test(text.charAt(offset))&& wordcharRegex.test(text.charAt(offset-1))){bookmark=selection.getBookmark();rng.collapse(true);rng=ExpandRange.expandRng(editor,rng,editor.formatter.get(name));rng=SplitRange.split(rng);editor.formatter.apply(name,vars,rng);selection.moveToBookmark(bookmark);}else{if(!caretContainer||textNode.nodeValue !==ZWSP){caretContainer=importNode(editor.getDoc(),createCaretContainer(true).dom());textNode=caretContainer.firstChild;rng.insertNode(caretContainer);offset=1;editor.formatter.apply(name,vars,caretContainer);}else{editor.formatter.apply(name,vars,caretContainer);}selection.setCursorLocation(textNode,offset);}};var removeCaretFormat=function(editor,name,vars,similar){var dom=editor.dom,selection=editor.selection;var rng=selection.getRng(true),container,offset,bookmark;var hasContentAfter,node,formatNode,parents=[],caretContainer;container=rng.startContainer;offset=rng.startOffset;node=container;if(container.nodeType===3){if(offset !==container.nodeValue.length){hasContentAfter=true;}node=node.parentNode;}while(node){if(MatchFormat.matchNode(editor,node,name,vars,similar)){formatNode=node;break;}if(node.nextSibling){hasContentAfter=true;}parents.push(node);node=node.parentNode;}if(!formatNode){return;}if(hasContentAfter){bookmark=selection.getBookmark();rng.collapse(true);rng=ExpandRange.expandRng(editor,rng,editor.formatter.get(name),true);rng=SplitRange.split(rng);editor.formatter.remove(name,vars,rng);selection.moveToBookmark(bookmark);}else{caretContainer=getParentCaretContainer(editor.getBody(),formatNode);var newCaretContainer=createCaretContainer(false).dom();var caretNode=insertFormatNodesIntoCaretContainer(parents,newCaretContainer);if(caretContainer){insertCaretContainerNode(editor,newCaretContainer,caretContainer);}else{insertCaretContainerNode(editor,newCaretContainer,formatNode);}removeCaretContainerNode(dom,selection,caretContainer,false);selection.setCursorLocation(caretNode,1);if(dom.isEmpty(formatNode)){dom.remove(formatNode);}}};var disableCaretContainer=function(body,dom,selection,keyCode){removeCaretContainer(body,dom,selection,null,false);if(keyCode===8 && selection.isCollapsed()&& selection.getStart().innerHTML===ZWSP){removeCaretContainer(body,dom,selection,getParentCaretContainer(body,selection.getStart()));}if(keyCode===37||keyCode===39){removeCaretContainer(body,dom,selection,getParentCaretContainer(body,selection.getStart()));}};var setup=function(editor){var dom=editor.dom,selection=editor.selection;var body=editor.getBody();editor.on('mouseup keydown',function(e){disableCaretContainer(body,dom,selection,e.keyCode);});};var replaceWithCaretFormat=function(targetNode,formatNodes){var caretContainer=createCaretContainer(false);var innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom());Insert.before(Element.fromDom(targetNode),caretContainer);Remove.remove(Element.fromDom(targetNode));return CaretPosition(innerMost,0);};var isFormatElement=function(editor,element){var inlineElements=editor.schema.getTextInlineElements();return inlineElements.hasOwnProperty(Node.name(element))&& !isCaretNode(element.dom())&& !NodeType.isBogus(element.dom());};return{setup:setup,applyCaretFormat:applyCaretFormat,removeCaretFormat:removeCaretFormat,isCaretNode:isCaretNode,getParentCaretContainer:getParentCaretContainer,replaceWithCaretFormat:replaceWithCaretFormat,isFormatElement:isFormatElement};});define('tinymce.core.util.LazyEvaluator',['ephox.katamari.api.Option'],function(Option){var evaluateUntil=function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome()){return result;}}return Option.none();};return{evaluateUntil:evaluateUntil};});define('tinymce.core.keyboard.BoundaryLocation',['ephox.katamari.api.Adt','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretUtils','tinymce.core.fmt.CaretFormat','tinymce.core.keyboard.InlineUtils','tinymce.core.util.LazyEvaluator'],function(Adt,Fun,Option,Options,CaretFinder,CaretUtils,CaretFormat,InlineUtils,LazyEvaluator){var Location=Adt.generate([{before:['element']},{start:['element']},{end:['element']},{after:['element']}]);var rescope=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock ? parentBlock :rootNode;};var before=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos);var scope=rescope(rootNode,nPos.container());return InlineUtils.findRootInline(isInlineTarget,scope,nPos).fold(function(){return CaretFinder.nextPosition(scope,nPos).bind(Fun.curry(InlineUtils.findRootInline,isInlineTarget,scope)).map(function(inline){return Location.before(inline);});},Option.none);};var isNotInsideFormatCaretContainer=function(rootNode,elm){return CaretFormat.getParentCaretContainer(rootNode,elm)===null;};var findInsideRootInline=function(isInlineTarget,rootNode,pos){return InlineUtils.findRootInline(isInlineTarget,rootNode,pos).filter(Fun.curry(isNotInsideFormatCaretContainer,rootNode));};var start=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var prevPos=CaretFinder.prevPosition(inline,nPos);return prevPos.isNone()? Option.some(Location.start(inline)):Option.none();});};var end=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){var nextPos=CaretFinder.nextPosition(inline,nPos);return nextPos.isNone()? Option.some(Location.end(inline)):Option.none();});};var after=function(isInlineTarget,rootNode,pos){var nPos=InlineUtils.normalizeBackwards(pos);var scope=rescope(rootNode,nPos.container());return InlineUtils.findRootInline(isInlineTarget,scope,nPos).fold(function(){return CaretFinder.prevPosition(scope,nPos).bind(Fun.curry(InlineUtils.findRootInline,isInlineTarget,scope)).map(function(inline){return Location.after(inline);});},Option.none);};var isValidLocation=function(location){return InlineUtils.isRtl(getElement(location))===false;};var readLocation=function(isInlineTarget,rootNode,pos){var location=LazyEvaluator.evaluateUntil([before,start,end,after],[isInlineTarget,rootNode,pos]);return location.filter(isValidLocation);};var getElement=function(location){return location.fold(Fun.identity,Fun.identity,Fun.identity,Fun.identity);};var getName=function(location){return location.fold(Fun.constant('before'),Fun.constant('start'),Fun.constant('end'),Fun.constant('after'));};var outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after);};var inside=function(location){return location.fold(Location.start,Location.start,Location.end,Location.end);};var isEq=function(location1,location2){return getName(location1)===getName(location2)&& getElement(location1)===getElement(location2);};var betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return Options.liftN([InlineUtils.findRootInline(isInlineTarget,rootNode,from),InlineUtils.findRootInline(isInlineTarget,rootNode,to)],function(fromInline,toInline){if(fromInline !==toInline && InlineUtils.hasSameParentBlock(rootNode,fromInline,toInline)){return Location.after(forward ? fromInline :toInline);}else{return location;}}).getOr(location);};var skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(Fun.constant(true),function(fromLocation){return !isEq(fromLocation,toLocation);});};var findLocationTraverse=function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=InlineUtils.normalizePosition(forward,pos);var to=CaretFinder.fromPosition(forward,rootNode,from).map(Fun.curry(InlineUtils.normalizePosition,forward));var location=to.fold(function(){return fromLocation.map(outside);},function(to){return readLocation(isInlineTarget,rootNode,to).map(Fun.curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(Fun.curry(skipNoMovement,fromLocation));});return location.filter(isValidLocation);};var findLocationSimple=function(forward,location){if(forward){return location.fold(Fun.compose(Option.some,Location.start),Option.none,Fun.compose(Option.some,Location.after),Option.none);}else{return location.fold(Option.none,Fun.compose(Option.some,Location.before),Option.none,Fun.compose(Option.some,Location.end));}};var findLocation=function(forward,isInlineTarget,rootNode,pos){var from=InlineUtils.normalizePosition(forward,pos);var fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(Fun.curry(findLocationSimple,forward)).orThunk(function(){return findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos);});};return{readLocation:readLocation,findLocation:findLocation,prevLocation:Fun.curry(findLocation,false),nextLocation:Fun.curry(findLocation,true),getElement:getElement,outside:outside,inside:inside};});define('ephox.katamari.api.Cell',[],function(){var Cell=function(initial){var value=initial;var get=function(){return value;};var set=function(v){value=v;};var clone=function(){return Cell(get());};return{get:get,set:set,clone:clone};};return Cell;});define('tinymce.core.selection.WordSelection',['ephox.katamari.api.Type','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition'],function(Type,CaretContainer,CaretPosition){var hasSelectionModifyApi=function(editor){return Type.isFunction(editor.selection.getSel().modify);};var moveRel=function(forward,selection,pos){var delta=forward ? 1 :-1;selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange());selection.getSel().modify('move',forward ? 'forward' :'backward','word');return true;};var moveByWord=function(forward,editor){var rng=editor.selection.getRng();var pos=forward ? CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);if(!hasSelectionModifyApi(editor)){return false;}else if(forward && CaretContainer.isBeforeInline(pos)){return moveRel(true,editor.selection,pos);}else if(!forward && CaretContainer.isAfterInline(pos)){return moveRel(false,editor.selection,pos);}else{return false;}};return{hasSelectionModifyApi:hasSelectionModifyApi,moveByWord:moveByWord};});define('tinymce.core.keyboard.BoundarySelection',['ephox.katamari.api.Arr','ephox.katamari.api.Cell','ephox.katamari.api.Fun','tinymce.core.caret.CaretContainerRemove','tinymce.core.caret.CaretPosition','tinymce.core.keyboard.BoundaryCaret','tinymce.core.keyboard.BoundaryLocation','tinymce.core.keyboard.InlineUtils','tinymce.core.selection.WordSelection'],function(Arr,Cell,Fun,CaretContainerRemove,CaretPosition,BoundaryCaret,BoundaryLocation,InlineUtils,WordSelection){var setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());editor.selection.setRng(rng);};var isFeatureEnabled=function(editor){return editor.settings.inline_boundaries !==false;};var setSelected=function(state,elm){if(state){elm.setAttribute('data-mce-selected','inline-boundary');}else{elm.removeAttribute('data-mce-selected');}};var renderCaretLocation=function(editor,caret,location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){setCaretPosition(editor,pos);return location;});};var findLocation=function(editor,caret,forward){var rootNode=editor.getBody();var from=CaretPosition.fromRangeStart(editor.selection.getRng());var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);var location=BoundaryLocation.findLocation(forward,isInlineTarget,rootNode,from);return location.bind(function(location){return renderCaretLocation(editor,caret,location);});};var toggleInlines=function(isInlineTarget,dom,elms){var selectedInlines=Arr.filter(dom.select('*[data-mce-selected="inline-boundary"]'),isInlineTarget);var targetInlines=Arr.filter(elms,isInlineTarget);Arr.each(Arr.difference(selectedInlines,targetInlines),Fun.curry(setSelected,false));Arr.each(Arr.difference(targetInlines,selectedInlines),Fun.curry(setSelected,true));};var safeRemoveCaretContainer=function(editor,caret){if(editor.selection.isCollapsed()&& editor.composing !==true && caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());if(CaretPosition.isTextPosition(pos)&& InlineUtils.isAtZwsp(pos)===false){setCaretPosition(editor,CaretContainerRemove.removeAndReposition(caret.get(),pos));caret.set(null);}}};var renderInsideInlineCaret=function(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=Arr.filter(elms,isInlineTarget);Arr.each(inlines,function(inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());BoundaryLocation.readLocation(isInlineTarget,editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location);});});}};var move=function(editor,caret,forward){return function(){return isFeatureEnabled(editor)? findLocation(editor,caret,forward).isSome():false;};};var moveWord=function(forward,editor,caret){return function(){return isFeatureEnabled(editor)? WordSelection.moveByWord(forward,editor):false;};};var setupSelectedState=function(editor){var caret=new Cell(null);var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);editor.on('NodeChange',function(e){if(isFeatureEnabled(editor)){toggleInlines(isInlineTarget,editor.dom,e.parents);safeRemoveCaretContainer(editor,caret);renderInsideInlineCaret(isInlineTarget,editor,caret,e.parents);}});return caret;};return{move:move,moveNextWord:Fun.curry(moveWord,true),movePrevWord:Fun.curry(moveWord,false),setupSelectedState:setupSelectedState,setCaretPosition:setCaretPosition};});define('tinymce.core.delete.InlineBoundaryDelete',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.sugar.api.node.Element','global!document','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.delete.DeleteElement','tinymce.core.keyboard.BoundaryCaret','tinymce.core.keyboard.BoundaryLocation','tinymce.core.keyboard.BoundarySelection','tinymce.core.keyboard.InlineUtils'],function(Fun,Option,Options,Element,document,CaretContainer,CaretFinder,CaretPosition,CaretUtils,DeleteElement,BoundaryCaret,BoundaryLocation,BoundarySelection,InlineUtils){var isFeatureEnabled=function(editor){return editor.settings.inline_boundaries !==false;};var rangeFromPositions=function(from,to){var range=document.createRange();range.setStart(from.container(),from.offset());range.setEnd(to.container(),to.offset());return range;};var hasOnlyTwoOrLessPositionsLeft=function(elm){return Options.liftN([CaretFinder.firstPositionIn(elm),CaretFinder.lastPositionIn(elm)],function(firstPos,lastPos){var normalizedFirstPos=InlineUtils.normalizePosition(true,firstPos);var normalizedLastPos=InlineUtils.normalizePosition(false,lastPos);return CaretFinder.nextPosition(elm,normalizedFirstPos).map(function(pos){return pos.isEqual(normalizedLastPos);}).getOr(true);}).getOr(true);};var setCaretLocation=function(editor,caret){return function(location){return BoundaryCaret.renderCaret(caret,location).map(function(pos){BoundarySelection.setCaretPosition(editor,pos);return true;}).getOr(false);};};var deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody();var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);editor.undoManager.ignore(function(){editor.selection.setRng(rangeFromPositions(from,to));editor.execCommand('Delete');BoundaryLocation.readLocation(isInlineTarget,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor,caret));});editor.nodeChanged();};var rescope=function(rootNode,node){var parentBlock=CaretUtils.getParentBlock(node,rootNode);return parentBlock ? parentBlock :rootNode;};var backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=rescope(editor.getBody(),from.container());var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);var fromLocation=BoundaryLocation.readLocation(isInlineTarget,rootNode,from);return fromLocation.bind(function(location){if(forward){return location.fold(Fun.constant(Option.some(BoundaryLocation.inside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none);}else{return location.fold(Option.none,Fun.constant(Option.some(BoundaryLocation.outside(location))),Option.none,Fun.constant(Option.some(BoundaryLocation.inside(location))));}}).map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=CaretFinder.navigate(forward,rootNode,from);var toLocation=toPosition.bind(function(pos){return BoundaryLocation.readLocation(isInlineTarget,rootNode,pos);});if(fromLocation.isSome()&& toLocation.isSome()){return InlineUtils.findRootInline(isInlineTarget,rootNode,from).map(function(elm){if(hasOnlyTwoOrLessPositionsLeft(elm)){DeleteElement.deleteElement(editor,forward,Element.fromDom(elm));return true;}else{return false;}}).getOr(false);}else{return toLocation.bind(function(_){return toPosition.map(function(to){if(forward){deleteFromTo(editor,caret,from,to);}else{deleteFromTo(editor,caret,to,from);}return true;});}).getOr(false);}});};var backspaceDelete=function(editor,caret,forward){if(editor.selection.isCollapsed()&& isFeatureEnabled(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from);}return false;};return{backspaceDelete:backspaceDelete};});define('tinymce.core.delete.TableDeleteAction',['ephox.katamari.api.Adt','ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.katamari.api.Struct','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.search.SelectorFilter','ephox.sugar.api.search.SelectorFind'],function(Adt,Arr,Fun,Option,Options,Struct,Compare,Element,SelectorFilter,SelectorFind){var tableCellRng=Struct.immutable('start','end');var tableSelection=Struct.immutable('rng','table','cells');var deleteAction=Adt.generate([{removeTable:['element']},{emptyCells:['cells']}]);var getClosestCell=function(container,isRoot){return SelectorFind.closest(Element.fromDom(container),'td,th',isRoot);};var getClosestTable=function(cell,isRoot){return SelectorFind.ancestor(cell,'table',isRoot);};var isExpandedCellRng=function(cellRng){return Compare.eq(cellRng.start(),cellRng.end())===false;};var getTableFromCellRng=function(cellRng,isRoot){return getClosestTable(cellRng.start(),isRoot).bind(function(startParentTable){return getClosestTable(cellRng.end(),isRoot).bind(function(endParentTable){return Compare.eq(startParentTable,endParentTable)? Option.some(startParentTable):Option.none();});});};var getCellRng=function(rng,isRoot){return Options.liftN([getClosestCell(rng.startContainer,isRoot),getClosestCell(rng.endContainer,isRoot)],tableCellRng).filter(isExpandedCellRng);};var getTableSelectionFromCellRng=function(cellRng,isRoot){return getTableFromCellRng(cellRng,isRoot).bind(function(table){var cells=SelectorFilter.descendants(table,'td,th');return tableSelection(cellRng,table,cells);});};var getTableSelectionFromRng=function(rootNode,rng){var isRoot=Fun.curry(Compare.eq,rootNode);return getCellRng(rng,isRoot).map(function(cellRng){return getTableSelectionFromCellRng(cellRng,isRoot);});};var getCellIndex=function(cellArray,cell){return Arr.findIndex(cellArray,function(x){return Compare.eq(x,cell);});};var getSelectedCells=function(tableSelection){return Options.liftN([getCellIndex(tableSelection.cells(),tableSelection.rng().start()),getCellIndex(tableSelection.cells(),tableSelection.rng().end())],function(startIndex,endIndex){return tableSelection.cells().slice(startIndex,endIndex+1);});};var getAction=function(tableSelection){return getSelectedCells(tableSelection).bind(function(selected){var cells=tableSelection.cells();return selected.length===cells.length ? deleteAction.removeTable(tableSelection.table()):deleteAction.emptyCells(selected);});};var getActionFromCells=function(cells){return deleteAction.emptyCells(cells);};var getActionFromRange=function(rootNode,rng){return getTableSelectionFromRng(rootNode,rng).map(getAction);};return{getActionFromRange:getActionFromRange,getActionFromCells:getActionFromCells};});define('tinymce.core.selection.MultiRange',['ephox.katamari.api.Arr','ephox.sugar.api.node.Element','tinymce.core.selection.RangeNodes'],function(Arr,Element,RangeNodes){var getRanges=function(selection){var ranges=[];if(selection){for(var i=0;i<selection.rangeCount;i++){ranges.push(selection.getRangeAt(i));}}return ranges;};var getSelectedNodes=function(ranges){return Arr.bind(ranges,function(range){var node=RangeNodes.getSelectedNode(range);return node ?[Element.fromDom(node)]:[];});};var hasMultipleRanges=function(selection){return getRanges(selection).length>1;};return{getRanges:getRanges,getSelectedNodes:getSelectedNodes,hasMultipleRanges:hasMultipleRanges};});define('tinymce.core.selection.TableCellSelection',['ephox.katamari.api.Arr','ephox.sugar.api.node.Element','ephox.sugar.api.search.SelectorFilter','tinymce.core.dom.ElementType','tinymce.core.selection.MultiRange'],function(Arr,Element,SelectorFilter,ElementType,MultiRange){var getCellsFromRanges=function(ranges){return Arr.filter(MultiRange.getSelectedNodes(ranges),ElementType.isTableCell);};var getCellsFromElement=function(elm){var selectedCells=SelectorFilter.descendants(elm,'td[data-mce-selected],th[data-mce-selected]');return selectedCells;};var getCellsFromElementOrRanges=function(ranges,element){var selectedCells=getCellsFromElement(element);var rangeCells=getCellsFromRanges(ranges);return selectedCells.length>0 ? selectedCells :rangeCells;};var getCellsFromEditor=function(editor){return getCellsFromElementOrRanges(MultiRange.getRanges(editor.selection.getSel()),Element.fromDom(editor.getBody()));};return{getCellsFromRanges:getCellsFromRanges,getCellsFromElement:getCellsFromElement,getCellsFromElementOrRanges:getCellsFromElementOrRanges,getCellsFromEditor:getCellsFromEditor};});define('tinymce.core.delete.TableDelete',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.delete.DeleteElement','tinymce.core.delete.TableDeleteAction','tinymce.core.dom.ElementType','tinymce.core.dom.Empty','tinymce.core.dom.PaddingBr','tinymce.core.dom.Parents','tinymce.core.selection.TableCellSelection'],function(Arr,Fun,Option,Compare,Element,Node,CaretFinder,CaretPosition,DeleteElement,TableDeleteAction,ElementType,Empty,PaddingBr,Parents,TableCellSelection){var emptyCells=function(editor,cells){Arr.each(cells,PaddingBr.fillWithPaddingBr);editor.selection.setCursorLocation(cells[0].dom(),0);return true;};var deleteTableElement=function(editor,table){DeleteElement.deleteElement(editor,false,table);return true;};var deleteCellRange=function(editor,rootElm,rng){return TableDeleteAction.getActionFromRange(rootElm,rng).map(function(action){return action.fold(Fun.curry(deleteTableElement,editor),Fun.curry(emptyCells,editor));});};var deleteCaptionRange=function(editor,caption){return emptyElement(editor,caption);};var deleteTableRange=function(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold(function(){return deleteCellRange(editor,rootElm,rng);},function(caption){return deleteCaptionRange(editor,caption);}).getOr(false);};var deleteRange=function(editor,startElm){var rootNode=Element.fromDom(editor.getBody());var rng=editor.selection.getRng();var selectedCells=TableCellSelection.getCellsFromEditor(editor);return selectedCells.length !==0 ? emptyCells(editor,selectedCells):deleteTableRange(editor,rootNode,rng,startElm);};var getParentCell=function(rootElm,elm){return Arr.find(Parents.parentsAndSelf(elm,rootElm),ElementType.isTableCell);};var getParentCaption=function(rootElm,elm){return Arr.find(Parents.parentsAndSelf(elm,rootElm),function(elm){return Node.name(elm)==='caption';});};var deleteBetweenCells=function(editor,rootElm,forward,fromCell,from){return CaretFinder.navigate(forward,editor.getBody(),from).bind(function(to){return getParentCell(rootElm,Element.fromDom(to.getNode())).map(function(toCell){return Compare.eq(toCell,fromCell)===false;});});};var emptyElement=function(editor,elm){PaddingBr.fillWithPaddingBr(elm);editor.selection.setCursorLocation(elm.dom(),0);return Option.some(true);};var isDeleteOfLastCharPos=function(fromCaption,forward,from,to){return CaretFinder.firstPositionIn(fromCaption.dom()).bind(function(first){return CaretFinder.lastPositionIn(fromCaption.dom()).map(function(last){return forward ? from.isEqual(first)&& to.isEqual(last):from.isEqual(last)&& to.isEqual(first);});}).getOr(true);};var emptyCaretCaption=function(editor,elm){return emptyElement(editor,elm);};var validateCaretCaption=function(rootElm,fromCaption,to){return getParentCaption(rootElm,Element.fromDom(to.getNode())).map(function(toCaption){return Compare.eq(toCaption,fromCaption)===false;});};var deleteCaretInsideCaption=function(editor,rootElm,forward,fromCaption,from){return CaretFinder.navigate(forward,editor.getBody(),from).bind(function(to){return isDeleteOfLastCharPos(fromCaption,forward,from,to)? emptyCaretCaption(editor,fromCaption):validateCaretCaption(rootElm,fromCaption,to);}).or(Option.some(true));};var deleteCaretCells=function(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind(function(fromCell){return Empty.isEmpty(fromCell)? emptyElement(editor,fromCell):deleteBetweenCells(editor,rootElm,forward,fromCell,from);});};var deleteCaretCaption=function(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return Empty.isEmpty(fromCaption)? emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from);};var deleteCaret=function(editor,forward,startElm){var rootElm=Element.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold(function(){return deleteCaretCells(editor,forward,rootElm,startElm);},function(fromCaption){return deleteCaretCaption(editor,forward,rootElm,fromCaption);}).getOr(false);};var backspaceDelete=function(editor,forward){var startElm=Element.fromDom(editor.selection.getStart(true));return editor.selection.isCollapsed()? deleteCaret(editor,forward,startElm):deleteRange(editor,startElm);};return{backspaceDelete:backspaceDelete};});define('tinymce.core.delete.DeleteCommands',['tinymce.core.delete.BlockBoundaryDelete','tinymce.core.delete.BlockRangeDelete','tinymce.core.delete.CefDelete','tinymce.core.delete.DeleteUtils','tinymce.core.delete.InlineBoundaryDelete','tinymce.core.delete.TableDelete'],function(BlockBoundaryDelete,BlockRangeDelete,CefDelete,DeleteUtils,BoundaryDelete,TableDelete){var nativeCommand=function(editor,command){editor.getDoc().execCommand(command,false,null);};var deleteCommand=function(editor){if(CefDelete.backspaceDelete(editor,false)){return;}else if(BoundaryDelete.backspaceDelete(editor,false)){return;}else if(BlockBoundaryDelete.backspaceDelete(editor,false)){return;}else if(TableDelete.backspaceDelete(editor)){return;}else if(BlockRangeDelete.backspaceDelete(editor,false)){return;}else{nativeCommand(editor,'Delete');DeleteUtils.paddEmptyBody(editor);}};var forwardDeleteCommand=function(editor){if(CefDelete.backspaceDelete(editor,true)){return;}else if(BoundaryDelete.backspaceDelete(editor,true)){return;}else if(BlockBoundaryDelete.backspaceDelete(editor,true)){return;}else if(TableDelete.backspaceDelete(editor)){return;}else if(BlockRangeDelete.backspaceDelete(editor,true)){return;}else{nativeCommand(editor,'ForwardDelete');}};return{deleteCommand:deleteCommand,forwardDeleteCommand:forwardDeleteCommand};});define('tinymce.core.selection.RangeCompare',[],function(){var isEq=function(rng1,rng2){return rng1 && rng2 &&(rng1.startContainer===rng2.startContainer && rng1.startOffset===rng2.startOffset)&&(rng1.endContainer===rng2.endContainer && rng1.endOffset===rng2.endOffset);};return{isEq:isEq};});define('tinymce.core.selection.NormalizeRange',['ephox.katamari.api.Option','ephox.katamari.api.Struct','tinymce.core.caret.CaretContainer','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker','tinymce.core.fmt.CaretFormat','tinymce.core.selection.RangeCompare'],function(Option,Struct,CaretContainer,NodeType,TreeWalker,CaretFormat,RangeCompare){var position=Struct.immutable('container','offset');var findParent=function(node,rootNode,predicate){while(node && node !==rootNode){if(predicate(node)){return node;}node=node.parentNode;}return null;};var hasParent=function(node,rootNode,predicate){return findParent(node,rootNode,predicate)!==null;};var hasParentWithName=function(node,rootNode,name){return hasParent(node,rootNode,function(node){return node.nodeName===name;});};var isTable=function(node){return node && node.nodeName==='TABLE';};var isTableCell=function(node){return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);};var isCeFalseCaretContainer=function(node,rootNode){return CaretContainer.isCaretContainer(node)&& hasParent(node,rootNode,CaretFormat.isCaretNode)===false;};var hasBrBeforeAfter=function(dom,node,left){var walker=new TreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());while((node=walker[left ? 'prev' :'next']())){if(NodeType.isBr(node)){return true;}}};var isPrevNode=function(node,name){return node.previousSibling && node.previousSibling.nodeName===name;};var hasContentEditableFalseParent=function(body,node){while(node && node !==body){if(NodeType.isContentEditableFalse(node)){return true;}node=node.parentNode;}return false;};var findTextNodeRelative=function(dom,isAfterNode,collapsed,left,startNode){var walker,lastInlineElement,parentBlockContainer,body=dom.getRoot(),node;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left && NodeType.isBr(startNode)&& isAfterNode && dom.isEmpty(parentBlockContainer)){return Option.some(position(startNode.parentNode,dom.nodeIndex(startNode)));}walker=new TreeWalker(startNode,parentBlockContainer);while((node=walker[left ? 'prev' :'next']())){if(dom.getContentEditableParent(node)==="false"||isCeFalseCaretContainer(node,body)){return Option.none();}if(NodeType.isText(node)&& node.nodeValue.length>0){if(hasParentWithName(node,body,'A')===false){return Option.some(position(node,left ? node.nodeValue.length :0));}return Option.none();}if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()]){return Option.none();}lastInlineElement=node;}if(collapsed && lastInlineElement){return Option.some(position(lastInlineElement,0));}return Option.none();};var normalizeEndPoint=function(dom,collapsed,start,rng){var container,offset,walker,body=dom.getRoot(),node,nonEmptyElementsMap;var directionLeft,isAfterNode,normalized=false;container=rng[(start ? 'start' :'end')+'Container'];offset=rng[(start ? 'start' :'end')+'Offset'];isAfterNode=NodeType.isElement(container)&& offset===container.childNodes.length;nonEmptyElementsMap=dom.schema.getNonEmptyElements();directionLeft=start;if(CaretContainer.isCaretContainer(container)){return Option.none();}if(NodeType.isElement(container)&& offset>container.childNodes.length-1){directionLeft=false;}if(NodeType.isDocument(container)){container=body;offset=0;}if(container===body){if(directionLeft){node=container.childNodes[offset>0 ? offset-1 :0];if(node){if(CaretContainer.isCaretContainer(node)){return Option.none();}if(nonEmptyElementsMap[node.nodeName]||isTable(node)){return Option.none();}}}if(container.hasChildNodes()){offset=Math.min(!directionLeft && offset>0 ? offset-1 :offset,container.childNodes.length-1);container=container.childNodes[offset];offset=NodeType.isText(container)&& isAfterNode ? container.data.length :0;if(!collapsed && container===body.lastChild && isTable(container)){return Option.none();}if(hasContentEditableFalseParent(body,container)||CaretContainer.isCaretContainer(container)){return Option.none();}if(container.hasChildNodes()&& isTable(container)===false){node=container;walker=new TreeWalker(container,body);do{if(NodeType.isContentEditableFalse(node)||CaretContainer.isCaretContainer(node)){normalized=false;break;}if(NodeType.isText(node)&& node.nodeValue.length>0){offset=directionLeft ? 0 :node.nodeValue.length;container=node;normalized=true;break;}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&& !isTableCell(node)){offset=dom.nodeIndex(node);container=node.parentNode;if((node.nodeName==='IMG'||node.nodeName==='PRE')&& !directionLeft){offset++;}normalized=true;break;}}while((node=(directionLeft ? walker.next():walker.prev())));}}}if(collapsed){if(NodeType.isText(container)&& offset===0){findTextNodeRelative(dom,isAfterNode,collapsed,true,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}if(NodeType.isElement(container)){node=container.childNodes[offset];if(!node){node=container.childNodes[offset-1];}if(node && NodeType.isBr(node)&& !isPrevNode(node,'A')&& !hasBrBeforeAfter(dom,node,false)&& !hasBrBeforeAfter(dom,node,true)){findTextNodeRelative(dom,isAfterNode,collapsed,true,node).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}}}if(directionLeft && !collapsed && NodeType.isText(container)&& offset===container.nodeValue.length){findTextNodeRelative(dom,isAfterNode,collapsed,false,container).each(function(pos){container=pos.container();offset=pos.offset();normalized=true;});}return normalized ? Option.some(position(container,offset)):Option.none();};var normalize=function(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange();normalizeEndPoint(dom,collapsed,true,normRng).each(function(pos){normRng.setStart(pos.container(),pos.offset());});if(!collapsed){normalizeEndPoint(dom,collapsed,false,normRng).each(function(pos){normRng.setEnd(pos.container(),pos.offset());});}if(collapsed){normRng.collapse(true);}return RangeCompare.isEq(rng,normRng)? Option.none():Option.some(normRng);};return{normalize:normalize};});define('tinymce.core.newline.InsertBr',['ephox.katamari.api.Fun','ephox.sugar.api.dom.Insert','ephox.sugar.api.node.Element','tinymce.core.caret.CaretFinder','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker','tinymce.core.keyboard.BoundaryLocation','tinymce.core.keyboard.InlineUtils','tinymce.core.selection.NormalizeRange'],function(Fun,Insert,Element,CaretFinder,CaretPosition,NodeType,TreeWalker,BoundaryLocation,InlineUtils,NormalizeRange){var hasRightSideContent=function(schema,container,parentBlock){var walker=new TreeWalker(container,parentBlock),node;var nonEmptyElementsMap=schema.getNonEmptyElements();while((node=walker.next())){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0){return true;}}};var scrollToBr=function(dom,selection,brElm){var marker=dom.create('span',{},'&nbsp;');brElm.parentNode.insertBefore(marker,brElm);selection.scrollIntoView(marker);dom.remove(marker);};var moveSelectionToBr=function(dom,selection,brElm,extraBr){var rng=dom.createRng();if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm);}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm);}selection.setRng(rng);};var insertBrAtCaret=function(editor,evt){var selection=editor.selection,dom=editor.dom;var brElm,extraBr;var rng=selection.getRng(true);NormalizeRange.normalize(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});var offset=rng.startOffset;var container=rng.startContainer;if(container.nodeType===1 && container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer && container.nodeType===3){offset=container.nodeValue.length;}else{offset=0;}}var parentBlock=dom.getParent(container,dom.isBlock);var containerBlock=parentBlock ? dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock ? containerBlock.nodeName.toUpperCase():'';var isControlKey=evt && evt.ctrlKey;if(containerBlockName==='LI' && !isControlKey){parentBlock=containerBlock;}if(container && container.nodeType===3 && offset>=container.nodeValue.length){if(!hasRightSideContent(editor.schema,container,parentBlock)){brElm=dom.create('br');rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true;}}brElm=dom.create('br');rng.insertNode(brElm);scrollToBr(dom,selection,brElm);moveSelectionToBr(dom,selection,brElm,extraBr);editor.undoManager.add();};var insertBrBefore=function(editor,inline){var br=Element.fromTag('br');Insert.before(Element.fromDom(inline),br);editor.undoManager.add();};var insertBrAfter=function(editor,inline){if(!hasBrAfter(editor.getBody(),inline)){Insert.after(Element.fromDom(inline),Element.fromTag('br'));}var br=Element.fromTag('br');Insert.after(Element.fromDom(inline),br);scrollToBr(editor.dom,editor.selection,br.dom());moveSelectionToBr(editor.dom,editor.selection,br.dom(),false);editor.undoManager.add();};var isBeforeBr=function(pos){return NodeType.isBr(pos.getNode());};var hasBrAfter=function(rootNode,startNode){if(isBeforeBr(CaretPosition.after(startNode))){return true;}else{return CaretFinder.nextPosition(rootNode,CaretPosition.after(startNode)).map(function(pos){return NodeType.isBr(pos.getNode());}).getOr(false);}};var isAnchorLink=function(elm){return elm && elm.nodeName==='A' && 'href' in elm;};var isInsideAnchor=function(location){return location.fold(Fun.constant(false),isAnchorLink,isAnchorLink,Fun.constant(false));};var readInlineAnchorLocation=function(editor){var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);var position=CaretPosition.fromRangeStart(editor.selection.getRng());return BoundaryLocation.readLocation(isInlineTarget,editor.getBody(),position).filter(isInsideAnchor);};var insertBrOutsideAnchor=function(editor,location){location.fold(Fun.noop,Fun.curry(insertBrBefore,editor),Fun.curry(insertBrAfter,editor),Fun.noop);};var insert=function(editor,evt){var anchorLocation=readInlineAnchorLocation(editor);if(anchorLocation.isSome()){anchorLocation.each(Fun.curry(insertBrOutsideAnchor,editor));}else{insertBrAtCaret(editor,evt);}};return{insert:insert};});define('ephox.sugar.api.selection.Situ',['ephox.katamari.api.Adt','ephox.katamari.api.Fun'],function(Adt,Fun){var adt=Adt.generate([{'before':['element']},{'on':['element','offset']},{after:['element']}]);var cata=function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter);};var getStart=function(situ){return situ.fold(Fun.identity,Fun.identity,Fun.identity)};return{before:adt.before,on:adt.on,after:adt.after,cata:cata,getStart:getStart};});define('ephox.sugar.api.selection.Selection',['ephox.katamari.api.Adt','ephox.katamari.api.Struct','ephox.sugar.api.node.Element','ephox.sugar.api.search.Traverse','ephox.sugar.api.selection.Situ'],function(Adt,Struct,Element,Traverse,Situ){var type=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var range=Struct.immutable('start','soffset','finish','foffset');var exactFromRange=function(simRange){return type.exact(simRange.start(),simRange.soffset(),simRange.finish(),simRange.foffset());};var getStart=function(selection){return selection.match({domRange:function(rng){return Element.fromDom(rng.startContainer);},relative:function(startSitu,finishSitu){return Situ.getStart(startSitu);},exact:function(start,soffset,finish,foffset){return start;}});};var getWin=function(selection){var start=getStart(selection);return Traverse.defaultView(start);};return{domRange:type.domRange,relative:type.relative,exact:type.exact,exactFromRange:exactFromRange,range:range,getWin:getWin};});define('tinymce.core.selection.SelectionBookmark',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sand.api.PlatformDetection','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.node.Text','ephox.sugar.api.search.Traverse','ephox.sugar.api.selection.Selection','global!document'],function(Fun,Option,PlatformDetection,Compare,Element,Node,Text,Traverse,Selection,document){var browser=PlatformDetection.detect().browser;var clamp=function(offset,element){var max=Node.isText(element)? Text.get(element).length :Traverse.children(element).length+1;if(offset>max){return max;}else if(offset<0){return 0;}return offset;};var normalizeRng=function(rng){return Selection.range(rng.start(),clamp(rng.soffset(),rng.start()),rng.finish(),clamp(rng.foffset(),rng.finish()));};var isOrContains=function(root,elm){return Compare.contains(root,elm)||Compare.eq(root,elm);};var isRngInRoot=function(root){return function(rng){return isOrContains(root,rng.start())&& isOrContains(root,rng.finish());};};var shouldStore=function(editor){return editor.inline===true||browser.isIE();};var nativeRangeToSelectionRange=function(r){return Selection.range(Element.fromDom(r.startContainer),r.startOffset,Element.fromDom(r.endContainer),r.endOffset);};var readRange=function(win){var selection=win.getSelection();var rng=!selection||selection.rangeCount===0 ? Option.none():Option.from(selection.getRangeAt(0));return rng.map(nativeRangeToSelectionRange);};var getBookmark=function(root){var win=Traverse.defaultView(root);return readRange(win.dom()).filter(isRngInRoot(root));};var validate=function(root,bookmark){return Option.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);};var bookmarkToNativeRng=function(bookmark){var rng=document.createRange();rng.setStart(bookmark.start().dom(),bookmark.soffset());rng.setEnd(bookmark.finish().dom(),bookmark.foffset());return Option.some(rng);};var store=function(editor){var newBookmark=shouldStore(editor)? getBookmark(Element.fromDom(editor.getBody())):Option.none();editor.bookmark=newBookmark.isSome()? newBookmark :editor.bookmark;};var storeNative=function(editor,rng){var root=Element.fromDom(editor.getBody());var range=shouldStore(editor)? Option.from(rng):Option.none();var newBookmark=range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=newBookmark.isSome()? newBookmark :editor.bookmark;};var getRng=function(editor){var bookmark=editor.bookmark ? editor.bookmark :Option.none();return bookmark .bind(Fun.curry(validate,Element.fromDom(editor.getBody()))).bind(bookmarkToNativeRng);};var restore=function(editor){getRng(editor).each(function(rng){editor.selection.setRng(rng);});};return{store:store,storeNative:storeNative,readRange:readRange,restore:restore,getRng:getRng,getBookmark:getBookmark,validate:validate};});define('tinymce.core.EditorCommands',['tinymce.core.Env','tinymce.core.InsertContent','tinymce.core.delete.DeleteCommands','tinymce.core.dom.NodeType','tinymce.core.newline.InsertBr','tinymce.core.selection.SelectionBookmark','tinymce.core.util.Tools'],function(Env,InsertContent,DeleteCommands,NodeType,InsertBr,SelectionBookmark,Tools){var each=Tools.each,extend=Tools.extend;var map=Tools.map,inArray=Tools.inArray,explode=Tools.explode;var TRUE=true,FALSE=false;return function(editor){var dom,selection,formatter,commands={state:{},exec:{},value:{}},settings=editor.settings,bookmark;editor.on('PreInit',function(){dom=editor.dom;selection=editor.selection;settings=editor.settings;formatter=editor.formatter;});var execCommand=function(command,ui,value,args){var func,customCommand,state=0;if(editor.removed){return;}if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)&&(!args||!args.skip_focus)){editor.focus();}else{SelectionBookmark.restore(editor);}args=editor.fire('BeforeExecCommand',{command:command,ui:ui,value:value});if(args.isDefaultPrevented()){return false;}customCommand=command.toLowerCase();if((func=commands.exec[customCommand])){func(customCommand,ui,value);editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}each(editor.plugins,function(p){if(p.execCommand && p.execCommand(command,ui,value)){editor.fire('ExecCommand',{command:command,ui:ui,value:value});state=true;return false;}});if(state){return state;}if(editor.theme && editor.theme.execCommand && editor.theme.execCommand(command,ui,value)){editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}try{state=editor.getDoc().execCommand(command,ui,value);}catch(ex){}if(state){editor.fire('ExecCommand',{command:command,ui:ui,value:value});return true;}return false;};var queryCommandState=function(command){var func;if(editor.quirks.isHidden()||editor.removed){return;}command=command.toLowerCase();if((func=commands.state[command])){return func(command);}try{return editor.getDoc().queryCommandState(command);}catch(ex){}return false;};var queryCommandValue=function(command){var func;if(editor.quirks.isHidden()||editor.removed){return;}command=command.toLowerCase();if((func=commands.value[command])){return func(command);}try{return editor.getDoc().queryCommandValue(command);}catch(ex){}};var addCommands=function(commandList,type){type=type||'exec';each(commandList,function(callback,command){each(command.toLowerCase().split(','),function(command){commands[type][command]=callback;});});};var addCommand=function(command,callback,scope){command=command.toLowerCase();commands.exec[command]=function(command,ui,value,args){return callback.call(scope||editor,ui,value,args);};};var queryCommandSupported=function(command){command=command.toLowerCase();if(commands.exec[command]){return true;}try{return editor.getDoc().queryCommandSupported(command);}catch(ex){}return false;};var addQueryStateHandler=function(command,callback,scope){command=command.toLowerCase();commands.state[command]=function(){return callback.call(scope||editor);};};var addQueryValueHandler=function(command,callback,scope){command=command.toLowerCase();commands.value[command]=function(){return callback.call(scope||editor);};};var hasCustomCommand=function(command){command=command.toLowerCase();return !!commands.exec[command];};extend(this,{execCommand:execCommand,queryCommandState:queryCommandState,queryCommandValue:queryCommandValue,queryCommandSupported:queryCommandSupported,addCommands:addCommands,addCommand:addCommand,addQueryStateHandler:addQueryStateHandler,addQueryValueHandler:addQueryValueHandler,hasCustomCommand:hasCustomCommand});var execNativeCommand=function(command,ui,value){if(ui===undefined){ui=FALSE;}if(value===undefined){value=null;}return editor.getDoc().execCommand(command,ui,value);};var isFormatMatch=function(name){return formatter.match(name);};var toggleFormat=function(name,value){formatter.toggle(name,value ?{value:value}:undefined);editor.nodeChanged();};var storeSelection=function(type){bookmark=selection.getBookmark(type);};var restoreSelection=function(){selection.moveToBookmark(bookmark);};addCommands({'mceResetDesignMode,mceBeginUndoLevel':function(){},'mceEndUndoLevel,mceAddUndoLevel':function(){editor.undoManager.add();},'Cut,Copy,Paste':function(command){var doc=editor.getDoc(),failed;try{execNativeCommand(command);}catch(ex){failed=TRUE;}if(command==='paste' && !doc.queryCommandEnabled(command)){failed=true;}if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. "+"Please use the Ctrl+X/C/V keyboard shortcuts instead.");if(Env.mac){msg=msg.replace(/Ctrl\+/g,'\u2318+');}editor.notificationManager.open({text:msg,type:'error'});}},unlink:function(){if(selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),'a');if(elm){editor.dom.remove(elm,true);}return;}formatter.remove("link");},'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone':function(command){var align=command.substring(7);if(align=='full'){align='justify';}each('left,center,right,justify'.split(','),function(name){if(align !=name){formatter.remove('align'+name);}});if(align !='none'){toggleFormat('align'+align);}},'InsertUnorderedList,InsertOrderedList':function(command){var listElm,listParent;execNativeCommand(command);listElm=dom.getParent(selection.getNode(),'ol,ul');if(listElm){listParent=listElm.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){storeSelection();dom.split(listParent,listElm);restoreSelection();}}},'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function(command){toggleFormat(command);},'ForeColor,HiliteColor,FontName':function(command,ui,value){toggleFormat(command,value);},FontSize:function(command,ui,value){var fontClasses,fontSizes;if(value>=1 && value<=7){fontSizes=explode(settings.font_size_style_values);fontClasses=explode(settings.font_size_classes);if(fontClasses){value=fontClasses[value-1]||value;}else{value=fontSizes[value-1]||value;}}toggleFormat(command,value);},RemoveFormat:function(command){formatter.remove(command);},mceBlockQuote:function(){toggleFormat('blockquote');},FormatBlock:function(command,ui,value){return toggleFormat(value||'p');},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:TRUE}),{cleanup:TRUE});selection.moveToBookmark(bookmark);},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();if(node !=editor.getBody()){storeSelection();editor.dom.remove(node,TRUE);restoreSelection();}},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(node.nodeType==1 && counter++==value){selection.select(node);return FALSE;}},editor.getBody());},mceSelectNode:function(command,ui,value){selection.select(value);},mceInsertContent:function(command,ui,value){InsertContent.insertAtCaret(editor,value);},mceInsertRawHTML:function(command,ui,value){selection.setContent('tiny_mce_marker');editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value;}));},mceToggleFormat:function(command,ui,value){toggleFormat(value);},mceSetContent:function(command,ui,value){editor.setContent(value);},'Indent,Outdent':function(command){var intentValue,indentUnit,value;intentValue=settings.indentation;indentUnit=/[a-z%]+$/i.exec(intentValue);intentValue=parseInt(intentValue,10);if(!queryCommandState('InsertUnorderedList')&& !queryCommandState('InsertOrderedList')){if(!settings.forced_root_block && !dom.getParent(selection.getNode(),dom.isBlock)){formatter.apply('div');}each(selection.getSelectedBlocks(),function(element){if(dom.getContentEditable(element)==="false"){return;}if(element.nodeName !=="LI"){var indentStyleName=editor.getParam('indent_use_margin',false)? 'margin' :'padding';indentStyleName=element.nodeName==='TABLE' ? 'margin' :indentStyleName;indentStyleName+=dom.getStyle(element,'direction',true)=='rtl' ? 'Right' :'Left';if(command=='outdent'){value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue);dom.setStyle(element,indentStyleName,value ? value+indentUnit :'');}else{value=(parseInt(element.style[indentStyleName]||0,10)+intentValue)+indentUnit;dom.setStyle(element,indentStyleName,value);}}});}else{execNativeCommand(command);}},mceRepaint:function(){},InsertHorizontalRule:function(){editor.execCommand('mceInsertContent',false,'<hr />');},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual;editor.addVisual();},mceReplaceContent:function(command,ui,value){editor.execCommand('mceInsertContent',false,value.replace(/\{\$selection\}/g,selection.getContent({format:'text'})));},mceInsertLink:function(command,ui,value){var anchor;if(typeof value=='string'){value={href:value};}anchor=dom.getParent(selection.getNode(),'a');value.href=value.href.replace(' ','%20');if(!anchor||!value.href){formatter.remove('link');}if(value.href){formatter.apply('link',value,anchor);}},selectAll:function(){var editingHost=dom.getParent(selection.getStart(),NodeType.isContentEditableTrue);if(editingHost){var rng=dom.createRng();rng.selectNodeContents(editingHost);selection.setRng(rng);}},"delete":function(){DeleteCommands.deleteCommand(editor);},"forwardDelete":function(){DeleteCommands.forwardDeleteCommand(editor);},mceNewDocument:function(){editor.setContent('');},InsertLineBreak:function(command,ui,value){InsertBr.insert(editor,value);return true;}});addCommands({'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull':function(command){var name='align'+command.substring(7);var nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks();var matches=map(nodes,function(node){return !!formatter.matchNode(node,name);});return inArray(matches,TRUE)!==-1;},'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function(command){return isFormatMatch(command);},mceBlockQuote:function(){return isFormatMatch('blockquote');},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&& parseInt(node.style.paddingLeft,10)>0){return TRUE;}if((node=dom.getParent(selection.getEnd(),dom.isBlock))&& parseInt(node.style.paddingLeft,10)>0){return TRUE;}}return(queryCommandState('InsertUnorderedList')||queryCommandState('InsertOrderedList')||(!settings.inline_styles && !!dom.getParent(selection.getNode(),'BLOCKQUOTE')));},'InsertUnorderedList,InsertOrderedList':function(command){var list=dom.getParent(selection.getNode(),'ul,ol');return list &&(command==='insertunorderedlist' && list.tagName==='UL'||command==='insertorderedlist' && list.tagName==='OL');}},'state');addCommands({'FontSize,FontName':function(command){var value=0,parent;if((parent=dom.getParent(selection.getNode(),'span'))){if(command=='fontsize'){value=parent.style.fontSize;}else{value=parent.style.fontFamily.replace(/, /g,',').replace(/[\'\"]/g,'').toLowerCase();}}return value;}},'value');addCommands({Undo:function(){editor.undoManager.undo();},Redo:function(){editor.undoManager.redo();}});};});define('tinymce.core.util.EventDispatcher',["tinymce.core.util.Tools"],function(Tools){var nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange "+"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover "+"draggesture dragdrop drop drag submit "+"compositionstart compositionend compositionupdate touchstart touchmove touchend",' ');var Dispatcher=function(settings){var self=this,scope,bindings={},toggleEvent;var returnFalse=function(){return false;};var returnTrue=function(){return true;};settings=settings||{};scope=settings.scope||self;toggleEvent=settings.toggleEvent||returnFalse;var fire=function(name,args){var handlers,i,l,callback;name=name.toLowerCase();args=args||{};args.type=name;if(!args.target){args.target=scope;}if(!args.preventDefault){args.preventDefault=function(){args.isDefaultPrevented=returnTrue;};args.stopPropagation=function(){args.isPropagationStopped=returnTrue;};args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=returnTrue;};args.isDefaultPrevented=returnFalse;args.isPropagationStopped=returnFalse;args.isImmediatePropagationStopped=returnFalse;}if(settings.beforeFire){settings.beforeFire(args);}handlers=bindings[name];if(handlers){for(i=0,l=handlers.length;i<l;i++){callback=handlers[i];if(callback.once){off(name,callback.func);}if(args.isImmediatePropagationStopped()){args.stopPropagation();return args;}if(callback.func.call(scope,args)===false){args.preventDefault();return args;}}}return args;};var on=function(name,callback,prepend,extra){var handlers,names,i;if(callback===false){callback=returnFalse;}if(callback){callback={func:callback};if(extra){Tools.extend(callback,extra);}names=name.toLowerCase().split(' ');i=names.length;while(i--){name=names[i];handlers=bindings[name];if(!handlers){handlers=bindings[name]=[];toggleEvent(name,true);}if(prepend){handlers.unshift(callback);}else{handlers.push(callback);}}}return self;};var off=function(name,callback){var i,handlers,bindingName,names,hi;if(name){names=name.toLowerCase().split(' ');i=names.length;while(i--){name=names[i];handlers=bindings[name];if(!name){for(bindingName in bindings){toggleEvent(bindingName,false);delete bindings[bindingName];}return self;}if(handlers){if(!callback){handlers.length=0;}else{hi=handlers.length;while(hi--){if(handlers[hi].func===callback){handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1));bindings[name]=handlers;}}}if(!handlers.length){toggleEvent(name,false);delete bindings[name];}}}}else{for(name in bindings){toggleEvent(name,false);}bindings={};}return self;};var once=function(name,callback,prepend){return on(name,callback,prepend,{once:true});};var has=function(name){name=name.toLowerCase();return !(!bindings[name]||bindings[name].length===0);};self.fire=fire;self.on=on;self.off=off;self.once=once;self.has=has;};Dispatcher.isNative=function(name){return !!nativeEvents[name.toLowerCase()];};return Dispatcher;});define('tinymce.core.util.Observable',["tinymce.core.util.EventDispatcher"],function(EventDispatcher){var getEventDispatcher=function(obj){if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){if(EventDispatcher.isNative(name)&& obj.toggleNativeEvent){obj.toggleNativeEvent(name,state);}}});}return obj._eventDispatcher;};return{fire:function(name,args,bubble){var self=this;if(self.removed && name !=="remove"){return args;}args=getEventDispatcher(self).fire(name,args,bubble);if(bubble !==false && self.parent){var parent=self.parent();while(parent && !args.isPropagationStopped()){parent.fire(name,args,false);parent=parent.parent();}}return args;},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend);},off:function(name,callback){return getEventDispatcher(this).off(name,callback);},once:function(name,callback){return getEventDispatcher(this).once(name,callback);},hasEventListeners:function(name){return getEventDispatcher(this).has(name);}};});define('tinymce.core.EditorObservable',["tinymce.core.util.Observable","tinymce.core.dom.DOMUtils","tinymce.core.util.Tools"],function(Observable,DOMUtils,Tools){var DOM=DOMUtils.DOM,customEventRootDelegates;var getEventTarget=function(editor,eventName){if(eventName=='selectionchange'){return editor.getDoc();}if(!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)){return editor.getDoc().documentElement;}if(editor.settings.event_root){if(!editor.eventRoot){editor.eventRoot=DOM.select(editor.settings.event_root)[0];}return editor.eventRoot;}return editor.getBody();};var bindEventDelegate=function(editor,eventName){var eventRootElm,delegate;var isListening=function(editor){return !editor.hidden && !editor.readonly;};if(!editor.delegates){editor.delegates={};}if(editor.delegates[eventName]||editor.removed){return;}eventRootElm=getEventTarget(editor,eventName);if(editor.settings.event_root){if(!customEventRootDelegates){customEventRootDelegates={};editor.editorManager.on('removeEditor',function(){var name;if(!editor.editorManager.activeEditor){if(customEventRootDelegates){for(name in customEventRootDelegates){editor.dom.unbind(getEventTarget(editor,name));}customEventRootDelegates=null;}}});}if(customEventRootDelegates[eventName]){return;}delegate=function(e){var target=e.target,editors=editor.editorManager.get(),i=editors.length;while(i--){var body=editors[i].getBody();if(body===target||DOM.isChildOf(target,body)){if(isListening(editors[i])){editors[i].fire(eventName,e);}}}};customEventRootDelegates[eventName]=delegate;DOM.bind(eventRootElm,eventName,delegate);}else{delegate=function(e){if(isListening(editor)){editor.fire(eventName,e);}};DOM.bind(eventRootElm,eventName,delegate);editor.delegates[eventName]=delegate;}};var EditorObservable={bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name);});},toggleNativeEvent:function(name,state){var self=this;if(name=="focus"||name=="blur"){return;}if(state){if(self.initialized){bindEventDelegate(self,name);}else{if(!self._pendingNativeEvents){self._pendingNativeEvents=[name];}else{self._pendingNativeEvents.push(name);}}}else if(self.initialized){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates[name];}},unbindAllNativeEvents:function(){var self=this,name;if(self.delegates){for(name in self.delegates){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);}delete self.delegates;}if(!self.inline){self.getBody().onload=null;self.dom.unbind(self.getWin());self.dom.unbind(self.getDoc());}self.dom.unbind(self.getBody());self.dom.unbind(self.getContainer());}};EditorObservable=Tools.extend({},Observable,EditorObservable);return EditorObservable;});define('tinymce.core.Mode',[],function(){var setEditorCommandState=function(editor,cmd,state){try{editor.getDoc().execCommand(cmd,false,state);}catch(ex){}};var clickBlocker=function(editor){var target,handler;target=editor.getBody();handler=function(e){if(editor.dom.getParents(e.target,'a').length>0){e.preventDefault();}};editor.dom.bind(target,'click',handler);return{unbind:function(){editor.dom.unbind(target,'click',handler);}};};var toggleReadOnly=function(editor,state){if(editor._clickBlocker){editor._clickBlocker.unbind();editor._clickBlocker=null;}if(state){editor._clickBlocker=clickBlocker(editor);editor.selection.controlSelection.hideResizeRect();editor.readonly=true;editor.getBody().contentEditable=false;}else{editor.readonly=false;editor.getBody().contentEditable=true;setEditorCommandState(editor,"StyleWithCSS",false);setEditorCommandState(editor,"enableInlineTableEditing",false);setEditorCommandState(editor,"enableObjectResizing",false);editor.focus();editor.nodeChanged();}};var setMode=function(editor,mode){var currentMode=editor.readonly ? 'readonly' :'design';if(mode==currentMode){return;}if(editor.initialized){toggleReadOnly(editor,mode=='readonly');}else{editor.on('init',function(){toggleReadOnly(editor,mode=='readonly');});}editor.fire('SwitchMode',{mode:mode});};return{setMode:setMode};});define('tinymce.core.Shortcuts',['tinymce.core.util.Tools','tinymce.core.Env'],function(Tools,Env){var each=Tools.each,explode=Tools.explode;var keyCodeLookup={"f9":120,"f10":121,"f11":122};var modifierNames=Tools.makeMap('alt,ctrl,shift,meta,access');return function(editor){var self=this,shortcuts={},pendingPatterns=[];var parseShortcut=function(pattern){var id,key,shortcut={};each(explode(pattern,'+'),function(value){if(value in modifierNames){shortcut[value]=true;}else{if(/^[0-9]{2,}$/.test(value)){shortcut.keyCode=parseInt(value,10);}else{shortcut.charCode=value.charCodeAt(0);shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0);}}});id=[shortcut.keyCode];for(key in modifierNames){if(shortcut[key]){id.push(key);}else{shortcut[key]=false;}}shortcut.id=id.join(',');if(shortcut.access){shortcut.alt=true;if(Env.mac){shortcut.ctrl=true;}else{shortcut.shift=true;}}if(shortcut.meta){if(Env.mac){shortcut.meta=true;}else{shortcut.ctrl=true;shortcut.meta=false;}}return shortcut;};var createShortcut=function(pattern,desc,cmdFunc,scope){var shortcuts;shortcuts=Tools.map(explode(pattern,'>'),parseShortcut);shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||editor});return Tools.extend(shortcuts[0],{desc:editor.translate(desc),subpatterns:shortcuts.slice(1)});};var hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey;};var isFunctionKey=function(e){return e.type==="keydown" && e.keyCode>=112 && e.keyCode<=123;};var matchShortcut=function(e,shortcut){if(!shortcut){return false;}if(shortcut.ctrl !=e.ctrlKey||shortcut.meta !=e.metaKey){return false;}if(shortcut.alt !=e.altKey||shortcut.shift !=e.shiftKey){return false;}if(e.keyCode==shortcut.keyCode||(e.charCode && e.charCode==shortcut.charCode)){e.preventDefault();return true;}return false;};var executeShortcutAction=function(shortcut){return shortcut.func ? shortcut.func.call(shortcut.scope):null;};editor.on('keyup keypress keydown',function(e){if((hasModifier(e)||isFunctionKey(e))&& !e.isDefaultPrevented()){each(shortcuts,function(shortcut){if(matchShortcut(e,shortcut)){pendingPatterns=shortcut.subpatterns.slice(0);if(e.type=="keydown"){executeShortcutAction(shortcut);}return true;}});if(matchShortcut(e,pendingPatterns[0])){if(pendingPatterns.length===1){if(e.type=="keydown"){executeShortcutAction(pendingPatterns[0]);}}pendingPatterns.shift();}}});self.add=function(pattern,desc,cmdFunc,scope){var cmd;cmd=cmdFunc;if(typeof cmdFunc==='string'){cmdFunc=function(){editor.execCommand(cmd,false,null);};}else if(Tools.isArray(cmd)){cmdFunc=function(){editor.execCommand(cmd[0],cmd[1],cmd[2]);};}each(explode(Tools.trim(pattern.toLowerCase())),function(pattern){var shortcut=createShortcut(pattern,desc,cmdFunc,scope);shortcuts[shortcut.id]=shortcut;});return true;};self.remove=function(pattern){var shortcut=createShortcut(pattern);if(shortcuts[shortcut.id]){delete shortcuts[shortcut.id];return true;}return false;};};});define('tinymce.core.html.SaxParser',["tinymce.core.html.Schema","tinymce.core.html.Entities","tinymce.core.util.Tools"],function(Schema,Entities,Tools){var each=Tools.each;var isValidPrefixAttrName=function(name){return name.indexOf('data-')===0||name.indexOf('aria-')===0;};var trimComments=function(text){return text.replace(/<!--|-->/g,'');};var findEndTag=function(schema,html,startIndex){var count=1,index,matches,tokenRegExp,shortEndedElements;shortEndedElements=schema.getShortEndedElements();tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g;tokenRegExp.lastIndex=index=startIndex;while((matches=tokenRegExp.exec(html))){index=tokenRegExp.lastIndex;if(matches[1]==='/'){count--;}else if(!matches[1]){if(matches[2]in shortEndedElements){continue;}count++;}if(count===0){break;}}return index;};var SaxParser=function(settings,schema){var self=this;var noop=function(){};settings=settings||{};self.schema=schema=schema||new Schema();if(settings.fix_self_closing !==false){settings.fix_self_closing=true;}each('comment cdata text start end pi doctype'.split(' '),function(name){if(name){self[name]=settings[name]||noop;}});self.parse=function(html){var self=this,matches,index=0,value,endRegExp,stack=[],attrList,i,text,name;var isInternalElement,removeInternalElements,shortEndedElements,fillAttrsMap,isShortEnded;var validate,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns;var attributesRequired,attributesDefault,attributesForced,processHtml;var anyAttributesRequired,selfClosing,tokenRegExp,attrRegExp,specialElements,attrValue,idCount=0;var decode=Entities.decode,fixSelfClosing,filteredUrlAttrs=Tools.makeMap('src,href,data,background,formaction,poster');var scriptUriRegExp=/((java|vb)script|mhtml):/i,dataUriRegExp=/^data:/i;var processEndTag=function(name){var pos,i;pos=stack.length;while(pos--){if(stack[pos].name===name){break;}}if(pos>=0){for(i=stack.length-1;i>=pos;i--){name=stack[i];if(name.valid){self.end(name.name);}}stack.length=pos;}};var parseAttribute=function(match,name,value,val2,val3){var attrRule,i,trimRegExp=/[\s\u0000-\u001F]+/g;name=name.toLowerCase();value=name in fillAttrsMap ? name :decode(value||val2||val3||'');if(validate && !isInternalElement && isValidPrefixAttrName(name)===false){attrRule=validAttributesMap[name];if(!attrRule && validAttributePatterns){i=validAttributePatterns.length;while(i--){attrRule=validAttributePatterns[i];if(attrRule.pattern.test(name)){break;}}if(i===-1){attrRule=null;}}if(!attrRule){return;}if(attrRule.validValues && !(value in attrRule.validValues)){return;}}if(filteredUrlAttrs[name]&& !settings.allow_script_urls){var uri=value.replace(trimRegExp,'');try{uri=decodeURIComponent(uri);}catch(ex){uri=unescape(uri);}if(scriptUriRegExp.test(uri)){return;}if(!settings.allow_html_data_urls && dataUriRegExp.test(uri)&& !/^data:image\//i.test(uri)){return;}}if(isInternalElement &&(name in filteredUrlAttrs||name.indexOf('on')===0)){return;}attrList.map[name]=value;attrList.push({name:name,value:value});};tokenRegExp=new RegExp('<(?:'+'(?:!--([\\w\\W]*?)-->)|'+'(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|'+'(?:!DOCTYPE([\\w\\W]*?)>)|'+'(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|'+'(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|'+'(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\\/|\\s+)>)'+')','g');attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g;shortEndedElements=schema.getShortEndedElements();selfClosing=settings.self_closing_elements||schema.getSelfClosingElements();fillAttrsMap=schema.getBoolAttrs();validate=settings.validate;removeInternalElements=settings.remove_internals;fixSelfClosing=settings.fix_self_closing;specialElements=schema.getSpecialElements();processHtml=html+'>';while((matches=tokenRegExp.exec(processHtml))){if(index<matches.index){self.text(decode(html.substr(index,matches.index-index)));}if((value=matches[6])){value=value.toLowerCase();if(value.charAt(0)===':'){value=value.substr(1);}processEndTag(value);}else if((value=matches[7])){if(matches.index+matches[0].length>html.length){self.text(decode(html.substr(matches.index)));index=matches.index+matches[0].length;continue;}value=value.toLowerCase();if(value.charAt(0)===':'){value=value.substr(1);}isShortEnded=value in shortEndedElements;if(fixSelfClosing && selfClosing[value]&& stack.length>0 && stack[stack.length-1].name===value){processEndTag(value);}if(!validate||(elementRule=schema.getElementRule(value))){isValidElement=true;if(validate){validAttributesMap=elementRule.attributes;validAttributePatterns=elementRule.attributePatterns;}if((attribsValue=matches[8])){isInternalElement=attribsValue.indexOf('data-mce-type')!==-1;if(isInternalElement && removeInternalElements){isValidElement=false;}attrList=[];attrList.map={};attribsValue.replace(attrRegExp,parseAttribute);}else{attrList=[];attrList.map={};}if(validate && !isInternalElement){attributesRequired=elementRule.attributesRequired;attributesDefault=elementRule.attributesDefault;attributesForced=elementRule.attributesForced;anyAttributesRequired=elementRule.removeEmptyAttrs;if(anyAttributesRequired && !attrList.length){isValidElement=false;}if(attributesForced){i=attributesForced.length;while(i--){attr=attributesForced[i];name=attr.name;attrValue=attr.value;if(attrValue==='{$uid}'){attrValue='mce_'+idCount++;}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue});}}if(attributesDefault){i=attributesDefault.length;while(i--){attr=attributesDefault[i];name=attr.name;if(!(name in attrList.map)){attrValue=attr.value;if(attrValue==='{$uid}'){attrValue='mce_'+idCount++;}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue});}}}if(attributesRequired){i=attributesRequired.length;while(i--){if(attributesRequired[i]in attrList.map){break;}}if(i===-1){isValidElement=false;}}if((attr=attrList.map['data-mce-bogus'])){if(attr==='all'){index=findEndTag(schema,html,tokenRegExp.lastIndex);tokenRegExp.lastIndex=index;continue;}isValidElement=false;}}if(isValidElement){self.start(value,attrList,isShortEnded);}}else{isValidElement=false;}if((endRegExp=specialElements[value])){endRegExp.lastIndex=index=matches.index+matches[0].length;if((matches=endRegExp.exec(html))){if(isValidElement){text=html.substr(index,matches.index-index);}index=matches.index+matches[0].length;}else{text=html.substr(index);index=html.length;}if(isValidElement){if(text.length>0){self.text(text,true);}self.end(value);}tokenRegExp.lastIndex=index;continue;}if(!isShortEnded){if(!attribsValue||attribsValue.indexOf('/')!=attribsValue.length-1){stack.push({name:value,valid:isValidElement});}else if(isValidElement){self.end(value);}}}else if((value=matches[1])){if(value.charAt(0)==='>'){value=' '+value;}if(!settings.allow_conditional_comments && value.substr(0,3).toLowerCase()==='[if'){value=' '+value;}self.comment(value);}else if((value=matches[2])){self.cdata(trimComments(value));}else if((value=matches[3])){self.doctype(value);}else if((value=matches[4])){self.pi(value,matches[5]);}index=matches.index+matches[0].length;}if(index<html.length){self.text(decode(html.substr(index)));}for(i=stack.length-1;i>=0;i--){value=stack[i];if(value.valid){self.end(value.name);}}};};SaxParser.findEndTag=findEndTag;return SaxParser;});define('tinymce.core.dom.TrimHtml',['tinymce.core.html.SaxParser','tinymce.core.text.Zwsp'],function(SaxParser,Zwsp){var trimHtml=function(tempAttrs,html){var trimContentRegExp=new RegExp(['\\s?('+tempAttrs.join('|')+')="[^"]+"'].join('|'),'gi');return html.replace(trimContentRegExp,'');};var trimInternal=function(serializer,html){var content=html;var bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g;var endTagIndex,index,matchLength,matches,shortEndedElements;var schema=serializer.schema;content=trimHtml(serializer.getTempAttrs(),content);shortEndedElements=schema.getShortEndedElements();while((matches=bogusAllRegExp.exec(content))){index=bogusAllRegExp.lastIndex;matchLength=matches[0].length;if(shortEndedElements[matches[1]]){endTagIndex=index;}else{endTagIndex=SaxParser.findEndTag(schema,content,index);}content=content.substring(0,index-matchLength)+content.substring(endTagIndex);bogusAllRegExp.lastIndex=index-matchLength;}return content;};var trimExternal=function(serializer,html){return Zwsp.trim(trimInternal(serializer,html));};return{trimExternal:trimExternal,trimInternal:trimInternal};});define('ephox.sugar.api.search.PredicateExists',['ephox.sugar.api.search.PredicateFind'],function(PredicateFind){var any=function(predicate){return PredicateFind.first(predicate).isSome();};var ancestor=function(scope,predicate,isRoot){return PredicateFind.ancestor(scope,predicate,isRoot).isSome();};var closest=function(scope,predicate,isRoot){return PredicateFind.closest(scope,predicate,isRoot).isSome();};var sibling=function(scope,predicate){return PredicateFind.sibling(scope,predicate).isSome();};var child=function(scope,predicate){return PredicateFind.child(scope,predicate).isSome();};var descendant=function(scope,predicate){return PredicateFind.descendant(scope,predicate).isSome();};return{any:any,ancestor:ancestor,closest:closest,sibling:sibling,child:child,descendant:descendant};});define('ephox.sugar.api.dom.Focus',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.search.PredicateExists','ephox.sugar.api.search.Traverse','global!document'],function(Fun,Option,Compare,Element,PredicateExists,Traverse,document){var focus=function(element){element.dom().focus();};var blur=function(element){element.dom().blur();};var hasFocus=function(element){var doc=Traverse.owner(element).dom();return element.dom()===doc.activeElement;};var active=function(_doc){var doc=_doc !==undefined ? _doc.dom():document;return Option.from(doc.activeElement).map(Element.fromDom);};var focusInside=function(element){var doc=Traverse.owner(element);var inside=active(doc).filter(function(a){return PredicateExists.closest(a,Fun.curry(Compare.eq,element));});inside.fold(function(){focus(element);},Fun.noop);};var search=function(element){return active(Traverse.owner(element)).filter(function(e){return element.dom().contains(e.dom());});};return{hasFocus:hasFocus,focus:focus,blur:blur,active:active,search:search,focusInside:focusInside};});define('tinymce.core.focus.EditorFocus',['ephox.katamari.api.Option','ephox.sugar.api.dom.Compare','ephox.sugar.api.dom.Focus','ephox.sugar.api.node.Element','tinymce.core.Env','tinymce.core.caret.CaretFinder','tinymce.core.dom.ElementType','tinymce.core.selection.RangeNodes','tinymce.core.selection.SelectionBookmark'],function(Option,Compare,Focus,Element,Env,CaretFinder,ElementType,RangeNodes,SelectionBookmark){var getContentEditableHost=function(editor,node){return editor.dom.getParent(node,function(node){return editor.dom.getContentEditable(node)==="true";});};var getCollapsedNode=function(rng){return rng.collapsed ? Option.from(RangeNodes.getNode(rng.startContainer,rng.startOffset)).map(Element.fromDom):Option.none();};var getFocusInElement=function(root,rng){return getCollapsedNode(rng).bind(function(node){if(ElementType.isTableSection(node)){return Option.some(node);}else if(Compare.contains(root,node)===false){return Option.some(root);}else{return Option.none();}});};var normalizeSelection=function(editor,rng){getFocusInElement(Element.fromDom(editor.getBody()),rng).bind(function(elm){return CaretFinder.firstPositionIn(elm.dom());}).fold(function(){editor.selection.normalize();},function(caretPos){editor.selection.setRng(caretPos.toRange());});};var focusBody=function(body){if(body.setActive){try{body.setActive();}catch(ex){body.focus();}}else{body.focus();}};var hasElementFocus=function(elm){return Focus.hasFocus(elm)||Focus.search(elm).isSome();};var hasIframeFocus=function(editor){return editor.iframeElement && Focus.hasFocus(Element.fromDom(editor.iframeElement));};var hasInlineFocus=function(editor){var rawBody=editor.getBody();return rawBody && hasElementFocus(Element.fromDom(rawBody));};var hasFocus=function(editor){return editor.inline ? hasInlineFocus(editor):hasIframeFocus(editor);};var focusEditor=function(editor){var selection=editor.selection,contentEditable=editor.settings.content_editable;var body=editor.getBody(),contentEditableHost,rng=selection.getRng();editor.quirks.refreshContentEditable();contentEditableHost=getContentEditableHost(editor,selection.getNode());if(editor.$.contains(body,contentEditableHost)){focusBody(contentEditableHost);normalizeSelection(editor,rng);activateEditor(editor);return;}if(editor.bookmark !==undefined && hasFocus(editor)===false){SelectionBookmark.getRng(editor).each(function(bookmarkRng){editor.selection.setRng(bookmarkRng);rng=bookmarkRng;});}if(!contentEditable){if(!Env.opera){focusBody(body);}editor.getWin().focus();}if(Env.gecko||contentEditable){focusBody(body);normalizeSelection(editor,rng);}activateEditor(editor);};var activateEditor=function(editor){editor.editorManager.setActive(editor);};var focus=function(editor,skipFocus){if(editor.removed){return;}skipFocus ? activateEditor(editor):focusEditor(editor);};return{focus:focus,hasFocus:hasFocus};});define('tinymce.core.EditorView',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.properties.Css','ephox.sugar.api.search.Traverse'],function(Fun,Option,Compare,Element,Css,Traverse){var getProp=function(propName,elm){var rawElm=elm.dom();return rawElm[propName];};var getComputedSizeProp=function(propName,elm){return parseInt(Css.get(elm,propName),10);};var getClientWidth=Fun.curry(getProp,'clientWidth');var getClientHeight=Fun.curry(getProp,'clientHeight');var getMarginTop=Fun.curry(getComputedSizeProp,'margin-top');var getMarginLeft=Fun.curry(getComputedSizeProp,'margin-left');var getBoundingClientRect=function(elm){return elm.dom().getBoundingClientRect();};var isInsideElementContentArea=function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm);var clientHeight=getClientHeight(bodyElm);return clientX>=0 && clientY>=0 && clientX<=clientWidth && clientY<=clientHeight;};var transpose=function(inline,elm,clientX,clientY){var clientRect=getBoundingClientRect(elm);var deltaX=inline ? clientRect.left+elm.dom().clientLeft+getMarginLeft(elm):0;var deltaY=inline ? clientRect.top+elm.dom().clientTop+getMarginTop(elm):0;var x=clientX-deltaX;var y=clientY-deltaY;return{x:x,y:y};};var isXYInContentArea=function(editor,clientX,clientY){var bodyElm=Element.fromDom(editor.getBody());var targetElm=editor.inline ? bodyElm :Traverse.documentElement(bodyElm);var transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y);};var fromDomSafe=function(node){return Option.from(node).map(Element.fromDom);};var isEditorAttachedToDom=function(editor){var rawContainer=editor.inline ? editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(function(container){return Compare.contains(Traverse.owner(container),container);}).getOr(false);};return{isXYInContentArea:isXYInContentArea,isEditorAttachedToDom:isEditorAttachedToDom};});define('tinymce.core.ui.NotificationManagerImpl',[],function(){return function(){var unimplemented=function(){throw new Error('Theme did not provide a NotificationManager implementation.');};return{open:unimplemented,close:unimplemented,reposition:unimplemented,getArgs:unimplemented};};});define('tinymce.core.api.NotificationManager',['ephox.katamari.api.Arr','ephox.katamari.api.Option','tinymce.core.EditorView','tinymce.core.ui.NotificationManagerImpl','tinymce.core.util.Delay'],function(Arr,Option,EditorView,NotificationManagerImpl,Delay){return function(editor){var notifications=[];var getImplementation=function(){var theme=editor.theme;return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl():NotificationManagerImpl();};var getTopNotification=function(){return Option.from(notifications[0]);};var isEqual=function(a,b){return a.type===b.type && a.text===b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;};var reposition=function(){if(notifications.length>0){getImplementation().reposition(notifications);}};var addNotification=function(notification){notifications.push(notification);};var closeNotification=function(notification){Arr.findIndex(notifications,function(otherNotification){return otherNotification===notification;}).each(function(index){notifications.splice(index,1);});};var open=function(args){if(editor.removed||!EditorView.isEditorAttachedToDom(editor)){return;}return Arr.find(notifications,function(notification){return isEqual(getImplementation().getArgs(notification),args);}).getOrThunk(function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(args,function(){closeNotification(notification);reposition();});addNotification(notification);reposition();return notification;});};var close=function(){getTopNotification().each(function(notification){getImplementation().close(notification);closeNotification(notification);reposition();});};var getNotifications=function(){return notifications;};var registerEvents=function(editor){editor.on('SkinLoaded',function(){var serviceMessage=editor.settings.service_message;if(serviceMessage){open({text:serviceMessage,type:'warning',timeout:0,icon:''});}});editor.on('ResizeEditor ResizeWindow',function(){Delay.requestAnimationFrame(reposition);});editor.on('remove',function(){Arr.each(notifications,function(notification){getImplementation().close(notification);});});};registerEvents(editor);return{open:open,close:close,getNotifications:getNotifications};};});define('tinymce.core.ui.WindowManagerImpl',[],function(){return function(){var unimplemented=function(){throw new Error('Theme did not provide a WindowManager implementation.');};return{open:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented};};});define('tinymce.core.api.WindowManager',['ephox.katamari.api.Arr','ephox.katamari.api.Option','tinymce.core.selection.SelectionBookmark','tinymce.core.ui.WindowManagerImpl'],function(Arr,Option,SelectionBookmark,WindowManagerImpl){return function(editor){var windows=[];var getImplementation=function(){var theme=editor.theme;return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl():WindowManagerImpl();};var funcBind=function(scope,f){return function(){return f ? f.apply(scope,arguments):undefined;};};var fireOpenEvent=function(win){editor.fire('OpenWindow',{win:win});};var fireCloseEvent=function(win){editor.fire('CloseWindow',{win:win});};var addWindow=function(win){windows.push(win);fireOpenEvent(win);};var closeWindow=function(win){Arr.findIndex(windows,function(otherWindow){return otherWindow===win;}).each(function(index){windows.splice(index,1);fireCloseEvent(win);if(windows.length===0){editor.focus();}});};var getTopWindow=function(){return Option.from(windows[windows.length-1]);};var open=function(args,params){editor.editorManager.setActive(editor);SelectionBookmark.store(editor);var win=getImplementation().open(args,params,closeWindow);addWindow(win);return win;};var alert=function(message,callback,scope){var win=getImplementation().alert(message,funcBind(scope ? scope :this,callback),closeWindow);addWindow(win);};var confirm=function(message,callback,scope){var win=getImplementation().confirm(message,funcBind(scope ? scope :this,callback),closeWindow);addWindow(win);};var close=function(){getTopWindow().each(function(win){getImplementation().close(win);closeWindow(win);});};var getParams=function(){return getTopWindow().map(getImplementation().getParams).getOr(null);};var setParams=function(params){getTopWindow().each(function(win){getImplementation().setParams(win,params);});};var getWindows=function(){return windows;};editor.on('remove',function(){Arr.each(windows.slice(0),function(win){getImplementation().close(win);});});return{windows:windows,open:open,alert:alert,confirm:confirm,close:close,getParams:getParams,setParams:setParams,getWindows:getWindows};};});define('tinymce.core.ErrorReporter',['global!window','tinymce.core.AddOnManager'],function(window,AddOnManager){var PluginManager=AddOnManager.PluginManager;var resolvePluginName=function(targetUrl,suffix){for(var name in PluginManager.urls){var matchUrl=PluginManager.urls[name]+'/plugin'+suffix+'.js';if(matchUrl===targetUrl){return name;}}return null;};var pluginUrlToMessage=function(editor,url){var plugin=resolvePluginName(url,editor.suffix);return plugin ? 'Failed to load plugin: '+plugin+' from url '+url :'Failed to load plugin url: '+url;};var displayNotification=function(editor,message){editor.notificationManager.open({type:'error',text:message});};var displayError=function(editor,message){if(editor._skinLoaded){displayNotification(editor,message);}else{editor.on('SkinLoaded',function(){displayNotification(editor,message);});}};var uploadError=function(editor,message){displayError(editor,'Failed to upload image: '+message);};var pluginLoadError=function(editor,url){displayError(editor,pluginUrlToMessage(editor,url));};var initError=function(message){var console=window.console;if(console && !window.test){if(console.error){console.error.apply(console,arguments);}else{console.log.apply(console,arguments);}}};return{pluginLoadError:pluginLoadError,uploadError:uploadError,displayError:displayError,initError:initError};});define('tinymce.core.PluginManager',['tinymce.core.AddOnManager'],function(AddOnManager){return AddOnManager.PluginManager;});define('tinymce.core.ThemeManager',['tinymce.core.AddOnManager'],function(AddOnManager){return AddOnManager.ThemeManager;});define('ephox.sand.api.XMLHttpRequest',['ephox.sand.util.Global'],function(Global){return function(){var f=Global.getOrDie('XMLHttpRequest');return new f();};});define('tinymce.core.file.Uploader',['ephox.sand.api.XMLHttpRequest','global!window','tinymce.core.util.Fun','tinymce.core.util.Promise','tinymce.core.util.Tools'],function(XMLHttpRequest,window,Fun,Promise,Tools){return function(uploadStatus,settings){var pendingPromises={};var pathJoin=function(path1,path2){if(path1){return path1.replace(/\/$/,'')+'/'+path2.replace(/^\//,'');}return path2;};var defaultHandler=function(blobInfo,success,failure,progress){var xhr,formData;xhr=new XMLHttpRequest();xhr.open('POST',settings.url);xhr.withCredentials=settings.credentials;xhr.upload.onprogress=function(e){progress(e.loaded / e.total*100);};xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status);};xhr.onload=function(){var json;if(xhr.status<200||xhr.status>=300){failure("HTTP Error: "+xhr.status);return;}json=JSON.parse(xhr.responseText);if(!json||typeof json.location !="string"){failure("Invalid JSON: "+xhr.responseText);return;}success(pathJoin(settings.basePath,json.location));};formData=new window.FormData();formData.append('file',blobInfo.blob(),blobInfo.filename());xhr.send(formData);};var noUpload=function(){return new Promise(function(resolve){resolve([]);});};var handlerSuccess=function(blobInfo,url){return{url:url,blobInfo:blobInfo,status:true};};var handlerFailure=function(blobInfo,error){return{url:'',blobInfo:blobInfo,status:false,error:error};};var resolvePending=function(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result);});delete pendingPromises[blobUri];};var uploadBlobInfo=function(blobInfo,handler,openNotification){uploadStatus.markPending(blobInfo.blobUri());return new Promise(function(resolve){var notification,progress;var noop=function(){};try{var closeNotification=function(){if(notification){notification.close();progress=noop;}};var success=function(url){closeNotification();uploadStatus.markUploaded(blobInfo.blobUri(),url);resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url));resolve(handlerSuccess(blobInfo,url));};var failure=function(error){closeNotification();uploadStatus.removeFailed(blobInfo.blobUri());resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error));resolve(handlerFailure(blobInfo,error));};progress=function(percent){if(percent<0||percent>100){return;}if(!notification){notification=openNotification();}notification.progressBar.value(percent);};handler(blobInfo,success,failure,progress);}catch(ex){resolve(handlerFailure(blobInfo,ex.message));}});};var isDefaultHandler=function(handler){return handler===defaultHandler;};var pendingUploadBlobInfo=function(blobInfo){var blobUri=blobInfo.blobUri();return new Promise(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[];pendingPromises[blobUri].push(resolve);});};var uploadBlobs=function(blobInfos,openNotification){blobInfos=Tools.grep(blobInfos,function(blobInfo){return !uploadStatus.isUploaded(blobInfo.blobUri());});return Promise.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())? pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification);}));};var upload=function(blobInfos,openNotification){return(!settings.url && isDefaultHandler(settings.handler))? noUpload():uploadBlobs(blobInfos,openNotification);};settings=Tools.extend({credentials:false,handler:defaultHandler},settings);return{upload:upload};};});define('ephox.sand.api.Blob',['ephox.sand.util.Global'],function(Global){return function(parts,properties){var f=Global.getOrDie('Blob');return new f(parts,properties);};});define('ephox.sand.api.FileReader',['ephox.sand.util.Global'],function(Global){return function(){var f=Global.getOrDie('FileReader');return new f();};});define('ephox.sand.api.Uint8Array',['ephox.sand.util.Global'],function(Global){return function(arr){var f=Global.getOrDie('Uint8Array');return new f(arr);};});define('ephox.sand.api.Window',['ephox.sand.util.Global'],function(Global){var requestAnimationFrame=function(callback){var f=Global.getOrDie('requestAnimationFrame');f(callback);};var atob=function(base64){var f=Global.getOrDie('atob');return f(base64);};return{atob:atob,requestAnimationFrame:requestAnimationFrame};});define('tinymce.core.file.Conversions',['ephox.sand.api.Blob','ephox.sand.api.FileReader','ephox.sand.api.Uint8Array','ephox.sand.api.Window','ephox.sand.api.XMLHttpRequest','tinymce.core.util.Promise'],function(Blob,FileReader,Uint8Array,Window,XMLHttpRequest,Promise){var blobUriToBlob=function(url){return new Promise(function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.");};try{var xhr=new XMLHttpRequest();xhr.open('GET',url,true);xhr.responseType='blob';xhr.onload=function(){if(this.status==200){resolve(this.response);}else{rejectWithError();}};xhr.onerror=rejectWithError;xhr.send();}catch(ex){rejectWithError();}});};var parseDataUri=function(uri){var type,matches;uri=decodeURIComponent(uri).split(',');matches=/data:([^;]+)/.exec(uri[0]);if(matches){type=matches[1];}return{type:type,data:uri[1]};};var dataUriToBlob=function(uri){return new Promise(function(resolve){var str,arr,i;uri=parseDataUri(uri);try{str=Window.atob(uri.data);}catch(e){resolve(new Blob([]));return;}arr=new Uint8Array(str.length);for(i=0;i<arr.length;i++){arr[i]=str.charCodeAt(i);}resolve(new Blob([arr],{type:uri.type}));});};var uriToBlob=function(url){if(url.indexOf('blob:')===0){return blobUriToBlob(url);}if(url.indexOf('data:')===0){return dataUriToBlob(url);}return null;};var blobToDataUri=function(blob){return new Promise(function(resolve){var reader=new FileReader();reader.onloadend=function(){resolve(reader.result);};reader.readAsDataURL(blob);});};return{uriToBlob:uriToBlob,blobToDataUri:blobToDataUri,parseDataUri:parseDataUri};});define('tinymce.core.file.ImageScanner',["tinymce.core.util.Promise","tinymce.core.util.Arr","tinymce.core.util.Fun","tinymce.core.file.Conversions","tinymce.core.Env"],function(Promise,Arr,Fun,Conversions,Env){var count=0;var uniqueId=function(prefix){return(prefix||'blobid')+(count++);};var imageToBlobInfo=function(blobCache,img,resolve,reject){var base64,blobInfo;if(img.src.indexOf('blob:')===0){blobInfo=blobCache.getByUri(img.src);if(blobInfo){resolve({image:img,blobInfo:blobInfo});}else{Conversions.uriToBlob(img.src).then(function(blob){Conversions.blobToDataUri(blob).then(function(dataUri){base64=Conversions.parseDataUri(dataUri).data;blobInfo=blobCache.create(uniqueId(),blob,base64);blobCache.add(blobInfo);resolve({image:img,blobInfo:blobInfo});});},function(err){reject(err);});}return;}base64=Conversions.parseDataUri(img.src).data;blobInfo=blobCache.findFirst(function(cachedBlobInfo){return cachedBlobInfo.base64()===base64;});if(blobInfo){resolve({image:img,blobInfo:blobInfo});}else{Conversions.uriToBlob(img.src).then(function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64);blobCache.add(blobInfo);resolve({image:img,blobInfo:blobInfo});},function(err){reject(err);});}};var getAllImages=function(elm){return elm ? elm.getElementsByTagName('img'):[];};return function(uploadStatus,blobCache){var cachedPromises={};var findAll=function(elm,predicate){var images,promises;if(!predicate){predicate=Fun.constant(true);}images=Arr.filter(getAllImages(elm),function(img){var src=img.src;if(!Env.fileApi){return false;}if(img.hasAttribute('data-mce-bogus')){return false;}if(img.hasAttribute('data-mce-placeholder')){return false;}if(!src||src==Env.transparentSrc){return false;}if(src.indexOf('blob:')===0){return !uploadStatus.isUploaded(src);}if(src.indexOf('data:')===0){return predicate(img);}return false;});promises=Arr.map(images,function(img){var newPromise;if(cachedPromises[img.src]){return new Promise(function(resolve){cachedPromises[img.src].then(function(imageInfo){if(typeof imageInfo==='string'){return imageInfo;}resolve({image:img,blobInfo:imageInfo.blobInfo});});});}newPromise=new Promise(function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject);}).then(function(result){delete cachedPromises[result.image.src];return result;})['catch'](function(error){delete cachedPromises[img.src];return error;});cachedPromises[img.src]=newPromise;return newPromise;});return Promise.all(promises);};return{findAll:findAll};};});define('tinymce.core.util.Uuid',[],function(){var count=0;var seed=function(){var rnd=function(){return Math.round(Math.random()*0xFFFFFFFF).toString(36);};var now=new Date().getTime();return 's'+now.toString(36)+rnd()+rnd()+rnd();};var uuid=function(prefix){return prefix+(count++)+seed();};return{uuid:uuid};});define('tinymce.core.file.BlobCache',['ephox.sand.api.URL','tinymce.core.util.Arr','tinymce.core.util.Fun','tinymce.core.util.Uuid'],function(URL,Arr,Fun,Uuid){return function(){var cache=[],constant=Fun.constant;var mimeToExt=function(mime){var mimes={'image/jpeg':'jpg','image/jpg':'jpg','image/gif':'gif','image/png':'png'};return mimes[mime.toLowerCase()]||'dat';};var create=function(o,blob,base64,filename){return typeof o==='object' ? toBlobInfo(o):toBlobInfo({id:o,name:filename,blob:blob,base64:base64});};var toBlobInfo=function(o){var id,name;if(!o.blob||!o.base64){throw "blob and base64 representations of the image are required for BlobInfo to be created";}id=o.id||Uuid.uuid('blobid');name=o.name||id;return{id:constant(id),name:constant(name),filename:constant(name+'.'+mimeToExt(o.blob.type)),blob:constant(o.blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(o.blob)),uri:constant(o.uri)};};var add=function(blobInfo){if(!get(blobInfo.id())){cache.push(blobInfo);}};var get=function(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id;});};var findFirst=function(predicate){return Arr.filter(cache,predicate)[0];};var getByUri=function(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()==blobUri;});};var removeByUri=function(blobUri){cache=Arr.filter(cache,function(blobInfo){if(blobInfo.blobUri()===blobUri){URL.revokeObjectURL(blobInfo.blobUri());return false;}return true;});};var destroy=function(){Arr.each(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri());});cache=[];};return{create:create,add:add,get:get,getByUri:getByUri,findFirst:findFirst,removeByUri:removeByUri,destroy:destroy};};});define('tinymce.core.file.UploadStatus',[],function(){return function(){var PENDING=1,UPLOADED=2;var blobUriStatuses={};var createStatus=function(status,resultUri){return{status:status,resultUri:resultUri};};var hasBlobUri=function(blobUri){return blobUri in blobUriStatuses;};var getResultUri=function(blobUri){var result=blobUriStatuses[blobUri];return result ? result.resultUri :null;};var isPending=function(blobUri){return hasBlobUri(blobUri)? blobUriStatuses[blobUri].status===PENDING :false;};var isUploaded=function(blobUri){return hasBlobUri(blobUri)? blobUriStatuses[blobUri].status===UPLOADED :false;};var markPending=function(blobUri){blobUriStatuses[blobUri]=createStatus(PENDING,null);};var markUploaded=function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(UPLOADED,resultUri);};var removeFailed=function(blobUri){delete blobUriStatuses[blobUri];};var destroy=function(){blobUriStatuses={};};return{hasBlobUri:hasBlobUri,getResultUri:getResultUri,isPending:isPending,isUploaded:isUploaded,markPending:markPending,markUploaded:markUploaded,removeFailed:removeFailed,destroy:destroy};};});define('tinymce.core.EditorUpload',["tinymce.core.util.Arr","tinymce.core.file.Uploader","tinymce.core.file.ImageScanner","tinymce.core.file.BlobCache","tinymce.core.file.UploadStatus","tinymce.core.ErrorReporter"],function(Arr,Uploader,ImageScanner,BlobCache,UploadStatus,ErrorReporter){return function(editor){var blobCache=new BlobCache(),uploader,imageScanner,settings=editor.settings;var uploadStatus=new UploadStatus();var aliveGuard=function(callback){return function(result){if(editor.selection){return callback(result);}return[];};};var cacheInvalidator=function(){return '?'+(new Date()).getTime();};var replaceString=function(content,search,replace){var index=0;do{index=content.indexOf(search,index);if(index !==-1){content=content.substring(0,index)+replace+content.substr(index+search.length);index+=replace.length-search.length+1;}}while(index !==-1);return content;};var replaceImageUrl=function(content,targetUrl,replacementUrl){content=replaceString(content,'src="'+targetUrl+'"','src="'+replacementUrl+'"');content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"');return content;};var replaceUrlInUndoStack=function(targetUrl,replacementUrl){Arr.each(editor.undoManager.data,function(level){if(level.type==='fragmented'){level.fragments=Arr.map(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl);});}else{level.content=replaceImageUrl(level.content,targetUrl,replacementUrl);}});};var openNotification=function(){return editor.notificationManager.open({text:editor.translate('Image uploading...'),type:'info',timeout:-1,progressBar:true});};var replaceImageUri=function(image,resultUri){blobCache.removeByUri(image.src);replaceUrlInUndoStack(image.src,resultUri);editor.$(image).attr({src:settings.images_reuse_filename ? resultUri+cacheInvalidator():resultUri,'data-mce-src':editor.convertURL(resultUri,'src')});};var uploadImages=function(callback){if(!uploader){uploader=new Uploader(uploadStatus,{url:settings.images_upload_url,basePath:settings.images_upload_base_path,credentials:settings.images_upload_credentials,handler:settings.images_upload_handler});}return scanForImages().then(aliveGuard(function(imageInfos){var blobInfos;blobInfos=Arr.map(imageInfos,function(imageInfo){return imageInfo.blobInfo;});return uploader.upload(blobInfos,openNotification).then(aliveGuard(function(result){var filteredResult=Arr.map(result,function(uploadInfo,index){var image=imageInfos[index].image;if(uploadInfo.status && editor.settings.images_replace_blob_uris !==false){replaceImageUri(image,uploadInfo.url);}else if(uploadInfo.error){ErrorReporter.uploadError(editor,uploadInfo.error);}return{element:image,status:uploadInfo.status};});if(callback){callback(filteredResult);}return filteredResult;}));}));};var uploadImagesAuto=function(callback){if(settings.automatic_uploads !==false){return uploadImages(callback);}};var isValidDataUriImage=function(imgElm){return settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm):true;};var scanForImages=function(){if(!imageScanner){imageScanner=new ImageScanner(uploadStatus,blobCache);}return imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){result=Arr.filter(result,function(resultItem){if(typeof resultItem==='string'){ErrorReporter.displayError(editor,resultItem);return false;}return true;});Arr.each(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri());resultItem.image.src=resultItem.blobInfo.blobUri();resultItem.image.removeAttribute('data-mce-src');});return result;}));};var destroy=function(){blobCache.destroy();uploadStatus.destroy();imageScanner=uploader=null;};var replaceBlobUris=function(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri){return 'src="'+resultUri+'"';}var blobInfo=blobCache.getByUri(blobUri);if(!blobInfo){blobInfo=Arr.reduce(editor.editorManager.get(),function(result,editor){return result||editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);},null);}if(blobInfo){return 'src="data:'+blobInfo.blob().type+';base64,'+blobInfo.base64()+'"';}return match;});};editor.on('setContent',function(){if(editor.settings.automatic_uploads !==false){uploadImagesAuto();}else{scanForImages();}});editor.on('RawSaveContent',function(e){e.content=replaceBlobUris(e.content);});editor.on('getContent',function(e){if(e.source_view||e.format=='raw'){return;}e.content=replaceBlobUris(e.content);});editor.on('PostRender',function(){editor.parser.addNodeFilter('img',function(images){Arr.each(images,function(img){var src=img.attr('src');if(blobCache.getByUri(src)){return;}var resultUri=uploadStatus.getResultUri(src);if(resultUri){img.attr('src',resultUri);}});});});return{blobCache:blobCache,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy};};});define('tinymce.core.ForceBlocks',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.sugar.api.node.Element','tinymce.core.dom.Bookmarks','tinymce.core.dom.NodeType','tinymce.core.dom.Parents','tinymce.core.focus.EditorFocus'],function(Arr,Fun,Element,Bookmarks,NodeType,Parents,EditorFocus){var isBlockElement=function(blockElements,node){return blockElements.hasOwnProperty(node.nodeName);};var isValidTarget=function(blockElements,node){if(NodeType.isText(node)){return true;}else if(NodeType.isElement(node)){return !isBlockElement(blockElements,node)&& !Bookmarks.isBookmarkNode(node);}else{return false;}};var hasBlockParent=function(blockElements,root,node){return Arr.exists(Parents.parents(Element.fromDom(node),Element.fromDom(root)),function(elm){return isBlockElement(blockElements,elm.dom());});};var addRootBlocks=function(editor){var settings=editor.settings,dom=editor.dom,selection=editor.selection;var schema=editor.schema,blockElements=schema.getBlockElements();var node=selection.getStart(),rootNode=editor.getBody(),rng;var startContainer,startOffset,endContainer,endOffset,rootBlockNode;var tempNode,wrapped,restoreSelection;var rootNodeName,forcedRootBlock;forcedRootBlock=settings.forced_root_block;if(!node||!NodeType.isElement(node)||!forcedRootBlock){return;}rootNodeName=rootNode.nodeName.toLowerCase();if(!schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())||hasBlockParent(blockElements,rootNode,node)){return;}rng=selection.getRng();startContainer=rng.startContainer;startOffset=rng.startOffset;endContainer=rng.endContainer;endOffset=rng.endOffset;restoreSelection=EditorFocus.hasFocus(editor);node=rootNode.firstChild;while(node){if(isValidTarget(blockElements,node)){if(NodeType.isText(node)&& node.nodeValue.length===0){tempNode=node;node=node.nextSibling;dom.remove(tempNode);continue;}if(!rootBlockNode){rootBlockNode=dom.create(forcedRootBlock,editor.settings.forced_root_block_attrs);node.parentNode.insertBefore(rootBlockNode,node);wrapped=true;}tempNode=node;node=node.nextSibling;rootBlockNode.appendChild(tempNode);}else{rootBlockNode=null;node=node.nextSibling;}}if(wrapped && restoreSelection){rng.setStart(startContainer,startOffset);rng.setEnd(endContainer,endOffset);selection.setRng(rng);editor.nodeChanged();}};var setup=function(editor){if(editor.settings.forced_root_block){editor.on('NodeChange',Fun.curry(addRootBlocks,editor));}};return{setup:setup};});define('tinymce.core.NodeChange',['tinymce.core.Env','tinymce.core.selection.RangeCompare','tinymce.core.util.Delay'],function(Env,RangeCompare,Delay){return function(editor){var lastRng,lastPath=[];var isSameElementPath=function(startElm){var i,currentPath;currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);if(currentPath.length===lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==lastPath[i]){break;}}if(i===-1){lastPath=currentPath;return true;}}lastPath=currentPath;return false;};if(!('onselectionchange' in editor.getDoc())){editor.on('NodeChange Click MouseUp KeyUp Focus',function(e){var nativeRng,fakeRng;nativeRng=editor.selection.getRng();fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type=='nodechange'||!RangeCompare.isEq(fakeRng,lastRng)){editor.fire('SelectionChange');}lastRng=fakeRng;});}editor.on('contextmenu',function(){editor.fire('SelectionChange');});editor.on('SelectionChange',function(){var startElm=editor.selection.getStart(true);if(!startElm||(!Env.range && editor.selection.isCollapsed())){return;}if(!isSameElementPath(startElm)&& editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true});}});editor.on('MouseUp',function(e){if(!e.isDefaultPrevented()){if(editor.selection.getNode().nodeName=='IMG'){Delay.setEditorTimeout(editor,function(){editor.nodeChanged();});}else{editor.nodeChanged();}}});this.nodeChanged=function(args){var selection=editor.selection,node,parents,root;if(editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly){root=editor.getBody();node=selection.getStart(true)||root;if(node.ownerDocument !=editor.getDoc()||!editor.dom.isChildOf(node,root)){node=root;}parents=[];editor.dom.getParent(node,function(node){if(node===root){return true;}parents.push(node);});args=args||{};args.element=node;args.parents=parents;editor.fire('NodeChange',args);}};};});define('tinymce.core.dom.MousePosition',[],function(){var getAbsolutePosition=function(elm){var doc,docElem,win,clientRect;clientRect=elm.getBoundingClientRect();doc=elm.ownerDocument;docElem=doc.documentElement;win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft};};var getBodyPosition=function(editor){return editor.inline ? getAbsolutePosition(editor.getBody()):{left:0,top:0};};var getScrollPosition=function(editor){var body=editor.getBody();return editor.inline ?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0};};var getBodyScroll=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement;var inlineScroll={left:body.scrollLeft,top:body.scrollTop};var iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline ? inlineScroll :iframeScroll;};var getMousePosition=function(editor,event){if(event.target.ownerDocument !==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer());var scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top};}return{left:event.pageX,top:event.pageY};};var calculatePosition=function(bodyPosition,scrollPosition,mousePosition){return{pageX:(mousePosition.left-bodyPosition.left)+scrollPosition.left,pageY:(mousePosition.top-bodyPosition.top)+scrollPosition.top};};var calc=function(editor,event){return calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event));};return{calc:calc};});define('tinymce.core.DragDropOverrides',['global!document','tinymce.core.dom.DOMUtils','tinymce.core.dom.MousePosition','tinymce.core.dom.NodeType','tinymce.core.util.Arr','tinymce.core.util.Delay','tinymce.core.util.Fun'],function(document,DOMUtils,MousePosition,NodeType,Arr,Delay,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue;var isDraggable=function(rootElm,elm){return isContentEditableFalse(elm)&& elm !==rootElm;};var isValidDropTarget=function(editor,targetElement,dragElement){if(targetElement===dragElement||editor.dom.isChildOf(targetElement,dragElement)){return false;}if(isContentEditableFalse(targetElement)){return false;}return true;};var cloneElement=function(elm){var cloneElm=elm.cloneNode(true);cloneElm.removeAttribute('data-mce-selected');return cloneElm;};var createGhost=function(editor,elm,width,height){var clonedElm=elm.cloneNode(true);editor.dom.setStyles(clonedElm,{width:width,height:height});editor.dom.setAttrib(clonedElm,'data-mce-selected',null);var ghostElm=editor.dom.create('div',{'class':'mce-drag-container','data-mce-bogus':'all',unselectable:'on',contenteditable:'false'});editor.dom.setStyles(ghostElm,{position:'absolute',opacity:0.5,overflow:'hidden',border:0,padding:0,margin:0,width:width,height:height});editor.dom.setStyles(clonedElm,{margin:0,boxSizing:'border-box'});ghostElm.appendChild(clonedElm);return ghostElm;};var appendGhostToBody=function(ghostElm,bodyElm){if(ghostElm.parentNode !==bodyElm){bodyElm.appendChild(ghostElm);}};var moveGhost=function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+'px';ghostElm.style.top=position.pageY+'px';if(position.pageX+width>maxX){overflowX=(position.pageX+width)-maxX;}if(position.pageY+height>maxY){overflowY=(position.pageY+height)-maxY;}ghostElm.style.width=(width-overflowX)+'px';ghostElm.style.height=(height-overflowY)+'px';};var removeElement=function(elm){if(elm && elm.parentNode){elm.parentNode.removeChild(elm);}};var isLeftMouseButtonPressed=function(e){return e.button===0;};var hasDraggableElement=function(state){return state.element;};var applyRelPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5};};var start=function(state,editor){return function(e){if(isLeftMouseButtonPressed(e)){var ceElm=Arr.find(editor.dom.getParents(e.target),Fun.or(isContentEditableFalse,isContentEditableTrue));if(isDraggable(editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm);var bodyElm=editor.getBody();var docElm=editor.getDoc().documentElement;state.element=ceElm;state.screenX=e.screenX;state.screenY=e.screenY;state.maxX=(editor.inline ? bodyElm.scrollWidth :docElm.offsetWidth)-2;state.maxY=(editor.inline ? bodyElm.scrollHeight :docElm.offsetHeight)-2;state.relX=e.pageX-elmPos.x;state.relY=e.pageY-elmPos.y;state.width=ceElm.offsetWidth;state.height=ceElm.offsetHeight;state.ghost=createGhost(editor,ceElm,state.width,state.height);}}};};var move=function(state,editor){var throttledPlaceCaretAt=Delay.throttle(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret();editor.selection.placeCaretAt(clientX,clientY);},0);return function(e){var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(hasDraggableElement(state)&& !state.dragging && movement>10){var args=editor.fire('dragstart',{target:state.element});if(args.isDefaultPrevented()){return;}state.dragging=true;editor.focus();}if(state.dragging){var targetPos=applyRelPos(state,MousePosition.calc(editor,e));appendGhostToBody(state.ghost,editor.getBody());moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY);throttledPlaceCaretAt(e.clientX,e.clientY);}};};var getRawTarget=function(selection){var rng=selection.getSel().getRangeAt(0);var startContainer=rng.startContainer;return startContainer.nodeType===3 ? startContainer.parentNode :startContainer;};var drop=function(state,editor){return function(e){if(state.dragging){if(isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var targetClone=cloneElement(state.element);var args=editor.fire('drop',{targetClone:targetClone,clientX:e.clientX,clientY:e.clientY});if(!args.isDefaultPrevented()){targetClone=args.targetClone;editor.undoManager.transact(function(){removeElement(state.element);editor.insertContent(editor.dom.getOuterHTML(targetClone));editor._selectionOverrides.hideFakeCaret();});}}}removeDragState(state);};};var stop=function(state,editor){return function(){removeDragState(state);if(state.dragging){editor.fire('dragend');}};};var removeDragState=function(state){state.dragging=false;state.element=null;removeElement(state.ghost);};var bindFakeDragEvents=function(editor){var state={},pageDom,dragStartHandler,dragHandler,dropHandler,dragEndHandler,rootDocument;pageDom=DOMUtils.DOM;rootDocument=document;dragStartHandler=start(state,editor);dragHandler=move(state,editor);dropHandler=drop(state,editor);dragEndHandler=stop(state,editor);editor.on('mousedown',dragStartHandler);editor.on('mousemove',dragHandler);editor.on('mouseup',dropHandler);pageDom.bind(rootDocument,'mousemove',dragHandler);pageDom.bind(rootDocument,'mouseup',dragEndHandler);editor.on('remove',function(){pageDom.unbind(rootDocument,'mousemove',dragHandler);pageDom.unbind(rootDocument,'mouseup',dragEndHandler);});};var blockIeDrop=function(editor){editor.on('drop',function(e){var realTarget=typeof e.clientX !=='undefined' ? editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;if(isContentEditableFalse(realTarget)||isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))){e.preventDefault();}});};var init=function(editor){bindFakeDragEvents(editor);blockIeDrop(editor);};return{init:init};});define('tinymce.core.caret.FakeCaret',['global!clearInterval','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretContainerRemove','tinymce.core.dom.DomQuery','tinymce.core.dom.NodeType','tinymce.core.geom.ClientRect','tinymce.core.util.Delay'],function(clearInterval,CaretContainer,CaretContainerRemove,DomQuery,NodeType,ClientRect,Delay){var isContentEditableFalse=NodeType.isContentEditableFalse;var isTableCell=function(node){return node && /^(TD|TH)$/i.test(node.nodeName);};return function(rootNode,isBlock){var cursorInterval,$lastVisualCaret=null,caretContainerNode;var getAbsoluteClientRect=function(node,before){var clientRect=ClientRect.collapse(node.getBoundingClientRect(),before),docElm,scrollX,scrollY,margin,rootRect;if(rootNode.tagName=='BODY'){docElm=rootNode.ownerDocument.documentElement;scrollX=rootNode.scrollLeft||docElm.scrollLeft;scrollY=rootNode.scrollTop||docElm.scrollTop;}else{rootRect=rootNode.getBoundingClientRect();scrollX=rootNode.scrollLeft-rootRect.left;scrollY=rootNode.scrollTop-rootRect.top;}clientRect.left+=scrollX;clientRect.right+=scrollX;clientRect.top+=scrollY;clientRect.bottom+=scrollY;clientRect.width=1;margin=node.offsetWidth-node.clientWidth;if(margin>0){if(before){margin*=-1;}clientRect.left+=margin;clientRect.right+=margin;}return clientRect;};var trimInlineCaretContainers=function(){var contentEditableFalseNodes,node,sibling,i,data;contentEditableFalseNodes=DomQuery('*[contentEditable=false]',rootNode);for(i=0;i<contentEditableFalseNodes.length;i++){node=contentEditableFalseNodes[i];sibling=node.previousSibling;if(CaretContainer.endsWithCaretContainer(sibling)){data=sibling.data;if(data.length==1){sibling.parentNode.removeChild(sibling);}else{sibling.deleteData(data.length-1,1);}}sibling=node.nextSibling;if(CaretContainer.startsWithCaretContainer(sibling)){data=sibling.data;if(data.length==1){sibling.parentNode.removeChild(sibling);}else{sibling.deleteData(0,1);}}}return null;};var show=function(before,node){var clientRect,rng;hide();if(isTableCell(node)){return null;}if(isBlock(node)){caretContainerNode=CaretContainer.insertBlock('p',node,before);clientRect=getAbsoluteClientRect(node,before);DomQuery(caretContainerNode).css('top',clientRect.top);$lastVisualCaret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(rootNode);if(before){$lastVisualCaret.addClass('mce-visual-caret-before');}startBlink();rng=node.ownerDocument.createRange();rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{caretContainerNode=CaretContainer.insertInline(node,before);rng=node.ownerDocument.createRange();if(isContentEditableFalse(caretContainerNode.nextSibling)){rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{rng.setStart(caretContainerNode,1);rng.setEnd(caretContainerNode,1);}return rng;}return rng;};var hide=function(){trimInlineCaretContainers();if(caretContainerNode){CaretContainerRemove.remove(caretContainerNode);caretContainerNode=null;}if($lastVisualCaret){$lastVisualCaret.remove();$lastVisualCaret=null;}clearInterval(cursorInterval);};var hasFocus=function(){return rootNode.ownerDocument.activeElement===rootNode;};var startBlink=function(){cursorInterval=Delay.setInterval(function(){if(hasFocus()){DomQuery('div.mce-visual-caret',rootNode).toggleClass('mce-visual-caret-hidden');}else{DomQuery('div.mce-visual-caret',rootNode).addClass('mce-visual-caret-hidden');}},500);};var destroy=function(){Delay.clearInterval(cursorInterval);};var getCss=function(){return('.mce-visual-caret {'+'position: absolute;'+'background-color: black;'+'background-color: currentcolor;'+'}'+'.mce-visual-caret-hidden {'+'display: none;'+'}'+'*[data-mce-caret] {'+'position: absolute;'+'left: -1000px;'+'right: auto;'+'top: 0;'+'margin: 0;'+'padding: 0;'+'}');};return{show:show,hide:hide,getCss:getCss,destroy:destroy};};});define('tinymce.core.dom.Dimensions',["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.geom.ClientRect"],function(Arr,NodeType,ClientRect){var getClientRects=function(node){var toArrayWithNode=function(clientRects){return Arr.map(clientRects,function(clientRect){clientRect=ClientRect.clone(clientRect);clientRect.node=node;return clientRect;});};if(Arr.isArray(node)){return Arr.reduce(node,function(result,node){return result.concat(getClientRects(node));},[]);}if(NodeType.isElement(node)){return toArrayWithNode(node.getClientRects());}if(NodeType.isText(node)){var rng=node.ownerDocument.createRange();rng.setStart(node,0);rng.setEnd(node,node.data.length);return toArrayWithNode(rng.getClientRects());}};return{getClientRects:getClientRects};});define('tinymce.core.caret.LineUtils',["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.Dimensions","tinymce.core.geom.ClientRect","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretCandidate"],function(Fun,Arr,NodeType,Dimensions,ClientRect,CaretUtils,CaretCandidate){var isContentEditableFalse=NodeType.isContentEditableFalse,findNode=CaretUtils.findNode,curry=Fun.curry;var distanceToRectLeft=function(clientRect,clientX){return Math.abs(clientRect.left-clientX);};var distanceToRectRight=function(clientRect,clientX){return Math.abs(clientRect.right-clientX);};var findClosestClientRect=function(clientRects,clientX){var isInside=function(clientX,clientRect){return clientX>=clientRect.left && clientX<=clientRect.right;};return Arr.reduce(clientRects,function(oldClientRect,clientRect){var oldDistance,newDistance;oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX));newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));if(isInside(clientX,clientRect)){return clientRect;}if(isInside(clientX,oldClientRect)){return oldClientRect;}if(newDistance==oldDistance && isContentEditableFalse(clientRect.node)){return clientRect;}if(newDistance<oldDistance){return clientRect;}return oldClientRect;});};var walkUntil=function(direction,rootNode,predicateFn,node){while((node=findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode))){if(predicateFn(node)){return;}}};var findLineNodeRects=function(rootNode,targetNodeRect){var clientRects=[];var collect=function(checkPosFn,node){var lineRects;lineRects=Arr.filter(Dimensions.getClientRects(node),function(clientRect){return !checkPosFn(clientRect,targetNodeRect);});clientRects=clientRects.concat(lineRects);return lineRects.length===0;};clientRects.push(targetNodeRect);walkUntil(-1,rootNode,curry(collect,ClientRect.isAbove),targetNodeRect.node);walkUntil(1,rootNode,curry(collect,ClientRect.isBelow),targetNodeRect.node);return clientRects;};var getContentEditableFalseChildren=function(rootNode){return Arr.filter(Arr.toArray(rootNode.getElementsByTagName('*')),isContentEditableFalse);};var caretInfo=function(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)};};var closestCaret=function(rootNode,clientX,clientY){var contentEditableFalseNodeRects,closestNodeRect;contentEditableFalseNodeRects=Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));contentEditableFalseNodeRects=Arr.filter(contentEditableFalseNodeRects,function(clientRect){return clientY>=clientRect.top && clientY<=clientRect.bottom;});closestNodeRect=findClosestClientRect(contentEditableFalseNodeRects,clientX);if(closestNodeRect){closestNodeRect=findClosestClientRect(findLineNodeRects(rootNode,closestNodeRect),clientX);if(closestNodeRect && isContentEditableFalse(closestNodeRect.node)){return caretInfo(closestNodeRect,clientX);}}return null;};return{findClosestClientRect:findClosestClientRect,findLineNodeRects:findLineNodeRects,closestCaret:closestCaret};});define('tinymce.core.dom.RangePoint',['ephox.katamari.api.Arr','tinymce.core.geom.ClientRect'],function(Arr,ClientRect){var isXYWithinRange=function(clientX,clientY,range){if(range.collapsed){return false;}return Arr.foldl(range.getClientRects(),function(state,rect){return state||ClientRect.containsXY(rect,clientX,clientY);},false);};return{isXYWithinRange:isXYWithinRange};});define('ephox.katamari.api.Throttler',['global!clearTimeout','global!setTimeout'],function(clearTimeout,setTimeout){var adaptable=function(fn,rate){var timer=null;var args=null;var cancel=function(){if(timer !==null){clearTimeout(timer);timer=null;args=null;}};var throttle=function(){args=arguments;if(timer===null){timer=setTimeout(function(){fn.apply(null,args);timer=null;args=null;},rate);}};return{cancel:cancel,throttle:throttle};};var first=function(fn,rate){var timer=null;var cancel=function(){if(timer !==null){clearTimeout(timer);timer=null;}};var throttle=function(){var args=arguments;if(timer===null){timer=setTimeout(function(){fn.apply(null,args);timer=null;args=null;},rate);}};return{cancel:cancel,throttle:throttle};};var last=function(fn,rate){var timer=null;var cancel=function(){if(timer !==null){clearTimeout(timer);timer=null;}};var throttle=function(){var args=arguments;if(timer !==null)clearTimeout(timer);timer=setTimeout(function(){fn.apply(null,args);timer=null;args=null;},rate);};return{cancel:cancel,throttle:throttle};};return{adaptable:adaptable,first:first,last:last};});define('tinymce.core.keyboard.CefUtils',['tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.dom.NodeType','tinymce.core.util.Fun'],function(CaretPosition,CaretUtils,NodeType,Fun){var isContentEditableTrue=NodeType.isContentEditableTrue;var isContentEditableFalse=NodeType.isContentEditableFalse;var showCaret=function(direction,editor,node,before){return editor._selectionOverrides.showCaret(direction,node,before);};var getNodeRange=function(node){var rng=node.ownerDocument.createRange();rng.selectNode(node);return rng;};var selectNode=function(editor,node){var e;e=editor.fire('BeforeObjectSelected',{target:node});if(e.isDefaultPrevented()){return null;}return getNodeRange(node);};var renderCaretAtRange=function(editor,range){var caretPosition,ceRoot;range=CaretUtils.normalizeRange(1,editor.getBody(),range);caretPosition=CaretPosition.fromRangeStart(range);if(isContentEditableFalse(caretPosition.getNode())){return showCaret(1,editor,caretPosition.getNode(),!caretPosition.isAtEnd());}if(isContentEditableFalse(caretPosition.getNode(true))){return showCaret(1,editor,caretPosition.getNode(true),false);}ceRoot=editor.dom.getParent(caretPosition.getNode(),Fun.or(isContentEditableFalse,isContentEditableTrue));if(isContentEditableFalse(ceRoot)){return showCaret(1,editor,ceRoot,false);}return null;};var renderRangeCaret=function(editor,range){var caretRange;if(!range||!range.collapsed){return range;}caretRange=renderCaretAtRange(editor,range);if(caretRange){return caretRange;}return range;};return{showCaret:showCaret,selectNode:selectNode,renderCaretAtRange:renderCaretAtRange,renderRangeCaret:renderRangeCaret};});define('tinymce.core.focus.CefFocus',['ephox.katamari.api.Throttler','tinymce.core.keyboard.CefUtils'],function(Throttler,CefUtils){var setup=function(editor){var renderFocusCaret=Throttler.first(function(){if(!editor.removed){var caretRange=CefUtils.renderRangeCaret(editor,editor.selection.getRng());editor.selection.setRng(caretRange);}},0);editor.on('focus',function(){renderFocusCaret.throttle();});editor.on('blur',function(){renderFocusCaret.cancel();});};return{setup:setup};});define('tinymce.core.util.VK',["tinymce.core.Env"],function(Env){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e);},metaKeyPressed:function(e){return(Env.mac ? e.metaKey :e.ctrlKey && !e.altKey);}};});define('tinymce.core.SelectionOverrides',['ephox.katamari.api.Arr','ephox.sugar.api.dom.Remove','ephox.sugar.api.node.Element','ephox.sugar.api.properties.Attr','ephox.sugar.api.search.SelectorFilter','ephox.sugar.api.search.SelectorFind','tinymce.core.DragDropOverrides','tinymce.core.EditorView','tinymce.core.Env','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.caret.CaretWalker','tinymce.core.caret.FakeCaret','tinymce.core.caret.LineUtils','tinymce.core.dom.NodeType','tinymce.core.dom.RangePoint','tinymce.core.focus.CefFocus','tinymce.core.keyboard.CefUtils','tinymce.core.util.VK'],function(Arr,Remove,Element,Attr,SelectorFilter,SelectorFind,DragDropOverrides,EditorView,Env,CaretContainer,CaretPosition,CaretUtils,CaretWalker,FakeCaret,LineUtils,NodeType,RangePoint,CefFocus,CefUtils,VK){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse;var SelectionOverrides=function(editor){var isBlock=function(node){return editor.dom.isBlock(node);};var rootNode=editor.getBody();var fakeCaret=new FakeCaret(editor.getBody(),isBlock),realSelectionId='sel-'+editor.dom.uniqueId(),selectedContentEditableNode;var isFakeSelectionElement=function(elm){return editor.dom.hasClass(elm,'mce-offscreen-selection');};var getRealSelectionElement=function(){var container=editor.dom.get(realSelectionId);return container ? container.getElementsByTagName('*')[0]:container;};var setRange=function(range){if(range){editor.selection.setRng(range);}};var getRange=function(){return editor.selection.getRng();};var scrollIntoView=function(node,alignToTop){editor.selection.scrollIntoView(node,alignToTop);};var showCaret=function(direction,node,before){var e;e=editor.fire('ShowCaret',{target:node,direction:direction,before:before});if(e.isDefaultPrevented()){return null;}scrollIntoView(node,direction===-1);return fakeCaret.show(before,node);};var getNormalizedRangeEndPoint=function(direction,range){range=CaretUtils.normalizeRange(direction,rootNode,range);if(direction==-1){return CaretPosition.fromRangeStart(range);}return CaretPosition.fromRangeEnd(range);};var showBlockCaretContainer=function(blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){CaretContainer.showCaretContainerBlock(blockCaretContainer);setRange(getRange());scrollIntoView(blockCaretContainer[0]);}};var registerEvents=function(){var getContentEditableRoot=function(node){var root=editor.getBody();while(node && node !=root){if(isContentEditableTrue(node)||isContentEditableFalse(node)){return node;}node=node.parentNode;}return null;};editor.on('mouseup',function(e){var range=getRange();if(range.collapsed && EditorView.isXYInContentArea(editor,e.clientX,e.clientY)){setRange(CefUtils.renderCaretAtRange(editor,range));}});editor.on('click',function(e){var contentEditableRoot;contentEditableRoot=getContentEditableRoot(e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();editor.focus();}if(isContentEditableTrue(contentEditableRoot)){if(editor.dom.isChildOf(contentEditableRoot,editor.selection.getNode())){removeContentEditableSelection();}}}});editor.on('blur NewBlock',function(){removeContentEditableSelection();});var handleTouchSelect=function(editor){var moved=false;editor.on('touchstart',function(){moved=false;});editor.on('touchmove',function(){moved=true;});editor.on('touchend',function(e){var contentEditableRoot=getContentEditableRoot(e.target);if(isContentEditableFalse(contentEditableRoot)){if(!moved){e.preventDefault();setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot));}}});};var hasNormalCaretPosition=function(elm){var caretWalker=new CaretWalker(elm);if(!elm.firstChild){return false;}var startPos=CaretPosition.before(elm.firstChild);var newPos=caretWalker.next(startPos);return newPos && !isBeforeContentEditableFalse(newPos)&& !isAfterContentEditableFalse(newPos);};var isInSameBlock=function(node1,node2){var block1=editor.dom.getParent(node1,editor.dom.isBlock);var block2=editor.dom.getParent(node2,editor.dom.isBlock);return block1===block2;};var hasBetterMouseTarget=function(targetNode,caretNode){var targetBlock=editor.dom.getParent(targetNode,editor.dom.isBlock);var caretBlock=editor.dom.getParent(caretNode,editor.dom.isBlock);return targetBlock && !isInSameBlock(targetBlock,caretBlock)&& hasNormalCaretPosition(targetBlock);};handleTouchSelect(editor);editor.on('mousedown',function(e){var contentEditableRoot;if(EditorView.isXYInContentArea(editor,e.clientX,e.clientY)===false){return;}contentEditableRoot=getContentEditableRoot(e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();setContentEditableSelection(CefUtils.selectNode(editor,contentEditableRoot));}else{removeContentEditableSelection();if(!(isContentEditableTrue(contentEditableRoot)&& e.shiftKey)&& !RangePoint.isXYWithinRange(e.clientX,e.clientY,editor.selection.getRng())){editor.selection.placeCaretAt(e.clientX,e.clientY);}}}else{removeContentEditableSelection();hideFakeCaret();var caretInfo=LineUtils.closestCaret(rootNode,e.clientX,e.clientY);if(caretInfo){if(!hasBetterMouseTarget(e.target,caretInfo.node)){e.preventDefault();editor.getBody().focus();setRange(showCaret(1,caretInfo.node,caretInfo.before));}}}});editor.on('keypress',function(e){if(VK.modifierPressed(e)){return;}switch(e.keyCode){default:if(isContentEditableFalse(editor.selection.getNode())){e.preventDefault();}break;}});editor.on('getSelectionRange',function(e){var rng=e.range;if(selectedContentEditableNode){if(!selectedContentEditableNode.parentNode){selectedContentEditableNode=null;return;}rng=rng.cloneRange();rng.selectNode(selectedContentEditableNode);e.range=rng;}});editor.on('setSelectionRange',function(e){var rng;rng=setContentEditableSelection(e.range,e.forward);if(rng){e.range=rng;}});editor.on('AfterSetSelectionRange',function(e){var rng=e.range;if(!isRangeInCaretContainer(rng)){hideFakeCaret();}if(!isFakeSelectionElement(rng.startContainer.parentNode)){removeContentEditableSelection();}});editor.on('copy',function(e){var clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&& e.clipboardData && !Env.ie){var realSelectionElement=getRealSelectionElement();if(realSelectionElement){e.preventDefault();clipboardData.clearData();clipboardData.setData('text/html',realSelectionElement.outerHTML);clipboardData.setData('text/plain',realSelectionElement.outerText);}}});DragDropOverrides.init(editor);CefFocus.setup(editor);};var addCss=function(){var styles=editor.contentStyles,rootClass='.mce-content-body';styles.push(fakeCaret.getCss());styles.push(rootClass+' .mce-offscreen-selection {'+'position: absolute;'+'left: -9999999999px;'+'max-width: 1000000px;'+'}'+rootClass+' *[contentEditable=false] {'+'cursor: default;'+'}'+rootClass+' *[contentEditable=true] {'+'cursor: text;'+'}');};var isWithinCaretContainer=function(node){return(CaretContainer.isCaretContainer(node)||CaretContainer.startsWithCaretContainer(node)||CaretContainer.endsWithCaretContainer(node));};var isRangeInCaretContainer=function(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer);};var setContentEditableSelection=function(range,forward){var node,$=editor.$,dom=editor.dom,$realSelectionContainer,sel,startContainer,startOffset,endOffset,e,caretPosition,targetClone,origTargetClone;if(!range){return null;}if(range.collapsed){if(!isRangeInCaretContainer(range)){if(forward===false){caretPosition=getNormalizedRangeEndPoint(-1,range);if(isContentEditableFalse(caretPosition.getNode(true))){return showCaret(-1,caretPosition.getNode(true),false);}if(isContentEditableFalse(caretPosition.getNode())){return showCaret(-1,caretPosition.getNode(),!caretPosition.isAtEnd());}}else{caretPosition=getNormalizedRangeEndPoint(1,range);if(isContentEditableFalse(caretPosition.getNode())){return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd());}if(isContentEditableFalse(caretPosition.getNode(true))){return showCaret(1,caretPosition.getNode(true),false);}}}return null;}startContainer=range.startContainer;startOffset=range.startOffset;endOffset=range.endOffset;if(startContainer.nodeType===3 && startOffset===0 && isContentEditableFalse(startContainer.parentNode)){startContainer=startContainer.parentNode;startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(startContainer.nodeType !=1){return null;}if(endOffset==startOffset+1){node=startContainer.childNodes[startOffset];}if(!isContentEditableFalse(node)){return null;}targetClone=origTargetClone=node.cloneNode(true);e=editor.fire('ObjectSelected',{target:node,targetClone:targetClone});if(e.isDefaultPrevented()){return null;}$realSelectionContainer=SelectorFind.descendant(Element.fromDom(editor.getBody()),'#'+realSelectionId).fold(function(){return $([]);},function(elm){return $([elm.dom()]);});targetClone=e.targetClone;if($realSelectionContainer.length===0){$realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr('id',realSelectionId);$realSelectionContainer.appendTo(editor.getBody());}range=editor.dom.createRng();if(targetClone===origTargetClone && Env.ie){$realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all">\u00a0</p>').append(targetClone);range.setStartAfter($realSelectionContainer[0].firstChild.firstChild);range.setEndAfter(targetClone);}else{$realSelectionContainer.empty().append('\u00a0').append(targetClone).append('\u00a0');range.setStart($realSelectionContainer[0].firstChild,1);range.setEnd($realSelectionContainer[0].lastChild,0);}$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y});$realSelectionContainer[0].focus();sel=editor.selection.getSel();sel.removeAllRanges();sel.addRange(range);Arr.each(SelectorFilter.descendants(Element.fromDom(editor.getBody()),'*[data-mce-selected]'),function(elm){Attr.remove(elm,'data-mce-selected');});node.setAttribute('data-mce-selected',1);selectedContentEditableNode=node;hideFakeCaret();return range;};var removeContentEditableSelection=function(){if(selectedContentEditableNode){selectedContentEditableNode.removeAttribute('data-mce-selected');SelectorFind.descendant(Element.fromDom(editor.getBody()),'#'+realSelectionId).each(Remove.remove);selectedContentEditableNode=null;}};var destroy=function(){fakeCaret.destroy();selectedContentEditableNode=null;};var hideFakeCaret=function(){fakeCaret.hide();};if(Env.ceFalse){registerEvents();addCss();}return{showCaret:showCaret,showBlockCaretContainer:showBlockCaretContainer,hideFakeCaret:hideFakeCaret,destroy:destroy};};return SelectionOverrides;});define('tinymce.core.undo.Diff',[],function(){var KEEP=0,INSERT=1,DELETE=2;var diff=function(left,right){var size=left.length+right.length+2;var vDown=new Array(size);var vUp=new Array(size);var snake=function(start,end,diag){return{start:start,end:end,diag:diag};};var buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(middle===null||middle.start===end1 && middle.diag===end1-end2||middle.end===start1 && middle.diag===start1-start2){var i=start1;var j=start2;while(i<end1||j<end2){if(i<end1 && j<end2 && left[i]===right[j]){script.push([KEEP,left[i]]);++i;++j;}else{if(end1-start1>end2-start2){script.push([DELETE,left[i]]);++i;}else{script.push([INSERT,right[j]]);++j;}}}}else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2){script.push([KEEP,left[i2]]);}buildScript(middle.end,end1,middle.end-middle.diag,end2,script);}};var buildSnake=function(start,diag,end1,end2){var end=start;while(end-diag<end2 && end<end1 && left[end]===right[end-diag]){++end;}return snake(start,end,diag);};var getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1;var n=end2-start2;if(m===0||n===0){return null;}var delta=m-n;var sum=n+m;var offset=(sum% 2===0 ? sum :sum+1)/ 2;vDown[1+offset]=start1;vUp[1+offset]=end1+1;for(var d=0;d<=offset;++d){for(var k=-d;k<=d;k+=2){var i=k+offset;if(k===-d||k !=d && vDown[i-1]<vDown[i+1]){vDown[i]=vDown[i+1];}else{vDown[i]=vDown[i-1]+1;}var x=vDown[i];var y=x-start1+start2-k;while(x<end1 && y<end2 && left[x]===right[y]){vDown[i]=++x;++y;}if(delta% 2 !=0 && delta-d<=k && k<=delta+d){if(vUp[i-delta]<=vDown[i]){return buildSnake(vUp[i-delta],k+start1-start2,end1,end2);}}}for(k=delta-d;k<=delta+d;k+=2){i=k+offset-delta;if(k===delta-d||k !=delta+d && vUp[i+1]<=vUp[i-1]){vUp[i]=vUp[i+1]-1;}else{vUp[i]=vUp[i-1];}x=vUp[i]-1;y=x-start1+start2-k;while(x>=start1 && y>=start2 && left[x]===right[y]){vUp[i]=x--;y--;}if(delta% 2===0 &&-d<=k && k<=d){if(vUp[i]<=vDown[i+delta]){return buildSnake(vUp[i],k+start1-start2,end1,end2);}}}}};var script=[];buildScript(0,left.length,0,right.length,script);return script;};return{KEEP:KEEP,DELETE:DELETE,INSERT:INSERT,diff:diff};});define('tinymce.core.undo.Fragments',['global!document','tinymce.core.html.Entities','tinymce.core.undo.Diff','tinymce.core.util.Arr'],function(document,Entities,Diff,Arr){var getOuterHtml=function(elm){if(elm.nodeType===1){return elm.outerHTML;}else if(elm.nodeType===3){return Entities.encodeRaw(elm.data,false);}else if(elm.nodeType===8){return '<!--'+elm.data+'-->';}return '';};var createFragment=function(html){var frag,node,container;container=document.createElement("div");frag=document.createDocumentFragment();if(html){container.innerHTML=html;}while((node=container.firstChild)){frag.appendChild(node);}return frag;};var insertAt=function(elm,html,index){var fragment=createFragment(html);if(elm.hasChildNodes()&& index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target);}else{elm.appendChild(fragment);}};var removeAt=function(elm,index){if(elm.hasChildNodes()&& index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target);}};var applyDiff=function(diff,elm){var index=0;Arr.each(diff,function(action){if(action[0]===Diff.KEEP){index++;}else if(action[0]===Diff.INSERT){insertAt(elm,action[1],index);index++;}else if(action[0]===Diff.DELETE){removeAt(elm,index);}});};var read=function(elm){return Arr.filter(Arr.map(elm.childNodes,getOuterHtml),function(item){return item.length>0;});};var write=function(fragments,elm){var currentFragments=Arr.map(elm.childNodes,getOuterHtml);applyDiff(Diff.diff(currentFragments,fragments),elm);return elm;};return{read:read,write:write};});define('tinymce.core.undo.Levels',['ephox.katamari.api.Arr','tinymce.core.dom.TrimHtml','tinymce.core.undo.Fragments'],function(Arr,TrimHtml,Fragments){var hasIframes=function(html){return html.indexOf('</iframe>')!==-1;};var createFragmentedLevel=function(fragments){return{type:'fragmented',fragments:fragments,content:'',bookmark:null,beforeBookmark:null};};var createCompleteLevel=function(content){return{type:'complete',fragments:null,content:content,bookmark:null,beforeBookmark:null};};var createFromEditor=function(editor){var fragments,content,trimmedFragments;fragments=Fragments.read(editor.getBody());trimmedFragments=Arr.bind(fragments,function(html){var trimmed=TrimHtml.trimInternal(editor.serializer,html);return trimmed.length>0 ?[trimmed]:[];});content=trimmedFragments.join('');return hasIframes(content)? createFragmentedLevel(trimmedFragments):createCompleteLevel(content);};var applyToEditor=function(editor,level,before){if(level.type==='fragmented'){Fragments.write(level.fragments,editor.getBody());}else{editor.setContent(level.content,{format:'raw'});}editor.selection.moveToBookmark(before ? level.beforeBookmark :level.bookmark);};var getLevelContent=function(level){return level.type==='fragmented' ? level.fragments.join(''):level.content;};var isEq=function(level1,level2){return !!level1 && !!level2 && getLevelContent(level1)===getLevelContent(level2);};return{createFragmentedLevel:createFragmentedLevel,createCompleteLevel:createCompleteLevel,createFromEditor:createFromEditor,applyToEditor:applyToEditor,isEq:isEq};});define('tinymce.core.UndoManager',['tinymce.core.dom.GetBookmark','tinymce.core.undo.Levels','tinymce.core.util.Tools'],function(GetBookmark,Levels,Tools){return function(editor){var self=this,index=0,data=[],beforeBookmark,isFirstTypedCharacter,locks=0;var isUnlocked=function(){return locks===0;};var setTyping=function(typing){if(isUnlocked()){self.typing=typing;}};var setDirty=function(state){editor.setDirty(state);};var addNonTypingUndoLevel=function(e){setTyping(false);self.add({},e);};var endTyping=function(){if(self.typing){setTyping(false);self.add();}};editor.on('init',function(){self.add();});editor.on('BeforeExecCommand',function(e){var cmd=e.command;if(cmd !=='Undo' && cmd !=='Redo' && cmd !=='mceRepaint'){endTyping();self.beforeChange();}});editor.on('ExecCommand',function(e){var cmd=e.command;if(cmd !=='Undo' && cmd !=='Redo' && cmd !=='mceRepaint'){addNonTypingUndoLevel(e);}});editor.on('ObjectResizeStart Cut',function(){self.beforeChange();});editor.on('SaveContent ObjectResized blur',addNonTypingUndoLevel);editor.on('DragEnd',addNonTypingUndoLevel);editor.on('KeyUp',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if((keyCode>=33 && keyCode<=36)||(keyCode>=37 && keyCode<=40)||keyCode===45||e.ctrlKey){addNonTypingUndoLevel();editor.nodeChanged();}if(keyCode===46||keyCode===8){editor.nodeChanged();}if(isFirstTypedCharacter && self.typing && Levels.isEq(Levels.createFromEditor(editor),data[0])===false){if(editor.isDirty()===false){setDirty(true);editor.fire('change',{level:data[0],lastLevel:null});}editor.fire('TypingUndo');isFirstTypedCharacter=false;editor.nodeChanged();}});editor.on('KeyDown',function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if((keyCode>=33 && keyCode<=36)||(keyCode>=37 && keyCode<=40)||keyCode===45){if(self.typing){addNonTypingUndoLevel(e);}return;}var modKey=(e.ctrlKey && !e.altKey)||e.metaKey;if((keyCode<16||keyCode>20)&& keyCode !==224 && keyCode !==91 && !self.typing && !modKey){self.beforeChange();setTyping(true);self.add({},e);isFirstTypedCharacter=true;}});editor.on('MouseDown',function(e){if(self.typing){addNonTypingUndoLevel(e);}});editor.addShortcut('meta+z','','Undo');editor.addShortcut('meta+y,meta+shift+z','','Redo');editor.on('AddUndo Undo Redo ClearUndos',function(e){if(!e.isDefaultPrevented()){editor.nodeChanged();}});self={data:data,typing:false,beforeChange:function(){if(isUnlocked()){beforeBookmark=GetBookmark.getUndoBookmark(editor.selection);}},add:function(level,event){var i,settings=editor.settings,lastLevel,currentLevel;currentLevel=Levels.createFromEditor(editor);level=level||{};level=Tools.extend(level,currentLevel);if(isUnlocked()===false||editor.removed){return null;}lastLevel=data[index];if(editor.fire('BeforeAddUndo',{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented()){return null;}if(lastLevel && Levels.isEq(lastLevel,level)){return null;}if(data[index]){data[index].beforeBookmark=beforeBookmark;}if(settings.custom_undo_redo_levels){if(data.length>settings.custom_undo_redo_levels){for(i=0;i<data.length-1;i++){data[i]=data[i+1];}data.length--;index=data.length;}}level.bookmark=GetBookmark.getUndoBookmark(editor.selection);if(index<data.length-1){data.length=index+1;}data.push(level);index=data.length-1;var args={level:level,lastLevel:lastLevel,originalEvent:event};editor.fire('AddUndo',args);if(index>0){setDirty(true);editor.fire('change',args);}return level;},undo:function(){var level;if(self.typing){self.add();self.typing=false;setTyping(false);}if(index>0){level=data[--index];Levels.applyToEditor(editor,level,true);setDirty(true);editor.fire('undo',{level:level});}return level;},redo:function(){var level;if(index<data.length-1){level=data[++index];Levels.applyToEditor(editor,level,false);setDirty(true);editor.fire('redo',{level:level});}return level;},clear:function(){data=[];index=0;self.typing=false;self.data=data;editor.fire('ClearUndos');},hasUndo:function(){return index>0||(self.typing && data[0]&& !Levels.isEq(Levels.createFromEditor(editor),data[0]));},hasRedo:function(){return index<data.length-1 && !self.typing;},transact:function(callback){endTyping();self.beforeChange();self.ignore(callback);return self.add();},ignore:function(callback){try{locks++;callback();}finally{locks--;}},extra:function(callback1,callback2){var lastLevel,bookmark;if(self.transact(callback1)){bookmark=data[index].bookmark;lastLevel=data[index-1];Levels.applyToEditor(editor,lastLevel,true);if(self.transact(callback2)){data[index-1].beforeBookmark=bookmark;}}}};return self;};});define('tinymce.core.fmt.Hooks',["tinymce.core.util.Arr","tinymce.core.dom.NodeType","tinymce.core.dom.DomQuery"],function(Arr,NodeType,$){var postProcessHooks={},filter=Arr.filter,each=Arr.each;var addPostProcessHook=function(name,hook){var hooks=postProcessHooks[name];if(!hooks){postProcessHooks[name]=hooks=[];}postProcessHooks[name].push(hook);};var postProcess=function(name,editor){each(postProcessHooks[name],function(hook){hook(editor);});};addPostProcessHook("pre",function(editor){var rng=editor.selection.getRng(),isPre,blocks;var hasPreSibling=function(pre){return isPre(pre.previousSibling)&& Arr.indexOf(blocks,pre.previousSibling)!==-1;};var joinPre=function(pre1,pre2){$(pre2).remove();$(pre1).append('<br><br>').append(pre2.childNodes);};isPre=NodeType.matchNodeNames('pre');if(!rng.collapsed){blocks=editor.selection.getSelectedBlocks();each(filter(filter(blocks,isPre),hasPreSibling),function(pre){joinPre(pre.previousSibling,pre);});}});return{postProcess:postProcess};});define('tinymce.core.selection.RangeWalk',['tinymce.core.util.Tools'],function(Tools){var each=Tools.each;var getEndChild=function(container,index){var childNodes=container.childNodes;index--;if(index>childNodes.length-1){index=childNodes.length-1;}else if(index<0){index=0;}return childNodes[index]||container;};var walk=function(dom,rng,callback){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,ancestor,startPoint,endPoint,node,parent,siblings,nodes;nodes=dom.select('td[data-mce-selected],th[data-mce-selected]');if(nodes.length>0){each(nodes,function(node){callback([node]);});return;}var exclude=function(nodes){var node;node=nodes[0];if(node.nodeType===3 && node===startContainer && startOffset>=node.nodeValue.length){nodes.splice(0,1);}node=nodes[nodes.length-1];if(endOffset===0 && nodes.length>0 && node===endContainer && node.nodeType===3){nodes.splice(nodes.length-1,1);}return nodes;};var collectSiblings=function(node,name,endNode){var siblings=[];for(;node && node !=endNode;node=node[name]){siblings.push(node);}return siblings;};var findEndPoint=function(node,root){do{if(node.parentNode===root){return node;}node=node.parentNode;}while(node);};var walkBoundary=function(startNode,endNode,next){var siblingName=next ? 'nextSibling' :'previousSibling';for(node=startNode,parent=node.parentNode;node && node !=endNode;node=parent){parent=node.parentNode;siblings=collectSiblings(node===startNode ? node :node[siblingName],siblingName);if(siblings.length){if(!next){siblings.reverse();}callback(exclude(siblings));}}};if(startContainer.nodeType===1 && startContainer.hasChildNodes()){startContainer=startContainer.childNodes[startOffset];}if(endContainer.nodeType===1 && endContainer.hasChildNodes()){endContainer=getEndChild(endContainer,endOffset);}if(startContainer===endContainer){return callback(exclude([startContainer]));}ancestor=dom.findCommonAncestor(startContainer,endContainer);for(node=startContainer;node;node=node.parentNode){if(node===endContainer){return walkBoundary(startContainer,ancestor,true);}if(node===ancestor){break;}}for(node=endContainer;node;node=node.parentNode){if(node===startContainer){return walkBoundary(endContainer,ancestor);}if(node===ancestor){break;}}startPoint=findEndPoint(startContainer,ancestor)||startContainer;endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,true);siblings=collectSiblings(startPoint===startContainer ? startPoint :startPoint.nextSibling,'nextSibling',endPoint===endContainer ? endPoint.nextSibling :endPoint);if(siblings.length){callback(exclude(siblings));}walkBoundary(endContainer,endPoint);};return{walk:walk};});define('tinymce.core.fmt.RemoveFormat',['tinymce.core.dom.Bookmarks','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker','tinymce.core.fmt.CaretFormat','tinymce.core.fmt.ExpandRange','tinymce.core.fmt.FormatUtils','tinymce.core.fmt.MatchFormat','tinymce.core.selection.RangeWalk','tinymce.core.util.Tools'],function(Bookmarks,NodeType,TreeWalker,CaretFormat,ExpandRange,FormatUtils,MatchFormat,RangeWalk,Tools){var MCE_ATTR_RE=/^(src|href|style)$/;var each=Tools.each;var isEq=FormatUtils.isEq;var isTableCell=function(node){return /^(TH|TD)$/.test(node.nodeName);};var getContainer=function(ed,rng,start){var container,offset,lastIdx;container=rng[start ? 'startContainer' :'endContainer'];offset=rng[start ? 'startOffset' :'endOffset'];if(NodeType.isElement(container)){lastIdx=container.childNodes.length-1;if(!start && offset){offset--;}container=container.childNodes[offset>lastIdx ? lastIdx :offset];}if(NodeType.isText(container)&& start && offset>=container.nodeValue.length){container=new TreeWalker(container,ed.getBody()).next()||container;}if(NodeType.isText(container)&& !start && offset===0){container=new TreeWalker(container,ed.getBody()).prev()||container;}return container;};var wrap=function(dom,node,name,attrs){var wrapper=dom.create(name,attrs);node.parentNode.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;};var matchName=function(dom,node,format){if(isEq(node,format.inline)){return true;}if(isEq(node,format.block)){return true;}if(format.selector){return NodeType.isElement(node)&& dom.is(node,format.selector);}};var isColorFormatAndAnchor=function(node,format){return format.links && node.tagName==='A';};var find=function(dom,node,next,inc){node=FormatUtils.getNonWhiteSpaceSibling(node,next,inc);return !node||(node.nodeName==='BR'||dom.isBlock(node));};var removeNode=function(ed,node,format){var parentNode=node.parentNode,rootBlockElm;var dom=ed.dom,forcedRootBlock=ed.settings.forced_root_block;if(format.block){if(!forcedRootBlock){if(dom.isBlock(node)&& !dom.isBlock(parentNode)){if(!find(dom,node,false)&& !find(dom,node.firstChild,true,1)){node.insertBefore(dom.create('br'),node.firstChild);}if(!find(dom,node,true)&& !find(dom,node.lastChild,false,1)){node.appendChild(dom.create('br'));}}}else{if(parentNode===dom.getRoot()){if(!format.list_block||!isEq(node,format.list_block)){each(Tools.grep(node.childNodes),function(node){if(FormatUtils.isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())){if(!rootBlockElm){rootBlockElm=wrap(dom,node,forcedRootBlock);dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs);}else{rootBlockElm.appendChild(node);}}else{rootBlockElm=0;}});}}}}if(format.selector && format.inline && !isEq(format.inline,node)){return;}dom.remove(node,1);};var removeFormat=function(ed,format,vars,node,compareNode){var i,attrs,stylesModified,dom=ed.dom;if(!matchName(dom,node,format)&& !isColorFormatAndAnchor(node,format)){return false;}if(format.remove !=='all'){each(format.styles,function(value,name){value=FormatUtils.normalizeStyleValue(dom,FormatUtils.replaceVars(value,vars),name);if(typeof name==='number'){name=value;compareNode=0;}if(format.remove_similar||(!compareNode||isEq(FormatUtils.getStyle(dom,compareNode,name),value))){dom.setStyle(node,name,'');}stylesModified=1;});if(stylesModified && dom.getAttrib(node,'style')===''){node.removeAttribute('style');node.removeAttribute('data-mce-style');}each(format.attributes,function(value,name){var valueOut;value=FormatUtils.replaceVars(value,vars);if(typeof name==='number'){name=value;compareNode=0;}if(!compareNode||isEq(dom.getAttrib(compareNode,name),value)){if(name==='class'){value=dom.getAttrib(node,name);if(value){valueOut='';each(value.split(/\s+/),function(cls){if(/mce\-\w+/.test(cls)){valueOut+=(valueOut ? ' ' :'')+cls;}});if(valueOut){dom.setAttrib(node,name,valueOut);return;}}}if(name==="class"){node.removeAttribute('className');}if(MCE_ATTR_RE.test(name)){node.removeAttribute('data-mce-'+name);}node.removeAttribute(name);}});each(format.classes,function(value){value=FormatUtils.replaceVars(value,vars);if(!compareNode||dom.hasClass(compareNode,value)){dom.removeClass(node,value);}});attrs=dom.getAttribs(node);for(i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(attrName.indexOf('_')!==0 && attrName.indexOf('data-')!==0){return false;}}}if(format.remove !=='none'){removeNode(ed,node,format);return true;}};var findFormatRoot=function(editor,container,name,vars,similar){var formatRoot;each(FormatUtils.getParents(editor.dom,container.parentNode).reverse(),function(parent){var format;if(!formatRoot && parent.id !=='_start' && parent.id !=='_end'){format=MatchFormat.matchNode(editor,parent,name,vars,similar);if(format && format.split !==false){formatRoot=parent;}}});return formatRoot;};var wrapAndSplit=function(editor,formatList,formatRoot,container,target,split,format,vars){var parent,clone,lastClone,firstClone,i,formatRootParent,dom=editor.dom;if(formatRoot){formatRootParent=formatRoot.parentNode;for(parent=container.parentNode;parent && parent !==formatRootParent;parent=parent.parentNode){clone=dom.clone(parent,false);for(i=0;i<formatList.length;i++){if(removeFormat(editor,formatList[i],vars,clone,clone)){clone=0;break;}}if(clone){if(lastClone){clone.appendChild(lastClone);}if(!firstClone){firstClone=clone;}lastClone=clone;}}if(split &&(!format.mixed||!dom.isBlock(formatRoot))){container=dom.split(formatRoot,container);}if(lastClone){target.parentNode.insertBefore(lastClone,target);firstClone.appendChild(target);}}return container;};var remove=function(ed,name,vars,node,similar){var formatList=ed.formatter.get(name),format=formatList[0];var bookmark,rng,contentEditable=true,dom=ed.dom,selection=ed.selection;var splitToFormatRoot=function(container){var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,true,format,vars);};var process=function(node){var children,i,l,lastContentEditable,hasContentEditableState;if(NodeType.isElement(node)&& dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==="true";hasContentEditableState=true;}children=Tools.grep(node.childNodes);if(contentEditable && !hasContentEditableState){for(i=0,l=formatList.length;i<l;i++){if(removeFormat(ed,formatList[i],vars,node,node)){break;}}}if(format.deep){if(children.length){for(i=0,l=children.length;i<l;i++){process(children[i]);}if(hasContentEditableState){contentEditable=lastContentEditable;}}}};var unwrap=function(start){var node=dom.get(start ? '_start' :'_end'),out=node[start ? 'firstChild' :'lastChild'];if(Bookmarks.isBookmarkNode(out)){out=out[start ? 'firstChild' :'lastChild'];}if(NodeType.isText(out)&& out.data.length===0){out=start ? node.previousSibling||node.nextSibling :node.nextSibling||node.previousSibling;}dom.remove(node,true);return out;};var removeRngStyle=function(rng){var startContainer,endContainer;var commonAncestorContainer=rng.commonAncestorContainer;rng=ExpandRange.expandRng(ed,rng,formatList,true);if(format.split){startContainer=getContainer(ed,rng,true);endContainer=getContainer(ed,rng);if(startContainer !==endContainer){if(/^(TR|TH|TD)$/.test(startContainer.nodeName)&& startContainer.firstChild){if(startContainer.nodeName==="TR"){startContainer=startContainer.firstChild.firstChild||startContainer;}else{startContainer=startContainer.firstChild||startContainer;}}if(commonAncestorContainer && /^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName)&& isTableCell(endContainer)&& endContainer.firstChild){endContainer=endContainer.firstChild||endContainer;}if(dom.isChildOf(startContainer,endContainer)&& startContainer !==endContainer && !dom.isBlock(endContainer)&& !isTableCell(startContainer)&& !isTableCell(endContainer)){startContainer=wrap(dom,startContainer,'span',{id:'_start','data-mce-type':'bookmark'});splitToFormatRoot(startContainer);startContainer=unwrap(true);return;}startContainer=wrap(dom,startContainer,'span',{id:'_start','data-mce-type':'bookmark'});endContainer=wrap(dom,endContainer,'span',{id:'_end','data-mce-type':'bookmark'});splitToFormatRoot(startContainer);splitToFormatRoot(endContainer);startContainer=unwrap(true);endContainer=unwrap();}else{startContainer=endContainer=splitToFormatRoot(startContainer);}rng.startContainer=startContainer.parentNode ? startContainer.parentNode :startContainer;rng.startOffset=dom.nodeIndex(startContainer);rng.endContainer=endContainer.parentNode ? endContainer.parentNode :endContainer;rng.endOffset=dom.nodeIndex(endContainer)+1;}RangeWalk.walk(dom,rng,function(nodes){each(nodes,function(node){process(node);if(NodeType.isElement(node)&& ed.dom.getStyle(node,'text-decoration')==='underline' && node.parentNode && FormatUtils.getTextDecoration(dom,node.parentNode)==='underline'){removeFormat(ed,{'deep':false,'exact':true,'inline':'span','styles':{'textDecoration':'underline'}},null,node);}});});};if(node){if(node.nodeType){rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);removeRngStyle(rng);}else{removeRngStyle(node);}return;}if(dom.getContentEditable(selection.getNode())==="false"){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){if(formatList[i].ceFalseOverride){if(removeFormat(ed,formatList[i],vars,node,node)){break;}}}return;}if(!selection.isCollapsed()||!format.inline||dom.select('td[data-mce-selected],th[data-mce-selected]').length){bookmark=selection.getBookmark();removeRngStyle(selection.getRng(true));selection.moveToBookmark(bookmark);if(format.inline && MatchFormat.match(ed,name,vars,selection.getStart())){FormatUtils.moveStart(dom,selection,selection.getRng(true));}ed.nodeChanged();}else{CaretFormat.removeCaretFormat(ed,name,vars,similar);}};return{removeFormat:removeFormat,remove:remove};});define('tinymce.core.fmt.MergeFormats',['ephox.katamari.api.Fun','tinymce.core.dom.Bookmarks','tinymce.core.dom.ElementUtils','tinymce.core.dom.NodeType','tinymce.core.fmt.CaretFormat','tinymce.core.fmt.FormatUtils','tinymce.core.fmt.MatchFormat','tinymce.core.fmt.RemoveFormat','tinymce.core.util.Tools'],function(Fun,Bookmarks,ElementUtils,NodeType,CaretFormat,FormatUtils,MatchFormat,RemoveFormat,Tools){var each=Tools.each;var isElementNode=function(node){return node && node.nodeType===1 && !Bookmarks.isBookmarkNode(node)&& !CaretFormat.isCaretNode(node)&& !NodeType.isBogus(node);};var findElementSibling=function(node,siblingName){var sibling;for(sibling=node;sibling;sibling=sibling[siblingName]){if(sibling.nodeType===3 && sibling.nodeValue.length !==0){return node;}if(sibling.nodeType===1 && !Bookmarks.isBookmarkNode(sibling)){return sibling;}}return node;};var mergeSiblingsNodes=function(dom,prev,next){var sibling,tmpSibling,elementUtils=new ElementUtils(dom);if(prev && next){prev=findElementSibling(prev,'previousSibling');next=findElementSibling(next,'nextSibling');if(elementUtils.compare(prev,next)){for(sibling=prev.nextSibling;sibling && sibling !==next;){tmpSibling=sibling;sibling=sibling.nextSibling;prev.appendChild(tmpSibling);}dom.remove(next);Tools.each(Tools.grep(next.childNodes),function(node){prev.appendChild(node);});return prev;}}return next;};var processChildElements=function(node,filter,process){each(node.childNodes,function(node){if(isElementNode(node)){if(filter(node)){process(node);}if(node.hasChildNodes()){processChildElements(node,filter,process);}}});};var hasStyle=function(dom,name){return Fun.curry(function(name,node){return !!(node && FormatUtils.getStyle(dom,node,name));},name);};var applyStyle=function(dom,name,value){return Fun.curry(function(name,value,node){dom.setStyle(node,name,value);if(node.getAttribute('style')===''){node.removeAttribute('style');}unwrapEmptySpan(dom,node);},name,value);};var unwrapEmptySpan=function(dom,node){if(node.nodeName==='SPAN' && dom.getAttribs(node).length===0){dom.remove(node,true);}};var processUnderlineAndColor=function(dom,node){var textDecoration;if(node.nodeType===1 && node.parentNode && node.parentNode.nodeType===1){textDecoration=FormatUtils.getTextDecoration(dom,node.parentNode);if(dom.getStyle(node,'color')&& textDecoration){dom.setStyle(node,'text-decoration',textDecoration);}else if(dom.getStyle(node,'text-decoration')===textDecoration){dom.setStyle(node,'text-decoration',null);}}};var mergeUnderlineAndColor=function(dom,format,vars,node){if(format.styles.color||format.styles.textDecoration){Tools.walk(node,Fun.curry(processUnderlineAndColor,dom),'childNodes');processUnderlineAndColor(dom,node);}};var mergeBackgroundColorAndFontSize=function(dom,format,vars,node){if(format.styles && format.styles.backgroundColor){processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'backgroundColor',FormatUtils.replaceVars(format.styles.backgroundColor,vars)));}};var mergeSubSup=function(dom,format,vars,node){if(format.inline==='sub'||format.inline==='sup'){processChildElements(node,hasStyle(dom,'fontSize'),applyStyle(dom,'fontSize',''));dom.remove(dom.select(format.inline==='sup' ? 'sub' :'sup',node),true);}};var mergeSiblings=function(dom,format,vars,node){if(node && format.merge_siblings !==false){node=mergeSiblingsNodes(dom,FormatUtils.getNonWhiteSpaceSibling(node),node);node=mergeSiblingsNodes(dom,node,FormatUtils.getNonWhiteSpaceSibling(node,true));}};var clearChildStyles=function(dom,format,node){if(format.clear_child_styles){var selector=format.links ? '*:not(a)' :'*';each(dom.select(selector,node),function(node){if(isElementNode(node)){each(format.styles,function(value,name){dom.setStyle(node,name,'');});}});}};var mergeWithChildren=function(editor,formatList,vars,node){each(formatList,function(format){each(editor.dom.select(format.inline,node),function(child){if(!isElementNode(child)){return;}RemoveFormat.removeFormat(editor,format,vars,child,format.exact ? child :null);});clearChildStyles(editor.dom,format,node);});};var mergeWithParents=function(editor,format,name,vars,node){if(MatchFormat.matchNode(editor,node.parentNode,name,vars)){if(RemoveFormat.removeFormat(editor,format,vars,node)){return;}}if(format.merge_with_parents){editor.dom.getParent(node.parentNode,function(parent){if(MatchFormat.matchNode(editor,parent,name,vars)){RemoveFormat.removeFormat(editor,format,vars,node);return true;}});}};return{mergeWithChildren:mergeWithChildren,mergeUnderlineAndColor:mergeUnderlineAndColor,mergeBackgroundColorAndFontSize:mergeBackgroundColorAndFontSize,mergeSubSup:mergeSubSup,mergeSiblings:mergeSiblings,mergeWithParents:mergeWithParents};});define('tinymce.core.fmt.ApplyFormat',['tinymce.core.dom.Bookmarks','tinymce.core.dom.NodeType','tinymce.core.fmt.CaretFormat','tinymce.core.fmt.ExpandRange','tinymce.core.fmt.FormatUtils','tinymce.core.fmt.Hooks','tinymce.core.fmt.MatchFormat','tinymce.core.fmt.MergeFormats','tinymce.core.selection.RangeNormalizer','tinymce.core.selection.RangeWalk','tinymce.core.util.Tools'],function(Bookmarks,NodeType,CaretFormat,ExpandRange,FormatUtils,Hooks,MatchFormat,MergeFormats,RangeNormalizer,RangeWalk,Tools){var each=Tools.each;var isElementNode=function(node){return node && node.nodeType===1 && !Bookmarks.isBookmarkNode(node)&& !CaretFormat.isCaretNode(node)&& !NodeType.isBogus(node);};var processChildElements=function(node,filter,process){each(node.childNodes,function(node){if(isElementNode(node)){if(filter(node)){process(node);}if(node.hasChildNodes()){processChildElements(node,filter,process);}}});};var applyFormat=function(ed,name,vars,node){var formatList=ed.formatter.get(name),format=formatList[0],bookmark,rng,isCollapsed=!node && ed.selection.isCollapsed();var dom=ed.dom,selection=ed.selection;var setElementFormat=function(elm,fmt){fmt=fmt||format;if(elm){if(fmt.onformat){fmt.onformat(elm,fmt,vars,node);}each(fmt.styles,function(value,name){dom.setStyle(elm,name,FormatUtils.replaceVars(value,vars));});if(fmt.styles){var styleVal=dom.getAttrib(elm,'style');if(styleVal){elm.setAttribute('data-mce-style',styleVal);}}each(fmt.attributes,function(value,name){dom.setAttrib(elm,name,FormatUtils.replaceVars(value,vars));});each(fmt.classes,function(value){value=FormatUtils.replaceVars(value,vars);if(!dom.hasClass(elm,value)){dom.addClass(elm,value);}});}};var applyNodeStyle=function(formatList,node){var found=false;if(!format.selector){return false;}each(formatList,function(format){if('collapsed' in format && format.collapsed !==isCollapsed){return;}if(dom.is(node,format.selector)&& !CaretFormat.isCaretNode(node)){setElementFormat(node,format);found=true;return false;}});return found;};var applyRngStyle=function(dom,rng,bookmark,nodeSpecific){var newWrappers=[],wrapName,wrapElm,contentEditable=true;wrapName=format.inline||format.block;wrapElm=dom.create(wrapName);setElementFormat(wrapElm);RangeWalk.walk(dom,rng,function(nodes){var currentWrapElm;var process=function(node){var nodeName,parentName,hasContentEditableState,lastContentEditable;lastContentEditable=contentEditable;nodeName=node.nodeName.toLowerCase();parentName=node.parentNode.nodeName.toLowerCase();if(node.nodeType===1 && dom.getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=dom.getContentEditable(node)==="true";hasContentEditableState=true;}if(FormatUtils.isEq(nodeName,'br')){currentWrapElm=0;if(format.block){dom.remove(node);}return;}if(format.wrapper && MatchFormat.matchNode(ed,node,name,vars)){currentWrapElm=0;return;}if(contentEditable && !hasContentEditableState && format.block && !format.wrapper && FormatUtils.isTextBlock(ed,nodeName)&& FormatUtils.isValid(ed,parentName,wrapName)){node=dom.rename(node,wrapName);setElementFormat(node);newWrappers.push(node);currentWrapElm=0;return;}if(format.selector){var found=applyNodeStyle(formatList,node);if(!format.inline||found){currentWrapElm=0;return;}}if(contentEditable && !hasContentEditableState && FormatUtils.isValid(ed,wrapName,nodeName)&& FormatUtils.isValid(ed,parentName,wrapName)&& !(!nodeSpecific && node.nodeType===3 && node.nodeValue.length===1 && node.nodeValue.charCodeAt(0)===65279)&& !CaretFormat.isCaretNode(node)&&(!format.inline||!dom.isBlock(node))){if(!currentWrapElm){currentWrapElm=dom.clone(wrapElm,false);node.parentNode.insertBefore(currentWrapElm,node);newWrappers.push(currentWrapElm);}currentWrapElm.appendChild(node);}else{currentWrapElm=0;each(Tools.grep(node.childNodes),process);if(hasContentEditableState){contentEditable=lastContentEditable;}currentWrapElm=0;}};each(nodes,process);});if(format.links===true){each(newWrappers,function(node){var process=function(node){if(node.nodeName==='A'){setElementFormat(node,format);}each(Tools.grep(node.childNodes),process);};process(node);});}each(newWrappers,function(node){var childCount;var getChildCount=function(node){var count=0;each(node.childNodes,function(node){if(!FormatUtils.isWhiteSpaceNode(node)&& !Bookmarks.isBookmarkNode(node)){count++;}});return count;};var getChildElementNode=function(root){var child=false;each(root.childNodes,function(node){if(isElementNode(node)){child=node;return false;}});return child;};var mergeStyles=function(node){var child,clone;child=getChildElementNode(node);if(child && !Bookmarks.isBookmarkNode(child)&& MatchFormat.matchName(dom,child,format)){clone=dom.clone(child,false);setElementFormat(clone);dom.replace(clone,node,true);dom.remove(child,1);}return clone||node;};childCount=getChildCount(node);if((newWrappers.length>1||!dom.isBlock(node))&& childCount===0){dom.remove(node,1);return;}if(format.inline||format.wrapper){if(!format.exact && childCount===1){node=mergeStyles(node);}MergeFormats.mergeWithChildren(ed,formatList,vars,node);MergeFormats.mergeWithParents(ed,format,name,vars,node);MergeFormats.mergeBackgroundColorAndFontSize(dom,format,vars,node);MergeFormats.mergeSubSup(dom,format,vars,node);MergeFormats.mergeSiblings(dom,format,vars,node);}});};if(dom.getContentEditable(selection.getNode())==="false"){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){if(formatList[i].ceFalseOverride && dom.is(node,formatList[i].selector)){setElementFormat(node,formatList[i]);return;}}return;}if(format){if(node){if(node.nodeType){if(!applyNodeStyle(formatList,node)){rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);applyRngStyle(dom,ExpandRange.expandRng(ed,rng,formatList),null,true);}}else{applyRngStyle(dom,node,null,true);}}else{if(!isCollapsed||!format.inline||dom.select('td[data-mce-selected],th[data-mce-selected]').length){var curSelNode=ed.selection.getNode();if(!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode,dom.isBlock)){applyFormat(ed,formatList[0].defaultBlock);}ed.selection.setRng(RangeNormalizer.normalize(ed.selection.getRng()));bookmark=selection.getBookmark();applyRngStyle(dom,ExpandRange.expandRng(ed,selection.getRng(true),formatList),bookmark);if(format.styles){MergeFormats.mergeUnderlineAndColor(dom,format,vars,curSelNode);}selection.moveToBookmark(bookmark);FormatUtils.moveStart(dom,selection,selection.getRng(true));ed.nodeChanged();}else{CaretFormat.applyCaretFormat(ed,name,vars);}}Hooks.postProcess(name,ed);}};return{applyFormat:applyFormat};});define('tinymce.core.fmt.FormatChanged',['ephox.katamari.api.Cell','tinymce.core.fmt.FormatUtils','tinymce.core.fmt.MatchFormat','tinymce.core.util.Tools'],function(Cell,FormatUtils,MatchFormat,Tools){var each=Tools.each;var setup=function(formatChangeData,editor){var currentFormats={};formatChangeData.set({});editor.on('NodeChange',function(e){var parents=FormatUtils.getParents(editor.dom,e.element),matchedFormats={};parents=Tools.grep(parents,function(node){return node.nodeType===1 && !node.getAttribute('data-mce-bogus');});each(formatChangeData.get(),function(callbacks,format){each(parents,function(node){if(editor.formatter.matchNode(node,format,{},callbacks.similar)){if(!currentFormats[format]){each(callbacks,function(callback){callback(true,{node:node,format:format,parents:parents});});currentFormats[format]=callbacks;}matchedFormats[format]=callbacks;return false;}if(MatchFormat.matchesUnInheritedFormatSelector(editor,node,format)){return false;}});});each(currentFormats,function(callbacks,format){if(!matchedFormats[format]){delete currentFormats[format];each(callbacks,function(callback){callback(false,{node:e.element,format:format,parents:parents});});}});});};var addListeners=function(formatChangeData,formats,callback,similar){var formatChangeItems=formatChangeData.get();each(formats.split(','),function(format){if(!formatChangeItems[format]){formatChangeItems[format]=[];formatChangeItems[format].similar=similar;}formatChangeItems[format].push(callback);});formatChangeData.set(formatChangeItems);};var formatChanged=function(editor,formatChangeState,formats,callback,similar){if(formatChangeState.get()===null){setup(formatChangeState,editor);}addListeners(formatChangeState,formats,callback,similar);};return{formatChanged:formatChanged};});define('tinymce.core.fmt.DefaultFormats',['tinymce.core.util.Tools'],function(Tools){var get=function(dom){var formats={valigntop:[{selector:'td,th',styles:{'verticalAlign':'top'}}],valignmiddle:[{selector:'td,th',styles:{'verticalAlign':'middle'}}],valignbottom:[{selector:'td,th',styles:{'verticalAlign':'bottom'}}],alignleft:[{selector:'figure.image',collapsed:false,classes:'align-left',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'left'},inherit:false,preview:false,defaultBlock:'div'},{selector:'img,table',collapsed:false,styles:{'float':'left'},preview:'font-family font-size'}],aligncenter:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'center'},inherit:false,preview:'font-family font-size',defaultBlock:'div'},{selector:'figure.image',collapsed:false,classes:'align-center',ceFalseOverride:true,preview:'font-family font-size'},{selector:'img',collapsed:false,styles:{display:'block',marginLeft:'auto',marginRight:'auto'},preview:false},{selector:'table',collapsed:false,styles:{marginLeft:'auto',marginRight:'auto'},preview:'font-family font-size'}],alignright:[{selector:'figure.image',collapsed:false,classes:'align-right',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'right'},inherit:false,preview:'font-family font-size',defaultBlock:'div'},{selector:'img,table',collapsed:false,styles:{'float':'right'},preview:'font-family font-size'}],alignjustify:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',styles:{textAlign:'justify'},inherit:false,defaultBlock:'div',preview:'font-family font-size'}],bold:[{inline:'strong',remove:'all'},{inline:'span',styles:{fontWeight:'bold'}},{inline:'b',remove:'all'}],italic:[{inline:'em',remove:'all'},{inline:'span',styles:{fontStyle:'italic'}},{inline:'i',remove:'all'}],underline:[{inline:'span',styles:{textDecoration:'underline'},exact:true},{inline:'u',remove:'all'}],strikethrough:[{inline:'span',styles:{textDecoration:'line-through'},exact:true},{inline:'strike',remove:'all'}],forecolor:{inline:'span',styles:{color:'%value'},links:true,remove_similar:true,clear_child_styles:true},hilitecolor:{inline:'span',styles:{backgroundColor:'%value'},links:true,remove_similar:true,clear_child_styles:true},fontname:{inline:'span',styles:{fontFamily:'%value'},clear_child_styles:true},fontsize:{inline:'span',styles:{fontSize:'%value'},clear_child_styles:true},fontsize_class:{inline:'span',attributes:{'class':'%value'}},blockquote:{block:'blockquote',wrapper:1,remove:'all'},subscript:{inline:'sub'},superscript:{inline:'sup'},code:{inline:'code'},link:{inline:'a',selector:'a',remove:'all',split:true,deep:true,onmatch:function(){return true;},onformat:function(elm,fmt,vars){Tools.each(vars,function(value,key){dom.setAttrib(elm,key,value);});}},removeformat:[{selector:'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',remove:'all',split:true,expand:false,block_expand:true,deep:true},{selector:'span',attributes:['style','class'],remove:'empty',split:true,expand:false,deep:true},{selector:'*',attributes:['style','class'],split:false,expand:false,deep:true}]};Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\s/),function(name){formats[name]={block:name,remove:'all'};});return formats;};return{get:get};});define('tinymce.core.fmt.FormatRegistry',['tinymce.core.fmt.DefaultFormats','tinymce.core.util.Tools'],function(DefaultFormats,Tools){return function(editor){var formats={};var get=function(name){return name ? formats[name]:formats;};var register=function(name,format){if(name){if(typeof name !=='string'){Tools.each(name,function(format,name){register(name,format);});}else{format=format.length ? format :[format];Tools.each(format,function(format){if(typeof format.deep==='undefined'){format.deep=!format.selector;}if(typeof format.split==='undefined'){format.split=!format.selector||format.inline;}if(typeof format.remove==='undefined' && format.selector && !format.inline){format.remove='none';}if(format.selector && format.inline){format.mixed=true;format.block_expand=true;}if(typeof format.classes==='string'){format.classes=format.classes.split(/\s+/);}});formats[name]=format;}}};var unregister=function(name){if(name && formats[name]){delete formats[name];}return formats;};register(DefaultFormats.get(editor.dom));register(editor.settings.formats);return{get:get,register:register,unregister:unregister};};});define('tinymce.core.fmt.Preview',["tinymce.core.dom.DOMUtils","tinymce.core.util.Tools","tinymce.core.html.Schema"],function(DOMUtils,Tools,Schema){var each=Tools.each;var dom=DOMUtils.DOM;var parsedSelectorToHtml=function(ancestry,editor){var elm,item,fragment;var schema=editor && editor.schema||new Schema({});var decorate=function(elm,item){if(item.classes.length){dom.addClass(elm,item.classes.join(' '));}dom.setAttribs(elm,item.attrs);};var createElement=function(sItem){var elm;item=typeof sItem==='string' ?{name:sItem,classes:[],attrs:{}}:sItem;elm=dom.create(item.name);decorate(elm,item);return elm;};var getRequiredParent=function(elm,candidate){var name=typeof elm !=='string' ? elm.nodeName.toLowerCase():elm;var elmRule=schema.getElementRule(name);var parentsRequired=elmRule && elmRule.parentsRequired;if(parentsRequired && parentsRequired.length){return candidate && Tools.inArray(parentsRequired,candidate)!==-1 ? candidate :parentsRequired[0];}else{return false;}};var wrapInHtml=function(elm,ancestry,siblings){var parent,parentCandidate,parentRequired;var ancestor=ancestry.length>0 && ancestry[0];var ancestorName=ancestor && ancestor.name;parentRequired=getRequiredParent(elm,ancestorName);if(parentRequired){if(ancestorName===parentRequired){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else{parentCandidate=parentRequired;}}else if(ancestor){parentCandidate=ancestry[0];ancestry=ancestry.slice(1);}else if(!siblings){return elm;}if(parentCandidate){parent=createElement(parentCandidate);parent.appendChild(elm);}if(siblings){if(!parent){parent=dom.create('div');parent.appendChild(elm);}Tools.each(siblings,function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm);});}return wrapInHtml(parent,ancestry,parentCandidate && parentCandidate.siblings);};if(ancestry && ancestry.length){item=ancestry[0];elm=createElement(item);fragment=dom.create('div');fragment.appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings));return fragment;}else{return '';}};var selectorToHtml=function(selector,editor){return parsedSelectorToHtml(parseSelector(selector),editor);};var parseSelectorItem=function(item){var tagName;var obj={classes:[],attrs:{}};item=obj.selector=Tools.trim(item);if(item !=='*'){tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function($0,$1,$2,$3,$4){switch($1){case '#':obj.attrs.id=$2;break;case '.':obj.classes.push($2);break;case ':':if(Tools.inArray('checked disabled enabled read-only required'.split(' '),$2)!==-1){obj.attrs[$2]=$2;}break;}if($3==='['){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);if(m){obj.attrs[m[1]]=m[2];}}return '';});}obj.name=tagName||'div';return obj;};var parseSelector=function(selector){if(!selector||typeof selector !=='string'){return[];}selector=selector.split(/\s*,\s*/)[0];selector=selector.replace(/\s*(~\+|~|\+|>)\s*/g,'$1');return Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem);var obj=siblings.pop();if(siblings.length){obj.siblings=siblings;}return obj;}).reverse();};var getCssText=function(editor,format){var name,previewFrag,previewElm,items;var previewCss='',parentFontSize,previewStyles;previewStyles=editor.settings.preview_styles;if(previewStyles===false){return '';}if(typeof previewStyles !=='string'){previewStyles='font-family font-size font-weight font-style text-decoration '+'text-transform color background-color border border-radius outline text-shadow';}var removeVars=function(val){return val.replace(/%(\w+)/g,'');};if(typeof format==="string"){format=editor.formatter.get(format);if(!format){return;}format=format[0];}if('preview' in format){previewStyles=format.preview;if(previewStyles===false){return '';}}name=format.block||format.inline||'span';items=parseSelector(format.selector);if(items.length){if(!items[0].name){items[0].name=name;}name=format.selector;previewFrag=parsedSelectorToHtml(items,editor);}else{previewFrag=parsedSelectorToHtml([name],editor);}previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;each(format.styles,function(value,name){value=removeVars(value);if(value){dom.setStyle(previewElm,name,value);}});each(format.attributes,function(value,name){value=removeVars(value);if(value){dom.setAttrib(previewElm,name,value);}});each(format.classes,function(value){value=removeVars(value);if(!dom.hasClass(previewElm,value)){dom.addClass(previewElm,value);}});editor.fire('PreviewFormats');dom.setStyles(previewFrag,{position:'absolute',left:-0xFFFF});editor.getBody().appendChild(previewFrag);parentFontSize=dom.getStyle(editor.getBody(),'fontSize',true);parentFontSize=/px$/.test(parentFontSize)? parseInt(parentFontSize,10):0;each(previewStyles.split(' '),function(name){var value=dom.getStyle(previewElm,name,true);if(name==='background-color' && /transparent|rgba\s*\([^)]+,\s*0\)/.test(value)){value=dom.getStyle(editor.getBody(),name,true);if(dom.toHex(value).toLowerCase()==='#ffffff'){return;}}if(name==='color'){if(dom.toHex(value).toLowerCase()==='#000000'){return;}}if(name==='font-size'){if(/em|%$/.test(value)){if(parentFontSize===0){return;}value=parseFloat(value,10)/ (/%$/.test(value)? 100 :1);value=(value*parentFontSize)+'px';}}if(name==="border" && value){previewCss+='padding:0 2px;';}previewCss+=name+':'+value+';';});editor.fire('AfterPreviewFormats');dom.remove(previewFrag);return previewCss;};return{getCssText:getCssText,parseSelector:parseSelector,selectorToHtml:selectorToHtml};});define('tinymce.core.fmt.ToggleFormat',['tinymce.core.fmt.ApplyFormat','tinymce.core.fmt.MatchFormat','tinymce.core.fmt.RemoveFormat'],function(ApplyFormat,MatchFormat,RemoveFormat){var toggle=function(editor,formats,name,vars,node){var fmt=formats.get(name);if(MatchFormat.match(editor,name,vars,node)&&(!('toggle' in fmt[0])||fmt[0].toggle)){RemoveFormat.remove(editor,name,vars,node);}else{ApplyFormat.applyFormat(editor,name,vars,node);}};return{toggle:toggle};});define('tinymce.core.keyboard.FormatShortcuts',[],function(){var setup=function(editor){editor.addShortcut('meta+b','','Bold');editor.addShortcut('meta+i','','Italic');editor.addShortcut('meta+u','','Underline');for(var i=1;i<=6;i++){editor.addShortcut('access+'+i,'',['FormatBlock',false,'h'+i]);}editor.addShortcut('access+7','',['FormatBlock',false,'p']);editor.addShortcut('access+8','',['FormatBlock',false,'div']);editor.addShortcut('access+9','',['FormatBlock',false,'address']);};return{setup:setup};});define('tinymce.core.api.Formatter',['ephox.katamari.api.Cell','ephox.katamari.api.Fun','tinymce.core.fmt.ApplyFormat','tinymce.core.fmt.CaretFormat','tinymce.core.fmt.FormatChanged','tinymce.core.fmt.FormatRegistry','tinymce.core.fmt.MatchFormat','tinymce.core.fmt.Preview','tinymce.core.fmt.RemoveFormat','tinymce.core.fmt.ToggleFormat','tinymce.core.keyboard.FormatShortcuts'],function(Cell,Fun,ApplyFormat,CaretFormat,FormatChanged,FormatRegistry,MatchFormat,Preview,RemoveFormat,ToggleFormat,FormatShortcuts){return function(editor){var formats=FormatRegistry(editor);var formatChangeState=Cell(null);FormatShortcuts.setup(editor);CaretFormat.setup(editor);return{get:formats.get,register:formats.register,unregister:formats.unregister,apply:Fun.curry(ApplyFormat.applyFormat,editor),remove:Fun.curry(RemoveFormat.remove,editor),toggle:Fun.curry(ToggleFormat.toggle,editor,formats),match:Fun.curry(MatchFormat.match,editor),matchAll:Fun.curry(MatchFormat.matchAll,editor),matchNode:Fun.curry(MatchFormat.matchNode,editor),canApply:Fun.curry(MatchFormat.canApply,editor),formatChanged:Fun.curry(FormatChanged.formatChanged,editor,formatChangeState),getCssText:Fun.curry(Preview.getCssText,editor)};};});define('ephox.katamari.api.Merger',['ephox.katamari.api.Type','global!Array','global!Error'],function(Type,Array,Error){var shallow=function(old,nu){return nu;};var deep=function(old,nu){var bothObjects=Type.isObject(old)&& Type.isObject(nu);return bothObjects ? deepMerge(old,nu):nu;};var baseMerge=function(merger){return function(){var objects=new Array(arguments.length);for(var i=0;i<objects.length;i++)objects[i]=arguments[i];if(objects.length===0)throw new Error('Can\'t merge zero objects');var ret={};for(var j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)if(curObject.hasOwnProperty(key)){ret[key]=merger(ret[key],curObject[key]);}}return ret;};};var deepMerge=baseMerge(deep);var merge=baseMerge(shallow);return{deepMerge:deepMerge,merge:merge};});define('tinymce.core.api.Events',[],function(){var firePreProcess=function(editor,args){return editor.fire('PreProcess',args);};var firePostProcess=function(editor,args){return editor.fire('PostProcess',args);};return{firePreProcess:firePreProcess,firePostProcess:firePostProcess};});define('tinymce.core.dom.DomSerializerFilters',['ephox.katamari.api.Arr','tinymce.core.html.Entities'],function(Arr,Entities){var register=function(htmlParser,settings,dom){htmlParser.addAttributeFilter('data-mce-tabindex',function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];node.attr('tabindex',node.attributes.map['data-mce-tabindex']);node.attr(name,null);}});htmlParser.addAttributeFilter('src,href,style',function(nodes,name){var i=nodes.length,node,value,internalName='data-mce-'+name;var urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,undef;while(i--){node=nodes[i];value=node.attributes.map[internalName];if(value !==undef){node.attr(name,value.length>0 ? value :null);node.attr(internalName,null);}else{value=node.attributes.map[name];if(name==="style"){value=dom.serializeStyle(dom.parseStyle(value),node.name);}else if(urlConverter){value=urlConverter.call(urlConverterScope,value,name,node.name);}node.attr(name,value.length>0 ? value :null);}}});htmlParser.addAttributeFilter('class',function(nodes){var i=nodes.length,node,value;while(i--){node=nodes[i];value=node.attr('class');if(value){value=node.attr('class').replace(/(?:^|\s)mce-item-\w+(?!\S)/g,'');node.attr('class',value.length>0 ? value :null);}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes,name,args){var i=nodes.length,node;while(i--){node=nodes[i];if(node.attributes.map['data-mce-type']==='bookmark' && !args.cleanup){node.remove();}}});htmlParser.addNodeFilter('noscript',function(nodes){var i=nodes.length,node;while(i--){node=nodes[i].firstChild;if(node){node.value=Entities.decode(node.value);}}});htmlParser.addNodeFilter('script,style',function(nodes,name){var i=nodes.length,node,value,type;var trim=function(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,'\n').replace(/^[\r\n]*|[\r\n]*$/g,'').replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,'').replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,'');};while(i--){node=nodes[i];value=node.firstChild ? node.firstChild.value :'';if(name==="script"){type=node.attr('type');if(type){node.attr('type',type==='mce-no/type' ? null :type.replace(/^mce\-/,''));}if(settings.element_format==='xhtml' && value.length>0){node.firstChild.value='// <![CDATA[\n'+trim(value)+'\n// ]]>';}}else{if(settings.element_format==='xhtml' && value.length>0){node.firstChild.value='<!--\n'+trim(value)+'\n-->';}}}});htmlParser.addNodeFilter('#comment',function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];if(node.value.indexOf('[CDATA[')===0){node.name='#cdata';node.type=4;node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,'');}else if(node.value.indexOf('mce:protected ')===0){node.name="#text";node.type=3;node.raw=true;node.value=unescape(node.value).substr(14);}}});htmlParser.addNodeFilter('xml:namespace,input',function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];if(node.type===7){node.remove();}else if(node.type===1){if(name==="input" && !("type" in node.attributes.map)){node.attr('type','text');}}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes){Arr.each(nodes,function(node){if(node.attr('data-mce-type')==='format-caret'){if(node.isEmpty(htmlParser.schema.getNonEmptyElements())){node.remove();}else{node.unwrap();}}});});htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,'+'data-mce-selected,data-mce-expando,'+'data-mce-type,data-mce-resize',function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});};var trimTrailingBr=function(rootNode){var brNode1,brNode2;var isBr=function(node){return node && node.name==='br';};brNode1=rootNode.lastChild;if(isBr(brNode1)){brNode2=brNode1.prev;if(isBr(brNode2)){brNode1.remove();brNode2.remove();}}};return{register:register,trimTrailingBr:trimTrailingBr};});define('tinymce.core.dom.DomSerializerPreProcess',['ephox.katamari.api.Merger','global!document','tinymce.core.api.Events','tinymce.core.util.Tools'],function(Merger,document,Events,Tools){var preProcess=function(editor,node,args){var impl,doc,oldDoc;var dom=editor.dom;node=node.cloneNode(true);impl=document.implementation;if(impl.createHTMLDocument){doc=impl.createHTMLDocument('');Tools.each(node.nodeName==='BODY' ? node.childNodes :[node],function(node){doc.body.appendChild(doc.importNode(node,true));});if(node.nodeName !=='BODY'){node=doc.body.firstChild;}else{node=doc.body;}oldDoc=dom.doc;dom.doc=doc;}Events.firePreProcess(editor,Merger.merge(args,{node:node}));if(oldDoc){dom.doc=oldDoc;}return node;};var shouldFireEvent=function(editor,args){return editor && editor.hasEventListeners('PreProcess')&& !args.no_events;};var process=function(editor,node,args){return shouldFireEvent(editor,args)? preProcess(editor,node,args):node;};return{process:process};});define('tinymce.core.html.LegacyFilter',['ephox.katamari.api.Arr','tinymce.core.html.Styles','tinymce.core.util.Tools'],function(Arr,Styles,Tools){var removeAttrs=function(node,names){Arr.each(names,function(name){node.attr(name,null);});};var addFontToSpansFilter=function(domParser,styles,fontSizes){domParser.addNodeFilter('font',function(nodes){Arr.each(nodes,function(node){var props=styles.parse(node.attr('style'));var color=node.attr('color');var face=node.attr('face');var size=node.attr('size');if(color){props.color=color;}if(face){props['font-family']=face;}if(size){props['font-size']=fontSizes[parseInt(node.attr('size'),10)-1];}node.name='span';node.attr('style',styles.serialize(props));removeAttrs(node,['color','face','size']);});});};var addStrikeToSpanFilter=function(domParser,styles){domParser.addNodeFilter('strike',function(nodes){Arr.each(nodes,function(node){var props=styles.parse(node.attr('style'));props['text-decoration']='line-through';node.name='span';node.attr('style',styles.serialize(props));});});};var addFilters=function(domParser,settings){var styles=Styles();if(settings.convert_fonts_to_spans){addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values));}addStrikeToSpanFilter(domParser,styles);};var register=function(domParser,settings){if(settings.inline_styles){addFilters(domParser,settings);}};return{register:register};});define('tinymce.core.html.Node',[],function(){var whiteSpaceRegExp=/^[ \t\r\n]*$/;var typeLookup={'#text':3,'#comment':8,'#cdata':4,'#pi':7,'#doctype':10,'#document-fragment':11};var walk=function(node,rootNode,prev){var sibling,parent,startName=prev ? 'lastChild' :'firstChild',siblingName=prev ? 'prev' :'next';if(node[startName]){return node[startName];}if(node !==rootNode){sibling=node[siblingName];if(sibling){return sibling;}for(parent=node.parent;parent && parent !==rootNode;parent=parent.parent){sibling=parent[siblingName];if(sibling){return sibling;}}}};var Node=function(name,type){this.name=name;this.type=type;if(type===1){this.attributes=[];this.attributes.map={};}};Node.prototype={replace:function(node){var self=this;if(node.parent){node.remove();}self.insert(node,self);self.remove();return self;},attr:function(name,value){var self=this,attrs,i,undef;if(typeof name !=="string"){for(i in name){self.attr(i,name[i]);}return self;}if((attrs=self.attributes)){if(value !==undef){if(value===null){if(name in attrs.map){delete attrs.map[name];i=attrs.length;while(i--){if(attrs[i].name===name){attrs=attrs.splice(i,1);return self;}}}return self;}if(name in attrs.map){i=attrs.length;while(i--){if(attrs[i].name===name){attrs[i].value=value;break;}}}else{attrs.push({name:name,value:value});}attrs.map[name]=value;return self;}return attrs.map[name];}},clone:function(){var self=this,clone=new Node(self.name,self.type),i,l,selfAttrs,selfAttr,cloneAttrs;if((selfAttrs=self.attributes)){cloneAttrs=[];cloneAttrs.map={};for(i=0,l=selfAttrs.length;i<l;i++){selfAttr=selfAttrs[i];if(selfAttr.name !=='id'){cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value};cloneAttrs.map[selfAttr.name]=selfAttr.value;}}clone.attributes=cloneAttrs;}clone.value=self.value;clone.shortEnded=self.shortEnded;return clone;},wrap:function(wrapper){var self=this;self.parent.insert(wrapper,self);wrapper.append(self);return self;},unwrap:function(){var self=this,node,next;for(node=self.firstChild;node;){next=node.next;self.insert(node,self,true);node=next;}self.remove();},remove:function(){var self=this,parent=self.parent,next=self.next,prev=self.prev;if(parent){if(parent.firstChild===self){parent.firstChild=next;if(next){next.prev=null;}}else{prev.next=next;}if(parent.lastChild===self){parent.lastChild=prev;if(prev){prev.next=null;}}else{next.prev=prev;}self.parent=self.next=self.prev=null;}return self;},append:function(node){var self=this,last;if(node.parent){node.remove();}last=self.lastChild;if(last){last.next=node;node.prev=last;self.lastChild=node;}else{self.lastChild=self.firstChild=node;}node.parent=self;return node;},insert:function(node,refNode,before){var parent;if(node.parent){node.remove();}parent=refNode.parent||this;if(before){if(refNode===parent.firstChild){parent.firstChild=node;}else{refNode.prev.next=node;}node.prev=refNode.prev;node.next=refNode;refNode.prev=node;}else{if(refNode===parent.lastChild){parent.lastChild=node;}else{refNode.next.prev=node;}node.next=refNode.next;node.prev=refNode;refNode.next=node;}node.parent=parent;return node;},getAll:function(name){var self=this,node,collection=[];for(node=self.firstChild;node;node=walk(node,self)){if(node.name===name){collection.push(node);}}return collection;},empty:function(){var self=this,nodes,i,node;if(self.firstChild){nodes=[];for(node=self.firstChild;node;node=walk(node,self)){nodes.push(node);}i=nodes.length;while(i--){node=nodes[i];node.parent=node.firstChild=node.lastChild=node.next=node.prev=null;}}self.firstChild=self.lastChild=null;return self;},isEmpty:function(elements,whitespace,predicate){var self=this,node=self.firstChild,i,name;whitespace=whitespace||{};if(node){do{if(node.type===1){if(node.attributes.map['data-mce-bogus']){continue;}if(elements[node.name]){return false;}i=node.attributes.length;while(i--){name=node.attributes[i].name;if(name==="name"||name.indexOf('data-mce-bookmark')===0){return false;}}}if(node.type===8){return false;}if(node.type===3 && !whiteSpaceRegExp.test(node.value)){return false;}if(node.type===3 && node.parent && whitespace[node.parent.name]&& whiteSpaceRegExp.test(node.value)){return false;}if(predicate && predicate(node)){return false;}}while((node=walk(node,self)));}return true;},walk:function(prev){return walk(this,null,prev);}};Node.create=function(name,attrs){var node,attrName;node=new Node(name,typeLookup[name]||1);if(attrs){for(attrName in attrs){node.attr(attrName,attrs[attrName]);}}return node;};return Node;});define('tinymce.core.html.DomParser',['tinymce.core.html.LegacyFilter','tinymce.core.html.Node','tinymce.core.html.SaxParser','tinymce.core.html.Schema','tinymce.core.util.Tools'],function(LegacyFilter,Node,SaxParser,Schema,Tools){var makeMap=Tools.makeMap,each=Tools.each,explode=Tools.explode,extend=Tools.extend;var paddEmptyNode=function(settings,args,blockElements,node){var brPreferred=settings.padd_empty_with_br||args.insert;if(brPreferred && blockElements[node.name]){node.empty().append(new Node('br','1')).shortEnded=true;}else{node.empty().append(new Node('#text','3')).value='\u00a0';}};var isPaddedWithNbsp=function(node){return hasOnlyChild(node,'#text')&& node.firstChild.value==='\u00a0';};var hasOnlyChild=function(node,name){return node && node.firstChild && node.firstChild===node.lastChild && node.firstChild.name===name;};var isPadded=function(schema,node){var rule=schema.getElementRule(node.name);return rule && rule.paddEmpty;};var isEmpty=function(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,function(node){return isPadded(schema,node);});};return function(settings,schema){var self=this,nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};settings=settings||{};settings.validate="validate" in settings ? settings.validate :true;settings.root_name=settings.root_name||'body';self.schema=schema=schema||new Schema();var fixInvalidChildren=function(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i;var nonEmptyElements,whitespaceElements,nonSplitableElements,textBlockElements,specialElements,sibling,nextNode;nonSplitableElements=makeMap('tr,td,th,tbody,thead,tfoot,table');nonEmptyElements=schema.getNonEmptyElements();whitespaceElements=schema.getWhiteSpaceElements();textBlockElements=schema.getTextBlockElements();specialElements=schema.getSpecialElements();for(ni=0;ni<nodes.length;ni++){node=nodes[ni];if(!node.parent||node.fixed){continue;}if(textBlockElements[node.name]&& node.parent.name=='li'){sibling=node.next;while(sibling){if(textBlockElements[sibling.name]){sibling.name='li';sibling.fixed=true;node.parent.insert(sibling,node.parent);}else{break;}sibling=sibling.next;}node.unwrap(node);continue;}parents=[node];for(parent=node.parent;parent && !schema.isValidChild(parent.name,node.name)&& !nonSplitableElements[parent.name];parent=parent.parent){parents.push(parent);}if(parent && parents.length>1){parents.reverse();newParent=currentNode=self.filterNode(parents[0].clone());for(i=0;i<parents.length-1;i++){if(schema.isValidChild(currentNode.name,parents[i].name)){tempNode=self.filterNode(parents[i].clone());currentNode.append(tempNode);}else{tempNode=currentNode;}for(childNode=parents[i].firstChild;childNode && childNode !=parents[i+1];){nextNode=childNode.next;tempNode.append(childNode);childNode=nextNode;}currentNode=tempNode;}if(!isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)){parent.insert(newParent,parents[0],true);parent.insert(node,newParent);}else{parent.insert(node,parents[0],true);}parent=parents[0];if(isEmpty(schema,nonEmptyElements,whitespaceElements,parent)||hasOnlyChild(parent,'br')){parent.empty().remove();}}else if(node.parent){if(node.name==='li'){sibling=node.prev;if(sibling &&(sibling.name==='ul'||sibling.name==='ul')){sibling.append(node);continue;}sibling=node.next;if(sibling &&(sibling.name==='ul'||sibling.name==='ul')){sibling.insert(node,sibling.firstChild,true);continue;}node.wrap(self.filterNode(new Node('ul',1)));continue;}if(schema.isValidChild(node.parent.name,'div')&& schema.isValidChild('div',node.name)){node.wrap(self.filterNode(new Node('div',1)));}else{if(specialElements[node.name]){node.empty().remove();}else{node.unwrap();}}}}};self.filterNode=function(node){var i,name,list;if(name in nodeFilters){list=matchedNodes[name];if(list){list.push(node);}else{matchedNodes[name]=[node];}}i=attributeFilters.length;while(i--){name=attributeFilters[i].name;if(name in node.attributes.map){list=matchedAttributes[name];if(list){list.push(node);}else{matchedAttributes[name]=[node];}}}return node;};self.addNodeFilter=function(name,callback){each(explode(name),function(name){var list=nodeFilters[name];if(!list){nodeFilters[name]=list=[];}list.push(callback);});};self.addAttributeFilter=function(name,callback){each(explode(name),function(name){var i;for(i=0;i<attributeFilters.length;i++){if(attributeFilters[i].name===name){attributeFilters[i].callbacks.push(callback);return;}}attributeFilters.push({name:name,callbacks:[callback]});});};self.parse=function(html,args){var parser,rootNode,node,nodes,i,l,fi,fl,list,name,validate;var blockElements,startWhiteSpaceRegExp,invalidChildren=[],isInWhiteSpacePreservedElement;var endWhiteSpaceRegExp,allWhiteSpaceRegExp,isAllWhiteSpaceRegExp,whiteSpaceElements;var children,nonEmptyElements,rootBlockName;args=args||{};matchedNodes={};matchedAttributes={};blockElements=extend(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());nonEmptyElements=schema.getNonEmptyElements();children=schema.children;validate=settings.validate;rootBlockName="forced_root_block" in args ? args.forced_root_block :settings.forced_root_block;whiteSpaceElements=schema.getWhiteSpaceElements();startWhiteSpaceRegExp=/^[ \t\r\n]+/;endWhiteSpaceRegExp=/[ \t\r\n]+$/;allWhiteSpaceRegExp=/[ \t\r\n]+/g;isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/;var addRootBlocks=function(){var node=rootNode.firstChild,next,rootBlockNode;var trim=function(rootBlockNode){if(rootBlockNode){node=rootBlockNode.firstChild;if(node && node.type==3){node.value=node.value.replace(startWhiteSpaceRegExp,'');}node=rootBlockNode.lastChild;if(node && node.type==3){node.value=node.value.replace(endWhiteSpaceRegExp,'');}}};if(!schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){return;}while(node){next=node.next;if(node.type==3||(node.type==1 && node.name !=='p' && !blockElements[node.name]&& !node.attr('data-mce-type'))){if(!rootBlockNode){rootBlockNode=createNode(rootBlockName,1);rootBlockNode.attr(settings.forced_root_block_attrs);rootNode.insert(rootBlockNode,node);rootBlockNode.append(node);}else{rootBlockNode.append(node);}}else{trim(rootBlockNode);rootBlockNode=null;}node=next;}trim(rootBlockNode);};var createNode=function(name,type){var node=new Node(name,type),list;if(name in nodeFilters){list=matchedNodes[name];if(list){list.push(node);}else{matchedNodes[name]=[node];}}return node;};var removeWhitespaceBefore=function(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode && textNode.type===3;){textVal=textNode.value.replace(endWhiteSpaceRegExp,'');if(textVal.length>0){textNode.value=textVal;return;}textNodeNext=textNode.next;if(textNodeNext){if(textNodeNext.type==3 && textNodeNext.value.length){textNode=textNode.prev;continue;}if(!blockElements[textNodeNext.name]&& textNodeNext.name !='script' && textNodeNext.name !='style'){textNode=textNode.prev;continue;}}sibling=textNode.prev;textNode.remove();textNode=sibling;}};var cloneAndExcludeBlocks=function(input){var name,output={};for(name in input){if(name !=='li' && name !='p'){output[name]=input[name];}}return output;};parser=new SaxParser({validate:validate,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,self_closing_elements:cloneAndExcludeBlocks(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode('#cdata',4)).value=text;},text:function(text,raw){var textNode;if(!isInWhiteSpacePreservedElement){text=text.replace(allWhiteSpaceRegExp,' ');if(node.lastChild && blockElements[node.lastChild.name]){text=text.replace(startWhiteSpaceRegExp,'');}}if(text.length !==0){textNode=createNode('#text',3);textNode.raw=!!raw;node.append(textNode).value=text;}},comment:function(text){node.append(createNode('#comment',8)).value=text;},pi:function(name,text){node.append(createNode(name,7)).value=text;removeWhitespaceBefore(node);},doctype:function(text){var newNode;newNode=node.append(createNode('#doctype',10));newNode.value=text;removeWhitespaceBefore(node);},start:function(name,attrs,empty){var newNode,attrFiltersLen,elementRule,attrName,parent;elementRule=validate ? schema.getElementRule(name):{};if(elementRule){newNode=createNode(elementRule.outputName||name,1);newNode.attributes=attrs;newNode.shortEnded=empty;node.append(newNode);parent=children[node.name];if(parent && children[newNode.name]&& !parent[newNode.name]){invalidChildren.push(newNode);}attrFiltersLen=attributeFilters.length;while(attrFiltersLen--){attrName=attributeFilters[attrFiltersLen].name;if(attrName in attrs.map){list=matchedAttributes[attrName];if(list){list.push(newNode);}else{matchedAttributes[attrName]=[newNode];}}}if(blockElements[name]){removeWhitespaceBefore(newNode);}if(!empty){node=newNode;}if(!isInWhiteSpacePreservedElement && whiteSpaceElements[name]){isInWhiteSpacePreservedElement=true;}}},end:function(name){var textNode,elementRule,text,sibling,tempNode;elementRule=validate ? schema.getElementRule(name):{};if(elementRule){if(blockElements[name]){if(!isInWhiteSpacePreservedElement){textNode=node.firstChild;if(textNode && textNode.type===3){text=textNode.value.replace(startWhiteSpaceRegExp,'');if(text.length>0){textNode.value=text;textNode=textNode.next;}else{sibling=textNode.next;textNode.remove();textNode=sibling;while(textNode && textNode.type===3){text=textNode.value;sibling=textNode.next;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling;}textNode=sibling;}}}textNode=node.lastChild;if(textNode && textNode.type===3){text=textNode.value.replace(endWhiteSpaceRegExp,'');if(text.length>0){textNode.value=text;textNode=textNode.prev;}else{sibling=textNode.prev;textNode.remove();textNode=sibling;while(textNode && textNode.type===3){text=textNode.value;sibling=textNode.prev;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling;}textNode=sibling;}}}}}if(isInWhiteSpacePreservedElement && whiteSpaceElements[name]){isInWhiteSpacePreservedElement=false;}if(elementRule.removeEmpty && isEmpty(schema,nonEmptyElements,whiteSpaceElements,node)){if(!node.attributes.map.name && !node.attributes.map.id){tempNode=node.parent;if(blockElements[node.name]){node.empty().remove();}else{node.unwrap();}node=tempNode;return;}}if(elementRule.paddEmpty &&(isPaddedWithNbsp(node)||isEmpty(schema,nonEmptyElements,whiteSpaceElements,node))){paddEmptyNode(settings,args,blockElements,node);}node=node.parent;}}},schema);rootNode=node=new Node(args.context||settings.root_name,11);parser.parse(html);if(validate && invalidChildren.length){if(!args.context){fixInvalidChildren(invalidChildren);}else{args.invalid=true;}}if(rootBlockName &&(rootNode.name=='body'||args.isRootContent)){addRootBlocks();}if(!args.invalid){for(name in matchedNodes){list=nodeFilters[name];nodes=matchedNodes[name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1);}}for(i=0,l=list.length;i<l;i++){list[i](nodes,name,args);}}for(i=0,l=attributeFilters.length;i<l;i++){list=attributeFilters[i];if(list.name in matchedAttributes){nodes=matchedAttributes[list.name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1);}}for(fi=0,fl=list.callbacks.length;fi<fl;fi++){list.callbacks[fi](nodes,list.name,args);}}}}return rootNode;};if(settings.remove_trailing_brs){self.addNodeFilter('br',function(nodes,_,args){var i,l=nodes.length,node,blockElements=extend({},schema.getBlockElements());var nonEmptyElements=schema.getNonEmptyElements(),parent,lastParent,prev,prevName;var whiteSpaceElements=schema.getNonEmptyElements();var elementRule,textNode;blockElements.body=1;for(i=0;i<l;i++){node=nodes[i];parent=node.parent;if(blockElements[node.parent.name]&& node===parent.lastChild){prev=node.prev;while(prev){prevName=prev.name;if(prevName !=="span"||prev.attr('data-mce-type')!=='bookmark'){if(prevName !=="br"){break;}if(prevName==='br'){node=null;break;}}prev=prev.prev;}if(node){node.remove();if(isEmpty(schema,nonEmptyElements,whiteSpaceElements,parent)){elementRule=schema.getElementRule(parent.name);if(elementRule){if(elementRule.removeEmpty){parent.remove();}else if(elementRule.paddEmpty){paddEmptyNode(settings,args,blockElements,parent);}}}}}else{lastParent=node;while(parent && parent.firstChild===lastParent && parent.lastChild===lastParent){lastParent=parent;if(blockElements[parent.name]){break;}parent=parent.parent;}if(lastParent===parent && settings.padd_empty_with_br !==true){textNode=new Node('#text',3);textNode.value='\u00a0';node.replace(textNode);}}}});}self.addAttributeFilter('href',function(nodes){var i=nodes.length,node;var appendRel=function(rel){var parts=rel.split(' ').filter(function(p){return p.length>0;});return parts.concat(['noopener']).sort().join(' ');};var addNoOpener=function(rel){var newRel=rel ? Tools.trim(rel):'';if(!/\b(noopener)\b/g.test(newRel)){return appendRel(newRel);}else{return newRel;}};if(!settings.allow_unsafe_link_target){while(i--){node=nodes[i];if(node.name==='a' && node.attr('target')==='_blank'){node.attr('rel',addNoOpener(node.attr('rel')));}}}});if(!settings.allow_html_in_named_anchor){self.addAttributeFilter('id,name',function(nodes){var i=nodes.length,sibling,prevSibling,parent,node;while(i--){node=nodes[i];if(node.name==='a' && node.firstChild && !node.attr('href')){parent=node.parent;sibling=node.lastChild;do{prevSibling=sibling.prev;parent.insert(sibling,node);sibling=prevSibling;}while(sibling);}}});}if(settings.fix_list_elements){self.addNodeFilter('ul,ol',function(nodes){var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode.name==='ul'||parentNode.name==='ol'){if(node.prev && node.prev.name==='li'){node.prev.append(node);}else{var li=new Node('li',1);li.attr('style','list-style-type: none');node.wrap(li);}}}});}if(settings.validate && schema.getValidClasses()){self.addAttributeFilter('class',function(nodes){var i=nodes.length,node,classList,ci,className,classValue;var validClasses=schema.getValidClasses(),validClassesMap,valid;while(i--){node=nodes[i];classList=node.attr('class').split(' ');classValue='';for(ci=0;ci<classList.length;ci++){className=classList[ci];valid=false;validClassesMap=validClasses['*'];if(validClassesMap && validClassesMap[className]){valid=true;}validClassesMap=validClasses[node.name];if(!valid && validClassesMap && validClassesMap[className]){valid=true;}if(valid){if(classValue){classValue+=' ';}classValue+=className;}}if(!classValue.length){classValue=null;}node.attr('class',classValue);}});}LegacyFilter.register(this,settings);};});define('tinymce.core.dom.DomSerializer',['ephox.katamari.api.Fun','ephox.katamari.api.Merger','tinymce.core.api.Events','tinymce.core.dom.DOMUtils','tinymce.core.dom.DomSerializerFilters','tinymce.core.dom.DomSerializerPreProcess','tinymce.core.html.DomParser','tinymce.core.html.Schema','tinymce.core.html.Serializer','tinymce.core.text.Zwsp','tinymce.core.util.Tools'],function(Fun,Merger,Events,DOMUtils,DomSerializerFilters,DomSerializerPreProcess,DomParser,Schema,Serializer,Zwsp,Tools){var addTempAttr=function(htmlParser,tempAttrs,name){if(Tools.inArray(tempAttrs,name)===-1){htmlParser.addAttributeFilter(name,function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});tempAttrs.push(name);}};var postProcess=function(editor,args,content){if(!args.no_events && editor){var outArgs=Events.firePostProcess(editor,Merger.merge(args,{content:content}));return outArgs.content;}else{return content;}};var getHtmlFromNode=function(dom,node,args){var html=Zwsp.trim(args.getInner ? node.innerHTML :dom.getOuterHTML(node));return args.selection ? html :Tools.trim(html);};var parseHtml=function(htmlParser,dom,html,args){var parserArgs=args.selection ? Merger.merge({forced_root_block:false},args):args;var rootNode=htmlParser.parse(html,parserArgs);DomSerializerFilters.trimTrailingBr(rootNode);return rootNode;};var serializeNode=function(settings,schema,node){var htmlSerializer=new Serializer(settings,schema);return htmlSerializer.serialize(node);};var toHtml=function(editor,settings,schema,rootNode,args){var content=serializeNode(settings,schema,rootNode);return postProcess(editor,args,content);};return function(settings,editor){var dom,schema,htmlParser,tempAttrs=['data-mce-selected'];dom=editor && editor.dom ? editor.dom :DOMUtils.DOM;schema=editor && editor.schema ? editor.schema :new Schema(settings);settings.entity_encoding=settings.entity_encoding||'named';settings.remove_trailing_brs="remove_trailing_brs" in settings ? settings.remove_trailing_brs :true;htmlParser=new DomParser(settings,schema);DomSerializerFilters.register(htmlParser,settings,dom);var serialize=function(node,parserArgs){var args=Merger.merge({format:'html'},parserArgs ? parserArgs :{});var targetNode=DomSerializerPreProcess.process(editor,node,args);var html=getHtmlFromNode(dom,targetNode,args);var rootNode=parseHtml(htmlParser,dom,html,args);return args.format==='tree' ? rootNode :toHtml(editor,settings,schema,rootNode,args);};return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:serialize,addRules:function(rules){schema.addValidElements(rules);},setRules:function(rules){schema.setValidElements(rules);},addTempAttr:Fun.curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:function(){return tempAttrs;}};};});define('tinymce.core.api.dom.Serializer',['tinymce.core.dom.DomSerializer'],function(DomSerializer){return function(settings,editor){var domSerializer=new DomSerializer(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs};};});define('tinymce.core.caret.CaretContainerInput',['ephox.katamari.api.Fun','ephox.sugar.api.node.Element','ephox.sugar.api.search.SelectorFind','tinymce.core.caret.CaretContainer'],function(Fun,Element,SelectorFind,CaretContainer){var findBlockCaretContainer=function(editor){return SelectorFind.descendant(Element.fromDom(editor.getBody()),'*[data-mce-caret]').fold(Fun.constant(null),function(elm){return elm.dom();});};var removeIeControlRect=function(editor){editor.selection.setRng(editor.selection.getRng());};var showBlockCaretContainer=function(editor,blockCaretContainer){if(blockCaretContainer.hasAttribute('data-mce-caret')){CaretContainer.showCaretContainerBlock(blockCaretContainer);removeIeControlRect(editor);editor.selection.scrollIntoView(blockCaretContainer);}};var handleBlockContainer=function(editor,e){var blockCaretContainer=findBlockCaretContainer(editor);if(!blockCaretContainer){return;}if(e.type==='compositionstart'){e.preventDefault();e.stopPropagation();showBlockCaretContainer(blockCaretContainer);return;}if(CaretContainer.hasContent(blockCaretContainer)){showBlockCaretContainer(editor,blockCaretContainer);}};var setup=function(editor){editor.on('keyup compositionstart',Fun.curry(handleBlockContainer,editor));};return{setup:setup};});define('tinymce.core.api.dom.BookmarkManager',['ephox.katamari.api.Fun','tinymce.core.dom.Bookmarks'],function(Fun,Bookmarks){var BookmarkManager=function(selection){return{getBookmark:Fun.curry(Bookmarks.getBookmark,selection),moveToBookmark:Fun.curry(Bookmarks.moveToBookmark,selection)};};BookmarkManager.isBookmarkNode=Bookmarks.isBookmarkNode;return BookmarkManager;});define('tinymce.core.dom.ControlSelection',['ephox.katamari.api.Fun','ephox.sugar.api.node.Element','ephox.sugar.api.search.Selectors','global!document','tinymce.core.dom.NodeType','tinymce.core.dom.RangePoint','tinymce.core.Env','tinymce.core.util.Delay','tinymce.core.util.Tools','tinymce.core.util.VK'],function(Fun,Element,Selectors,document,NodeType,RangePoint,Env,Delay,Tools,VK){var isContentEditableFalse=NodeType.isContentEditableFalse;var isContentEditableTrue=NodeType.isContentEditableTrue;var getContentEditableRoot=function(root,node){while(node && node !=root){if(isContentEditableTrue(node)||isContentEditableFalse(node)){return node;}node=node.parentNode;}return null;};return function(selection,editor){var dom=editor.dom,each=Tools.each;var selectedElm,selectedElmGhost,resizeHelper,resizeHandles,selectedHandle;var startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted;var width,height,editableDoc=editor.getDoc(),rootDocument=document;var abs=Math.abs,round=Math.round,rootElement=editor.getBody(),startScrollWidth,startScrollHeight;resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var rootClass='.mce-content-body';editor.contentStyles.push(rootClass+' div.mce-resizehandle {'+'position: absolute;'+'border: 1px solid black;'+'box-sizing: content-box;'+'background: #FFF;'+'width: 7px;'+'height: 7px;'+'z-index: 10000'+'}'+rootClass+' .mce-resizehandle:hover {'+'background: #000'+'}'+rootClass+' img[data-mce-selected],'+rootClass+' hr[data-mce-selected] {'+'outline: 1px solid black;'+'resize: none'+'}'+rootClass+' .mce-clonedresizable {'+'position: absolute;'+(Env.gecko ? '' :'outline: 1px dashed black;')+'opacity: .5;'+'filter: alpha(opacity=50);'+'z-index: 10000'+'}'+rootClass+' .mce-resize-helper {'+'background: #555;'+'background: rgba(0,0,0,0.75);'+'border-radius: 3px;'+'border: 1px;'+'color: white;'+'display: none;'+'font-family: sans-serif;'+'font-size: 12px;'+'white-space: nowrap;'+'line-height: 14px;'+'margin: 5px 10px;'+'padding: 5px;'+'position: absolute;'+'z-index: 10001'+'}');var isImage=function(elm){return elm &&(elm.nodeName==='IMG'||editor.dom.is(elm,'figure.image'));};var isEventOnImageOutsideRange=function(evt,range){return isImage(evt.target)&& !RangePoint.isXYWithinRange(evt.clientX,evt.clientY,range);};var contextMenuSelectImage=function(evt){var target=evt.target;if(isEventOnImageOutsideRange(evt,editor.selection.getRng())&& !evt.isDefaultPrevented()){evt.preventDefault();editor.selection.select(target);}};var getResizeTarget=function(elm){return editor.dom.is(elm,'figure.image')? elm.querySelector('img'):elm;};var isResizable=function(elm){var selector=editor.settings.object_resizing;if(selector===false||Env.iOS){return false;}if(typeof selector !='string'){selector='table,img,figure.image,div';}if(elm.getAttribute('data-mce-resize')==='false'){return false;}if(elm==editor.getBody()){return false;}return Selectors.is(Element.fromDom(elm),selector);};var resizeGhostElement=function(e){var deltaX,deltaY,proportional;var resizeHelperX,resizeHelperY;deltaX=e.screenX-startX;deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW;height=deltaY*selectedHandle[3]+startH;width=width<5 ? 5 :width;height=height<5 ? 5 :height;if(isImage(selectedElm)&& editor.settings.resize_img_proportional !==false){proportional=!VK.modifierPressed(e);}else{proportional=VK.modifierPressed(e)||(isImage(selectedElm)&& selectedHandle[2]*selectedHandle[3]!==0);}if(proportional){if(abs(deltaX)>abs(deltaY)){height=round(width*ratio);width=round(height / ratio);}else{width=round(height / ratio);height=round(width*ratio);}}dom.setStyles(getResizeTarget(selectedElmGhost),{width:width,height:height});resizeHelperX=selectedHandle.startPos.x+deltaX;resizeHelperY=selectedHandle.startPos.y+deltaY;resizeHelperX=resizeHelperX>0 ? resizeHelperX :0;resizeHelperY=resizeHelperY>0 ? resizeHelperY :0;dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:'block'});resizeHelper.innerHTML=width+' &times; '+height;if(selectedHandle[2]<0 && selectedElmGhost.clientWidth<=width){dom.setStyle(selectedElmGhost,'left',selectedElmX+(startW-width));}if(selectedHandle[3]<0 && selectedElmGhost.clientHeight<=height){dom.setStyle(selectedElmGhost,'top',selectedElmY+(startH-height));}deltaX=rootElement.scrollWidth-startScrollWidth;deltaY=rootElement.scrollHeight-startScrollHeight;if(deltaX+deltaY !==0){dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY});}if(!resizeStarted){editor.fire('ObjectResizeStart',{target:selectedElm,width:startW,height:startH});resizeStarted=true;}};var endGhostResize=function(){resizeStarted=false;var setSizeProp=function(name,value){if(value){if(selectedElm.style[name]||!editor.schema.isValid(selectedElm.nodeName.toLowerCase(),name)){dom.setStyle(getResizeTarget(selectedElm),name,value);}else{dom.setAttrib(getResizeTarget(selectedElm),name,value);}}};setSizeProp('width',width);setSizeProp('height',height);dom.unbind(editableDoc,'mousemove',resizeGhostElement);dom.unbind(editableDoc,'mouseup',endGhostResize);if(rootDocument !=editableDoc){dom.unbind(rootDocument,'mousemove',resizeGhostElement);dom.unbind(rootDocument,'mouseup',endGhostResize);}dom.remove(selectedElmGhost);dom.remove(resizeHelper);showResizeRect(selectedElm);editor.fire('ObjectResized',{target:selectedElm,width:width,height:height});dom.setAttrib(selectedElm,'style',dom.getAttrib(selectedElm,'style'));editor.nodeChanged();};var showResizeRect=function(targetElm){var position,targetWidth,targetHeight,e,rect;hideResizeRect();unbindResizeHandleEvents();position=dom.getPos(targetElm,rootElement);selectedElmX=position.x;selectedElmY=position.y;rect=targetElm.getBoundingClientRect();targetWidth=rect.width||(rect.right-rect.left);targetHeight=rect.height||(rect.bottom-rect.top);if(selectedElm !=targetElm){selectedElm=targetElm;width=height=0;}e=editor.fire('ObjectSelected',{target:targetElm});if(isResizable(targetElm)&& !e.isDefaultPrevented()){each(resizeHandles,function(handle,name){var handleElm;var startDrag=function(e){startX=e.screenX;startY=e.screenY;startW=getResizeTarget(selectedElm).clientWidth;startH=getResizeTarget(selectedElm).clientHeight;ratio=startH / startW;selectedHandle=handle;handle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY};startScrollWidth=rootElement.scrollWidth;startScrollHeight=rootElement.scrollHeight;selectedElmGhost=selectedElm.cloneNode(true);dom.addClass(selectedElmGhost,'mce-clonedresizable');dom.setAttrib(selectedElmGhost,'data-mce-bogus','all');selectedElmGhost.contentEditable=false;selectedElmGhost.unSelectabe=true;dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0});selectedElmGhost.removeAttribute('data-mce-selected');rootElement.appendChild(selectedElmGhost);dom.bind(editableDoc,'mousemove',resizeGhostElement);dom.bind(editableDoc,'mouseup',endGhostResize);if(rootDocument !=editableDoc){dom.bind(rootDocument,'mousemove',resizeGhostElement);dom.bind(rootDocument,'mouseup',endGhostResize);}resizeHelper=dom.add(rootElement,'div',{'class':'mce-resize-helper','data-mce-bogus':'all'},startW+' &times; '+startH);};handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.remove(handleElm);}handleElm=dom.add(rootElement,'div',{id:'mceResizeHandle'+name,'data-mce-bogus':'all','class':'mce-resizehandle',unselectable:true,style:'cursor:'+name+'-resize; margin:0; padding:0'});if(Env.ie){handleElm.contentEditable=false;}dom.bind(handleElm,'mousedown',function(e){e.stopImmediatePropagation();e.preventDefault();startDrag(e);});handle.elm=handleElm;dom.setStyles(handleElm,{left:(targetWidth*handle[0]+selectedElmX)-(handleElm.offsetWidth / 2),top:(targetHeight*handle[1]+selectedElmY)-(handleElm.offsetHeight / 2)});});}else{hideResizeRect();}selectedElm.setAttribute('data-mce-selected','1');};var hideResizeRect=function(){var name,handleElm;unbindResizeHandleEvents();if(selectedElm){selectedElm.removeAttribute('data-mce-selected');}for(name in resizeHandles){handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.unbind(handleElm);dom.remove(handleElm);}}};var updateResizeRect=function(e){var startElm,controlElm;var isChildOrEqual=function(node,parent){if(node){do{if(node===parent){return true;}}while((node=node.parentNode));}};if(resizeStarted||editor.removed){return;}each(dom.select('img[data-mce-selected],hr[data-mce-selected]'),function(img){img.removeAttribute('data-mce-selected');});controlElm=e.type=='mousedown' ? e.target :selection.getNode();controlElm=dom.$(controlElm).closest('table,img,figure.image,hr')[0];if(isChildOrEqual(controlElm,rootElement)){disableGeckoResize();startElm=selection.getStart(true);if(isChildOrEqual(startElm,controlElm)&& isChildOrEqual(selection.getEnd(true),controlElm)){showResizeRect(controlElm);return;}}hideResizeRect();};var isWithinContentEditableFalse=function(elm){return isContentEditableFalse(getContentEditableRoot(editor.getBody(),elm));};var unbindResizeHandleEvents=function(){for(var name in resizeHandles){var handle=resizeHandles[name];if(handle.elm){dom.unbind(handle.elm);delete handle.elm;}}};var disableGeckoResize=function(){try{editor.getDoc().execCommand('enableObjectResizing',false,false);}catch(ex){}};editor.on('init',function(){disableGeckoResize();if(Env.ie && Env.ie>=11){editor.on('mousedown click',function(e){var target=e.target,nodeName=target.nodeName;if(!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName)&& !isWithinContentEditableFalse(target)){if(e.button !==2){editor.selection.select(target,nodeName=='TABLE');}if(e.type=='mousedown'){editor.nodeChanged();}}});editor.dom.bind(rootElement,'mscontrolselect',function(e){var delayedSelect=function(node){Delay.setEditorTimeout(editor,function(){editor.selection.select(node);});};if(isWithinContentEditableFalse(e.target)){e.preventDefault();delayedSelect(e.target);return;}if(/^(TABLE|IMG|HR)$/.test(e.target.nodeName)){e.preventDefault();if(e.target.tagName=='IMG'){delayedSelect(e.target);}}});}var throttledUpdateResizeRect=Delay.throttle(function(e){if(!editor.composing){updateResizeRect(e);}});editor.on('nodechange ResizeEditor ResizeWindow drop',throttledUpdateResizeRect);editor.on('keyup compositionend',function(e){if(selectedElm && selectedElm.nodeName=="TABLE"){throttledUpdateResizeRect(e);}});editor.on('hide blur',hideResizeRect);editor.on('contextmenu',contextMenuSelectImage);});editor.on('remove',unbindResizeHandleEvents);var destroy=function(){selectedElm=selectedElmGhost=null;};return{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:destroy};};});define('tinymce.core.dom.ScrollIntoView',['tinymce.core.dom.NodeType'],function(NodeType){var getPos=function(elm){var x=0,y=0;var offsetParent=elm;while(offsetParent && offsetParent.nodeType){x+=offsetParent.offsetLeft||0;y+=offsetParent.offsetTop||0;offsetParent=offsetParent.offsetParent;}return{x:x,y:y};};var fireScrollIntoViewEvent=function(editor,elm,alignToTop){var scrollEvent={elm:elm,alignToTop:alignToTop};editor.fire('scrollIntoView',scrollEvent);return scrollEvent.isDefaultPrevented();};var scrollIntoView=function(editor,elm,alignToTop){var y,viewPort,dom=editor.dom,root=dom.getRoot(),viewPortY,viewPortH,offsetY=0;if(fireScrollIntoViewEvent(editor,elm,alignToTop)){return;}if(!NodeType.isElement(elm)){return;}if(alignToTop===false){offsetY=elm.offsetHeight;}if(root.nodeName !=='BODY'){var scrollContainer=editor.selection.getScrollContainer();if(scrollContainer){y=getPos(elm).y-getPos(scrollContainer).y+offsetY;viewPortH=scrollContainer.clientHeight;viewPortY=scrollContainer.scrollTop;if(y<viewPortY||y+25>viewPortY+viewPortH){scrollContainer.scrollTop=y<viewPortY ? y :y-viewPortH+25;}return;}}viewPort=dom.getViewPort(editor.getWin());y=dom.getPos(elm).y+offsetY;viewPortY=viewPort.y;viewPortH=viewPort.h;if(y<viewPort.y||y+25>viewPortY+viewPortH){editor.getWin().scrollTo(0,y<viewPortY ? y :y-viewPortH+25);}};return{scrollIntoView:scrollIntoView};});define('tinymce.core.selection.CaretRangeFromPoint',['tinymce.core.dom.NodeType','tinymce.core.util.Tools'],function(NodeType,Tools){var hasCeProperty=function(node){return NodeType.isContentEditableTrue(node)||NodeType.isContentEditableFalse(node);};var findParent=function(node,rootNode,predicate){while(node && node !==rootNode){if(predicate(node)){return node;}node=node.parentNode;}return null;};var findClosestIeRange=function(clientX,clientY,doc){var element,rng,rects;element=doc.elementFromPoint(clientX,clientY);rng=doc.body.createTextRange();if(!element||element.tagName==='HTML'){element=doc.body;}rng.moveToElementText(element);rects=Tools.toArray(rng.getClientRects());rects=rects.sort(function(a,b){a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY));b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY));return a-b;});if(rects.length>0){clientY=(rects[0].bottom+rects[0].top)/ 2;try{rng.moveToPoint(clientX,clientY);rng.collapse(true);return rng;}catch(ex){}}return null;};var moveOutOfContentEditableFalse=function(rng,rootNode){var parentElement=rng && rng.parentElement ? rng.parentElement():null;return NodeType.isContentEditableFalse(findParent(parentElement,rootNode,hasCeProperty))? null :rng;};var fromPoint=function(clientX,clientY,doc){var rng,point;if(doc.caretPositionFromPoint){point=doc.caretPositionFromPoint(clientX,clientY);if(point){rng=doc.createRange();rng.setStart(point.offsetNode,point.offset);rng.collapse(true);}}else if(doc.caretRangeFromPoint){rng=doc.caretRangeFromPoint(clientX,clientY);}else if(doc.body.createTextRange){rng=doc.body.createTextRange();try{rng.moveToPoint(clientX,clientY);rng.collapse(true);}catch(ex){rng=findClosestIeRange(clientX,clientY,doc);}return moveOutOfContentEditableFalse(rng,doc.body);}return rng;};return{fromPoint:fromPoint};});define('tinymce.core.selection.EventProcessRanges',['ephox.katamari.api.Arr'],function(Arr){var processRanges=function(editor,ranges){return Arr.map(ranges,function(range){var evt=editor.fire('GetSelectionRange',{range:range});return evt.range !==range ? evt.range :range;});};return{processRanges:processRanges};});define('ephox.sugar.api.dom.Replication',['ephox.sugar.api.properties.Attr','ephox.sugar.api.node.Element','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.InsertAll','ephox.sugar.api.dom.Remove','ephox.sugar.api.search.Traverse'],function(Attr,Element,Insert,InsertAll,Remove,Traverse){var clone=function(original,deep){return Element.fromDom(original.dom().cloneNode(deep));};var shallow=function(original){return clone(original,false);};var deep=function(original){return clone(original,true);};var shallowAs=function(original,tag){var nu=Element.fromTag(tag);var attributes=Attr.clone(original);Attr.setAll(nu,attributes);return nu;};var copy=function(original,tag){var nu=shallowAs(original,tag);var cloneChildren=Traverse.children(deep(original));InsertAll.append(nu,cloneChildren);return nu;};var mutate=function(original,tag){var nu=shallowAs(original,tag);Insert.before(original,nu);var children=Traverse.children(original);InsertAll.append(nu,children);Remove.remove(original);return nu;};return{shallow:shallow,shallowAs:shallowAs,deep:deep,copy:copy,mutate:mutate};});define('ephox.sugar.api.node.Fragment',['ephox.katamari.api.Arr','ephox.sugar.api.node.Element','global!document'],function(Arr,Element,document){var fromElements=function(elements,scope){var doc=scope||document;var fragment=doc.createDocumentFragment();Arr.each(elements,function(element){fragment.appendChild(element.dom());});return Element.fromDom(fragment);};return{fromElements:fromElements};});define('tinymce.core.selection.SelectionUtils',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.katamari.api.Options','ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','ephox.sugar.api.node.Node','ephox.sugar.api.search.Traverse','tinymce.core.dom.NodeType'],function(Arr,Fun,Option,Options,Compare,Element,Node,Traverse,NodeType){var getStartNode=function(rng){var sc=rng.startContainer,so=rng.startOffset;if(NodeType.isText(sc)){return so===0 ? Option.some(Element.fromDom(sc)):Option.none();}else{return Option.from(sc.childNodes[so]).map(Element.fromDom);}};var getEndNode=function(rng){var ec=rng.endContainer,eo=rng.endOffset;if(NodeType.isText(ec)){return eo===ec.data.length ? Option.some(Element.fromDom(ec)):Option.none();}else{return Option.from(ec.childNodes[eo-1]).map(Element.fromDom);}};var getFirstChildren=function(node){return Traverse.firstChild(node).fold(Fun.constant([node]),function(child){return[node].concat(getFirstChildren(child));});};var getLastChildren=function(node){return Traverse.lastChild(node).fold(Fun.constant([node]),function(child){if(Node.name(child)==='br'){return Traverse.prevSibling(child).map(function(sibling){return[node].concat(getLastChildren(sibling));}).getOr([]);}else{return[node].concat(getLastChildren(child));}});};var hasAllContentsSelected=function(elm,rng){return Options.liftN([getStartNode(rng),getEndNode(rng)],function(startNode,endNode){var start=Arr.find(getFirstChildren(elm),Fun.curry(Compare.eq,startNode));var end=Arr.find(getLastChildren(elm),Fun.curry(Compare.eq,endNode));return start.isSome()&& end.isSome();}).getOr(false);};return{hasAllContentsSelected:hasAllContentsSelected};});define('tinymce.core.selection.SimpleTableModel',['ephox.katamari.api.Arr','ephox.katamari.api.Option','ephox.katamari.api.Struct','ephox.sugar.api.dom.Compare','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.InsertAll','ephox.sugar.api.dom.Replication','ephox.sugar.api.node.Element','ephox.sugar.api.properties.Attr','ephox.sugar.api.search.SelectorFilter'],function(Arr,Option,Struct,Compare,Insert,InsertAll,Replication,Element,Attr,SelectorFilter){var tableModel=Struct.immutable('element','width','rows');var tableRow=Struct.immutable('element','cells');var cellPosition=Struct.immutable('x','y');var getSpan=function(td,key){var value=parseInt(Attr.get(td,key),10);return isNaN(value)? 1 :value;};var fillout=function(table,x,y,tr,td){var rowspan=getSpan(td,'rowspan');var colspan=getSpan(td,'colspan');var rows=table.rows();for(var y2=y;y2<y+rowspan;y2++){if(!rows[y2]){rows[y2]=tableRow(Replication.deep(tr),[]);}for(var x2=x;x2<x+colspan;x2++){var cells=rows[y2].cells();cells[x2]=y2==y && x2==x ? td :Replication.shallow(td);}}};var cellExists=function(table,x,y){var rows=table.rows();var cells=rows[y]? rows[y].cells():[];return !!cells[x];};var skipCellsX=function(table,x,y){while(cellExists(table,x,y)){x++;}return x;};var getWidth=function(rows){return Arr.foldl(rows,function(acc,row){return row.cells().length>acc ? row.cells().length :acc;},0);};var findElementPos=function(table,element){var rows=table.rows();for(var y=0;y<rows.length;y++){var cells=rows[y].cells();for(var x=0;x<cells.length;x++){if(Compare.eq(cells[x],element)){return Option.some(cellPosition(x,y));}}}return Option.none();};var extractRows=function(table,sx,sy,ex,ey){var newRows=[];var rows=table.rows();for(var y=sy;y<=ey;y++){var cells=rows[y].cells();var slice=sx<ex ? cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element(),slice));}return newRows;};var subTable=function(table,startPos,endPos){var sx=startPos.x(),sy=startPos.y();var ex=endPos.x(),ey=endPos.y();var newRows=sy<ey ? extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element(),getWidth(newRows),newRows);};var createDomTable=function(table,rows){var tableElement=Replication.shallow(table.element());var tableBody=Element.fromTag('tbody');InsertAll.append(tableBody,rows);Insert.append(tableElement,tableBody);return tableElement;};var modelRowsToDomRows=function(table){return Arr.map(table.rows(),function(row){var cells=Arr.map(row.cells(),function(cell){var td=Replication.deep(cell);Attr.remove(td,'colspan');Attr.remove(td,'rowspan');return td;});var tr=Replication.shallow(row.element());InsertAll.append(tr,cells);return tr;});};var fromDom=function(tableElm){var table=tableModel(Replication.shallow(tableElm),0,[]);Arr.each(SelectorFilter.descendants(tableElm,'tr'),function(tr,y){Arr.each(SelectorFilter.descendants(tr,'td,th'),function(td,x){fillout(table,skipCellsX(table,x,y),y,tr,td);});});return tableModel(table.element(),getWidth(table.rows()),table.rows());};var toDom=function(table){return createDomTable(table,modelRowsToDomRows(table));};var subsection=function(table,startElement,endElement){return findElementPos(table,startElement).bind(function(startPos){return findElementPos(table,endElement).map(function(endPos){return subTable(table,startPos,endPos);});});};return{fromDom:fromDom,toDom:toDom,subsection:subsection};});define('tinymce.core.selection.FragmentReader',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.sugar.api.dom.Compare','ephox.sugar.api.dom.Insert','ephox.sugar.api.dom.Replication','ephox.sugar.api.node.Element','ephox.sugar.api.node.Fragment','ephox.sugar.api.node.Node','ephox.sugar.api.search.SelectorFind','ephox.sugar.api.search.Traverse','tinymce.core.dom.ElementType','tinymce.core.dom.Parents','tinymce.core.selection.SelectionUtils','tinymce.core.selection.SimpleTableModel','tinymce.core.selection.TableCellSelection'],function(Arr,Fun,Compare,Insert,Replication,Element,Fragment,Node,SelectorFind,Traverse,ElementType,Parents,SelectionUtils,SimpleTableModel,TableCellSelection){var findParentListContainer=function(parents){return Arr.find(parents,function(elm){return Node.name(elm)==='ul'||Node.name(elm)==='ol';});};var getFullySelectedListWrappers=function(parents,rng){return Arr.find(parents,function(elm){return Node.name(elm)==='li' && SelectionUtils.hasAllContentsSelected(elm,rng);}).fold(Fun.constant([]),function(li){return findParentListContainer(parents).map(function(listCont){return[Element.fromTag('li'),Element.fromTag(Node.name(listCont))];}).getOr([]);});};var wrap=function(innerElm,elms){var wrapped=Arr.foldl(elms,function(acc,elm){Insert.append(elm,acc);return elm;},innerElm);return elms.length>0 ? Fragment.fromElements([wrapped]):wrapped;};var directListWrappers=function(commonAnchorContainer){if(ElementType.isListItem(commonAnchorContainer)){return Traverse.parent(commonAnchorContainer).filter(ElementType.isList).fold(Fun.constant([]),function(listElm){return[commonAnchorContainer,listElm];});}else{return ElementType.isList(commonAnchorContainer)?[commonAnchorContainer]:[];}};var getWrapElements=function(rootNode,rng){var commonAnchorContainer=Element.fromDom(rng.commonAncestorContainer);var parents=Parents.parentsAndSelf(commonAnchorContainer,rootNode);var wrapElements=Arr.filter(parents,function(elm){return ElementType.isInline(elm)||ElementType.isHeading(elm);});var listWrappers=getFullySelectedListWrappers(parents,rng);var allWrappers=wrapElements.concat(listWrappers.length ? listWrappers :directListWrappers(commonAnchorContainer));return Arr.map(allWrappers,Replication.shallow);};var emptyFragment=function(){return Fragment.fromElements([]);};var getFragmentFromRange=function(rootNode,rng){return wrap(Element.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng));};var getParentTable=function(rootElm,cell){return SelectorFind.ancestor(cell,'table',Fun.curry(Compare.eq,rootElm));};var getTableFragment=function(rootNode,selectedTableCells){return getParentTable(rootNode,selectedTableCells[0]).bind(function(tableElm){var firstCell=selectedTableCells[0];var lastCell=selectedTableCells[selectedTableCells.length-1];var fullTableModel=SimpleTableModel.fromDom(tableElm);return SimpleTableModel.subsection(fullTableModel,firstCell,lastCell).map(function(sectionedTableModel){return Fragment.fromElements([SimpleTableModel.toDom(sectionedTableModel)]);});}).getOrThunk(emptyFragment);};var getSelectionFragment=function(rootNode,ranges){return ranges.length>0 && ranges[0].collapsed ? emptyFragment():getFragmentFromRange(rootNode,ranges[0]);};var read=function(rootNode,ranges){var selectedCells=TableCellSelection.getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0 ? getTableFragment(rootNode,selectedCells):getSelectionFragment(rootNode,ranges);};return{read:read};});define('tinymce.core.selection.GetSelectionContent',['ephox.sugar.api.node.Element','tinymce.core.selection.EventProcessRanges','tinymce.core.selection.FragmentReader','tinymce.core.selection.MultiRange','tinymce.core.text.Zwsp'],function(Element,EventProcessRanges,FragmentReader,MultiRange,Zwsp){var getContent=function(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create("body");var sel=editor.selection.getSel(),fragment;var ranges=EventProcessRanges.processRanges(editor,MultiRange.getRanges(sel));args=args||{};args.get=true;args.format=args.format||'html';args.selection=true;args=editor.fire('BeforeGetContent',args);if(args.isDefaultPrevented()){editor.fire('GetContent',args);return args.content;}if(args.format==='text'){return editor.selection.isCollapsed()? '' :Zwsp.trim(rng.text||(sel.toString ? sel.toString():''));}if(rng.cloneContents){fragment=args.contextual ? FragmentReader.read(Element.fromDom(editor.getBody()),ranges).dom():rng.cloneContents();if(fragment){tmpElm.appendChild(fragment);}}else if(rng.item !==undefined||rng.htmlText !==undefined){tmpElm.innerHTML='<br>'+(rng.item ? rng.item(0).outerHTML :rng.htmlText);tmpElm.removeChild(tmpElm.firstChild);}else{tmpElm.innerHTML=rng.toString();}args.getInner=true;var content=editor.selection.serializer.serialize(tmpElm,args);if(args.format==='tree'){return content;}args.content=editor.selection.isCollapsed()? '' :content;editor.fire('GetContent',args);return args.content;};return{getContent:getContent};});define('tinymce.core.selection.SetSelectionContent',[],function(){var setContent=function(editor,content,args){var rng=editor.selection.getRng(),caretNode,doc=editor.getDoc(),frag,temp;args=args||{format:'html'};args.set=true;args.selection=true;args.content=content;if(!args.no_events){args=editor.fire('BeforeSetContent',args);if(args.isDefaultPrevented()){editor.fire('SetContent',args);return;}}content=args.content;if(rng.insertNode){content+='<span id="__caret">_</span>';if(rng.startContainer==doc && rng.endContainer==doc){doc.body.innerHTML=content;}else{rng.deleteContents();if(doc.body.childNodes.length===0){doc.body.innerHTML=content;}else{if(rng.createContextualFragment){rng.insertNode(rng.createContextualFragment(content));}else{frag=doc.createDocumentFragment();temp=doc.createElement('div');frag.appendChild(temp);temp.outerHTML=content;rng.insertNode(frag);}}}caretNode=editor.dom.get('__caret');rng=doc.createRange();rng.setStartBefore(caretNode);rng.setEndBefore(caretNode);editor.selection.setRng(rng);editor.dom.remove('__caret');try{editor.selection.setRng(rng);}catch(ex){}}else{if(rng.item){doc.execCommand('Delete',false,null);rng=editor.getRng();}if(/^\s+/.test(content)){rng.pasteHTML('<span id="__mce_tmp">_</span>'+content);editor.dom.remove('__mce_tmp');}else{rng.pasteHTML(content);}}if(!args.no_events){editor.fire('SetContent',args);}};return{setContent:setContent};});define('tinymce.core.dom.Selection',['ephox.sugar.api.dom.Compare','ephox.sugar.api.node.Element','tinymce.core.Env','tinymce.core.api.dom.BookmarkManager','tinymce.core.caret.CaretPosition','tinymce.core.dom.ControlSelection','tinymce.core.dom.ScrollIntoView','tinymce.core.dom.TreeWalker','tinymce.core.focus.EditorFocus','tinymce.core.selection.CaretRangeFromPoint','tinymce.core.selection.EventProcessRanges','tinymce.core.selection.GetSelectionContent','tinymce.core.selection.MultiRange','tinymce.core.selection.NormalizeRange','tinymce.core.selection.SelectionBookmark','tinymce.core.selection.SetSelectionContent','tinymce.core.util.Tools'],function(Compare,Element,Env,BookmarkManager,CaretPosition,ControlSelection,ScrollIntoView,TreeWalker,EditorFocus,CaretRangeFromPoint,EventProcessRanges,GetSelectionContent,MultiRange,NormalizeRange,SelectionBookmark,SetSelectionContent,Tools){var each=Tools.each,trim=Tools.trim;var isAttachedToDom=function(node){return !!(node && node.ownerDocument)&& Compare.contains(Element.fromDom(node.ownerDocument),Element.fromDom(node));};var isValidRange=function(rng){if(!rng){return false;}else if(rng.select){return true;}else{return isAttachedToDom(rng.startContainer)&& isAttachedToDom(rng.endContainer);}};var Selection=function(dom,win,serializer,editor){var self=this;self.dom=dom;self.win=win;self.serializer=serializer;self.editor=editor;self.bookmarkManager=new BookmarkManager(self);self.controlSelection=new ControlSelection(self,editor);};Selection.prototype={setCursorLocation:function(node,offset){var self=this,rng=self.dom.createRng();if(!node){self._moveEndPoint(rng,self.editor.getBody(),true);self.setRng(rng);}else{rng.setStart(node,offset);rng.setEnd(node,offset);self.setRng(rng);self.collapse(false);}},getContent:function(args){return GetSelectionContent.getContent(this.editor,args);},setContent:function(content,args){SetSelectionContent.setContent(this.editor,content,args);},getStart:function(real){var self=this,rng=self.getRng(),startElement;startElement=rng.startContainer;if(startElement.nodeType==1 && startElement.hasChildNodes()){if(!real||!rng.collapsed){startElement=startElement.childNodes[Math.min(startElement.childNodes.length-1,rng.startOffset)];}}if(startElement && startElement.nodeType==3){return startElement.parentNode;}return startElement;},getEnd:function(real){var self=this,rng=self.getRng(),endElement,endOffset;endElement=rng.endContainer;endOffset=rng.endOffset;if(endElement.nodeType==1 && endElement.hasChildNodes()){if(!real||!rng.collapsed){endElement=endElement.childNodes[endOffset>0 ? endOffset-1 :endOffset];}}if(endElement && endElement.nodeType==3){return endElement.parentNode;}return endElement;},getBookmark:function(type,normalized){return this.bookmarkManager.getBookmark(type,normalized);},moveToBookmark:function(bookmark){return this.bookmarkManager.moveToBookmark(bookmark);},select:function(node,content){var self=this,dom=self.dom,rng=dom.createRng(),idx;if(node){idx=dom.nodeIndex(node);rng.setStart(node.parentNode,idx);rng.setEnd(node.parentNode,idx+1);if(content){self._moveEndPoint(rng,node,true);self._moveEndPoint(rng,node);}self.setRng(rng);}return node;},isCollapsed:function(){var self=this,rng=self.getRng(),sel=self.getSel();if(!rng||rng.item){return false;}if(rng.compareEndPoints){return rng.compareEndPoints('StartToEnd',rng)===0;}return !sel||rng.collapsed;},collapse:function(toStart){var self=this,rng=self.getRng();rng.collapse(!!toStart);self.setRng(rng);},getSel:function(){var win=this.win;return win.getSelection ? win.getSelection():win.document.selection;},getRng:function(w3c){var self=this,selection,rng,elm,doc;var tryCompareBoundaryPoints=function(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange);}catch(ex){return-1;}};if(!self.win){return null;}doc=self.win.document;if(typeof doc==='undefined'||doc===null){return null;}if(self.editor.bookmark !==undefined && EditorFocus.hasFocus(self.editor)===false){var bookmark=SelectionBookmark.getRng(self.editor);if(bookmark.isSome()){return bookmark.getOr(doc.createRange());}}try{if((selection=self.getSel())){if(selection.rangeCount>0){rng=selection.getRangeAt(0);}else{rng=selection.createRange ? selection.createRange():doc.createRange();}}}catch(ex){}rng=EventProcessRanges.processRanges(self.editor,[rng])[0];if(!rng){rng=doc.createRange ? doc.createRange():doc.body.createTextRange();}if(rng.setStart && rng.startContainer.nodeType===9 && rng.collapsed){elm=self.dom.getRoot();rng.setStart(elm,0);rng.setEnd(elm,0);}if(self.selectedRange && self.explicitRange){if(tryCompareBoundaryPoints(rng.START_TO_START,rng,self.selectedRange)===0 && tryCompareBoundaryPoints(rng.END_TO_END,rng,self.selectedRange)===0){rng=self.explicitRange;}else{self.selectedRange=null;self.explicitRange=null;}}return rng;},setRng:function(rng,forward){var self=this,sel,node,evt;if(!isValidRange(rng)){return;}if(rng.select){self.explicitRange=null;try{rng.select();}catch(ex){}return;}sel=self.getSel();evt=self.editor.fire('SetSelectionRange',{range:rng,forward:forward});rng=evt.range;if(sel){self.explicitRange=rng;try{sel.removeAllRanges();sel.addRange(rng);}catch(ex){}if(forward===false && sel.extend){sel.collapse(rng.endContainer,rng.endOffset);sel.extend(rng.startContainer,rng.startOffset);}self.selectedRange=sel.rangeCount>0 ? sel.getRangeAt(0):null;}if(!rng.collapsed && rng.startContainer===rng.endContainer && sel.setBaseAndExtent && !Env.ie){if(rng.endOffset-rng.startOffset<2){if(rng.startContainer.hasChildNodes()){node=rng.startContainer.childNodes[rng.startOffset];if(node && node.tagName==='IMG'){sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset);if(sel.anchorNode !==rng.startContainer||sel.focusNode !==rng.endContainer){sel.setBaseAndExtent(node,0,node,1);}}}}}self.editor.fire('AfterSetSelectionRange',{range:rng,forward:forward});},setNode:function(elm){var self=this;self.setContent(self.dom.getOuterHTML(elm));return elm;},getNode:function(){var self=this,rng=self.getRng(),elm;var startContainer,endContainer,startOffset,endOffset,root=self.dom.getRoot();var skipEmptyTextNodes=function(node,forwards){var orig=node;while(node && node.nodeType===3 && node.length===0){node=forwards ? node.nextSibling :node.previousSibling;}return node||orig;};if(!rng){return root;}startContainer=rng.startContainer;endContainer=rng.endContainer;startOffset=rng.startOffset;endOffset=rng.endOffset;elm=rng.commonAncestorContainer;if(!rng.collapsed){if(startContainer==endContainer){if(endOffset-startOffset<2){if(startContainer.hasChildNodes()){elm=startContainer.childNodes[startOffset];}}}if(startContainer.nodeType===3 && endContainer.nodeType===3){if(startContainer.length===startOffset){startContainer=skipEmptyTextNodes(startContainer.nextSibling,true);}else{startContainer=startContainer.parentNode;}if(endOffset===0){endContainer=skipEmptyTextNodes(endContainer.previousSibling,false);}else{endContainer=endContainer.parentNode;}if(startContainer && startContainer===endContainer){return startContainer;}}}if(elm && elm.nodeType==3){return elm.parentNode;}return elm;},getSelectedBlocks:function(startElm,endElm){var self=this,dom=self.dom,node,root,selectedBlocks=[];root=dom.getRoot();startElm=dom.getParent(startElm||self.getStart(),dom.isBlock);endElm=dom.getParent(endElm||self.getEnd(),dom.isBlock);if(startElm && startElm !=root){selectedBlocks.push(startElm);}if(startElm && endElm && startElm !=endElm){node=startElm;var walker=new TreeWalker(startElm,root);while((node=walker.next())&& node !=endElm){if(dom.isBlock(node)){selectedBlocks.push(node);}}}if(endElm && startElm !=endElm && endElm !=root){selectedBlocks.push(endElm);}return selectedBlocks;},isForward:function(){var dom=this.dom,sel=this.getSel(),anchorRange,focusRange;if(!sel||!sel.anchorNode||!sel.focusNode){return true;}anchorRange=dom.createRng();anchorRange.setStart(sel.anchorNode,sel.anchorOffset);anchorRange.collapse(true);focusRange=dom.createRng();focusRange.setStart(sel.focusNode,sel.focusOffset);focusRange.collapse(true);return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0;},normalize:function(){var self=this,rng=self.getRng();if(!MultiRange.hasMultipleRanges(self.getSel())){var normRng=NormalizeRange.normalize(self.dom,rng);normRng.each(function(normRng){self.setRng(normRng,self.isForward());});return normRng.getOr(rng);}return rng;},selectorChanged:function(selector,callback){var self=this,currentSelectors;if(!self.selectorChangedData){self.selectorChangedData={};currentSelectors={};self.editor.on('NodeChange',function(e){var node=e.element,dom=self.dom,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};each(self.selectorChangedData,function(callbacks,selector){each(parents,function(node){if(dom.is(node,selector)){if(!currentSelectors[selector]){each(callbacks,function(callback){callback(true,{node:node,selector:selector,parents:parents});});currentSelectors[selector]=callbacks;}matchedSelectors[selector]=callbacks;return false;}});});each(currentSelectors,function(callbacks,selector){if(!matchedSelectors[selector]){delete currentSelectors[selector];each(callbacks,function(callback){callback(false,{node:node,selector:selector,parents:parents});});}});});}if(!self.selectorChangedData[selector]){self.selectorChangedData[selector]=[];}self.selectorChangedData[selector].push(callback);return self;},getScrollContainer:function(){var scrollContainer,node=this.dom.getRoot();while(node && node.nodeName !='BODY'){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break;}node=node.parentNode;}return scrollContainer;},scrollIntoView:function(elm,alignToTop){ScrollIntoView.scrollIntoView(this.editor,elm,alignToTop);},placeCaretAt:function(clientX,clientY){this.setRng(CaretRangeFromPoint.fromPoint(clientX,clientY,this.editor.getDoc()));},_moveEndPoint:function(rng,node,start){var root=node,walker=new TreeWalker(node,root);var nonEmptyElementsMap=this.dom.schema.getNonEmptyElements();do{if(node.nodeType==3 && trim(node.nodeValue).length !==0){if(start){rng.setStart(node,0);}else{rng.setEnd(node,node.nodeValue.length);}return;}if(nonEmptyElementsMap[node.nodeName]&& !/^(TD|TH)$/.test(node.nodeName)){if(start){rng.setStartBefore(node);}else{if(node.nodeName=='BR'){rng.setEndBefore(node);}else{rng.setEndAfter(node);}}return;}if(Env.ie && Env.ie<11 && this.dom.isBlock(node)&& this.dom.isEmpty(node)){if(start){rng.setStart(node,0);}else{rng.setEnd(node,0);}return;}}while((node=(start ? walker.next():walker.prev())));if(root.nodeName=='BODY'){if(start){rng.setStart(root,0);}else{rng.setEnd(root,root.childNodes.length);}}},getBoundingClientRect:function(){var rng=this.getRng();return rng.collapsed ? CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect();},destroy:function(){this.win=null;this.controlSelection.destroy();}};return Selection;});define('tinymce.core.caret.LineWalker',["tinymce.core.util.Fun","tinymce.core.util.Arr","tinymce.core.dom.Dimensions","tinymce.core.caret.CaretCandidate","tinymce.core.caret.CaretUtils","tinymce.core.caret.CaretWalker","tinymce.core.caret.CaretPosition","tinymce.core.geom.ClientRect"],function(Fun,Arr,Dimensions,CaretCandidate,CaretUtils,CaretWalker,CaretPosition,ClientRect){var curry=Fun.curry;var findUntil=function(direction,rootNode,predicateFn,node){while((node=CaretUtils.findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode))){if(predicateFn(node)){return;}}};var walkUntil=function(direction,isAboveFn,isBeflowFn,rootNode,predicateFn,caretPosition){var line=0,node,result=[],targetClientRect;var add=function(node){var i,clientRect,clientRects;clientRects=Dimensions.getClientRects(node);if(direction==-1){clientRects=clientRects.reverse();}for(i=0;i<clientRects.length;i++){clientRect=clientRects[i];if(isBeflowFn(clientRect,targetClientRect)){continue;}if(result.length>0 && isAboveFn(clientRect,Arr.last(result))){line++;}clientRect.line=line;if(predicateFn(clientRect)){return true;}result.push(clientRect);}};targetClientRect=Arr.last(caretPosition.getClientRects());if(!targetClientRect){return result;}node=caretPosition.getNode();add(node);findUntil(direction,rootNode,add,node);return result;};var aboveLineNumber=function(lineNumber,clientRect){return clientRect.line>lineNumber;};var isLine=function(lineNumber,clientRect){return clientRect.line===lineNumber;};var upUntil=curry(walkUntil,-1,ClientRect.isAbove,ClientRect.isBelow);var downUntil=curry(walkUntil,1,ClientRect.isBelow,ClientRect.isAbove);var positionsUntil=function(direction,rootNode,predicateFn,node){var caretWalker=new CaretWalker(rootNode),walkFn,isBelowFn,isAboveFn,caretPosition,result=[],line=0,clientRect,targetClientRect;var getClientRect=function(caretPosition){if(direction==1){return Arr.last(caretPosition.getClientRects());}return Arr.last(caretPosition.getClientRects());};if(direction==1){walkFn=caretWalker.next;isBelowFn=ClientRect.isBelow;isAboveFn=ClientRect.isAbove;caretPosition=CaretPosition.after(node);}else{walkFn=caretWalker.prev;isBelowFn=ClientRect.isAbove;isAboveFn=ClientRect.isBelow;caretPosition=CaretPosition.before(node);}targetClientRect=getClientRect(caretPosition);do{if(!caretPosition.isVisible()){continue;}clientRect=getClientRect(caretPosition);if(isAboveFn(clientRect,targetClientRect)){continue;}if(result.length>0 && isBelowFn(clientRect,Arr.last(result))){line++;}clientRect=ClientRect.clone(clientRect);clientRect.position=caretPosition;clientRect.line=line;if(predicateFn(clientRect)){return result;}result.push(clientRect);}while((caretPosition=walkFn(caretPosition)));return result;};return{upUntil:upUntil,downUntil:downUntil,positionsUntil:positionsUntil,isAboveLine:curry(aboveLineNumber),isLine:curry(isLine)};});define('tinymce.core.keyboard.CefNavigation',['tinymce.core.Env','tinymce.core.caret.CaretContainer','tinymce.core.caret.CaretPosition','tinymce.core.caret.CaretUtils','tinymce.core.caret.CaretWalker','tinymce.core.caret.LineUtils','tinymce.core.caret.LineWalker','tinymce.core.dom.NodeType','tinymce.core.keyboard.CefUtils','tinymce.core.selection.RangeNodes','tinymce.core.util.Arr','tinymce.core.util.Fun'],function(Env,CaretContainer,CaretPosition,CaretUtils,CaretWalker,LineUtils,LineWalker,NodeType,CefUtils,RangeNodes,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse;var getSelectedNode=RangeNodes.getSelectedNode;var isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse;var isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse;var getVisualCaretPosition=function(walkFn,caretPosition){while((caretPosition=walkFn(caretPosition))){if(caretPosition.isVisible()){return caretPosition;}}return caretPosition;};var isMoveInsideSameBlock=function(fromCaretPosition,toCaretPosition){var inSameBlock=CaretUtils.isInSameBlock(fromCaretPosition,toCaretPosition);if(!inSameBlock && NodeType.isBr(fromCaretPosition.getNode())){return true;}return inSameBlock;};var isRangeInCaretContainerBlock=function(range){return CaretContainer.isCaretContainerBlock(range.startContainer);};var getNormalizedRangeEndPoint=function(direction,rootNode,range){range=CaretUtils.normalizeRange(direction,rootNode,range);if(direction===-1){return CaretPosition.fromRangeStart(range);}return CaretPosition.fromRangeEnd(range);};var moveToCeFalseHorizontally=function(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range){var node,caretPosition,peekCaretPosition,rangeIsInContainerBlock;if(!range.collapsed){node=getSelectedNode(range);if(isContentEditableFalse(node)){return CefUtils.showCaret(direction,editor,node,direction===-1);}}rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeContentEditableFalseFn(caretPosition)){return CefUtils.selectNode(editor,caretPosition.getNode(direction===-1));}caretPosition=getNextPosFn(caretPosition);if(!caretPosition){if(rangeIsInContainerBlock){return range;}return null;}if(isBeforeContentEditableFalseFn(caretPosition)){return CefUtils.showCaret(direction,editor,caretPosition.getNode(direction===-1),direction===1);}peekCaretPosition=getNextPosFn(caretPosition);if(isBeforeContentEditableFalseFn(peekCaretPosition)){if(isMoveInsideSameBlock(caretPosition,peekCaretPosition)){return CefUtils.showCaret(direction,editor,peekCaretPosition.getNode(direction===-1),direction===1);}}if(rangeIsInContainerBlock){return CefUtils.renderRangeCaret(editor,caretPosition.toRange());}return null;};var moveToCeFalseVertically=function(direction,editor,walkerFn,range){var caretPosition,linePositions,nextLinePositions,closestNextLineRect,caretClientRect,clientX,dist1,dist2,contentEditableFalseNode;contentEditableFalseNode=getSelectedNode(range);caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);linePositions=walkerFn(editor.getBody(),LineWalker.isAboveLine(1),caretPosition);nextLinePositions=Arr.filter(linePositions,LineWalker.isLine(1));caretClientRect=Arr.last(caretPosition.getClientRects());if(isBeforeContentEditableFalse(caretPosition)){contentEditableFalseNode=caretPosition.getNode();}if(isAfterContentEditableFalse(caretPosition)){contentEditableFalseNode=caretPosition.getNode(true);}if(!caretClientRect){return null;}clientX=caretClientRect.left;closestNextLineRect=LineUtils.findClosestClientRect(nextLinePositions,clientX);if(closestNextLineRect){if(isContentEditableFalse(closestNextLineRect.node)){dist1=Math.abs(clientX-closestNextLineRect.left);dist2=Math.abs(clientX-closestNextLineRect.right);return CefUtils.showCaret(direction,editor,closestNextLineRect.node,dist1<dist2);}}if(contentEditableFalseNode){var caretPositions=LineWalker.positionsUntil(direction,editor.getBody(),LineWalker.isAboveLine(1),contentEditableFalseNode);closestNextLineRect=LineUtils.findClosestClientRect(Arr.filter(caretPositions,LineWalker.isLine(1)),clientX);if(closestNextLineRect){return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange());}closestNextLineRect=Arr.last(Arr.filter(caretPositions,LineWalker.isLine(0)));if(closestNextLineRect){return CefUtils.renderRangeCaret(editor,closestNextLineRect.position.toRange());}}};var createTextBlock=function(editor){var textBlock=editor.dom.create(editor.settings.forced_root_block);if(!Env.ie||Env.ie>=11){textBlock.innerHTML='<br data-mce-bogus="1">';}return textBlock;};var exitPreBlock=function(editor,direction,range){var pre,caretPos,newBlock;var caretWalker=new CaretWalker(editor.getBody());var getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next);var getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev);if(range.collapsed && editor.settings.forced_root_block){pre=editor.dom.getParent(range.startContainer,'PRE');if(!pre){return;}if(direction===1){caretPos=getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));}else{caretPos=getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));}if(!caretPos){newBlock=createTextBlock(editor);if(direction===1){editor.$(pre).after(newBlock);}else{editor.$(pre).before(newBlock);}editor.selection.select(newBlock,true);editor.selection.collapse();}}};var getHorizontalRange=function(editor,forward){var caretWalker=new CaretWalker(editor.getBody());var getNextVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.next);var getPrevVisualCaretPosition=Fun.curry(getVisualCaretPosition,caretWalker.prev);var newRange,direction=forward ? 1 :-1;var getNextPosFn=forward ? getNextVisualCaretPosition :getPrevVisualCaretPosition;var isBeforeContentEditableFalseFn=forward ? isBeforeContentEditableFalse :isAfterContentEditableFalse;var range=editor.selection.getRng();newRange=moveToCeFalseHorizontally(direction,editor,getNextPosFn,isBeforeContentEditableFalseFn,range);if(newRange){return newRange;}newRange=exitPreBlock(editor,direction,range);if(newRange){return newRange;}return null;};var getVerticalRange=function(editor,down){var newRange,direction=down ? 1 :-1;var walkerFn=down ? LineWalker.downUntil :LineWalker.upUntil;var range=editor.selection.getRng();newRange=moveToCeFalseVertically(direction,editor,walkerFn,range);if(newRange){return newRange;}newRange=exitPreBlock(editor,direction,range);if(newRange){return newRange;}return null;};var moveH=function(editor,forward){return function(){var newRng=getHorizontalRange(editor,forward);if(newRng){editor.selection.setRng(newRng);return true;}else{return false;}};};var moveV=function(editor,down){return function(){var newRng=getVerticalRange(editor,down);if(newRng){editor.selection.setRng(newRng);return true;}else{return false;}};};return{moveH:moveH,moveV:moveV};});define('tinymce.core.keyboard.MatchKeys',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.katamari.api.Merger'],function(Arr,Fun,Merger){var defaultPatterns=function(patterns){return Arr.map(patterns,function(pattern){return Merger.merge({shiftKey:false,altKey:false,ctrlKey:false,metaKey:false,keyCode:0,action:Fun.noop},pattern);});};var matchesEvent=function(pattern,evt){return(evt.keyCode===pattern.keyCode && evt.shiftKey===pattern.shiftKey && evt.altKey===pattern.altKey && evt.ctrlKey===pattern.ctrlKey && evt.metaKey===pattern.metaKey);};var match=function(patterns,evt){return Arr.bind(defaultPatterns(patterns),function(pattern){return matchesEvent(pattern,evt)?[pattern]:[];});};var action=function(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args);};};var execute=function(patterns,evt){return Arr.find(match(patterns,evt),function(pattern){return pattern.action();});};return{match:match,action:action,execute:execute};});define('tinymce.core.keyboard.ArrowKeys',['ephox.sand.api.PlatformDetection','tinymce.core.keyboard.BoundarySelection','tinymce.core.keyboard.CefNavigation','tinymce.core.keyboard.MatchKeys','tinymce.core.util.VK'],function(PlatformDetection,BoundarySelection,CefNavigation,MatchKeys,VK){var executeKeydownOverride=function(editor,caret,evt){var os=PlatformDetection.detect().os;MatchKeys.execute([{keyCode:VK.RIGHT,action:CefNavigation.moveH(editor,true)},{keyCode:VK.LEFT,action:CefNavigation.moveH(editor,false)},{keyCode:VK.UP,action:CefNavigation.moveV(editor,false)},{keyCode:VK.DOWN,action:CefNavigation.moveV(editor,true)},{keyCode:VK.RIGHT,action:BoundarySelection.move(editor,caret,true)},{keyCode:VK.LEFT,action:BoundarySelection.move(editor,caret,false)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:BoundarySelection.moveNextWord(editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:BoundarySelection.movePrevWord(editor,caret)}],evt).each(function(_){evt.preventDefault();});};var setup=function(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride(editor,caret,evt);}});};return{setup:setup};});define('tinymce.core.delete.InlineFormatDelete',['ephox.katamari.api.Arr','ephox.katamari.api.Fun','ephox.sugar.api.node.Element','ephox.sugar.api.search.Traverse','tinymce.core.caret.CaretPosition','tinymce.core.delete.DeleteElement','tinymce.core.delete.DeleteUtils','tinymce.core.dom.ElementType','tinymce.core.dom.Parents','tinymce.core.fmt.CaretFormat'],function(Arr,Fun,Element,Traverse,CaretPosition,DeleteElement,DeleteUtils,ElementType,Parents,CaretFormat){var getParentInlines=function(rootElm,startElm){var parents=Parents.parentsAndSelf(startElm,rootElm);return Arr.findIndex(parents,ElementType.isBlock).fold(Fun.constant(parents),function(index){return parents.slice(0,index);});};var hasOnlyOneChild=function(elm){return Traverse.children(elm).length===1;};var deleteLastPosition=function(forward,editor,target,parentInlines){var isFormatElement=Fun.curry(CaretFormat.isFormatElement,editor);var formatNodes=Arr.map(Arr.filter(parentInlines,isFormatElement),function(elm){return elm.dom();});if(formatNodes.length===0){DeleteElement.deleteElement(editor,forward,target);}else{var pos=CaretFormat.replaceWithCaretFormat(target.dom(),formatNodes);editor.selection.setRng(pos.toRange());}};var deleteCaret=function(editor,forward){var rootElm=Element.fromDom(editor.getBody());var startElm=Element.fromDom(editor.selection.getStart());var parentInlines=Arr.filter(getParentInlines(rootElm,startElm),hasOnlyOneChild);return Arr.last(parentInlines).map(function(target){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());if(DeleteUtils.willDeleteLastPositionInElement(forward,fromPos,target.dom())){deleteLastPosition(forward,editor,target,parentInlines);return true;}else{return false;}}).getOr(false);};var backspaceDelete=function(editor,forward){return editor.selection.isCollapsed()? deleteCaret(editor,forward):false;};return{backspaceDelete:backspaceDelete};});define('tinymce.core.keyboard.DeleteBackspaceKeys',['tinymce.core.delete.BlockBoundaryDelete','tinymce.core.delete.BlockRangeDelete','tinymce.core.delete.CefDelete','tinymce.core.delete.InlineBoundaryDelete','tinymce.core.delete.InlineFormatDelete','tinymce.core.delete.TableDelete','tinymce.core.keyboard.MatchKeys','tinymce.core.util.VK'],function(BlockBoundaryDelete,BlockRangeDelete,CefDelete,InlineBoundaryDelete,InlineFormatDelete,TableDelete,MatchKeys,VK){var executeKeydownOverride=function(editor,caret,evt){MatchKeys.execute([{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,false)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.backspaceDelete,editor,true)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,false)},{keyCode:VK.DELETE,action:MatchKeys.action(InlineBoundaryDelete.backspaceDelete,editor,caret,true)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,false)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockRangeDelete.backspaceDelete,editor,true)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,false)},{keyCode:VK.DELETE,action:MatchKeys.action(BlockBoundaryDelete.backspaceDelete,editor,true)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(TableDelete.backspaceDelete,editor,false)},{keyCode:VK.DELETE,action:MatchKeys.action(TableDelete.backspaceDelete,editor,true)},{keyCode:VK.BACKSPACE,action:MatchKeys.action(InlineFormatDelete.backspaceDelete,editor,false)},{keyCode:VK.DELETE,action:MatchKeys.action(InlineFormatDelete.backspaceDelete,editor,true)}],evt).each(function(_){evt.preventDefault();});};var executeKeyupOverride=function(editor,evt){MatchKeys.execute([{keyCode:VK.BACKSPACE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)},{keyCode:VK.DELETE,action:MatchKeys.action(CefDelete.paddEmptyElement,editor)}],evt);};var setup=function(editor,caret){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride(editor,caret,evt);}});editor.on('keyup',function(evt){if(evt.isDefaultPrevented()===false){executeKeyupOverride(editor,evt);}});};return{setup:setup};});define('tinymce.core.api.Settings',[],function(){var getBodySetting=function(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);if(value.indexOf('=')!==-1){var bodyObj=editor.getParam(name,'','hash');return bodyObj.hasOwnProperty(editor.id)? bodyObj[editor.id]:defaultValue;}else{return value;}};var getIframeAttrs=function(editor){return editor.getParam('iframe_attrs',{});};var getDocType=function(editor){return editor.getParam('doctype','<!DOCTYPE html>');};var getDocumentBaseUrl=function(editor){return editor.getParam('document_base_url','');};var getBodyId=function(editor){return getBodySetting(editor,'body_id','tinymce');};var getBodyClass=function(editor){return getBodySetting(editor,'body_class','');};var getContentSecurityPolicy=function(editor){return editor.getParam('content_security_policy','');};var shouldPutBrInPre=function(editor){return editor.getParam('br_in_pre',true);};var getForcedRootBlock=function(editor){if(editor.getParam('force_p_newlines',false)){return 'p';}var block=editor.getParam('forced_root_block','p');return block===false ? '' :block;};var getForcedRootBlockAttrs=function(editor){return editor.getParam('forced_root_block_attrs',{});};var getBrNewLineSelector=function(editor){return editor.getParam('br_newline_selector','.mce-toc h2,figcaption,caption');};var getNoNewLineSelector=function(editor){return editor.getParam('no_newline_selector','');};var shouldKeepStyles=function(editor){return editor.getParam('keep_styles',true);};var shouldEndContainerOnEmtpyBlock=function(editor){return editor.getParam('end_container_on_empty_block',false);};return{getIframeAttrs:getIframeAttrs,getDocType:getDocType,getDocumentBaseUrl:getDocumentBaseUrl,getBodyId:getBodyId,getBodyClass:getBodyClass,getContentSecurityPolicy:getContentSecurityPolicy,shouldPutBrInPre:shouldPutBrInPre,getForcedRootBlock:getForcedRootBlock,getForcedRootBlockAttrs:getForcedRootBlockAttrs,getBrNewLineSelector:getBrNewLineSelector,getNoNewLineSelector:getNoNewLineSelector,shouldKeepStyles:shouldKeepStyles,shouldEndContainerOnEmtpyBlock:shouldEndContainerOnEmtpyBlock};});define('tinymce.core.newline.NewLineUtils',['ephox.katamari.api.Fun','ephox.katamari.api.Option','ephox.sugar.api.node.Element','tinymce.core.dom.ElementType','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker'],function(Fun,Option,Element,ElementType,NodeType,TreeWalker){var firstNonWhiteSpaceNodeSibling=function(node){while(node){if(node.nodeType===1||(node.nodeType===3 && node.data && /[\r\n\s]/.test(node.data))){return node;}node=node.nextSibling;}};var moveToCaretPosition=function(editor,root){var walker,node,rng,lastNode=root,tempElm,dom=editor.dom;var moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(!root){return;}if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);if(firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)){root.insertBefore(dom.doc.createTextNode('\u00a0'),root.firstChild);}}rng=dom.createRng();root.normalize();if(root.hasChildNodes()){walker=new TreeWalker(root,root);while((node=walker.current())){if(NodeType.isText(node)){rng.setStart(node,0);rng.setEnd(node,0);break;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node);rng.setEndBefore(node);break;}lastNode=node;node=walker.next();}if(!node){rng.setStart(lastNode,0);rng.setEnd(lastNode,0);}}else{if(NodeType.isBr(root)){if(root.nextSibling && dom.isBlock(root.nextSibling)){rng.setStartBefore(root);rng.setEndBefore(root);}else{rng.setStartAfter(root);rng.setEndAfter(root);}}else{rng.setStart(root,0);rng.setEnd(root,0);}}editor.selection.setRng(rng);dom.remove(tempElm);editor.selection.scrollIntoView(root);};var getEditableRoot=function(dom,node){var root=dom.getRoot(),parent,editableRoot;parent=node;while(parent !==root && dom.getContentEditable(parent)!=="false"){if(dom.getContentEditable(parent)==="true"){editableRoot=parent;}parent=parent.parentNode;}return parent !==root ? editableRoot :root;};var getParentBlock=function(editor){return Option.from(editor.dom.getParent(editor.selection.getStart(true),editor.dom.isBlock));};var getParentBlockName=function(editor){return getParentBlock(editor).fold(Fun.constant(''),function(parentBlock){return parentBlock.nodeName.toUpperCase();});};var isListItemParentBlock=function(editor){return getParentBlock(editor).filter(function(elm){return ElementType.isListItem(Element.fromDom(elm));}).isSome();};return{moveToCaretPosition:moveToCaretPosition,getEditableRoot:getEditableRoot,getParentBlock:getParentBlock,getParentBlockName:getParentBlockName,isListItemParentBlock:isListItemParentBlock};});define('tinymce.core.newline.InsertLi',['tinymce.core.dom.NodeType','tinymce.core.newline.NewLineUtils'],function(NodeType,NewLineUtils){var hasFirstChild=function(elm,name){return elm.firstChild && elm.firstChild.nodeName===name;};var hasParent=function(elm,parentName){return elm && elm.parentNode && elm.parentNode.nodeName===parentName;};var isListBlock=function(elm){return elm && /^(OL|UL|LI)$/.test(elm.nodeName);};var isNestedList=function(elm){return isListBlock(elm)&& isListBlock(elm.parentNode);};var getContainerBlock=function(containerBlock){var containerBlockParent=containerBlock.parentNode;if(/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)){return containerBlockParent;}return containerBlock;};var isFirstOrLastLi=function(containerBlock,parentBlock,first){var node=containerBlock[first ? 'firstChild' :'lastChild'];while(node){if(NodeType.isElement(node)){break;}node=node[first ? 'nextSibling' :'previousSibling'];}return node===parentBlock;};var insert=function(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom;var rng=editor.selection.getRng();if(containerBlock===editor.getBody()){return;}if(isNestedList(containerBlock)){newBlockName='LI';}var newBlock=newBlockName ? createNewBlock(newBlockName):dom.create('BR');if(isFirstOrLastLi(containerBlock,parentBlock,true)&& isFirstOrLastLi(containerBlock,parentBlock,false)){if(hasParent(containerBlock,'LI')){dom.insertAfter(newBlock,getContainerBlock(containerBlock));}else{dom.replace(newBlock,containerBlock);}}else if(isFirstOrLastLi(containerBlock,parentBlock,true)){if(hasParent(containerBlock,'LI')){dom.insertAfter(newBlock,getContainerBlock(containerBlock));newBlock.appendChild(dom.doc.createTextNode(' '));newBlock.appendChild(containerBlock);}else{containerBlock.parentNode.insertBefore(newBlock,containerBlock);}}else if(isFirstOrLastLi(containerBlock,parentBlock,false)){dom.insertAfter(newBlock,getContainerBlock(containerBlock));}else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock);tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();if(newBlockName==='LI' && hasFirstChild(fragment,'LI')){newBlock=fragment.firstChild;dom.insertAfter(fragment,containerBlock);}else{dom.insertAfter(fragment,containerBlock);dom.insertAfter(newBlock,containerBlock);}}dom.remove(parentBlock);NewLineUtils.moveToCaretPosition(editor,newBlock);};return{insert:insert};});define('tinymce.core.newline.InsertBlock',['tinymce.core.api.Settings','tinymce.core.caret.CaretContainer','tinymce.core.dom.NodeType','tinymce.core.dom.TreeWalker','tinymce.core.fmt.CaretFormat','tinymce.core.newline.InsertLi','tinymce.core.newline.NewLineUtils','tinymce.core.selection.NormalizeRange','tinymce.core.text.Zwsp','tinymce.core.util.Tools'],function(Settings,CaretContainer,NodeType,TreeWalker,CaretFormat,InsertLi,NewLineUtils,NormalizeRange,Zwsp,Tools){var isEmptyAnchor=function(elm){return elm && elm.nodeName==="A" && Tools.trim(Zwsp.trim(elm.innerText||elm.textContent)).length===0;};var isTableCell=function(node){return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);};var emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">';};var containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||(container.previousSibling && container.previousSibling.nodeName===nodeName);};var canSplitBlock=function(dom,node){return node && dom.isBlock(node)&& !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&& !/^(fixed|absolute)/i.test(node.style.position)&& dom.getContentEditable(node)!=="true";};var trimInlineElementsOnLeftSideOfBlock=function(dom,nonEmptyElementsMap,block){var node=block,firstChilds=[],i;if(!node){return;}while((node=node.firstChild)){if(dom.isBlock(node)){return;}if(NodeType.isElement(node)&& !nonEmptyElementsMap[node.nodeName.toLowerCase()]){firstChilds.push(node);}}i=firstChilds.length;while(i--){node=firstChilds[i];if(!node.hasChildNodes()||(node.firstChild===node.lastChild && node.firstChild.nodeValue==='')){dom.remove(node);}else{if(isEmptyAnchor(node)){dom.remove(node);}}}};var normalizeZwspOffset=function(start,container,offset){if(NodeType.isText(container)===false){return offset;}if(start){return offset===1 && container.data.charAt(offset-1)===Zwsp.ZWSP ? 0 :offset;}else{return offset===container.data.length-1 && container.data.charAt(offset)===Zwsp.ZWSP ? container.data.length :offset;}};var includeZwspInRange=function(rng){var newRng=rng.cloneRange();newRng.setStart(rng.startContainer,normalizeZwspOffset(true,rng.startContainer,rng.startOffset));newRng.setEnd(rng.endContainer,normalizeZwspOffset(false,rng.endContainer,rng.endOffset));return newRng;};var trimLeadingLineBreaks=function(node){do{if(NodeType.isText(node)){node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,'');}node=node.firstChild;}while(node);};var getEditableRoot=function(dom,node){var root=dom.getRoot(),parent,editableRoot;parent=node;while(parent !==root && dom.getContentEditable(parent)!=="false"){if(dom.getContentEditable(parent)==="true"){editableRoot=parent;}parent=parent.parentNode;}return parent !==root ? editableRoot :root;};var setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=Settings.getForcedRootBlock(editor);if(forcedRootBlockName && forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){editor.dom.setAttribs(node,Settings.getForcedRootBlockAttrs(editor));}};var wrapSelfAndSiblingsInDefaultBlock=function(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||'P';var dom=editor.dom,editableRoot=getEditableRoot(dom,container);parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){parentBlock=parentBlock||editableRoot;if(parentBlock===editor.getBody()||isTableCell(parentBlock)){rootBlockName=parentBlock.nodeName.toLowerCase();}else{rootBlockName=parentBlock.parentNode.nodeName.toLowerCase();}if(!parentBlock.hasChildNodes()){newBlock=dom.create(blockName);setForcedBlockAttrs(editor,newBlock);parentBlock.appendChild(newBlock);rng.setStart(newBlock,0);rng.setEnd(newBlock,0);return newBlock;}node=container;while(node.parentNode !==parentBlock){node=node.parentNode;}while(node && !dom.isBlock(node)){startNode=node;node=node.previousSibling;}if(startNode && editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){newBlock=dom.create(blockName);setForcedBlockAttrs(editor,newBlock);startNode.parentNode.insertBefore(newBlock,startNode);node=startNode;while(node && !dom.isBlock(node)){next=node.nextSibling;newBlock.appendChild(node);node=next;}rng.setStart(container,offset);rng.setEnd(container,offset);}}return container;};var addBrToBlockIfNeeded=function(dom,block){var lastChild;block.normalize();lastChild=block.lastChild;if(!lastChild||(/^(left|right)$/gi.test(dom.getStyle(lastChild,'float',true)))){dom.add(block,'br');}};var insert=function(editor,evt){var tmpRng,editableRoot,container,offset,parentBlock,shiftKey;var newBlock,fragment,containerBlock,parentBlockName,containerBlockName,newBlockName,isAfterLastNodeInContainer;var dom=editor.dom;var schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements();var rng=editor.selection.getRng();var createNewBlock=function(name){var node=container,block,clonedNode,caretNode,textInlineElements=schema.getTextInlineElements();if(name||parentBlockName==="TABLE"||parentBlockName==="HR"){block=dom.create(name||newBlockName);setForcedBlockAttrs(editor,block);}else{block=parentBlock.cloneNode(false);}caretNode=block;if(Settings.shouldKeepStyles(editor)===false){dom.setAttrib(block,'style',null);dom.setAttrib(block,'class',null);}else{do{if(textInlineElements[node.nodeName]){if(CaretFormat.isCaretNode(node)){continue;}clonedNode=node.cloneNode(false);dom.setAttrib(clonedNode,'id','');if(block.hasChildNodes()){clonedNode.appendChild(block.firstChild);block.appendChild(clonedNode);}else{caretNode=clonedNode;block.appendChild(clonedNode);}}}while((node=node.parentNode)&& node !==editableRoot);}emptyBlock(caretNode);return block;};var isCaretAtStartOrEndOfBlock=function(start){var walker,node,name,normalizedOffset;normalizedOffset=normalizeZwspOffset(start,container,offset);if(NodeType.isText(container)&&(start ? normalizedOffset>0 :normalizedOffset<container.nodeValue.length)){return false;}if(container.parentNode===parentBlock && isAfterLastNodeInContainer && !start){return true;}if(start && NodeType.isElement(container)&& container===parentBlock.firstChild){return true;}if(containerAndSiblingName(container,'TABLE')||containerAndSiblingName(container,'HR')){return(isAfterLastNodeInContainer && !start)||(!isAfterLastNodeInContainer && start);}walker=new TreeWalker(container,parentBlock);if(NodeType.isText(container)){if(start && normalizedOffset===0){walker.prev();}else if(!start && normalizedOffset===container.nodeValue.length){walker.next();}}while((node=walker.current())){if(NodeType.isElement(node)){if(!node.getAttribute('data-mce-bogus')){name=node.nodeName.toLowerCase();if(nonEmptyElementsMap[name]&& name !=='br'){return false;}}}else if(NodeType.isText(node)&& !/^[ \t\r\n]*$/.test(node.nodeValue)){return false;}if(start){walker.prev();}else{walker.next();}}return true;};var insertNewBlockAfter=function(){if(/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&& containerBlockName !=='HGROUP'){newBlock=createNewBlock(newBlockName);}else{newBlock=createNewBlock();}if(Settings.shouldEndContainerOnEmtpyBlock(editor)&& canSplitBlock(dom,containerBlock)&& dom.isEmpty(parentBlock)){newBlock=dom.split(containerBlock,parentBlock);}else{dom.insertAfter(newBlock,parentBlock);}NewLineUtils.moveToCaretPosition(editor,newBlock);};NormalizeRange.normalize(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});container=rng.startContainer;offset=rng.startOffset;newBlockName=Settings.getForcedRootBlock(editor);shiftKey=evt.shiftKey;if(NodeType.isElement(container)&& container.hasChildNodes()){isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer && NodeType.isText(container)){offset=container.nodeValue.length;}else{offset=0;}}editableRoot=getEditableRoot(dom,container);if(!editableRoot){return;}if((newBlockName && !shiftKey)||(!newBlockName && shiftKey)){container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset);}parentBlock=dom.getParent(container,dom.isBlock);containerBlock=parentBlock ? dom.getParent(parentBlock.parentNode,dom.isBlock):null;parentBlockName=parentBlock ? parentBlock.nodeName.toUpperCase():'';containerBlockName=containerBlock ? containerBlock.nodeName.toUpperCase():'';if(containerBlockName==='LI' && !evt.ctrlKey){parentBlock=containerBlock;containerBlock=containerBlock.parentNode;parentBlockName=containerBlockName;}if(/^(LI|DT|DD)$/.test(parentBlockName)){if(dom.isEmpty(parentBlock)){InsertLi.insert(editor,createNewBlock,containerBlock,parentBlock,newBlockName);return;}}if(newBlockName && parentBlock===editor.getBody()){return;}newBlockName=newBlockName||'P';if(CaretContainer.isCaretContainerBlock(parentBlock)){newBlock=CaretContainer.showCaretContainerBlock(parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}NewLineUtils.moveToCaretPosition(editor,newBlock);}else if(isCaretAtStartOrEndOfBlock()){insertNewBlockAfter();}else if(isCaretAtStartOrEndOfBlock(true)){newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock);NewLineUtils.moveToCaretPosition(editor,containerAndSiblingName(parentBlock,'HR')? newBlock :parentBlock);}else{tmpRng=includeZwspInRange(rng).cloneRange();tmpRng.setEndAfter(parentBlock);fragment=tmpRng.extractContents();trimLeadingLineBreaks(fragment);newBlock=fragment.firstChild;dom.insertAfter(fragment,parentBlock);trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock);addBrToBlockIfNeeded(dom,parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}newBlock.normalize();if(dom.isEmpty(newBlock)){dom.remove(newBlock);insertNewBlockAfter();}else{NewLineUtils.moveToCaretPosition(editor,newBlock);}}dom.setAttrib(newBlock,'id','');editor.fire('NewBlock',{newBlock:newBlock});};return{insert:insert};});define('tinymce.core.newline.ContextSelectors',['ephox.sugar.api.node.Element','ephox.sugar.api.search.Selectors','tinymce.core.api.Settings','tinymce.core.newline.NewLineUtils'],function(Element,Selectors,Settings,NewLineUtils){var matchesSelector=function(editor,selector){return NewLineUtils.getParentBlock(editor).filter(function(parentBlock){return selector.length>0 && Selectors.is(Element.fromDom(parentBlock),selector);}).isSome();};var shouldInsertBr=function(editor){return matchesSelector(editor,Settings.getBrNewLineSelector(editor));};var shouldBlockNewLine=function(editor){return matchesSelector(editor,Settings.getNoNewLineSelector(editor));};return{shouldInsertBr:shouldInsertBr,shouldBlockNewLine:shouldBlockNewLine};});define('tinymce.core.newline.NewLineAction',['ephox.katamari.api.Adt','ephox.katamari.api.Arr','ephox.katamari.api.Option','tinymce.core.api.Settings','tinymce.core.newline.ContextSelectors','tinymce.core.newline.NewLineUtils','tinymce.core.util.LazyEvaluator'],function(Adt,Arr,Option,Settings,ContextSelectors,NewLineUtils,LazyEvaluator){var newLineAction=Adt.generate([{br:[]},{block:[]},{none:[]}]);var shouldBlockNewLine=function(editor,shiftKey){return ContextSelectors.shouldBlockNewLine(editor);};var isBrMode=function(requiredState){return function(editor,shiftKey){var brMode=Settings.getForcedRootBlock(editor)==='';return brMode===requiredState;};};var inListBlock=function(requiredState){return function(editor,shiftKey){return NewLineUtils.isListItemParentBlock(editor)===requiredState;};};var inPreBlock=function(requiredState){return function(editor,shiftKey){var inPre=NewLineUtils.getParentBlockName(editor)==='PRE';return inPre===requiredState;};};var shouldPutBrInPre=function(requiredState){return function(editor,shiftKey){return Settings.shouldPutBrInPre(editor)===requiredState;};};var inBrContext=function(editor,shiftKey){return ContextSelectors.shouldInsertBr(editor);};var hasShiftKey=function(editor,shiftKey){return shiftKey;};var canInsertIntoEditableRoot=function(editor){var forcedRootBlock=Settings.getForcedRootBlock(editor);var rootEditable=NewLineUtils.getEditableRoot(editor.dom,editor.selection.getStart());return rootEditable && editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock ? forcedRootBlock :'P');};var match=function(predicates,action){return function(editor,shiftKey){var isMatch=Arr.foldl(predicates,function(res,p){return res && p(editor,shiftKey);},true);return isMatch ? Option.some(action):Option.none();};};var getAction=function(editor,evt){return LazyEvaluator.evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inPreBlock(true),shouldPutBrInPre(false),hasShiftKey],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false)],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true),hasShiftKey],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true)],newLineAction.br()),match([inListBlock(true),hasShiftKey],newLineAction.br()),match([inListBlock(true)],newLineAction.block()),match([isBrMode(true),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match([isBrMode(true)],newLineAction.br()),match([inBrContext],newLineAction.br()),match([isBrMode(false),hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,evt.shiftKey]).getOr(newLineAction.none());};return{getAction:getAction};});define('tinymce.core.newline.InsertNewLine',['ephox.katamari.api.Fun','tinymce.core.newline.InsertBlock','tinymce.core.newline.InsertBr','tinymce.core.newline.NewLineAction'],function(Fun,InsertBlock,InsertBr,NewLineAction){var insert=function(editor,evt){NewLineAction.getAction(editor,evt).fold(function(){InsertBr.insert(editor,evt);},function(){InsertBlock.insert(editor,evt);},Fun.noop);};return{insert:insert};});define('tinymce.core.keyboard.EnterKey',['tinymce.core.newline.InsertNewLine','tinymce.core.util.VK'],function(InsertNewLine,VK){var endTypingLevel=function(undoManager){if(undoManager.typing){undoManager.typing=false;undoManager.add();}};var handleEnterKeyEvent=function(editor,event){if(event.isDefaultPrevented()){return;}event.preventDefault();endTypingLevel(editor.undoManager);editor.undoManager.transact(function(){if(editor.selection.isCollapsed()===false){editor.execCommand('Delete');}InsertNewLine.insert(editor,event);});};var setup=function(editor){editor.on('keydown',function(event){if(event.keyCode===VK.ENTER){handleEnterKeyEvent(editor,event);}});};return{setup:setup};});define('tinymce.core.keyboard.InsertSpace',['ephox.katamari.api.Fun','tinymce.core.caret.CaretPosition','tinymce.core.dom.NodeType','tinymce.core.keyboard.BoundaryLocation','tinymce.core.keyboard.InlineUtils'],function(Fun,CaretPosition,NodeType,BoundaryLocation,InlineUtils){var isValidInsertPoint=function(location,caretPosition){return isAtStartOrEnd(location)&& NodeType.isText(caretPosition.container());};var insertNbspAtPosition=function(editor,caretPosition){var container=caretPosition.container();var offset=caretPosition.offset();container.insertData(offset,'\u00a0');editor.selection.setCursorLocation(container,offset+1);};var insertAtLocation=function(editor,caretPosition,location){if(isValidInsertPoint(location,caretPosition)){insertNbspAtPosition(editor,caretPosition);return true;}else{return false;}};var insertAtCaret=function(editor){var isInlineTarget=Fun.curry(InlineUtils.isInlineTarget,editor);var caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());var boundaryLocation=BoundaryLocation.readLocation(isInlineTarget,editor.getBody(),caretPosition);return boundaryLocation.map(Fun.curry(insertAtLocation,editor,caretPosition)).getOr(false);};var isAtStartOrEnd=function(location){return location.fold(Fun.constant(false),Fun.constant(true),Fun.constant(true),Fun.constant(false));};var insertAtSelection=function(editor){return editor.selection.isCollapsed()? insertAtCaret(editor):false;};return{insertAtSelection:insertAtSelection};});define('tinymce.core.keyboard.SpaceKey',['tinymce.core.keyboard.InsertSpace','tinymce.core.keyboard.MatchKeys','tinymce.core.util.VK'],function(InsertSpace,MatchKeys,VK){var executeKeydownOverride=function(editor,evt){MatchKeys.execute([{keyCode:VK.SPACEBAR,action:MatchKeys.action(InsertSpace.insertAtSelection,editor)}],evt).each(function(_){evt.preventDefault();});};var setup=function(editor){editor.on('keydown',function(evt){if(evt.isDefaultPrevented()===false){executeKeydownOverride(editor,evt);}});};return{setup:setup};});define('tinymce.core.keyboard.KeyboardOverrides',['tinymce.core.keyboard.ArrowKeys','tinymce.core.keyboard.BoundarySelection','tinymce.core.keyboard.DeleteBackspaceKeys','tinymce.core.keyboard.EnterKey','tinymce.core.keyboard.SpaceKey'],function(ArrowKeys,BoundarySelection,DeleteBackspaceKeys,EnterKey,SpaceKey){var setup=function(editor){var caret=BoundarySelection.setupSelectedState(editor);ArrowKeys.setup(editor,caret);DeleteBackspaceKeys.setup(editor,caret);EnterKey.setup(editor);SpaceKey.setup(editor);};return{setup:setup};});define('tinymce.core.util.Quirks',['global!document','global!window','tinymce.core.Env','tinymce.core.caret.CaretContainer','tinymce.core.selection.CaretRangeFromPoint','tinymce.core.util.Delay','tinymce.core.util.Tools','tinymce.core.util.VK'],function(document,window,Env,CaretContainer,CaretRangeFromPoint,Delay,Tools,VK){return function(editor){var each=Tools.each;var BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,settings=editor.settings,parser=editor.parser;var isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit;var mceInternalUrlPrefix='data:text/mce-internal,';var mceInternalDataType=isIE ? 'Text' :'URL';var setEditorCommandState=function(cmd,state){try{editor.getDoc().execCommand(cmd,false,state);}catch(ex){}};var isDefaultPrevented=function(e){return e.isDefaultPrevented();};var setMceInternalContent=function(e){var selectionHtml,internalContent;if(e.dataTransfer){if(editor.selection.isCollapsed()&& e.target.tagName=='IMG'){selection.select(e.target);}selectionHtml=editor.selection.getContent();if(selectionHtml.length>0){internalContent=mceInternalUrlPrefix+escape(editor.id)+','+escape(selectionHtml);e.dataTransfer.setData(mceInternalDataType,internalContent);}}};var getMceInternalContent=function(e){var internalContent;if(e.dataTransfer){internalContent=e.dataTransfer.getData(mceInternalDataType);if(internalContent && internalContent.indexOf(mceInternalUrlPrefix)>=0){internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(',');return{id:unescape(internalContent[0]),html:unescape(internalContent[1])};}}return null;};var insertClipboardContents=function(content,internal){if(editor.queryCommandSupported('mceInsertClipboardContent')){editor.execCommand('mceInsertClipboardContent',false,{content:content,internal:internal});}else{editor.execCommand('mceInsertContent',false,content);}};var emptyEditorWhenDeleting=function(){var serializeRng=function(rng){var body=dom.create("body");var contents=rng.cloneContents();body.appendChild(contents);return selection.serializer.serialize(body,{format:'html'});};var allContentsSelected=function(rng){var selection=serializeRng(rng);var allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection;};editor.on('keydown',function(e){var keyCode=e.keyCode,isCollapsed,body;if(!isDefaultPrevented(e)&&(keyCode==DELETE||keyCode==BACKSPACE)){isCollapsed=editor.selection.isCollapsed();body=editor.getBody();if(isCollapsed && !dom.isEmpty(body)){return;}if(!isCollapsed && !allContentsSelected(editor.selection.getRng())){return;}e.preventDefault();editor.setContent('');if(body.firstChild && dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0);}else{editor.selection.setCursorLocation(body,0);}editor.nodeChanged();}});};var selectAll=function(){editor.shortcuts.add('meta+a',null,'SelectAll');};var inputMethodFocus=function(){if(!editor.settings.content_editable){dom.bind(editor.getDoc(),'mousedown mouseup',function(e){var rng;if(e.target==editor.getDoc().documentElement){rng=selection.getRng();editor.getBody().focus();if(e.type=='mousedown'){if(CaretContainer.isCaretContainer(rng.startContainer)){return;}selection.placeCaretAt(e.clientX,e.clientY);}else{selection.setRng(rng);}}});}};var removeHrOnBackspace=function(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&& e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName('hr').length){return;}if(selection.isCollapsed()&& selection.getRng(true).startOffset===0){var node=selection.getNode();var previousSibling=node.previousSibling;if(node.nodeName=='HR'){dom.remove(node);e.preventDefault();return;}if(previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase()==="hr"){dom.remove(previousSibling);e.preventDefault();}}}});};var focusBody=function(){if(!window.Range.prototype.getClientRects){editor.on('mousedown',function(e){if(!isDefaultPrevented(e)&& e.target.nodeName==="HTML"){var body=editor.getBody();body.blur();Delay.setEditorTimeout(editor,function(){body.focus();});}});}};var selectControlElements=function(){editor.on('click',function(e){var target=e.target;if(/^(IMG|HR)$/.test(target.nodeName)&& dom.getContentEditableParent(target)!=="false"){e.preventDefault();editor.selection.select(target);editor.nodeChanged();}if(target.nodeName=='A' && dom.hasClass(target,'mce-item-anchor')){e.preventDefault();selection.select(target);}});};var removeStylesWhenDeletingAcrossBlockElements=function(){var getAttributeApplyFunction=function(){var template=dom.getAttribs(selection.getStart().cloneNode(false));return function(){var target=selection.getStart();if(target !==editor.getBody()){dom.setAttrib(target,"style",null);each(template,function(attr){target.setAttributeNode(attr.cloneNode(true));});}};};var isSelectionAcrossElements=function(){return !selection.isCollapsed()&& dom.getParent(selection.getStart(),dom.isBlock)!=dom.getParent(selection.getEnd(),dom.isBlock);};editor.on('keypress',function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(e.keyCode==8||e.keyCode==46)&& isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();editor.getDoc().execCommand('delete',false,null);applyAttributes();e.preventDefault();return false;}});dom.bind(editor.getDoc(),'cut',function(e){var applyAttributes;if(!isDefaultPrevented(e)&& isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,function(){applyAttributes();});}});};var disableBackspaceIntoATable=function(){editor.on('keydown',function(e){if(!isDefaultPrevented(e)&& e.keyCode===BACKSPACE){if(selection.isCollapsed()&& selection.getRng(true).startOffset===0){var previousSibling=selection.getNode().previousSibling;if(previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase()==="table"){e.preventDefault();return false;}}}});};var removeBlockQuoteOnBackSpace=function(){editor.on('keydown',function(e){var rng,container,offset,root,parent;if(isDefaultPrevented(e)||e.keyCode !=VK.BACKSPACE){return;}rng=selection.getRng();container=rng.startContainer;offset=rng.startOffset;root=dom.getRoot();parent=container;if(!rng.collapsed||offset !==0){return;}while(parent && parent.parentNode && parent.parentNode.firstChild==parent && parent.parentNode !=root){parent=parent.parentNode;}if(parent.tagName==='BLOCKQUOTE'){editor.formatter.toggle('blockquote',null,parent);rng=dom.createRng();rng.setStart(container,0);rng.setEnd(container,0);selection.setRng(rng);}});};var setGeckoEditingOptions=function(){var setOpts=function(){refreshContentEditable();setEditorCommandState("StyleWithCSS",false);setEditorCommandState("enableInlineTableEditing",false);if(!settings.object_resizing){setEditorCommandState("enableObjectResizing",false);}};if(!settings.readonly){editor.on('BeforeExecCommand MouseDown',setOpts);}};var addBrAfterLastLinks=function(){var fixLinks=function(){each(dom.select('a'),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){while(parentNode && !dom.isBlock(parentNode)){if(parentNode.parentNode.lastChild !==parentNode||parentNode===root){return;}parentNode=parentNode.parentNode;}dom.add(parentNode,'br',{'data-mce-bogus':1});}});};editor.on('SetContent ExecCommand',function(e){if(e.type=="setcontent"||e.command==='mceInsertLink'){fixLinks();}});};var setDefaultBlockType=function(){if(settings.forced_root_block){editor.on('init',function(){setEditorCommandState('DefaultParagraphSeparator',settings.forced_root_block);});}};var normalizeSelection=function(){editor.on('keyup focusin mouseup',function(e){if(!VK.modifierPressed(e)){selection.normalize();}},true);};var showBrokenImageIcon=function(){editor.contentStyles.push('img:-moz-broken {'+'-moz-force-broken-image-icon:1;'+'min-width:24px;'+'min-height:24px'+'}');};var restoreFocusOnKeyDown=function(){if(!editor.inline){editor.on('keydown',function(){if(document.activeElement==document.body){editor.getWin().focus();}});}};var bodyHeight=function(){if(!editor.inline){editor.contentStyles.push('body {min-height: 150px}');editor.on('click',function(e){var rng;if(e.target.nodeName=='HTML'){if(Env.ie>11){editor.getBody().focus();return;}rng=editor.selection.getRng();editor.getBody().focus();editor.selection.setRng(rng);editor.selection.normalize();editor.nodeChanged();}});}};var blockCmdArrowNavigation=function(){if(Env.mac){editor.on('keydown',function(e){if(VK.metaKeyPressed(e)&& !e.shiftKey &&(e.keyCode==37||e.keyCode==39)){e.preventDefault();editor.selection.getSel().modify('move',e.keyCode==37 ? 'backward' :'forward','lineboundary');}});}};var disableAutoUrlDetect=function(){setEditorCommandState("AutoUrlDetect",false);};var tapLinksAndImages=function(){editor.on('click',function(e){var elm=e.target;do{if(elm.tagName==='A'){e.preventDefault();return;}}while((elm=elm.parentNode));});editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');};var blockFormSubmitInsideEditor=function(){editor.on('init',function(){editor.dom.bind(editor.getBody(),'submit',function(e){e.preventDefault();});});};var removeAppleInterchangeBrs=function(){parser.addNodeFilter('br',function(nodes){var i=nodes.length;while(i--){if(nodes[i].attr('class')=='Apple-interchange-newline'){nodes[i].remove();}}});};var ieInternalDragAndDrop=function(){editor.on('dragstart',function(e){setMceInternalContent(e);});editor.on('drop',function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent && internalContent.id !=editor.id){e.preventDefault();var rng=CaretRangeFromPoint.fromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng);insertClipboardContents(internalContent.html,true);}}});};var refreshContentEditable=function(){};var isHidden=function(){var sel;if(!isGecko||editor.removed){return 0;}sel=editor.selection.getSel();return(!sel||!sel.rangeCount||sel.rangeCount===0);};removeBlockQuoteOnBackSpace();emptyEditorWhenDeleting();if(!Env.windowsPhone){normalizeSelection();}if(isWebKit){inputMethodFocus();selectControlElements();setDefaultBlockType();blockFormSubmitInsideEditor();disableBackspaceIntoATable();removeAppleInterchangeBrs();if(Env.iOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}else{selectAll();}}if(Env.ie>=11){bodyHeight();disableBackspaceIntoATable();}if(Env.ie){selectAll();disableAutoUrlDetect();ieInternalDragAndDrop();}if(isGecko){removeHrOnBackspace();focusBody();removeStylesWhenDeletingAcrossBlockElements();setGeckoEditingOptions();addBrAfterLastLinks();showBrokenImageIcon();blockCmdArrowNavigation();disableBackspaceIntoATable();}return{refreshContentEditable:refreshContentEditable,isHidden:isHidden};};});define('tinymce.core.init.InitContentBody',['ephox.sugar.api.dom.Insert','ephox.sugar.api.node.Element','ephox.sugar.api.properties.Attr','global!document','global!window','tinymce.core.EditorUpload','tinymce.core.ForceBlocks','tinymce.core.NodeChange','tinymce.core.SelectionOverrides','tinymce.core.UndoManager','tinymce.core.api.Formatter','tinymce.core.api.dom.Serializer','tinymce.core.caret.CaretContainerInput','tinymce.core.dom.DOMUtils','tinymce.core.dom.Selection','tinymce.core.html.DomParser','tinymce.core.html.Node','tinymce.core.html.Schema','tinymce.core.keyboard.KeyboardOverrides','tinymce.core.util.Delay','tinymce.core.util.Quirks','tinymce.core.util.Tools'],function(Insert,Element,Attr,document,window,EditorUpload,ForceBlocks,NodeChange,SelectionOverrides,UndoManager,Formatter,Serializer,CaretContainerInput,DOMUtils,Selection,DomParser,Node,Schema,KeyboardOverrides,Delay,Quirks,Tools){var DOM=DOMUtils.DOM;var appendStyle=function(editor,text){var head=Element.fromDom(editor.getDoc().head);var tag=Element.fromTag('style');Attr.set(tag,'type','text/css');Insert.append(tag,Element.fromText(text));Insert.append(head,tag);};var createParser=function(editor){var parser=new DomParser(editor.settings,editor.schema);parser.addAttributeFilter('src,href,style,tabindex',function(nodes,name){var i=nodes.length,node,dom=editor.dom,value,internalName;while(i--){node=nodes[i];value=node.attr(name);internalName='data-mce-'+name;if(!node.attributes.map[internalName]){if(value.indexOf('data:')===0||value.indexOf('blob:')===0){continue;}if(name==="style"){value=dom.serializeStyle(dom.parseStyle(value),node.name);if(!value.length){value=null;}node.attr(internalName,value);node.attr(name,value);}else if(name==="tabindex"){node.attr(internalName,value);node.attr(name,null);}else{node.attr(internalName,editor.convertURL(value,name,node.name));}}}});parser.addNodeFilter('script',function(nodes){var i=nodes.length,node,type;while(i--){node=nodes[i];type=node.attr('type')||'no/type';if(type.indexOf('mce-')!==0){node.attr('type','mce-'+type);}}});parser.addNodeFilter('#cdata',function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];node.type=8;node.name='#comment';node.value='[CDATA['+node.value+']]';}});parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div',function(nodes){var i=nodes.length,node,nonEmptyElements=editor.schema.getNonEmptyElements();while(i--){node=nodes[i];if(node.isEmpty(nonEmptyElements)&& node.getAll('br').length===0){node.append(new Node('br',1)).shortEnded=true;}}});return parser;};var autoFocus=function(editor){if(editor.settings.auto_focus){Delay.setEditorTimeout(editor,function(){var focusEditor;if(editor.settings.auto_focus===true){focusEditor=editor;}else{focusEditor=editor.editorManager.get(editor.settings.auto_focus);}if(!focusEditor.destroyed){focusEditor.focus();}},100);}};var initEditor=function(editor){editor.bindPendingEventDelegates();editor.initialized=true;editor.fire('init');editor.focus(true);editor.nodeChanged({initial:true});editor.execCallback('init_instance_callback',editor);autoFocus(editor);};var getStyleSheetLoader=function(editor){return editor.inline ? DOM.styleSheetLoader :editor.dom.styleSheetLoader;};var initContentBody=function(editor,skipWrite){var settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc(),body,contentCssText;if(!settings.inline){editor.getElement().style.visibility=editor.orgVisibility;}if(!skipWrite && !settings.content_editable){doc.open();doc.write(editor.iframeHTML);doc.close();}if(settings.content_editable){editor.on('remove',function(){var bodyEl=this.getBody();DOM.removeClass(bodyEl,'mce-content-body');DOM.removeClass(bodyEl,'mce-edit-focus');DOM.setAttrib(bodyEl,'contentEditable',null);});DOM.addClass(targetElm,'mce-content-body');editor.contentDocument=doc=settings.content_document||document;editor.contentWindow=settings.content_window||window;editor.bodyElement=targetElm;settings.content_document=settings.content_window=null;settings.root_name=targetElm.nodeName.toLowerCase();}body=editor.getBody();body.disabled=true;editor.readonly=settings.readonly;if(!editor.readonly){if(editor.inline && DOM.getStyle(body,'position',true)==='static'){body.style.position='relative';}body.contentEditable=editor.getParam('content_editable_state',true);}body.disabled=false;editor.editorUpload=new EditorUpload(editor);editor.schema=new Schema(settings);editor.dom=new DOMUtils(doc,{keep_values:true,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,class_filter:settings.class_filter,update_styles:true,root_element:editor.inline ? editor.getBody():null,collect:settings.content_editable,schema:editor.schema,onSetAttrib:function(e){editor.fire('SetAttrib',e);}});editor.parser=createParser(editor);editor.serializer=new Serializer(settings,editor);editor.selection=new Selection(editor.dom,editor.getWin(),editor.serializer,editor);editor.formatter=new Formatter(editor);editor.undoManager=new UndoManager(editor);editor._nodeChangeDispatcher=new NodeChange(editor);editor._selectionOverrides=new SelectionOverrides(editor);CaretContainerInput.setup(editor);KeyboardOverrides.setup(editor);ForceBlocks.setup(editor);editor.fire('PreInit');if(!settings.browser_spellcheck && !settings.gecko_spellcheck){doc.body.spellcheck=false;DOM.setAttrib(body,"spellcheck","false");}editor.quirks=new Quirks(editor);editor.fire('PostRender');if(settings.directionality){body.dir=settings.directionality;}if(settings.nowrap){body.style.whiteSpace="nowrap";}if(settings.protect){editor.on('BeforeSetContent',function(e){Tools.each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return '<!--mce:protected '+escape(str)+'-->';});});});}editor.on('SetContent',function(){editor.addVisual(editor.getBody());});if(settings.padd_empty_editor){editor.on('PostProcess',function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,'');});}editor.load({initial:true,format:'html'});editor.startContent=editor.getContent({format:'raw'});editor.on('compositionstart compositionend',function(e){editor.composing=e.type==='compositionstart';});if(editor.contentStyles.length>0){contentCssText='';Tools.each(editor.contentStyles,function(style){contentCssText+=style+"\r\n";});editor.dom.addStyle(contentCssText);}getStyleSheetLoader(editor).loadAll(editor.contentCSS,function(_){initEditor(editor);},function(urls){initEditor(editor);});if(settings.content_style){appendStyle(editor,settings.content_style);}};return{initContentBody:initContentBody};});define('tinymce.core.init.InitIframe',['ephox.sugar.api.node.Element','ephox.sugar.api.properties.Attr','ephox.sugar.api.properties.Css','global!document','global!window','tinymce.core.Env','tinymce.core.api.Settings','tinymce.core.dom.DOMUtils','tinymce.core.init.InitContentBody','tinymce.core.util.Uuid'],function(Element,Attr,Css,document,window,Env,Settings,DOMUtils,InitContentBody,Uuid){var DOM=DOMUtils.DOM;var relaxDomain=function(editor,ifr){if(document.domain !==window.location.hostname && Env.ie && Env.ie<12){var bodyUuid=Uuid.uuid('mce');editor[bodyUuid]=function(){InitContentBody.initContentBody(editor);};var domainRelaxUrl='javascript:(function(){'+'document.open();document.domain="'+document.domain+'";'+'var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);'+'document.close();ed.'+bodyUuid+'(true);})()';DOM.setAttrib(ifr,'src',domainRelaxUrl);return true;}return false;};var normalizeHeight=function(height){var normalizedHeight=typeof height==='number' ? height+'px' :height;return normalizedHeight ? normalizedHeight :'';};var createIframeElement=function(id,title,height,customAttrs){var iframe=Element.fromTag('iframe');Attr.setAll(iframe,customAttrs);Attr.setAll(iframe,{id:id+'_ifr',frameBorder:'0',allowTransparency:'true',title:title});Css.setAll(iframe,{width:'100%',height:normalizeHeight(height),display:'block'});return iframe;};var getIframeHtml=function(editor){var bodyId,bodyClass,iframeHTML;iframeHTML=Settings.getDocType(editor)+'<html><head>';if(Settings.getDocumentBaseUrl(editor)!==editor.documentBaseUrl){iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />';}iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';bodyId=Settings.getBodyId(editor);bodyClass=Settings.getBodyClass(editor);if(Settings.getContentSecurityPolicy(editor)){iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+Settings.getContentSecurityPolicy(editor)+'" />';}iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'"><br></body></html>';return iframeHTML;};var createIframe=function(editor,o){var title=editor.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. "+"Press ALT-F10 for toolbar. Press ALT-0 for help");var ifr=createIframeElement(editor.id,title,o.height,Settings.getIframeAttrs(editor)).dom();ifr.onload=function(){ifr.onload=null;editor.fire("load");};var isDomainRelaxed=relaxDomain(editor,ifr);editor.contentAreaContainer=o.iframeContainer;editor.iframeElement=ifr;editor.iframeHTML=getIframeHtml(editor);DOM.add(o.iframeContainer,ifr);return isDomainRelaxed;};var init=function(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);if(boxInfo.editorContainer){DOM.get(boxInfo.editorContainer).style.display=editor.orgDisplay;editor.hidden=DOM.isHidden(boxInfo.editorContainer);}editor.getElement().style.display='none';DOM.setAttrib(editor.id,'aria-hidden',true);if(!isDomainRelaxed){InitContentBody.initContentBody(editor);}};return{init:init};});define('tinymce.core.init.Init',['ephox.katamari.api.Type','global!document','global!window','tinymce.core.PluginManager','tinymce.core.ThemeManager','tinymce.core.dom.DOMUtils','tinymce.core.init.InitContentBody','tinymce.core.init.InitIframe','tinymce.core.util.Tools'],function(Type,document,window,PluginManager,ThemeManager,DOMUtils,InitContentBody,InitIframe,Tools){var DOM=DOMUtils.DOM;var initPlugin=function(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin),pluginUrl,pluginInstance;pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,'');plugin=Tools.trim(plugin);if(Plugin && Tools.inArray(initializedPlugins,plugin)===-1){Tools.each(PluginManager.dependencies(plugin),function(dep){initPlugin(editor,initializedPlugins,dep);});if(editor.plugins[plugin]){return;}pluginInstance=new Plugin(editor,pluginUrl,editor.$);editor.plugins[plugin]=pluginInstance;if(pluginInstance.init){pluginInstance.init(editor,pluginUrl);initializedPlugins.push(plugin);}}};var trimLegacyPrefix=function(name){return name.replace(/^\-/,'');};var initPlugins=function(editor){var initializedPlugins=[];Tools.each(editor.settings.plugins.split(/[ ,]/),function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name));});};var initTheme=function(editor){var Theme,theme=editor.settings.theme;if(Type.isString(theme)){editor.settings.theme=trimLegacyPrefix(theme);Theme=ThemeManager.get(theme);editor.theme=new Theme(editor,ThemeManager.urls[theme]);if(editor.theme.init){editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,''),editor.$);}}else{editor.theme={};}};var renderFromLoadedTheme=function(editor){var w,h,minHeight,re,info,settings=editor.settings,elm=editor.getElement();w=settings.width||DOM.getStyle(elm,'width')||'100%';h=settings.height||DOM.getStyle(elm,'height')||elm.offsetHeight;minHeight=settings.min_height||100;re=/^[0-9\.]+(|px)$/i;if(re.test(''+w)){w=Math.max(parseInt(w,10),100);}if(re.test(''+h)){h=Math.max(parseInt(h,10),minHeight);}info=editor.theme.renderUI({targetNode:elm,width:w,height:h,deltaWidth:settings.delta_width,deltaHeight:settings.delta_height});if(!settings.content_editable){h=(info.iframeHeight||h)+(typeof h==='number' ?(info.deltaHeight||0):'');if(h<minHeight){h=minHeight;}}info.height=h;return info;};var renderFromThemeFunc=function(editor){var info,elm=editor.getElement();info=editor.settings.theme(editor,elm);if(info.editorContainer.nodeType){info.editorContainer.id=info.editorContainer.id||editor.id+"_parent";}if(info.iframeContainer && info.iframeContainer.nodeType){info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer";}info.height=info.iframeHeight ? info.iframeHeight :elm.offsetHeight;return info;};var createThemeFalseResult=function(element){return{editorContainer:element,iframeContainer:element};};var renderThemeFalseIframe=function(targetElement){var iframeContainer=DOM.create('div');DOM.insertAfter(iframeContainer,targetElement);return createThemeFalseResult(iframeContainer);};var renderThemeFalse=function(editor){var targetElement=editor.getElement();return editor.inline ? createThemeFalseResult(null):renderThemeFalseIframe(targetElement);};var renderThemeUi=function(editor){var settings=editor.settings,elm=editor.getElement();editor.orgDisplay=elm.style.display;if(Type.isString(settings.theme)){return renderFromLoadedTheme(editor);}else if(Type.isFunction(settings.theme)){return renderFromThemeFunc(editor);}else{return renderThemeFalse(editor);}};var init=function(editor){var settings=editor.settings,elm=editor.getElement(),boxInfo;editor.rtl=settings.rtl_ui||editor.editorManager.i18n.rtl;editor.editorManager.i18n.setCode(settings.language);settings.aria_label=settings.aria_label||DOM.getAttrib(elm,'aria-label',editor.getLang('aria.rich_text_area'));editor.fire('ScriptsLoaded');initTheme(editor);initPlugins(editor);boxInfo=renderThemeUi(editor);editor.editorContainer=boxInfo.editorContainer ? boxInfo.editorContainer :null;if(settings.content_css){Tools.each(Tools.explode(settings.content_css),function(u){editor.contentCSS.push(editor.documentBaseURI.toAbsolute(u));});}if(settings.content_editable){return InitContentBody.initContentBody(editor);}else{return InitIframe.init(editor,boxInfo);}};return{init:init};});define('tinymce.core.init.Render',['ephox.katamari.api.Type','global!window','tinymce.core.api.NotificationManager','tinymce.core.api.WindowManager','tinymce.core.dom.DOMUtils','tinymce.core.dom.EventUtils','tinymce.core.dom.ScriptLoader','tinymce.core.Env','tinymce.core.ErrorReporter','tinymce.core.init.Init','tinymce.core.PluginManager','tinymce.core.ThemeManager','tinymce.core.util.Tools'],function(Type,window,NotificationManager,WindowManager,DOMUtils,EventUtils,ScriptLoader,Env,ErrorReporter,Init,PluginManager,ThemeManager,Tools){var DOM=DOMUtils.DOM;var hasSkipLoadPrefix=function(name){return name.charAt(0)==='-';};var loadLanguage=function(scriptLoader,editor){var settings=editor.settings;if(settings.language && settings.language !=='en' && !settings.language_url){settings.language_url=editor.editorManager.baseURL+'/langs/'+settings.language+'.js';}if(settings.language_url && !editor.editorManager.i18n.data[settings.language]){scriptLoader.add(settings.language_url);}};var loadTheme=function(scriptLoader,editor,suffix,callback){var settings=editor.settings,theme=settings.theme;if(Type.isString(theme)){if(!hasSkipLoadPrefix(theme)&& !ThemeManager.urls.hasOwnProperty(theme)){var themeUrl=settings.theme_url;if(themeUrl){ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl));}else{ThemeManager.load(theme,'themes/'+theme+'/theme'+suffix+'.js');}}scriptLoader.loadQueue(function(){ThemeManager.waitFor(theme,callback);});}else{callback();}};var loadPlugins=function(settings,suffix){if(Tools.isArray(settings.plugins)){settings.plugins=settings.plugins.join(' ');}Tools.each(settings.external_plugins,function(url,name){PluginManager.load(name,url);settings.plugins+=' '+name;});Tools.each(settings.plugins.split(/[ ,]/),function(plugin){plugin=Tools.trim(plugin);if(plugin && !PluginManager.urls[plugin]){if(hasSkipLoadPrefix(plugin)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,function(dep){var defaultSettings={prefix:'plugins/',resource:dep,suffix:'/plugin'+suffix+'.js'};dep=PluginManager.createUrl(defaultSettings,dep);PluginManager.load(dep.resource,dep);});}else{PluginManager.load(plugin,{prefix:'plugins/',resource:plugin,suffix:'/plugin'+suffix+'.js'});}}});};var loadScripts=function(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;loadTheme(scriptLoader,editor,suffix,function(){loadLanguage(scriptLoader,editor);loadPlugins(editor.settings,suffix);scriptLoader.loadQueue(function(){if(!editor.removed){Init.init(editor);}},editor,function(urls){ErrorReporter.pluginLoadError(editor,urls[0]);if(!editor.removed){Init.init(editor);}});});};var render=function(editor){var settings=editor.settings,id=editor.id;var readyHandler=function(){DOM.unbind(window,'ready',readyHandler);editor.render();};if(!EventUtils.Event.domLoaded){DOM.bind(window,'ready',readyHandler);return;}if(!editor.getElement()){return;}if(!Env.contentEditable){return;}if(!settings.inline){editor.orgVisibility=editor.getElement().style.visibility;editor.getElement().style.visibility='hidden';}else{editor.inline=true;}var form=editor.getElement().form||DOM.getParent(id,'form');if(form){editor.formElement=form;if(settings.hidden_input && !/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)){DOM.insertAfter(DOM.create('input',{type:'hidden',name:id}),id);editor.hasHiddenInput=true;}editor.formEventDelegate=function(e){editor.fire(e.type,e);};DOM.bind(form,'submit reset',editor.formEventDelegate);editor.on('reset',function(){editor.setContent(editor.startContent,{format:'raw'});});if(settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit){form._mceOldSubmit=form.submit;form.submit=function(){editor.editorManager.triggerSave();editor.setDirty(false);return form._mceOldSubmit(form);};}}editor.windowManager=new WindowManager(editor);editor.notificationManager=new NotificationManager(editor);if(settings.encoding==='xml'){editor.on('GetContent',function(e){if(e.save){e.content=DOM.encode(e.content);}});}if(settings.add_form_submit_trigger){editor.on('submit',function(){if(editor.initialized){editor.save();}});}if(settings.add_unload_trigger){editor._beforeUnload=function(){if(editor.initialized && !editor.destroyed && !editor.isHidden()){editor.save({format:'raw',no_events:true,set_dirty:false});}};editor.editorManager.on('BeforeUnload',editor._beforeUnload);}editor.editorManager.add(editor);loadScripts(editor,editor.suffix);};return{render:render};});define('tinymce.core.ui.Sidebar',[],function(){var add=function(editor,name,settings){var sidebars=editor.sidebars ? editor.sidebars :[];sidebars.push({name:name,settings:settings});editor.sidebars=sidebars;};return{add:add};});define('tinymce.core.util.URI',['global!document','tinymce.core.util.Tools'],function(document,Tools){var each=Tools.each,trim=Tools.trim;var queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(' ');var DEFAULT_PORTS={'ftp':21,'http':80,'https':443,'mailto':25};var URI=function(url,settings){var self=this,baseUri,baseUrl;url=trim(url);settings=self.settings=settings||{};baseUri=settings.base_uri;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url)){self.source=url;return;}var isProtocolRelative=url.indexOf('//')===0;if(url.indexOf('/')===0 && !isProtocolRelative){url=(baseUri ? baseUri.protocol||'http' :'http')+'://mce_host'+url;}if(!/^[\w\-]*:?\/\//.test(url)){baseUrl=settings.base_uri ? settings.base_uri.path :new URI(document.location.href).directory;if(settings.base_uri.protocol===""){url='//mce_host'+self.toAbsPath(baseUrl,url);}else{url=/([^#?]*)([#?]?.*)/.exec(url);url=((baseUri && baseUri.protocol)||'http')+'://mce_host'+self.toAbsPath(baseUrl,url[1])+url[2];}}url=url.replace(/@@/g,'(mce_at)');url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each(queryParts,function(v,i){var part=url[i];if(part){part=part.replace(/\(mce_at\)/g,'@@');}self[v]=part;});if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol;}if(!self.userInfo){self.userInfo=baseUri.userInfo;}if(!self.port && self.host==='mce_host'){self.port=baseUri.port;}if(!self.host||self.host==='mce_host'){self.host=baseUri.host;}self.source='';}if(isProtocolRelative){self.protocol='';}};URI.prototype={setPath:function(path){var self=this;path=/^(.*?)\/?(\w+)?$/.exec(path);self.path=path[0];self.directory=path[1];self.file=path[2];self.source='';self.getURI();},toRelative:function(uri){var self=this,output;if(uri==="./"){return uri;}uri=new URI(uri,{base_uri:self});if((uri.host !='mce_host' && self.host !=uri.host && uri.host)||self.port !=uri.port||(self.protocol !=uri.protocol && uri.protocol !=="")){return uri.getURI();}var tu=self.getURI(),uu=uri.getURI();if(tu==uu||(tu.charAt(tu.length-1)=="/" && tu.substr(0,tu.length-1)==uu)){return tu;}output=self.toRelPath(self.path,uri.path);if(uri.query){output+='?'+uri.query;}if(uri.anchor){output+='#'+uri.anchor;}return output;},toAbsolute:function(uri,noHost){uri=new URI(uri,{base_uri:this});return uri.getURI(noHost && this.isSameOrigin(uri));},isSameOrigin:function(uri){if(this.host==uri.host && this.protocol==uri.protocol){if(this.port==uri.port){return true;}var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort &&((this.port||defaultPort)==(uri.port||defaultPort))){return true;}}return false;},toRelPath:function(base,path){var items,breakPoint=0,out='',i,l;base=base.substring(0,base.lastIndexOf('/'));base=base.split('/');items=path.split('/');if(base.length>=items.length){for(i=0,l=base.length;i<l;i++){if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break;}}}if(base.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break;}}}if(breakPoint===1){return path;}for(i=0,l=base.length-(breakPoint-1);i<l;i++){out+="../";}for(i=breakPoint-1,l=items.length;i<l;i++){if(i !=breakPoint-1){out+="/"+items[i];}else{out+=items[i];}}return out;},toAbsPath:function(base,path){var i,nb=0,o=[],tr,outPath;tr=/\/$/.test(path)? '/' :'';base=base.split('/');path=path.split('/');each(base,function(k){if(k){o.push(k);}});base=o;for(i=path.length-1,o=[];i>=0;i--){if(path[i].length===0||path[i]==="."){continue;}if(path[i]==='..'){nb++;continue;}if(nb>0){nb--;continue;}o.push(path[i]);}i=base.length-nb;if(i<=0){outPath=o.reverse().join('/');}else{outPath=base.slice(0,i).join('/')+'/'+o.reverse().join('/');}if(outPath.indexOf('/')!==0){outPath='/'+outPath;}if(tr && outPath.lastIndexOf('/')!==outPath.length-1){outPath+=tr;}return outPath;},getURI:function(noProtoHost){var s,self=this;if(!self.source||noProtoHost){s='';if(!noProtoHost){if(self.protocol){s+=self.protocol+'://';}else{s+='//';}if(self.userInfo){s+=self.userInfo+'@';}if(self.host){s+=self.host;}if(self.port){s+=':'+self.port;}}if(self.path){s+=self.path;}if(self.query){s+='?'+self.query;}if(self.anchor){s+='#'+self.anchor;}self.source=s;}return self.source;}};URI.parseDataUri=function(uri){var type,matches;uri=decodeURIComponent(uri).split(',');matches=/data:([^;]+)/.exec(uri[0]);if(matches){type=matches[1];}return{type:type,data:uri[1]};};URI.getDocumentBaseUrl=function(loc){var baseUrl;if(loc.protocol.indexOf('http')!==0 && loc.protocol !=='file:'){baseUrl=loc.href;}else{baseUrl=loc.protocol+'//'+loc.host+loc.pathname;}if(/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)){baseUrl=baseUrl.replace(/[\?#].*$/,'').replace(/[\/\\][^\/]+$/,'');if(!/[\/\\]$/.test(baseUrl)){baseUrl+='/';}}return baseUrl;};return URI;});define('tinymce.core.Editor',['tinymce.core.AddOnManager','tinymce.core.EditorCommands','tinymce.core.EditorObservable','tinymce.core.EditorSettings','tinymce.core.Env','tinymce.core.Mode','tinymce.core.Shortcuts','tinymce.core.dom.DOMUtils','tinymce.core.dom.DomQuery','tinymce.core.dom.TrimHtml','tinymce.core.focus.EditorFocus','tinymce.core.html.Serializer','tinymce.core.init.Render','tinymce.core.ui.Sidebar','tinymce.core.util.Tools','tinymce.core.util.URI','tinymce.core.util.Uuid'],function(AddOnManager,EditorCommands,EditorObservable,EditorSettings,Env,Mode,Shortcuts,DOMUtils,DomQuery,TrimHtml,EditorFocus,Serializer,Render,Sidebar,Tools,URI,Uuid){var DOM=DOMUtils.DOM;var extend=Tools.extend,each=Tools.each;var trim=Tools.trim,resolve=Tools.resolve;var ie=Env.ie;var Editor=function(id,settings,editorManager){var self=this,documentBaseUrl,baseUri;documentBaseUrl=self.documentBaseUrl=editorManager.documentBaseURL;baseUri=editorManager.baseURI;settings=EditorSettings.getEditorSettings(self,id,documentBaseUrl,editorManager.defaultSettings,settings);self.settings=settings;AddOnManager.language=settings.language||'en';AddOnManager.languageLoad=settings.language_load;AddOnManager.baseURL=editorManager.baseURL;self.id=id;self.setDirty(false);self.plugins={};self.documentBaseURI=new URI(settings.document_base_url,{base_uri:baseUri});self.baseURI=baseUri;self.contentCSS=[];self.contentStyles=[];self.shortcuts=new Shortcuts(self);self.loadedCSS={};self.editorCommands=new EditorCommands(self);self.suffix=editorManager.suffix;self.editorManager=editorManager;self.inline=settings.inline;self.buttons={};self.menuItems={};if(settings.cache_suffix){Env.cacheSuffix=settings.cache_suffix.replace(/^[\?\&]+/,'');}if(settings.override_viewport===false){Env.overrideViewPort=false;}editorManager.fire('SetupEditor',self);self.execCallback('setup',self);self.$=DomQuery.overrideDefaults(function(){return{context:self.inline ? self.getBody():self.getDoc(),element:self.getBody()};});};Editor.prototype={render:function(){Render.render(this);},focus:function(skipFocus){EditorFocus.focus(this,skipFocus);},execCallback:function(name){var self=this,callback=self.settings[name],scope;if(!callback){return;}if(self.callbackLookup &&(scope=self.callbackLookup[name])){callback=scope.func;scope=scope.scope;}if(typeof callback==='string'){scope=callback.replace(/\.\w+$/,'');scope=scope ? resolve(scope):0;callback=resolve(callback);self.callbackLookup=self.callbackLookup||{};self.callbackLookup[name]={func:callback,scope:scope};}return callback.apply(scope||self,Array.prototype.slice.call(arguments,1));},translate:function(text){if(text && Tools.is(text,'string')){var lang=this.settings.language||'en',i18n=this.editorManager.i18n;text=i18n.data[lang+'.'+text]||text.replace(/\{\#([^\}]+)\}/g,function(a,b){return i18n.data[lang+'.'+b]||'{#'+b+'}';});}return this.editorManager.translate(text);},getLang:function(name,defaultVal){return(this.editorManager.i18n.data[(this.settings.language||'en')+'.'+name]||(defaultVal !==undefined ? defaultVal :'{#'+name+'}'));},getParam:function(name,defaultVal,type){var value=name in this.settings ? this.settings[name]:defaultVal,output;if(type==='hash'){output={};if(typeof value==='string'){each(value.indexOf('=')>0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(','),function(value){value=value.split('=');if(value.length>1){output[trim(value[0])]=trim(value[1]);}else{output[trim(value[0])]=trim(value);}});}else{output=value;}return output;}return value;},nodeChanged:function(args){this._nodeChangeDispatcher.nodeChanged(args);},addButton:function(name,settings){var self=this;if(settings.cmd){settings.onclick=function(){self.execCommand(settings.cmd);};}if(settings.stateSelector && typeof settings.active==='undefined'){settings.active=false;}if(!settings.text && !settings.icon){settings.icon=name;}self.buttons=self.buttons;settings.tooltip=settings.tooltip||settings.title;self.buttons[name]=settings;},addSidebar:function(name,settings){return Sidebar.add(this,name,settings);},addMenuItem:function(name,settings){var self=this;if(settings.cmd){settings.onclick=function(){self.execCommand(settings.cmd);};}self.menuItems=self.menuItems;self.menuItems[name]=settings;},addContextToolbar:function(predicate,items){var self=this,selector;self.contextToolbars=self.contextToolbars||[];if(typeof predicate=="string"){selector=predicate;predicate=function(elm){return self.dom.is(elm,selector);};}self.contextToolbars.push({id:Uuid.uuid('mcet'),predicate:predicate,items:items});},addCommand:function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope);},addQueryStateHandler:function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope);},addQueryValueHandler:function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope);},addShortcut:function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope);},execCommand:function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args);},queryCommandState:function(cmd){return this.editorCommands.queryCommandState(cmd);},queryCommandValue:function(cmd){return this.editorCommands.queryCommandValue(cmd);},queryCommandSupported:function(cmd){return this.editorCommands.queryCommandSupported(cmd);},show:function(){var self=this;if(self.hidden){self.hidden=false;if(self.inline){self.getBody().contentEditable=true;}else{DOM.show(self.getContainer());DOM.hide(self.id);}self.load();self.fire('show');}},hide:function(){var self=this,doc=self.getDoc();if(!self.hidden){if(ie && doc && !self.inline){doc.execCommand('SelectAll');}self.save();if(self.inline){self.getBody().contentEditable=false;if(self==self.editorManager.focusedEditor){self.editorManager.focusedEditor=null;}}else{DOM.hide(self.getContainer());DOM.setStyle(self.id,'display',self.orgDisplay);}self.hidden=true;self.fire('hide');}},isHidden:function(){return !!this.hidden;},setProgressState:function(state,time){this.fire('ProgressState',{state:state,time:time});},load:function(args){var self=this,elm=self.getElement(),html;if(self.removed){return '';}if(elm){args=args||{};args.load=true;html=self.setContent(elm.value !==undefined ? elm.value :elm.innerHTML,args);args.element=elm;if(!args.no_events){self.fire('LoadContent',args);}args.element=elm=null;return html;}},save:function(args){var self=this,elm=self.getElement(),html,form;if(!elm||!self.initialized||self.removed){return;}args=args||{};args.save=true;args.element=elm;html=args.content=self.getContent(args);if(!args.no_events){self.fire('SaveContent',args);}if(args.format=='raw'){self.fire('RawSaveContent',args);}html=args.content;if(!/TEXTAREA|INPUT/i.test(elm.nodeName)){if(!self.inline){elm.innerHTML=html;}if((form=DOM.getParent(self.id,'form'))){each(form.elements,function(elm){if(elm.name==self.id){elm.value=html;return false;}});}}else{elm.value=html;}args.element=elm=null;if(args.set_dirty !==false){self.setDirty(false);}return html;},setContent:function(content,args){var self=this,body=self.getBody(),forcedRootBlockName,padd;args=args||{};args.format=args.format||'html';args.set=true;args.content=content;if(!args.no_events){self.fire('BeforeSetContent',args);}content=args.content;if(content.length===0||/^\s+$/.test(content)){padd=ie && ie<11 ? '' :'<br data-mce-bogus="1">';if(body.nodeName=='TABLE'){content='<tr><td>'+padd+'</td></tr>';}else if(/^(UL|OL)$/.test(body.nodeName)){content='<li>'+padd+'</li>';}forcedRootBlockName=self.settings.forced_root_block;if(forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())){content=padd;content=self.dom.createHTML(forcedRootBlockName,self.settings.forced_root_block_attrs,content);}else if(!ie && !content){content='<br data-mce-bogus="1">';}self.dom.setHTML(body,content);self.fire('SetContent',args);}else{if(args.format !=='raw'){content=new Serializer({validate:self.validate},self.schema).serialize(self.parser.parse(content,{isRootContent:true,insert:true}));}args.content=trim(content);self.dom.setHTML(body,args.content);if(!args.no_events){self.fire('SetContent',args);}}return args.content;},getContent:function(args){var self=this,content,body=self.getBody();if(self.removed){return '';}args=args||{};args.format=args.format||'html';args.get=true;args.getInner=true;if(!args.no_events){self.fire('BeforeGetContent',args);}if(args.format==='raw'){content=Tools.trim(TrimHtml.trimExternal(self.serializer,body.innerHTML));}else if(args.format==='text'){content=body.innerText||body.textContent;}else if(args.format==='tree'){return self.serializer.serialize(body,args);}else{content=self.serializer.serialize(body,args);}if(args.format !=='text'){args.content=trim(content);}else{args.content=content;}if(!args.no_events){self.fire('GetContent',args);}return args.content;},insertContent:function(content,args){if(args){content=extend({content:content},args);}this.execCommand('mceInsertContent',false,content);},isDirty:function(){return !this.isNotDirty;},setDirty:function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state;if(state && state !=oldState){this.fire('dirty');}},setMode:function(mode){Mode.setMode(this,mode);},getContainer:function(){var self=this;if(!self.container){self.container=DOM.get(self.editorContainer||self.id+'_parent');}return self.container;},getContentAreaContainer:function(){return this.contentAreaContainer;},getElement:function(){if(!this.targetElm){this.targetElm=DOM.get(this.id);}return this.targetElm;},getWin:function(){var self=this,elm;if(!self.contentWindow){elm=self.iframeElement;if(elm){self.contentWindow=elm.contentWindow;}}return self.contentWindow;},getDoc:function(){var self=this,win;if(!self.contentDocument){win=self.getWin();if(win){self.contentDocument=win.document;}}return self.contentDocument;},getBody:function(){var doc=this.getDoc();return this.bodyElement||(doc ? doc.body :null);},convertURL:function(url,name,elm){var self=this,settings=self.settings;if(settings.urlconverter_callback){return self.execCallback('urlconverter_callback',url,elm,true,name);}if(!settings.convert_urls||(elm && elm.nodeName=='LINK')||url.indexOf('file:')===0||url.length===0){return url;}if(settings.relative_urls){return self.documentBaseURI.toRelative(url);}url=self.documentBaseURI.toAbsolute(url,settings.remove_script_host);return url;},addVisual:function(elm){var self=this,settings=self.settings,dom=self.dom,cls;elm=elm||self.getBody();if(self.hasVisual===undefined){self.hasVisual=settings.visual;}each(dom.select('table,a',elm),function(elm){var value;switch(elm.nodeName){case 'TABLE':cls=settings.visual_table_class||'mce-item-table';value=dom.getAttrib(elm,'border');if((!value||value=='0')&& self.hasVisual){dom.addClass(elm,cls);}else{dom.removeClass(elm,cls);}return;case 'A':if(!dom.getAttrib(elm,'href',false)){value=dom.getAttrib(elm,'name')||elm.id;cls=settings.visual_anchor_class||'mce-item-anchor';if(value && self.hasVisual){dom.addClass(elm,cls);}else{dom.removeClass(elm,cls);}}return;}});self.fire('VisualAid',{element:elm,hasVisual:self.hasVisual});},remove:function(){var self=this;if(!self.removed){self.save();self.removed=1;self.unbindAllNativeEvents();if(self.hasHiddenInput){DOM.remove(self.getElement().nextSibling);}if(!self.inline){if(ie && ie<10){self.getDoc().execCommand('SelectAll',false,null);}DOM.setStyle(self.id,'display',self.orgDisplay);self.getBody().onload=null;}self.fire('remove');self.editorManager.remove(self);DOM.remove(self.getContainer());self._selectionOverrides.destroy();self.editorUpload.destroy();self.destroy();}},destroy:function(automatic){var self=this,form;if(self.destroyed){return;}if(!automatic && !self.removed){self.remove();return;}if(!automatic){self.editorManager.off('beforeunload',self._beforeUnload);if(self.theme && self.theme.destroy){self.theme.destroy();}self.selection.destroy();self.dom.destroy();}form=self.formElement;if(form){if(form._mceOldSubmit){form.submit=form._mceOldSubmit;form._mceOldSubmit=null;}DOM.unbind(form,'submit reset',self.formEventDelegate);}self.contentAreaContainer=self.formElement=self.container=self.editorContainer=null;self.bodyElement=self.contentDocument=self.contentWindow=null;self.iframeElement=self.targetElm=null;if(self.selection){self.selection=self.selection.win=self.selection.dom=self.selection.dom.doc=null;}self.destroyed=1;},uploadImages:function(callback){return this.editorUpload.uploadImages(callback);},_scanForImages:function(){return this.editorUpload.scanForImages();}};extend(Editor.prototype,EditorObservable);return Editor;});define('tinymce.core.api.FocusManager',['global!document'],function(document){var isEditorUIElement=function(elm){return elm.className.toString().indexOf('mce-')!==-1;};return{isEditorUIElement:isEditorUIElement};});define('tinymce.core.selection.SelectionRestore',['ephox.katamari.api.Throttler','ephox.sand.api.PlatformDetection','global!document','tinymce.core.dom.DOMUtils','tinymce.core.selection.SelectionBookmark'],function(Throttler,PlatformDetection,document,DOMUtils,SelectionBookmark){var isManualNodeChange=function(e){return e.type==='nodechange' && e.selectionChange;};var registerPageMouseUp=function(editor,throttledStore){var mouseUpPage=function(){throttledStore.throttle();};DOMUtils.DOM.bind(document,'mouseup',mouseUpPage);editor.on('remove',function(){DOMUtils.DOM.unbind(document,'mouseup',mouseUpPage);});};var registerFocusOut=function(editor){editor.on('focusout',function(){SelectionBookmark.store(editor);});};var registerMouseUp=function(editor,throttledStore){editor.on('mouseup touchend',function(e){throttledStore.throttle();});};var registerEditorEvents=function(editor,throttledStore){var browser=PlatformDetection.detect().browser;if(browser.isIE()||browser.isEdge()){registerFocusOut(editor);}else{registerMouseUp(editor,throttledStore);}editor.on('keyup nodechange',function(e){if(!isManualNodeChange(e)){SelectionBookmark.store(editor);}});};var register=function(editor){var throttledStore=Throttler.first(function(){SelectionBookmark.store(editor);},0);if(editor.inline){registerPageMouseUp(editor,throttledStore);}editor.on('init',function(){registerEditorEvents(editor,throttledStore);});editor.on('remove',function(){throttledStore.cancel();});};return{register:register};});define('tinymce.core.focus.FocusController',['ephox.katamari.api.Fun','global!document','tinymce.core.api.FocusManager','tinymce.core.dom.DOMUtils','tinymce.core.selection.SelectionRestore','tinymce.core.util.Delay'],function(Fun,document,FocusManager,DOMUtils,SelectionRestore,Delay){var documentFocusInHandler,DOM=DOMUtils.DOM;var isEditorUIElement=function(elm){return FocusManager.isEditorUIElement(elm);};var isUIElement=function(editor,elm){var customSelector=editor ? editor.settings.custom_ui_selector :'';var parent=DOM.getParent(elm,function(elm){return(isEditorUIElement(elm)||(customSelector ? editor.dom.is(elm,customSelector):false));});return parent !==null;};var getActiveElement=function(){try{return document.activeElement;}catch(ex){return document.body;}};var registerEvents=function(editorManager,e){var editor=e.editor;SelectionRestore.register(editor);editor.on('focusin',function(){var focusedEditor=editorManager.focusedEditor;if(focusedEditor !=editor){if(focusedEditor){focusedEditor.fire('blur',{focusedEditor:editor});}editorManager.setActive(editor);editorManager.focusedEditor=editor;editor.fire('focus',{blurredEditor:focusedEditor});editor.focus(true);}});editor.on('focusout',function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;if(!isUIElement(editor,getActiveElement())&& focusedEditor==editor){editor.fire('blur',{focusedEditor:null});editorManager.focusedEditor=null;}});});if(!documentFocusInHandler){documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor,target;target=e.target;if(activeEditor && target.ownerDocument===document){if(target !==document.body && !isUIElement(activeEditor,target)&& editorManager.focusedEditor===activeEditor){activeEditor.fire('blur',{focusedEditor:null});editorManager.focusedEditor=null;}}};DOM.bind(document,'focusin',documentFocusInHandler);}};var unregisterDocumentEvents=function(editorManager,e){if(editorManager.focusedEditor==e.editor){editorManager.focusedEditor=null;}if(!editorManager.activeEditor){DOM.unbind(document,'focusin',documentFocusInHandler);documentFocusInHandler=null;}};var setup=function(editorManager){editorManager.on('AddEditor',Fun.curry(registerEvents,editorManager));editorManager.on('RemoveEditor',Fun.curry(unregisterDocumentEvents,editorManager));};return{setup:setup,isEditorUIElement:isEditorUIElement,isUIElement:isUIElement};});define('tinymce.core.util.I18n',["tinymce.core.util.Tools"],function(Tools){"use strict";var data={},code="en";return{setCode:function(newCode){if(newCode){code=newCode;this.rtl=this.data[newCode]? this.data[newCode]._dir==='rtl' :false;}},getCode:function(){return code;},rtl:false,add:function(code,items){var langData=data[code];if(!langData){data[code]=langData={};}for(var name in items){langData[name]=items[name];}this.setCode(code);},translate:function(text){var langData=data[code]||{};var toString=function(obj){if(Tools.is(obj,'function')){return Object.prototype.toString.call(obj);}return !isEmpty(obj)? ''+obj :'';};var isEmpty=function(text){return text===''||text===null||Tools.is(text,'undefined');};var getLangData=function(text){text=toString(text);return Tools.hasOwn(langData,text)? toString(langData[text]):text;};if(isEmpty(text)){return '';}if(Tools.is(text,'object')&& Tools.hasOwn(text,'raw')){return toString(text.raw);}if(Tools.is(text,'array')){var values=text.slice(1);text=getLangData(text[0]).replace(/\{([0-9]+)\}/g,function($1,$2){return Tools.hasOwn(values,$2)? toString(values[$2]):$1;});}return getLangData(text).replace(/{context:\w+}$/,'');},data:data};});define('tinymce.core.EditorManager',['ephox.katamari.api.Arr','ephox.katamari.api.Type','global!document','global!window','tinymce.core.AddOnManager','tinymce.core.Editor','tinymce.core.Env','tinymce.core.ErrorReporter','tinymce.core.dom.DOMUtils','tinymce.core.dom.DomQuery','tinymce.core.focus.FocusController','tinymce.core.util.I18n','tinymce.core.util.Observable','tinymce.core.util.Promise','tinymce.core.util.Tools','tinymce.core.util.URI'],function(Arr,Type,document,window,AddOnManager,Editor,Env,ErrorReporter,DOMUtils,DomQuery,FocusController,I18n,Observable,Promise,Tools,URI){var DOM=DOMUtils.DOM;var explode=Tools.explode,each=Tools.each,extend=Tools.extend;var instanceCounter=0,beforeUnloadDelegate,EditorManager,boundGlobalEvents=false;var legacyEditors=[],editors=[];var isValidLegacyKey=function(id){return id !=='length';};var globalEventDelegate=function(e){each(EditorManager.get(),function(editor){if(e.type==='scroll'){editor.fire('ScrollWindow',e);}else{editor.fire('ResizeWindow',e);}});};var toggleGlobalEvents=function(state){if(state !==boundGlobalEvents){if(state){DomQuery(window).on('resize scroll',globalEventDelegate);}else{DomQuery(window).off('resize scroll',globalEventDelegate);}boundGlobalEvents=state;}};var removeEditorFromList=function(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++){if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break;}}editors=Arr.filter(editors,function(editor){return targetEditor !==editor;});if(EditorManager.activeEditor===targetEditor){EditorManager.activeEditor=editors.length>0 ? editors[0]:null;}if(EditorManager.focusedEditor===targetEditor){EditorManager.focusedEditor=null;}return oldEditors.length !==editors.length;};var purgeDestroyedEditor=function(editor){if(editor && editor.initialized && !(editor.getContainer()||editor.getBody()).parentNode){removeEditorFromList(editor);editor.unbindAllNativeEvents();editor.destroy(true);editor.removed=true;editor=null;}return editor;};EditorManager={defaultSettings:{},$:DomQuery,majorVersion:'4',minorVersion:'7.4',releaseDate:'2017-12-05',editors:legacyEditors,i18n:I18n,activeEditor:null,settings:{},setup:function(){var self=this,baseURL,documentBaseURL,suffix="",preInit,src;documentBaseURL=URI.getDocumentBaseUrl(document.location);if(/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)){documentBaseURL=documentBaseURL.replace(/[\?#].*$/,'').replace(/[\/\\][^\/]+$/,'');if(!/[\/\\]$/.test(documentBaseURL)){documentBaseURL+='/';}}preInit=window.tinymce||window.tinyMCEPreInit;if(preInit){baseURL=preInit.base||preInit.baseURL;suffix=preInit.suffix;}else{var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){src=scripts[i].src;var srcScript=src.substring(src.lastIndexOf('/'));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){if(srcScript.indexOf('.min')!=-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));break;}}if(!baseURL && document.currentScript){src=document.currentScript.src;if(src.indexOf('.min')!=-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));}}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL);self.documentBaseURL=documentBaseURL;self.baseURI=new URI(self.baseURL);self.suffix=suffix;FocusController.setup(self);},overrideDefaults:function(defaultSettings){var baseUrl,suffix;baseUrl=defaultSettings.base_url;if(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,''));this.baseURI=new URI(this.baseURL);}suffix=defaultSettings.suffix;if(defaultSettings.suffix){this.suffix=suffix;}this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;for(var name in pluginBaseUrls){AddOnManager.PluginManager.urls[name]=pluginBaseUrls[name];}},init:function(settings){var self=this,result,invalidInlineTargets;invalidInlineTargets=Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track '+'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu',' ');var isInvalidInlineTarget=function(settings,elm){return settings.inline && elm.tagName.toLowerCase()in invalidInlineTargets;};var createId=function(elm){var id=elm.id;if(!id){id=elm.name;if(id && !DOM.get(id)){id=elm.name;}else{id=DOM.uniqueId();}elm.setAttribute('id',id);}return id;};var execCallback=function(name){var callback=settings[name];if(!callback){return;}return callback.apply(self,Array.prototype.slice.call(arguments,2));};var hasClass=function(elm,className){return className.constructor===RegExp ? className.test(elm.className):DOM.hasClass(elm,className);};var findTargets=function(settings){var l,targets=[];if(Env.ie && Env.ie<11){ErrorReporter.initError('TinyMCE does not support the browser you are using. For a list of supported'+' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');return[];}if(settings.types){each(settings.types,function(type){targets=targets.concat(DOM.select(type.selector));});return targets;}else if(settings.selector){return DOM.select(settings.selector);}else if(settings.target){return[settings.target];}switch(settings.mode){case "exact":l=settings.elements||'';if(l.length>0){each(explode(l),function(id){var elm;if((elm=DOM.get(id))){targets.push(elm);}else{each(document.forms,function(f){each(f.elements,function(e){if(e.name===id){id='mce_editor_'+instanceCounter++;DOM.setAttrib(e,'id',id);targets.push(e);}});});}});}break;case "textareas":case "specific_textareas":each(DOM.select('textarea'),function(elm){if(settings.editor_deselector && hasClass(elm,settings.editor_deselector)){return;}if(!settings.editor_selector||hasClass(elm,settings.editor_selector)){targets.push(elm);}});break;}return targets;};var provideResults=function(editors){result=editors;};var initEditors=function(){var initCount=0,editors=[],targets;var createEditor=function(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor);editor.on('init',function(){if(++initCount===targets.length){provideResults(editors);}});editor.targetElm=editor.targetElm||targetElm;editor.render();};DOM.unbind(window,'ready',initEditors);execCallback('onpageload');targets=DomQuery.unique(findTargets(settings));if(settings.types){each(settings.types,function(type){Tools.each(targets,function(elm){if(DOM.is(elm,type.selector)){createEditor(createId(elm),extend({},settings,type),elm);return false;}return true;});});return;}Tools.each(targets,function(elm){purgeDestroyedEditor(self.get(elm.id));});targets=Tools.grep(targets,function(elm){return !self.get(elm.id);});if(targets.length===0){provideResults([]);}else{each(targets,function(elm){if(isInvalidInlineTarget(settings,elm)){ErrorReporter.initError('Could not initialize inline editor on invalid inline target element',elm);}else{createEditor(createId(elm),settings,elm);}});}};self.settings=settings;DOM.bind(window,'ready',initEditors);return new Promise(function(resolve){if(result){resolve(result);}else{provideResults=function(editors){resolve(editors);};}});},get:function(id){if(arguments.length===0){return editors.slice(0);}else if(Type.isString(id)){return Arr.find(editors,function(editor){return editor.id===id;}).getOr(null);}else if(Type.isNumber(id)){return editors[id]? editors[id]:null;}else{return null;}},add:function(editor){var self=this,existingEditor;existingEditor=legacyEditors[editor.id];if(existingEditor===editor){return editor;}if(self.get(editor.id)===null){if(isValidLegacyKey(editor.id)){legacyEditors[editor.id]=editor;}legacyEditors.push(editor);editors.push(editor);}toggleGlobalEvents(true);self.activeEditor=editor;self.fire('AddEditor',{editor:editor});if(!beforeUnloadDelegate){beforeUnloadDelegate=function(){self.fire('BeforeUnload');};DOM.bind(window,'beforeunload',beforeUnloadDelegate);}return editor;},createEditor:function(id,settings){return this.add(new Editor(id,settings,this));},remove:function(selector){var self=this,i,editor;if(!selector){for(i=editors.length-1;i>=0;i--){self.remove(editors[i]);}return;}if(Type.isString(selector)){selector=selector.selector||selector;each(DOM.select(selector),function(elm){editor=self.get(elm.id);if(editor){self.remove(editor);}});return;}editor=selector;if(Type.isNull(self.get(editor.id))){return null;}if(removeEditorFromList(editor)){self.fire('RemoveEditor',{editor:editor});}if(editors.length===0){DOM.unbind(window,'beforeunload',beforeUnloadDelegate);}editor.remove();toggleGlobalEvents(editors.length>0);return editor;},execCommand:function(cmd,ui,value){var self=this,editor=self.get(value);switch(cmd){case "mceAddEditor":if(!self.get(value)){new Editor(value,self.settings,self).render();}return true;case "mceRemoveEditor":if(editor){editor.remove();}return true;case 'mceToggleEditor':if(!editor){self.execCommand('mceAddEditor',0,value);return true;}if(editor.isHidden()){editor.show();}else{editor.hide();}return true;}if(self.activeEditor){return self.activeEditor.execCommand(cmd,ui,value);}return false;},triggerSave:function(){each(editors,function(editor){editor.save();});},addI18n:function(code,items){I18n.add(code,items);},translate:function(text){return I18n.translate(text);},setActive:function(editor){var activeEditor=this.activeEditor;if(this.activeEditor !=editor){if(activeEditor){activeEditor.fire('deactivate',{relatedTarget:editor});}editor.fire('activate',{relatedTarget:activeEditor});}this.activeEditor=editor;}};extend(EditorManager,Observable);EditorManager.setup();return EditorManager;});define('tinymce.core.api.dom.RangeUtils',['ephox.katamari.api.Fun','tinymce.core.selection.CaretRangeFromPoint','tinymce.core.selection.NormalizeRange','tinymce.core.selection.RangeCompare','tinymce.core.selection.RangeNodes','tinymce.core.selection.RangeWalk','tinymce.core.selection.SplitRange'],function(Fun,CaretRangeFromPoint,NormalizeRange,RangeCompare,RangeNodes,RangeWalk,SplitRange){var RangeUtils=function(dom){var walk=function(rng,callback){return RangeWalk.walk(dom,rng,callback);};var split=SplitRange.split;var normalize=function(rng){return NormalizeRange.normalize(dom,rng).fold(Fun.constant(false),function(normalizedRng){rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset);rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset);return true;});};return{walk:walk,split:split,normalize:normalize};};RangeUtils.compareRanges=RangeCompare.isEq;RangeUtils.getCaretRangeFromPoint=CaretRangeFromPoint.fromPoint;RangeUtils.getSelectedNode=RangeNodes.getSelectedNode;RangeUtils.getNode=RangeNodes.getNode;return RangeUtils;});define('tinymce.core.geom.Rect',[],function(){"use strict";var min=Math.min,max=Math.max,round=Math.round;var relativePosition=function(rect,targetRect,rel){var x,y,w,h,targetW,targetH;x=targetRect.x;y=targetRect.y;w=rect.w;h=rect.h;targetW=targetRect.w;targetH=targetRect.h;rel=(rel||'').split('');if(rel[0]==='b'){y+=targetH;}if(rel[1]==='r'){x+=targetW;}if(rel[0]==='c'){y+=round(targetH / 2);}if(rel[1]==='c'){x+=round(targetW / 2);}if(rel[3]==='b'){y-=h;}if(rel[4]==='r'){x-=w;}if(rel[3]==='c'){y-=round(h / 2);}if(rel[4]==='c'){x-=round(w / 2);}return create(x,y,w,h);};var findBestRelativePosition=function(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++){pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x && pos.x+pos.w<=constrainRect.w+constrainRect.x && pos.y>=constrainRect.y && pos.y+pos.h<=constrainRect.h+constrainRect.y){return rels[i];}}return null;};var inflate=function(rect,w,h){return create(rect.x-w,rect.y-h,rect.w+w*2,rect.h+h*2);};var intersect=function(rect,cropRect){var x1,y1,x2,y2;x1=max(rect.x,cropRect.x);y1=max(rect.y,cropRect.y);x2=min(rect.x+rect.w,cropRect.x+cropRect.w);y2=min(rect.y+rect.h,cropRect.y+cropRect.h);if(x2-x1<0||y2-y1<0){return null;}return create(x1,y1,x2-x1,y2-y1);};var clamp=function(rect,clampRect,fixedSize){var underflowX1,underflowY1,overflowX2,overflowY2,x1,y1,x2,y2,cx2,cy2;x1=rect.x;y1=rect.y;x2=rect.x+rect.w;y2=rect.y+rect.h;cx2=clampRect.x+clampRect.w;cy2=clampRect.y+clampRect.h;underflowX1=max(0,clampRect.x-x1);underflowY1=max(0,clampRect.y-y1);overflowX2=max(0,x2-cx2);overflowY2=max(0,y2-cy2);x1+=underflowX1;y1+=underflowY1;if(fixedSize){x2+=underflowX1;y2+=underflowY1;x1-=overflowX2;y1-=overflowY2;}x2-=overflowX2;y2-=overflowY2;return create(x1,y1,x2-x1,y2-y1);};var create=function(x,y,w,h){return{x:x,y:y,w:w,h:h};};var fromClientRect=function(clientRect){return create(clientRect.left,clientRect.top,clientRect.width,clientRect.height);};return{inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp,create:create,fromClientRect:fromClientRect};});define('tinymce.core.ui.Factory',[],function(){"use strict";var types={};return{add:function(type,typeClass){types[type.toLowerCase()]=typeClass;},has:function(type){return !!types[type.toLowerCase()];},get:function(type){var lctype=type.toLowerCase();var controlType=types.hasOwnProperty(lctype)? types[lctype]:null;if(controlType===null){throw new Error("Could not find module for type: "+type);}return controlType;},create:function(type,settings){var ControlType;if(typeof type=='string'){settings=settings||{};settings.type=type;}else{settings=type;type=settings.type;}type=type.toLowerCase();ControlType=types[type];if(!ControlType){throw new Error("Could not find control by type: "+type);}ControlType=new ControlType(settings);ControlType.type=type;return ControlType;}};});define('tinymce.core.util.Class',["tinymce.core.util.Tools"],function(Tools){var each=Tools.each,extend=Tools.extend;var extendClass,initializing;var Class=function(){};Class.extend=extendClass=function(prop){var self=this,_super=self.prototype,prototype,name,member;var Class=function(){var i,mixins,mixin,self=this;if(!initializing){if(self.init){self.init.apply(self,arguments);}mixins=self.Mixins;if(mixins){i=mixins.length;while(i--){mixin=mixins[i];if(mixin.init){mixin.init.apply(self,arguments);}}}}};var dummy=function(){return this;};var createMethod=function(name,fn){return function(){var self=this,tmp=self._super,ret;self._super=_super[name];ret=fn.apply(self,arguments);self._super=tmp;return ret;};};initializing=true;prototype=new self();initializing=false;if(prop.Mixins){each(prop.Mixins,function(mixin){for(var name in mixin){if(name !=="init"){prop[name]=mixin[name];}}});if(_super.Mixins){prop.Mixins=_super.Mixins.concat(prop.Mixins);}}if(prop.Methods){each(prop.Methods.split(','),function(name){prop[name]=dummy;});}if(prop.Properties){each(prop.Properties.split(','),function(name){var fieldName='_'+name;prop[name]=function(value){var self=this,undef;if(value !==undef){self[fieldName]=value;return self;}return self[fieldName];};});}if(prop.Statics){each(prop.Statics,function(func,name){Class[name]=func;});}if(prop.Defaults && _super.Defaults){prop.Defaults=extend({},_super.Defaults,prop.Defaults);}for(name in prop){member=prop[name];if(typeof member=="function" && _super[name]){prototype[name]=createMethod(name,member);}else{prototype[name]=member;}}Class.prototype=prototype;Class.constructor=Class;Class.extend=extendClass;return Class;};return Class;});define('tinymce.core.util.Color',[],function(){var min=Math.min,max=Math.max,round=Math.round;var Color=function(value){var self=this,r=0,g=0,b=0;var rgb2hsv=function(r,g,b){var h,s,v,d,minRGB,maxRGB;h=0;s=0;v=0;r=r / 255;g=g / 255;b=b / 255;minRGB=min(r,min(g,b));maxRGB=max(r,max(g,b));if(minRGB==maxRGB){v=minRGB;return{h:0,s:0,v:v*100};}d=(r==minRGB)? g-b :((b==minRGB)? r-g :b-r);h=(r==minRGB)? 3 :((b==minRGB)? 1 :5);h=60*(h-d / (maxRGB-minRGB));s=(maxRGB-minRGB)/ maxRGB;v=maxRGB;return{h:round(h),s:round(s*100),v:round(v*100)};};var hsvToRgb=function(hue,saturation,brightness){var side,chroma,x,match;hue=(parseInt(hue,10)||0)% 360;saturation=parseInt(saturation,10)/ 100;brightness=parseInt(brightness,10)/ 100;saturation=max(0,min(saturation,1));brightness=max(0,min(brightness,1));if(saturation===0){r=g=b=round(255*brightness);return;}side=hue / 60;chroma=brightness*saturation;x=chroma*(1-Math.abs(side% 2-1));match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma;g=x;b=0;break;case 1:r=x;g=chroma;b=0;break;case 2:r=0;g=chroma;b=x;break;case 3:r=0;g=x;b=chroma;break;case 4:r=x;g=0;b=chroma;break;case 5:r=chroma;g=0;b=x;break;default:r=g=b=0;}r=round(255*(r+match));g=round(255*(g+match));b=round(255*(b+match));};var toHex=function(){var hex=function(val){val=parseInt(val,10).toString(16);return val.length>1 ? val :'0'+val;};return '#'+hex(r)+hex(g)+hex(b);};var toRgb=function(){return{r:r,g:g,b:b};};var toHsv=function(){return rgb2hsv(r,g,b);};var parse=function(value){var matches;if(typeof value=='object'){if("r" in value){r=value.r;g=value.g;b=value.b;}else if("v" in value){hsvToRgb(value.h,value.s,value.v);}}else{if((matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))){r=parseInt(matches[1],10);g=parseInt(matches[2],10);b=parseInt(matches[3],10);}else if((matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))){r=parseInt(matches[1],16);g=parseInt(matches[2],16);b=parseInt(matches[3],16);}else if((matches=/#([0-F])([0-F])([0-F])/gi.exec(value))){r=parseInt(matches[1]+matches[1],16);g=parseInt(matches[2]+matches[2],16);b=parseInt(matches[3]+matches[3],16);}}r=r<0 ? 0 :(r>255 ? 255 :r);g=g<0 ? 0 :(g>255 ? 255 :g);b=b<0 ? 0 :(b>255 ? 255 :b);return self;};if(value){parse(value);}self.toRgb=toRgb;self.toHsv=toHsv;self.toHex=toHex;self.parse=parse;};return Color;});define('tinymce.core.util.JSON',['global!window'],function(window){var serialize=function(o,quote){var i,v,t,name;quote=quote||'"';if(o===null){return 'null';}t=typeof o;if(t=='string'){v='\bb\tt\nn\ff\rr\""\'\'\\\\';return quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){if(quote==='"' && a==="'"){return a;}i=v.indexOf(b);if(i+1){return '\\'+v.charAt(i+1);}a=b.charCodeAt().toString(16);return '\\u'+'0000'.substring(a.length)+a;})+quote;}if(t=='object'){if(o.hasOwnProperty && Object.prototype.toString.call(o)==='[object Array]'){for(i=0,v='[';i<o.length;i++){v+=(i>0 ? ',' :'')+serialize(o[i],quote);}return v+']';}v='{';for(name in o){if(o.hasOwnProperty(name)){v+=typeof o[name]!='function' ?(v.length>1 ? ','+quote :quote)+name+quote+':'+serialize(o[name],quote):'';}}return v+'}';}return ''+o;};return{serialize:serialize,parse:function(text){try{return window[String.fromCharCode(101)+'val']('('+text+')');}catch(ex){}}};});define('tinymce.core.util.JSONP',["tinymce.core.dom.DOMUtils"],function(DOMUtils){return{callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=settings.count !==undefined ? settings.count :self.count;var id='tinymce_jsonp_'+count;self.callbacks[count]=function(json){dom.remove(id);delete self.callbacks[count];settings.callback(json);};dom.add(dom.doc.body,'script',{id:id,src:settings.url,type:'text/javascript'});self.count++;}};});define('tinymce.core.util.XHR',['ephox.sand.api.XMLHttpRequest','global!setTimeout','tinymce.core.util.Observable','tinymce.core.util.Tools'],function(XMLHttpRequest,setTimeout,Observable,Tools){var XHR={send:function(settings){var xhr,count=0;var ready=function(){if(!settings.async||xhr.readyState==4||count++>10000){if(settings.success && count<10000 && xhr.status==200){settings.success.call(settings.success_scope,''+xhr.responseText,xhr,settings);}else if(settings.error){settings.error.call(settings.error_scope,count>10000 ? 'TIMED_OUT' :'GENERAL',xhr,settings);}xhr=null;}else{setTimeout(ready,10);}};settings.scope=settings.scope||this;settings.success_scope=settings.success_scope||settings.scope;settings.error_scope=settings.error_scope||settings.scope;settings.async=settings.async===false ? false :true;settings.data=settings.data||'';XHR.fire('beforeInitialize',{settings:settings});xhr=new XMLHttpRequest();if(xhr){if(xhr.overrideMimeType){xhr.overrideMimeType(settings.content_type);}xhr.open(settings.type||(settings.data ? 'POST' :'GET'),settings.url,settings.async);if(settings.crossDomain){xhr.withCredentials=true;}if(settings.content_type){xhr.setRequestHeader('Content-Type',settings.content_type);}if(settings.requestheaders){Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value);});}xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr=XHR.fire('beforeSend',{xhr:xhr,settings:settings}).xhr;xhr.send(settings.data);if(!settings.async){return ready();}setTimeout(ready,10);}}};Tools.extend(XHR,Observable);return XHR;});define('tinymce.core.util.JSONRequest',["tinymce.core.util.JSON","tinymce.core.util.XHR","tinymce.core.util.Tools"],function(JSON,XHR,Tools){var extend=Tools.extend;var JSONRequest=function(settings){this.settings=extend({},settings);this.count=0;};JSONRequest.sendRPC=function(o){return new JSONRequest().send(o);};JSONRequest.prototype={send:function(args){var ecb=args.error,scb=args.success;args=extend(this.settings,args);args.success=function(c,x){c=JSON.parse(c);if(typeof c=='undefined'){c={error:'JSON Parse error.'};}if(c.error){ecb.call(args.error_scope||args.scope,c.error,x);}else{scb.call(args.success_scope||args.scope,c.result);}};args.error=function(ty,x){if(ecb){ecb.call(args.error_scope||args.scope,ty,x);}};args.data=JSON.serialize({id:args.id||'c'+(this.count++),method:args.method,params:args.params});args.content_type='application/json';XHR.send(args);}};return JSONRequest;});define('tinymce.core.util.LocalStorage',['global!document','global!window'],function(document,window){var LocalStorage,storageElm,items,keys,userDataKey,hasOldIEDataSupport;try{if(window.localStorage){return window.localStorage;}}catch(ex){}userDataKey="tinymce";storageElm=document.documentElement;hasOldIEDataSupport=!!storageElm.addBehavior;if(hasOldIEDataSupport){storageElm.addBehavior('#default#userData');}var updateKeys=function(){keys=[];for(var key in items){keys.push(key);}LocalStorage.length=keys.length;};var load=function(){var key,data,value,pos=0;items={};if(!hasOldIEDataSupport){return;}var next=function(end){var value,nextPos;nextPos=end !==undefined ? pos+end :data.indexOf(',',pos);if(nextPos===-1||nextPos>data.length){return null;}value=data.substring(pos,nextPos);pos=nextPos+1;return value;};storageElm.load(userDataKey);data=storageElm.getAttribute(userDataKey)||'';do{var offset=next();if(offset===null){break;}key=next(parseInt(offset,32)||0);if(key !==null){offset=next();if(offset===null){break;}value=next(parseInt(offset,32)||0);if(key){items[key]=value;}}}while(key !==null);updateKeys();};var save=function(){var value,data='';if(!hasOldIEDataSupport){return;}for(var key in items){value=items[key];data+=(data ? ',' :'')+key.length.toString(32)+','+key+','+value.length.toString(32)+','+value;}storageElm.setAttribute(userDataKey,data);try{storageElm.save(userDataKey);}catch(ex){}updateKeys();};LocalStorage={key:function(index){return keys[index];},getItem:function(key){return key in items ? items[key]:null;},setItem:function(key,value){items[key]=""+value;save();},removeItem:function(key){delete items[key];save();},clear:function(){items={};save();}};load();return LocalStorage;});define('tinymce.core.api.Tinymce',['tinymce.core.AddOnManager','tinymce.core.Editor','tinymce.core.EditorCommands','tinymce.core.EditorManager','tinymce.core.EditorObservable','tinymce.core.Env','tinymce.core.Shortcuts','tinymce.core.UndoManager','tinymce.core.api.FocusManager','tinymce.core.api.Formatter','tinymce.core.api.NotificationManager','tinymce.core.api.WindowManager','tinymce.core.api.dom.BookmarkManager','tinymce.core.api.dom.RangeUtils','tinymce.core.api.dom.Serializer','tinymce.core.dom.ControlSelection','tinymce.core.dom.DOMUtils','tinymce.core.dom.DomQuery','tinymce.core.dom.EventUtils','tinymce.core.dom.ScriptLoader','tinymce.core.dom.Selection','tinymce.core.dom.Sizzle','tinymce.core.dom.TreeWalker','tinymce.core.geom.Rect','tinymce.core.html.DomParser','tinymce.core.html.Entities','tinymce.core.html.Node','tinymce.core.html.SaxParser','tinymce.core.html.Schema','tinymce.core.html.Serializer','tinymce.core.html.Styles','tinymce.core.html.Writer','tinymce.core.ui.Factory','tinymce.core.util.Class','tinymce.core.util.Color','tinymce.core.util.Delay','tinymce.core.util.EventDispatcher','tinymce.core.util.I18n','tinymce.core.util.JSON','tinymce.core.util.JSONP','tinymce.core.util.JSONRequest','tinymce.core.util.LocalStorage','tinymce.core.util.Observable','tinymce.core.util.Promise','tinymce.core.util.Tools','tinymce.core.util.URI','tinymce.core.util.VK','tinymce.core.util.XHR'],function(AddOnManager,Editor,EditorCommands,EditorManager,EditorObservable,Env,Shortcuts,UndoManager,FocusManager,Formatter,NotificationManager,WindowManager,BookmarkManager,RangeUtils,DomSerializer,ControlSelection,DOMUtils,DomQuery,EventUtils,ScriptLoader,Selection,Sizzle,TreeWalker,Rect,DomParser,Entities,Node,SaxParser,Schema,HtmlSerializer,Styles,Writer,Factory,Class,Color,Delay,EventDispatcher,I18n,JSON,JSONP,JSONRequest,LocalStorage,Observable,Promise,Tools,URI,VK,XHR){var tinymce=EditorManager;var publicApi={geom:{Rect:Rect},util:{Promise:Promise,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,XHR:XHR,JSON:JSON,JSONRequest:JSONRequest,JSONP:JSONP,LocalStorage:LocalStorage,Color:Color},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:TreeWalker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:Selection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:Node,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},ui:{Factory:Factory},Env:Env,AddOnManager:AddOnManager,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:AddOnManager.PluginManager,ThemeManager:AddOnManager.ThemeManager,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac};tinymce=Tools.extend(tinymce,publicApi);return tinymce;});define('tinymce.core.api.Main',['ephox.katamari.api.Fun','global!window','tinymce.core.api.Tinymce'],function(Fun,window,Tinymce){var context=this||window;var exportToModuleLoaders=function(tinymce){if(typeof context.define==="function" && !context.define.amd){context.define("ephox/tinymce",[],Fun.constant(tinymce));context.define("tinymce.core.EditorManager",[],Fun.constant(tinymce));}if(typeof module==='object'){module.exports=tinymce;}};var exportToWindowGlobal=function(tinymce){window.tinymce=tinymce;window.tinyMCE=tinymce;};return function(){exportToWindowGlobal(Tinymce);exportToModuleLoaders(Tinymce);return Tinymce;};});dem('tinymce.core.api.Main')();})();"uses sctrict";(function(){function __init(){if(document.body.firstChild !=this.o){document.body.insertBefore(this.o,document.body.firstChild);}else{console.debug("is first the child");}$igk(document.body).addClass('igk-dsg-mode');var progress;igk.winui.dragdrop.init(document.body,{uri:this.getAttribute('dropuri'),supported:'text/html,image/jpeg,image/png,video/mp4',async:true,start:function(){if(!progress){progress=igk.createNode("div");progress.addClass("igk-winui-track");progress.add("div").addClass("track");document.body.insertBefore(progress.o,document.body.firstChild);progress.init();}else{document.body.insertBefore(progress.o,document.body.firstChild);}progress.select('.track').setCss({width:"0%"});},update:null,done:function(evt){progress.remove();},progress:function(i){progress.select('.track').setCss({width:Math.round((i.loaded/i.total)*100,2)+"%"});},drop:function(evt){igk.winui.dragdrop.fn.update_file.apply(this,arguments);},enter:null,over:null,leave:null });};var _NS=0;var m_prop=0;igk.system.createNS("igk.winui.designer",{inithierarchi:function(q){if(!m_prop||typeof(q)=='undefined'){console.error("can't init hierachy");return;}igk.ajx.post(m_prop.uri+'getHierachi',null,function(xhr){if(this.isReady()){var p=$igk(q.parentNode);p.setHtml(xhr.responseText);p.init();p.qselect("ul[role='alignment']").each_all(function(){this.qselect('a[role]').each_all(function(){var r=this.getAttribute('role');this.reg_event("click",function(evt){igk.evts.stop(evt);if(_NS.align)_NS.align(r);});});});p.qselect("ul[role='font']").each_all(function(){this.qselect('a[role]').each_all(function(){var r=this.getAttribute('role');this.reg_event("click",function(evt){igk.evts.stop(evt);if(_NS.font)_NS.font(r);});});});p.qselect("a[role='store']").each_all(function(){this.reg_event('click',function(evt){igk.evts.stop(evt);igk.ajx.post(this.getAttribute('href'),igk.winui.designer.getDesignerPostData(),function(){});});});}});},init:function(q,prop){m_prop=prop;$igk(q).remove();}});_NS=igk.winui.designer;igk.winui.initClassControl("igk-winui-designer",__init);igk.ready(function(){});(function(){var rects=[];var rs_mode=0;var _vdirs=['top','left','right','bottom'];var _CSS={};function __initRect(){var H=0;var W=0;var L=0;var T=0;var n=null;var q=this;var sc=0;var ack=0;var sbutton={cssDef:{left:q.getComputedStyle('left'),top:q.getComputedStyle('top'),right:q.getComputedStyle('right'),bottom:q.getComputedStyle('bottom'),fontSize:q.getComputedStyle('fontSize'),textAlign:q.getComputedStyle('textAlign'),width:q.getComputedStyle('width'),height:q.getComputedStyle('height')}};var rdu;function _update(){switch(sbutton.f){case 4:sbutton.cssDef.height=(H+sbutton.outy)+"px";break;case 1:if(sbutton.pos=="relative"){sbutton.cssDef.top=(T+sbutton.outy)+"px";}break;case 2:if(sbutton.pos=="relative"){sbutton.cssDef.left=(L+sbutton.outx)+"px";}break;case 3:sbutton.cssDef.width=(W+sbutton.outx)+"px";break;}q.setCss(sbutton.cssDef);_setdu(_style_def());};function _setdu(s){if(!rdu && !sbutton.du){sbutton.du=$igk("#du").getItemAt(0);rdu=1;}if(sbutton.du){sbutton.du.setHtml(s);}};function _reset(){q.setCss({left:'auto',top:'auto',width:'auto',height:'auto' });};function _align(t){sbutton.cssDef.textAlign=t;q.setCss(sbutton.cssDef);if(t=='justify'){q.setCss({"textJustify":'none'});}_setdu(_style_def());};function _fonts(t){sbutton.cssDef.fontSize=t;q.setCss(sbutton.cssDef);_setdu(_style_def());};function _style_def(){var o="";o=q.getCssSelector()+"{";o+=q.o.style["cssText"];o+="}";return o;}function _designerPostData(){var mt=igk.web.getcookies("dsg/mt");var m='global';q.setCss(sbutton.cssDef);if(mt==1){m=igk.css.getMediaType();}if(!(m in _CSS)){_CSS[m]={};}_CSS[m][q.getCssSelector()]=q.o.style["cssText"];return "q="+igk.utils.Base64.encode(JSON.stringify(_CSS));}igk.winui.designer.reset=_reset;igk.winui.designer.align=_align;igk.winui.designer.font=_fonts;igk.winui.designer.getstyledef=_style_def;igk.winui.designer.getDesignerPostData=_designerPostData;function _ms_down(evt){var n=$igk(evt.target);if(igk.winui.mouseButton(evt)==igk.winui.mouseButton.Left){H=igk.getNumber(q.getComputedStyle("height"));W=igk.getNumber(q.getComputedStyle("width"));T=igk.getNumber(q.getComputedStyle("top"));L=igk.getNumber(q.getComputedStyle("left"));sc=n;igk.winui.mouseCapture.setCapture(sc);ack=1;sbutton.f=n.fn.tag;sbutton.x=evt.screenX;sbutton.y=evt.screenY;sbutton.outx=0;sbutton.outy=0;sbutton.pos=q.getComputedStyle("position");evt.preventDefault();evt.stopPropagation();}};function _ms_move(evt){if(ack){var n=$igk(evt.target);sbutton.outx=-sbutton.x+evt.screenX;sbutton.outy=-sbutton.y+evt.screenY;_update();evt.preventDefault();evt.stopPropagation();}};function _ms_up(evt){_update();igk.winui.mouseCapture.releaseCapture(sc);ack=0;evt.preventDefault();evt.stopPropagation();};for(var i=0;i<_vdirs.length;i++){n=this.add('div').addClass("snippet "+_vdirs[i]).reg_event("mousedown",_ms_down).reg_event("mousemove",_ms_move).reg_event("mouseup",_ms_up);n.fn.tag=i+1;}};igk.winui.initClassControl("igk-dsg-rect",__initRect);})();})();